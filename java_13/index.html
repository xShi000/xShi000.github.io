<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <title>极简Java十三：JavaWeb - 及时当勉励，岁月不待人！@iNuo</title>
    
    <meta name="description" content="第一章  本章内容  XML语法 XML约束 XML解析   什么是XML？可扩展标记语言！
  语法和HTML类似
  标签可由用户自定义
  用来存储数据
  用来传递数据
  用来做配置文件
  1.1 XML语法 XML文档声明：   文档声明必须以&lt;?xml开头，以?&gt;结束！
  文档声明必须从文档的第0行第0列开始！
  文档声明属性：
a) version：指定xml文档版本（必须）
b) encoding：文档编码（可选默认utf-8）
  &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; 元素：   元素是XML文档组成最重要的部分
  普通元素由开始标签，元素体，结束标签组成
  元素命名：
a)区分大小写
b)不能使用空格，不能使用冒号:
  必须有根元素
  &lt;Student&gt; &lt;name&gt;&lt;/name&gt; &lt;age&gt;&lt;/age&gt; &lt;sex&gt;&lt;/sex&gt; &lt;/student&gt; 属性：   属性是元素的一部分，必须出现在元素开始标签">
    <meta name="author" content="">
    
    <link href="https://xshi000.github.io/an-old-hope.min.css" rel="stylesheet">
    <link href="https://xshi000.github.io/style.css" rel="stylesheet">
    <link href="https://xshi000.github.io/custom.css" rel="stylesheet">
    
    <link rel="apple-touch-icon" href="https://xshi000.github.io/apple-touch-icon.png">
    <link rel="icon" href="https://xshi000.github.io/favicon.ico">
    <meta name="generator" content="Hugo 0.65.3" />
    
    
    
    <script>
      function setTheme() {
        const time = new Date();

        const prev = localStorage.getItem('date');
        const date = String(time.getMonth() + 1) + '.' + String(time.getDate());

        const now = time.getTime();
        let sunrise;
        let sunset;

        function setBodyClass() {
          if (now > sunrise && now < sunset) return;
          document.body.classList.add('dark');
        }

        if (date !== prev) {
          fetch('https://api.ipgeolocation.io/astronomy?apiKey=5ed37d85103e4defa5df4c5298ed5215')
            .then(res => res.json())
            .then(data => {
              sunrise = data.sunrise.split(':').map(Number);
              sunset = data.sunset.split(':').map(Number);
            })
            .catch(() => {
              sunrise = [7, 0];
              sunset = [19, 0];
            })
            .finally(() => {
              sunrise = time.setHours(sunrise[0], sunrise[1], 0);
              sunset = time.setHours(sunset[0], sunset[1], 0);
              setBodyClass();
              localStorage.setItem('sunrise', sunrise);
              localStorage.setItem('sunset', sunset);
            });
          localStorage.setItem('date', date);
        } else {
          sunrise = Number(localStorage.getItem('sunrise'));
          sunset = Number(localStorage.getItem('sunset'));
          setBodyClass();
        }
      }
    </script>
  </head>
  <body class="single">
    <script>
      setTheme();
    </script>
    <header class="header">
      <nav class="nav">
        <p class="logo"><a href="https://xshi000.github.io/">及时当勉励，岁月不待人！@iNuo</a></p>
      </nav>
    </header>
    <main class="main">


<article class="post-single">
  <header class="post-header">
    <h1 class="post-title">极简Java十三：JavaWeb</h1>
    <div class="post-meta">February 4, 2021</div>
  </header>
  <div class="post-content"><hr>
<h3 id="第一章">第一章</h3>
<hr>
<h5 id="本章内容">本章内容</h5>
<ul>
<li>XML语法</li>
<li>XML约束</li>
<li>XML解析</li>
</ul>
<hr>
<p>什么是XML？可扩展标记语言！</p>
<ul>
<li>
<p>语法和HTML类似</p>
</li>
<li>
<p>标签可由用户自定义</p>
</li>
<li>
<p>用来存储数据</p>
</li>
<li>
<p>用来传递数据</p>
</li>
<li>
<p>用来做配置文件</p>
</li>
</ul>
<h4 id="11-xml语法">1.1 XML语法</h4>
<h5 id="xml文档声明">XML文档声明：</h5>
<ol>
<li>
<p>文档声明必须以&lt;?xml开头，以?&gt;结束！</p>
</li>
<li>
<p>文档声明必须从文档的第0行第0列开始！</p>
</li>
<li>
<p>文档声明属性：</p>
<p>a) version：指定xml文档版本（必须）</p>
<p>b) encoding：文档编码（可选默认utf-8）</p>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</code></pre></div><h5 id="元素">元素：</h5>
<ol>
<li>
<p>元素是XML文档组成最重要的部分</p>
</li>
<li>
<p>普通元素由开始标签，元素体，结束标签组成</p>
</li>
<li>
<p>元素命名：</p>
<p>a)区分大小写</p>
<p>b)不能使用空格，不能使用冒号:</p>
</li>
<li>
<p>必须有根元素</p>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;Student&gt;</span>
    <span style="color:#f92672">&lt;name&gt;&lt;/name&gt;</span>
    <span style="color:#f92672">&lt;age&gt;&lt;/age&gt;</span>
    <span style="color:#f92672">&lt;sex&gt;&lt;/sex&gt;</span>
<span style="color:#f92672">&lt;/student&gt;</span>
</code></pre></div><h5 id="属性">属性：</h5>
<ol>
<li>
<p>属性是元素的一部分，必须出现在元素开始标签</p>
</li>
<li>
<p>定义格式：属性名=属性值，属性值用‘ 单引号 ’或” 双引号 ”</p>
</li>
<li>
<p>一个元素可以有多个属性，但不能同名</p>
</li>
<li>
<p>属性名必须以字母开头不能是空格，冒号等特殊字符</p>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;Student</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;p0001&#34;</span><span style="color:#f92672">&gt;</span>
</code></pre></div><h5 id="注释">注释：</h5>
<p>Xml的注释与html相同都是&lt;!—开头&gt;结束</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!--注释--&gt;</span>
</code></pre></div><h5 id="转义字符">转义字符：</h5>
<p>XML中的转义字符与HTML一样。因为很多符号已经被XML文档结构所使用，所以在元素体或属性值中想使用这些符号就必须使用转义字符，例如：“&lt;”、“&gt;”、“’”、“””、“&amp;”。</p>
<p><img src="/img/image-20201228100725854.png" alt="image-20201228100725854"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
<span style="color:#f92672">&lt;student</span> <span style="color:#a6e22e">number=</span><span style="color:#e6db74">&#34;p_0001&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;weight&gt;</span>&amp;lt;60kg<span style="color:#f92672">&lt;/weight&gt;</span>
    <span style="color:#f92672">&lt;height&gt;</span>&amp;gt;170cm<span style="color:#f92672">&lt;/height&gt;</span>
<span style="color:#f92672">&lt;/student&gt;</span>
</code></pre></div><h5 id="cdata区">CDATA区：</h5>
<p>转义字符的另一种使用方式，直接将其放入CDATA区即可！XML文件可在浏览器中浏览！！</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;![CDATA[ ]]&gt;</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
<span style="color:#f92672">&lt;student</span> <span style="color:#a6e22e">number=</span><span style="color:#e6db74">&#34;p_0001&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;name&gt;</span>张三<span style="color:#f92672">&lt;/name&gt;</span>
    <span style="color:#f92672">&lt;age&gt;</span>23<span style="color:#f92672">&lt;/age&gt;</span>
    <span style="color:#f92672">&lt;sex&gt;</span>男<span style="color:#f92672">&lt;/sex&gt;</span>
    <span style="color:#f92672">&lt;weight&gt;</span>&amp;lt;60kg<span style="color:#f92672">&lt;/weight&gt;</span>
    <span style="color:#f92672">&lt;height&gt;</span>&amp;gt;170cm<span style="color:#f92672">&lt;/height&gt;</span>
    <span style="color:#75715e">&lt;!--CDATA区--&gt;</span>
    <span style="color:#f92672">&lt;weight&gt;</span><span style="color:#75715e">&lt;![CDATA[&lt;]]&gt;</span>60kg<span style="color:#f92672">&lt;/weight&gt;</span>
    <span style="color:#f92672">&lt;height&gt;</span><span style="color:#75715e">&lt;![CDATA[&gt;]]&gt;</span>170cm<span style="color:#f92672">&lt;/height&gt;</span>
<span style="color:#f92672">&lt;/student&gt;</span>
</code></pre></div><h4 id="12-xml约束">1.2 XML约束</h4>
<p>规定xml文档的书写规则</p>
<p>要求：</p>
<ol>
<li>
<p>能够在xml中引入约束文档</p>
</li>
<li>
<p>能够简单的读懂约束文档。</p>
</li>
</ol>
<p>分类：</p>
<ol>
<li>
<p>DTD：一种简单的约束技术</p>
</li>
<li>
<p>Schema：一种复杂的约束技术</p>
</li>
</ol>
<h5 id="dtd约束">DTD约束</h5>
<p>文档声明</p>
<ol>
<li>
<p>内部dtd：将约束规则定义在xml文档中</p>
</li>
<li>
<p>外部dtd：将约束的规则定义在外部的dtd文件中</p>
</li>
</ol>
<ul>
<li>
<p>本地：&lt;!DOCTYPE 根标签名 SYSTEM &ldquo;dtd文件的位置&quot;&gt;</p>
</li>
<li>
<p>网络：&lt;!DOCTYPE 根标签名 PUBLIC &ldquo;dtd文件名字&rdquo; &ldquo;dtd文件的位置URL&quot;&gt;</p>
</li>
</ul>
<p>内部dtd:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
<span style="color:#75715e">&lt;!DOCTYPE students [
</span><span style="color:#75715e">        &lt;!ELEMENT students (student+) &gt;</span>
        <span style="color:#75715e">&lt;!ELEMENT student (name,age,sex)&gt;</span>
        <span style="color:#75715e">&lt;!ELEMENT name (#PCDATA)&gt;</span>
        <span style="color:#75715e">&lt;!ELEMENT age (#PCDATA)&gt;</span>
        <span style="color:#75715e">&lt;!ELEMENT sex (#PCDATA)&gt;</span>
        <span style="color:#75715e">&lt;!ATTLIST student number ID #REQUIRED&gt;</span>
        ]&gt;

<span style="color:#f92672">&lt;students&gt;</span>
    <span style="color:#f92672">&lt;student</span> <span style="color:#a6e22e">number=</span><span style="color:#e6db74">&#34;P_0001&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;name&gt;</span>张胜男<span style="color:#f92672">&lt;/name&gt;</span>
        <span style="color:#f92672">&lt;age&gt;</span>43<span style="color:#f92672">&lt;/age&gt;</span>
        <span style="color:#f92672">&lt;sex&gt;</span>女<span style="color:#f92672">&lt;/sex&gt;</span>
    <span style="color:#f92672">&lt;/student&gt;</span>
    <span style="color:#f92672">&lt;student</span> <span style="color:#a6e22e">number=</span><span style="color:#e6db74">&#34;P_0002&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;name&gt;</span>李四<span style="color:#f92672">&lt;/name&gt;</span>
        <span style="color:#f92672">&lt;age&gt;</span>24<span style="color:#f92672">&lt;/age&gt;</span>
        <span style="color:#f92672">&lt;sex&gt;</span>男<span style="color:#f92672">&lt;/sex&gt;</span>
    <span style="color:#f92672">&lt;/student&gt;</span>
<span style="color:#f92672">&lt;/students&gt;</span>
</code></pre></div><p>外部dtd：</p>
<p>b_student.dtd</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"> <span style="color:#75715e">&lt;!ELEMENT students (student+) &gt;</span>
    <span style="color:#75715e">&lt;!ELEMENT student (name,age,sex)&gt;</span>
    <span style="color:#75715e">&lt;!ELEMENT name (#PCDATA)&gt;</span>
    <span style="color:#75715e">&lt;!ELEMENT age (#PCDATA)&gt;</span>
    <span style="color:#75715e">&lt;!ELEMENT sex (#PCDATA)&gt;</span>
    <span style="color:#75715e">&lt;!ATTLIST student number ID #REQUIRED&gt;</span>
</code></pre></div><p>b_student.xml</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
<span style="color:#75715e">&lt;!DOCTYPE students SYSTEM &#34;b_student.dtd&#34;&gt;</span>

<span style="color:#f92672">&lt;students&gt;</span>
    <span style="color:#f92672">&lt;student</span> <span style="color:#a6e22e">number=</span><span style="color:#e6db74">&#34;P_0001&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;name&gt;</span>张胜男<span style="color:#f92672">&lt;/name&gt;</span>
        <span style="color:#f92672">&lt;age&gt;</span>43<span style="color:#f92672">&lt;/age&gt;</span>
        <span style="color:#f92672">&lt;sex&gt;</span>女<span style="color:#f92672">&lt;/sex&gt;</span>
    <span style="color:#f92672">&lt;/student&gt;</span>
    <span style="color:#f92672">&lt;student</span> <span style="color:#a6e22e">number=</span><span style="color:#e6db74">&#34;P_0002&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;name&gt;</span>李四<span style="color:#f92672">&lt;/name&gt;</span>
        <span style="color:#f92672">&lt;age&gt;</span>24<span style="color:#f92672">&lt;/age&gt;</span>
        <span style="color:#f92672">&lt;sex&gt;</span>男<span style="color:#f92672">&lt;/sex&gt;</span>
    <span style="color:#f92672">&lt;/student&gt;</span>
<span style="color:#f92672">&lt;/students&gt;</span>
</code></pre></div><h5 id="schema约束">Schema约束</h5>
<ul>
<li>
<p>比DTD强大，是DTD 替代者</p>
</li>
<li>
<p>也是XML文档，但扩展名为xsd</p>
</li>
<li>
<p>可以定义元素的内容规则</p>
</li>
</ul>
<p>Schema引入</p>
<ol>
<li>
<p>填写xml文档的根元素</p>
</li>
<li>
<p>引入xsi前缀.   xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&rdquo;</p>
</li>
<li>
<p>引入xsd文件命名空间.   xsi:schemaLocation=&quot;http://www.xh.cn/xml student.xsd&rdquo;</p>
</li>
<li>
<p>为每一个xsd约束声明一个前缀,作为标识   xmlns=&quot;http://www.xh.cn/xml&rdquo;</p>
</li>
</ol>
<p>案例演示：</p>
<p>Schema约束文件：student.xsd</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34;?&gt;</span>
<span style="color:#f92672">&lt;xsd:schema</span> <span style="color:#a6e22e">xmlns=</span><span style="color:#e6db74">&#34;http://www.xh.cn/xml&#34;</span>
        <span style="color:#a6e22e">xmlns:xsd=</span><span style="color:#e6db74">&#34;http://www.w3.org/2001/XMLSchema&#34;</span>
        <span style="color:#a6e22e">targetNamespace=</span><span style="color:#e6db74">&#34;http://www.xh.cn/xml&#34;</span> <span style="color:#a6e22e">elementFormDefault=</span><span style="color:#e6db74">&#34;qualified&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;xsd:element</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;students&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;studentsType&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;xsd:complexType</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;studentsType&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;xsd:sequence&gt;</span>
            <span style="color:#f92672">&lt;xsd:element</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;student&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;studentType&#34;</span> <span style="color:#a6e22e">minOccurs=</span><span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#a6e22e">maxOccurs=</span><span style="color:#e6db74">&#34;unbounded&#34;</span><span style="color:#f92672">/&gt;</span>
        <span style="color:#f92672">&lt;/xsd:sequence&gt;</span>
    <span style="color:#f92672">&lt;/xsd:complexType&gt;</span>
    <span style="color:#f92672">&lt;xsd:complexType</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;studentType&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;xsd:sequence&gt;</span>
            <span style="color:#f92672">&lt;xsd:element</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;name&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;xsd:string&#34;</span><span style="color:#f92672">/&gt;</span>
            <span style="color:#f92672">&lt;xsd:element</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;age&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;ageType&#34;</span> <span style="color:#f92672">/&gt;</span>
            <span style="color:#f92672">&lt;xsd:element</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;sex&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;sexType&#34;</span> <span style="color:#f92672">/&gt;</span>
        <span style="color:#f92672">&lt;/xsd:sequence&gt;</span>
        <span style="color:#f92672">&lt;xsd:attribute</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;number&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;numberType&#34;</span> <span style="color:#a6e22e">use=</span><span style="color:#e6db74">&#34;required&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;/xsd:complexType&gt;</span>
    <span style="color:#f92672">&lt;xsd:simpleType</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;sexType&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;xsd:restriction</span> <span style="color:#a6e22e">base=</span><span style="color:#e6db74">&#34;xsd:string&#34;</span><span style="color:#f92672">&gt;</span>
            <span style="color:#f92672">&lt;xsd:enumeration</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;male&#34;</span><span style="color:#f92672">/&gt;</span>
            <span style="color:#f92672">&lt;xsd:enumeration</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;female&#34;</span><span style="color:#f92672">/&gt;</span>
        <span style="color:#f92672">&lt;/xsd:restriction&gt;</span>
    <span style="color:#f92672">&lt;/xsd:simpleType&gt;</span>
    <span style="color:#f92672">&lt;xsd:simpleType</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;ageType&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;xsd:restriction</span> <span style="color:#a6e22e">base=</span><span style="color:#e6db74">&#34;xsd:integer&#34;</span><span style="color:#f92672">&gt;</span>
            <span style="color:#f92672">&lt;xsd:minInclusive</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;0&#34;</span><span style="color:#f92672">/&gt;</span>
            <span style="color:#f92672">&lt;xsd:maxInclusive</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;256&#34;</span><span style="color:#f92672">/&gt;</span>
        <span style="color:#f92672">&lt;/xsd:restriction&gt;</span>
    <span style="color:#f92672">&lt;/xsd:simpleType&gt;</span>
    <span style="color:#f92672">&lt;xsd:simpleType</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;numberType&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;xsd:restriction</span> <span style="color:#a6e22e">base=</span><span style="color:#e6db74">&#34;xsd:string&#34;</span><span style="color:#f92672">&gt;</span>
            <span style="color:#f92672">&lt;xsd:pattern</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;p_\d{4}&#34;</span><span style="color:#f92672">/&gt;</span>
        <span style="color:#f92672">&lt;/xsd:restriction&gt;</span>
    <span style="color:#f92672">&lt;/xsd:simpleType&gt;</span>
<span style="color:#f92672">&lt;/xsd:schema&gt;</span> 
</code></pre></div><p>XML文件：student.xml</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
<span style="color:#75715e">&lt;!-- 
</span><span style="color:#75715e">	1.填写xml文档的根元素
</span><span style="color:#75715e">	2.引入xsi前缀.  xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34;
</span><span style="color:#75715e">	3.引入xsd文件命名空间.  xsi:schemaLocation=&#34;http://www.xh.cn/xml  c_student.xsd&#34;
</span><span style="color:#75715e">	4.为每一个xsd约束声明一个前缀,作为标识  xmlns=&#34;http://www.xh.cn/xml&#34; 
</span><span style="color:#75715e"> --&gt;</span>
 <span style="color:#f92672">&lt;students</span>   <span style="color:#a6e22e">xmlns:xsi=</span><span style="color:#e6db74">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
 			 <span style="color:#a6e22e">xmlns=</span><span style="color:#e6db74">&#34;http://www.xh.cn/xml&#34;</span> 
 		     <span style="color:#a6e22e">xsi:schemaLocation=</span><span style="color:#e6db74">&#34;http://www.xh.cn/xml  c_student.xsd&#34;</span>
 		    <span style="color:#f92672">&gt;</span>
 	<span style="color:#f92672">&lt;student</span> <span style="color:#a6e22e">number=</span><span style="color:#e6db74">&#34;p_0001&#34;</span><span style="color:#f92672">&gt;</span>
 		<span style="color:#f92672">&lt;name&gt;</span>tom<span style="color:#f92672">&lt;/name&gt;</span>
 		<span style="color:#f92672">&lt;age&gt;</span>18<span style="color:#f92672">&lt;/age&gt;</span>
 		<span style="color:#f92672">&lt;sex&gt;</span>male<span style="color:#f92672">&lt;/sex&gt;</span>
 	<span style="color:#f92672">&lt;/student&gt;</span>
		 
 <span style="color:#f92672">&lt;/students&gt;</span>
</code></pre></div><h4 id="13-xml解析">1.3 XML解析</h4>
<p>操作xml文档，将文档中的数据读取到内存中</p>
<ol>
<li>
<p>解析(读取)：将文档中的数据读取到内存中</p>
</li>
<li>
<p>写入：将内存中的数据保存到xml文档中，持久化的存储！</p>
</li>
</ol>
<p>解析xml的方式</p>
<ol>
<li>DOM：将标记语言文档一次性加载进内存，在内存中形成一颗dom树</li>
</ol>
<ul>
<li>
<p>优点：操作方便，可以对文档进行CRUD的所有操作</p>
</li>
<li>
<p>缺点：占内存</p>
</li>
</ul>
<ol start="2">
<li>SAX：逐行读取，基于事件驱动的。</li>
</ol>
<ul>
<li>
<p>优点：不占内存。</p>
</li>
<li>
<p>缺点：只能读取，不能增删改</p>
</li>
</ul>
<h5 id="dom解析">DOM解析</h5>
<p>生成一个DOM树，并获得一个Document对象</p>
<p><img src="/img/image-20201228101132862.png" alt="image-20201228101132862"></p>
<p>xml常见的解析器：操作xml文档，将文档中的数据读取到内存中</p>
<ol>
<li>
<p>DOM4J：一款非常优秀的解析器</p>
</li>
<li>
<p>Jsoup：jsoup 是一款Java 的HTML解析器，它提供了一套非常省力的API，可通过DOM，CSS以及类似于jQuery的操作方法来取出和操作数据。</p>
</li>
</ol>
<h5 id="jsoup快速入门">Jsoup快速入门</h5>
<ol>
<li>
<p>导入jar包：jsoup-1.11.2.jar、JsoupXpath-0.3.2.jar</p>
</li>
<li>
<p>获取Document对象</p>
</li>
<li>
<p>获取对应的标签Element对象</p>
</li>
<li>
<p>获取数据</p>
</li>
</ol>
<p>案例演示</p>
<p>代码：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">D_Jsoup</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> IOException <span style="color:#f92672">{</span>

        <span style="color:#75715e">// 获取b_student.xml的path
</span><span style="color:#75715e"></span>        String path <span style="color:#f92672">=</span> D_Jsoup<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getClassLoader</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getResource</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;b_student.xml&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">getPath</span><span style="color:#f92672">();</span>
        
        <span style="color:#75715e">// 解析xml文档，加载文档进内存，获取dom树---&gt;Document
</span><span style="color:#75715e"></span>        Document document <span style="color:#f92672">=</span> Jsoup<span style="color:#f92672">.</span><span style="color:#a6e22e">parse</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span>path<span style="color:#f92672">),</span> <span style="color:#e6db74">&#34;utf-8&#34;</span><span style="color:#f92672">);</span>

        <span style="color:#75715e">// 获取元素对象 Element
</span><span style="color:#75715e"></span>        Elements elements <span style="color:#f92672">=</span> document<span style="color:#f92672">.</span><span style="color:#a6e22e">getElementsByTag</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">);</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>elements<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">());</span>

        <span style="color:#75715e">// 获取第一个name的Element对象
</span><span style="color:#75715e"></span>        Element element <span style="color:#f92672">=</span> elements<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>0<span style="color:#f92672">);</span>
        <span style="color:#75715e">// 获取文本数据
</span><span style="color:#75715e"></span>        String name <span style="color:#f92672">=</span> element<span style="color:#f92672">.</span><span style="color:#a6e22e">text</span><span style="color:#f92672">();</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>name<span style="color:#f92672">);</span>

    <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
</code></pre></div><hr>
<h3 id="第二章">第二章</h3>
<hr>
<h5 id="本章内容-1">本章内容</h5>
<ul>
<li>Http协议</li>
<li>Web常见概念</li>
<li>Web应用服务器Tomcat</li>
</ul>
<hr>
<h4 id="21-什么是http协议">2.1 什么是Http协议？</h4>
<p>HTTP，超文本传输协议（HyperText Transfer Protocol)是互联网上应用最为广泛的 一种网络协议。所有的WWW文件都必须遵守这个标准。设计HTTP最初的目的是为 了提供一种发布和接收HTML页面的方法</p>
<p><img src="/img/image-20201228101405111.png" alt="image-20201228101405111"></p>
<p>Http协议的组成</p>
<p>Http协议由Http请求和Http响应组成，当在浏览器中输入网址访问某个网站时， 你的浏览器会将你的请求封装成一个Http请求发送给服务器站点，服务器接收到请求后会组织响应数据封装成一个Http响应返回给浏览器。即没有请求就没有响应。</p>
<h5 id="http请求">Http请求</h5>
<p>栗子：提交一个表单页面form.html</p>
<p><img src="/img/image-20201228101442184.png" alt="image-20201228101442184"></p>
<p><img src="/img/image-20201228101428658.png" alt="image-20201228101428658"></p>
<ol>
<li>请求行</li>
</ol>
<p>请求方式：POST、GET</p>
<p>请求的资源：/DemoEE/form.html</p>
<p>协议版本：HTTP/1.1</p>
<p>​	HTTP/1.0，发送请求，创建一次连接，获得一个web资源，连接断开。</p>
<p>​	HTTP/1.1，发送请求，创建一次连接，获得多个web资源，保持连接。</p>
<ol start="2">
<li>请求头</li>
</ol>
<p>请求头是客户端发送给服务器端的一些信息，使用键值对表示key：value</p>
<p>常见请求头：</p>
<p><img src="/img/image-20201228101528838.png" alt="image-20201228101528838"></p>
<ul>
<li>
<p>Referer：浏览器通知服务器，当前请求来自何处。如果是直接访问，则不会有这个头。常用于：防盗链</p>
</li>
<li>
<p>If-Modified-Since：浏览器通知服务器，本地缓存的最后变更时间。与另一响应头组合控制浏览器页面缓存</p>
</li>
<li>
<p>Cookie：与会话有关技术，用于存放浏览器缓存的cookie信息。</p>
</li>
<li>
<p>User-Agent：浏览器通知服务器，客户端浏览器与操作系统相关信息</p>
</li>
<li>
<p>Connection: 保持连接状态。Keep-Alive 连接中，close 已关闭</p>
</li>
<li>
<p>Host: 请求的服务器主机名</p>
</li>
<li>
<p>Content-Length: 请求体的长度</p>
</li>
<li>
<p>Content-Type: 如果是POST请求，会有这个头，默认值为application/x-www-form-urlencoded，表示请求体内容使用url编码</p>
</li>
<li>
<p>Accept：浏览器可支持的MIME类型。文件类型的一种描述方式。</p>
<p>MIME格式：大类型/小类型[;参数]</p>
<p>text/html ，html文件</p>
<p>text/css，css文件</p>
<p>text/javascript，js文件</p>
<p>image/，所有图片文件</p>
</li>
<li>
<p>Accept-Encoding: 浏览器通知服务器，浏览器支持的数据压缩格式。如：GZIP压缩</p>
</li>
<li>
<p>Accept-Language: 浏览器通知服务器，浏览器支持的语言。各国语言（国际化i18n）</p>
</li>
</ul>
<ol start="3">
<li>请求体</li>
</ol>
<p>当请求方式是post的时，请求体会有请求的参数，格式如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">username<span style="color:#f92672">=</span>zhangsan<span style="color:#f92672">&amp;</span>password<span style="color:#f92672">=</span>123
</code></pre></div><p>如果请求方式为get，那么请求参数不会出现在请求体中，会拼接在url地址后面!</p>
<p><a href="http://localhost:8080...?username=zhangsan&amp;password=123">http://localhost:8080&hellip;?username=</a><a href="http://localhost:8080...?username=zhangsan&amp;password=123">zhangsan&amp;password</a><a href="http://localhost:8080...?username=zhangsan&amp;password=123">=123</a></p>
<h5 id="http响应">Http响应</h5>
<p><img src="/img/image-20201228101604521.png" alt="image-20201228101604521"></p>
<p>响应行</p>
<p>Http协议状态码：</p>
<ul>
<li>
<p>200：请求成功</p>
</li>
<li>
<p>302：请求重定向</p>
</li>
<li>
<p>304：请求资源没有改变，访问本地缓存</p>
</li>
<li>
<p>404: 请求资源不存在</p>
</li>
<li>
<p>500：服务器内部错误</p>
</li>
</ul>
<p>响应头</p>
<p><img src="/img/image-20201228101641275.png" alt="image-20201228101641275"></p>
<p>响应体</p>
<p>响应体是服务器回写给客户端的页面正文，浏览器将正文加载到内存，然后解析渲染显示页面内容</p>
<h4 id="22-web常见概念">2.2 WEB常见概念</h4>
<p>B/S与C/S</p>
<ul>
<li>
<p>Brower/Server：浏览器 服务器 系统；例：网站</p>
</li>
<li>
<p>Client/Server：客户端 服务器 系统；例：QQ、飞秋、大型游戏</p>
</li>
</ul>
<p>WEB服务器：供向外部发布web资源的服务器软件</p>
<p><img src="/img/image-20201228101759177.png" alt="image-20201228101759177"></p>
<p>WEB资源</p>
<p>1）静态资源：web页面中供人们浏览的数据始终不变，如：HTML、CSS、JS、图片、多媒体。</p>
<p>2）动态资源：web页面中供人们浏览的数据是由程序产生的如：JSP/Servlet、ASP、PHP</p>
<p>javaWEB领域：动态资源认为通过java代码去动态生成html。</p>
<p>请求响应</p>
<p><img src="/img/image-20201228101844634.png" alt="image-20201228101844634"></p>
<p>请求的URL地址</p>
<p><img src="/img/image-20201228101905856.png" alt="image-20201228101905856"></p>
<p>WEB应用服务器</p>
<p>1）weblogic：oracle公司的大型收费web服务器</p>
<p>2）websphere：IBM公司的大型收费web服务器</p>
<p>3）Tomcat：Apache开源组织下的 开源免费的中小型的web应用服务器</p>
<h4 id="23-tomcat服务器">2.3 Tomcat服务器</h4>
<ol>
<li>
<p>下载Tomcat；官网地址：http://tomcat.apache.org/whichversion.html</p>
</li>
<li>
<p>安装Tomcat；Tomcat有安装版和解压版（绿色版）</p>
<p>安装版：以.exe形式的安装包，双击安装到我们的电脑上，用的比较少</p>
<p>解压版：即绿色版，解压后直接使用，用的比较多</p>
</li>
</ol>
<p>Tomcat的目录</p>
<p><img src="/img/image-20201228102002428.png" alt="image-20201228102002428"></p>
<ul>
<li>
<p>bin：脚本目录</p>
<p>启动脚本：startup.bat</p>
<p>停止脚本：shutdown.bat</p>
</li>
<li>
<p>conf：配置文件目录 (config /configuration)</p>
<p>核心配置文件：server.xml</p>
<p>用户权限配置文件：tomcat-users.xml</p>
<p>所有web项目默认配置文件：web.xml</p>
</li>
<li>
<p>lib：依赖库，tomcat和web项目中需要使用的jar包</p>
</li>
<li>
<p>logs：日志文件，localhost_access_log.*.txt是tomcat记录用户访问信息，星表示时间。</p>
<p>例如：localhost_access_log.2016-02-28.txt</p>
</li>
<li>
<p>temp：临时文件目录，文件夹内内容可以任意删除。</p>
</li>
<li>
<p>webapps：默认情况下发布WEB项目所存放的目录。</p>
</li>
<li>
<p>work：tomcat处理JSP的工作目录。</p>
</li>
</ul>
<h5 id="tomcat启动与运行">Tomcat启动与运行</h5>
<p>双击Tomcat下的bin下的startup.bat启动Tomcat</p>
<p>在浏览器的地址栏中输入http://localhost:8080,看到如下页面证明启动成功</p>
<p><img src="/img/image-20201228102042386.png" alt="image-20201228102042386"></p>
<p>双击Tomcat下的bin下的shutdown.bat关闭Tomcat</p>
<p>Tomcat启动不成功的原因分析</p>
<ol>
<li>
<p>没有配置JAVA_HOME环境变量</p>
</li>
<li>
<p>端口冲突：修改配置文件conf下server.xml的端口号</p>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;Connector</span> <span style="color:#a6e22e">port=</span><span style="color:#e6db74">&#34;8080&#34;</span> <span style="color:#a6e22e">protocol=</span><span style="color:#e6db74">&#34;HTTP/1.1&#34;</span>
        <span style="color:#a6e22e">connectionTimeout=</span><span style="color:#e6db74">&#34;20000&#34;</span>
        <span style="color:#a6e22e">redirectPort=</span><span style="color:#e6db74">&#34;8443&#34;</span> <span style="color:#f92672">/&gt;</span>
</code></pre></div><h5 id="tomcat部署项目">Tomcat部署项目</h5>
<p>四种部署方式：</p>
<ol>
<li>
<p>直接将项目DemoProject放置在 webapps目录下，重启Tomcat</p>
<p>访问：http://localhost:8080/DemoProject/Demo.html</p>
</li>
<li>
<p>打成war包放在webapps目录下，重启Tomcat，访问即可！</p>
</li>
<li>
<p>配置conf/server.xml；在host标签中配置：</p>
<p>docBase为项目实际存储目录（可任意选取存储位置）</p>
<p>path为虚拟路径（可任意指定）用来代替实际目录！</p>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;Context</span> <span style="color:#a6e22e">docBase=</span><span style="color:#e6db74">&#34;F:\Tomcat\apache-tomcat-8.5.31\webapps\DemoProject&#34;</span> <span style="color:#a6e22e">path=</span><span style="color:#e6db74">&#34;/hehe&#34;</span><span style="color:#f92672">/&gt;</span>
</code></pre></div><p>​		配置完成后，重启Tomcat，访问：http://localhost:8080/hehe/Demo.html</p>
<ol start="4">
<li>在conf\catalina\localhost创建一个任意名称的xml文件abc.xml，在文件中编写：</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;Context</span> <span style="color:#a6e22e">docBase=</span><span style="color:#e6db74">&#34;F:\Tomcat\apache-tomcat-8.5.31\webapps\DemoProject&#34;</span><span style="color:#f92672">/&gt;</span>
</code></pre></div><p>​		配置完成后，重启Tomcat，访问：http://localhost:8080/abc/Demo.html</p>
<h5 id="web项目的目录结构">WEB项目的目录结构</h5>
<ol>
<li>
<p>静态项目，直接放在webapp</p>
</li>
<li>
<p>动态项目：</p>
<p>项目的根目录</p>
<p>​     web-inf目录</p>
<pre><code>     web.xml：核心配置文件

     classes：放置字节码文件

     lib：放置依赖的jar包
</code></pre>
</li>
</ol>
<h5 id="使用idea创建web项目">使用Idea创建WEB项目</h5>
<ol>
<li>
<p>创建javaweb项：File&ndash;&gt;New&ndash;&gt;Project</p>
</li>
<li>
<p>选择web项目：Java Enterprise &ndash;&gt;</p>
<p>Web Application：javaEE version选择JavaEE7 &ndash;&gt; Application Server：选择Tomcat &ndash;&gt; 勾选 Web Application &ndash;&gt; 勾选 Create web.xml</p>
<p><img src="/img/image-20201228102221045.png" alt="image-20201228102221045"></p>
</li>
<li>
<p>创建工程和目录地址</p>
</li>
<li>
<p>启动项目后，自动访问默认文件 index.jsp</p>
</li>
<li>
<p>Web下，新建Demo01.html；【重启项目】访问：http://localhost:8080/Demo01.html</p>
</li>
</ol>
<p>注：每次添加新页面，都需要重启项目才能显示！所以，我们需要对Tomcat进行相关配置！如下：</p>
<h5 id="idea中tomcat相关配置">IDEA中Tomcat相关配置</h5>
<ol>
<li>
<p>热部署：</p>
<p>IDEA界面右上角 &ndash;&gt; Tomcat  &ndash;&gt; Edit Configurations  &ndash;&gt; Server</p>
<p>​	On update action：update resources，表示更新资源以后重新部署项目</p>
<p>​    On frame deactivation：update resources</p>
<p>测试：Web下，新建Demo02.html；访问：http://localhost:8080/Demo02.html</p>
<p>创建虚拟路径：</p>
<p>IDEA界面右上角 &ndash;&gt; Tomcat  &ndash;&gt; Edit Configurations  &ndash;&gt; Deployment</p>
<p>​	Application context：/Servlet</p>
<p>测试访问：http://localhost:8080/Servlet/Demo02.html</p>
<p>​</p>
</li>
<li>
<p>WEB-INF目录下的资源不能被浏览器直接访问。</p>
</li>
<li>
<p>断点调试：使用&quot;小虫子&quot;启动 dubug 启动</p>
</li>
</ol>
<hr>
<h3 id="第三章">第三章</h3>
<hr>
<h5 id="本章内容-2">本章内容</h5>
<ul>
<li>Servlet</li>
</ul>
<hr>
<h5 id="什么是servlet">什么是Servlet？</h5>
<p>定义：运行在服务器端的小程序！</p>
<p>本质上servlet就是一个实现了servlet接口的类</p>
<p>servlet接口定义了Java类被tomcat识别的规则</p>
<h5 id="servlet入门案例">Servlet入门案例</h5>
<ol>
<li>创建一个JAVAEE项目</li>
</ol>
<p>File&ndash;&gt;New&ndash;&gt;Project &ndash;&gt; Java Enterprise &ndash;&gt;Web Application：JavaEE7 &ndash;&gt; Application Server：Tomcat &ndash;&gt; 勾选 Web Application &ndash;&gt; 勾选 Create web.xml</p>
<ol start="2">
<li>定义类实现Servlet接口</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.Demo<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Demo01</span> <span style="color:#66d9ef">implements</span> Servlet <span style="color:#f92672">{</span>

<span style="color:#f92672">}</span>
</code></pre></div><ol start="3">
<li>实现接口中的方法</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Demo01</span> <span style="color:#66d9ef">implements</span> Servlet <span style="color:#f92672">{</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">service</span><span style="color:#f92672">(</span>ServletRequest servletRequest<span style="color:#f92672">,</span> ServletResponse servletResponse<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Demo01实现Servlet接口，便可被Tomcat识别！！重写service方法输出此句！！&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    
	<span style="color:#75715e">//其他重写方法略...
</span><span style="color:#75715e"></span>
<span style="color:#f92672">}</span>
</code></pre></div><ol start="4">
<li>在Web.xml中配置Servlet</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;servlet&gt;</span>
    <span style="color:#f92672">&lt;servlet-name&gt;</span>Demo<span style="color:#f92672">&lt;/servlet-name&gt;</span>
    <span style="color:#f92672">&lt;servlet-class&gt;</span>com.iNuo.Demo.Demo01<span style="color:#f92672">&lt;/servlet-class&gt;</span>
<span style="color:#f92672">&lt;/servlet&gt;</span>
<span style="color:#f92672">&lt;servlet-mapping&gt;</span>
    <span style="color:#f92672">&lt;servlet-name&gt;</span>Demo<span style="color:#f92672">&lt;/servlet-name&gt;</span>
    <span style="color:#f92672">&lt;url-pattern&gt;</span>/Dem<span style="color:#f92672">&lt;/url-pattern&gt;</span>
<span style="color:#f92672">&lt;/servlet-apping&gt;</span>
</code></pre></div><ol start="5">
<li>启动项目，访问：http://localhost:8080/Dem；控制台输出Demo01的输出语句，即service方法被执行！</li>
</ol>
<h5 id="servlet执行原理">Servlet执行原理</h5>
<p><img src="/img/image-20210201163618492.png" alt="image-20210201163618492"></p>
<h5 id="servlet生命周期">Servlet生命周期</h5>
<ul>
<li>默认Servlet被访问时创建，可通过&lt;load-on-startup&gt;设置为0或正数（默认为负数）改为服务器启动时创建</li>
</ul>
<p><img src="/img/image-20201228102434169.png" alt="image-20201228102434169"></p>
<ul>
<li>
<p>Servlet被创建，执行init方法，只执行一次</p>
</li>
<li>
<p>提供服务，执行service方法，执行多次</p>
</li>
<li>
<p>被销毁，执行destroy方法，只执行一次</p>
</li>
</ul>
<p>注意事项</p>
<ul>
<li>
<p>Servlet是单例的</p>
</li>
<li>
<p>多个用户同时访问可能存在线程安全问题</p>
</li>
<li>
<p>尽量不要在Servlet中定义成员变量，如果定义了，不要在方法中修改</p>
</li>
<li>
<p>服务器被关闭时Servlet被销毁</p>
</li>
<li>
<p>先执行Destroy然后Servlet才被销毁</p>
</li>
</ul>
<h5 id="servlet注解配置">Servlet注解配置</h5>
<ul>
<li>创建JavaEE项目选择Servlet版本3.0以上，可不创建Web.xml</li>
<li>定义类实现Servlet接口</li>
<li>实现方法，在类上使用@WebServlet注解配置</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.Demo<span style="color:#f92672">;</span>


<span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/Dem&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Demo01</span> <span style="color:#66d9ef">implements</span> Servlet <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">init</span><span style="color:#f92672">(</span>ServletConfig servletConfig<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException <span style="color:#f92672">{</span>

    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> ServletConfig <span style="color:#a6e22e">getServletConfig</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">service</span><span style="color:#f92672">(</span>ServletRequest servletRequest<span style="color:#f92672">,</span> ServletResponse servletResponse<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Demo01实现Servlet接口，便可被Tomcat识别！！重写service方法输出此句！！&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getServletInfo</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">destroy</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>

    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><p>启动项目，访问：http://localhost:8080/Dem；控制台输出Demo01的输出语句，即service方法被执行！</p>
<h5 id="idea的servlet配置">Idea的Servlet配置</h5>
<ul>
<li>Idea会为每一个tomcat部署的项目单独建立一份配置文件</li>
</ul>
<p>启动项目，控制台输出的即为配置文件地址：Using CATALINA_BASE:   &ldquo;C:\Users\iNuo.IntelliJIdea2019.3\system\tomcat\Tomcat_8_5_31_Servlet&rdquo;，目录下的conf/server.xml</p>
<p><img src="../../../Typora/works/img/image-20210201170732325.png" alt="image-20210201170732325"></p>
<p>其中，\conf\Catalina\localhost目录下的xml文件中包含虚拟路径和实际项目路径</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;Context</span> <span style="color:#a6e22e">path=</span><span style="color:#e6db74">&#34;/Servlet_war_exploded&#34;</span> <span style="color:#a6e22e">docBase=</span><span style="color:#e6db74">&#34;F:\IDEA\IntelliJ IDEA 2019.3.3\projects\Chap13\src\com\iNuo\Demo\Demo03\Servlet\out\artifacts\Servlet_war_exploded&#34;</span> <span style="color:#f92672">/&gt;</span>
</code></pre></div><ul>
<li>查看控制台的log：C:\Users\iNuo.IntelliJIdea2019.3\system\tomcat\Tomcat_8_5_31_Servlet\logs</li>
</ul>
<p><img src="../../../Typora/works/img/image-20210201170815588.png" alt="image-20210201170815588"></p>
<ul>
<li>工作空间项目和tomcat部署的项目不在一起</li>
</ul>
<p>工作空间项目路径：F:\IDEA\IntelliJ IDEA 2019.3.3\projects\Chap13\src\com\iNuo\Demo\Demo03\Servlet</p>
<p>Tomcat部署项目路径：F:\IDEA\IntelliJ IDEA 2019.3.3\projects\Chap13\src\com\iNuo\Demo\Demo03\Servlet\out\artifacts\Servlet_war_exploded</p>
<h5 id="servlet的体系结构">Servlet的体系结构</h5>
<ul>
<li>Servlet接口</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/Demo01&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Demo01</span> <span style="color:#66d9ef">implements</span> Servlet <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#f92672">...</span>
    <span style="color:#f92672">...</span>
    <span style="color:#f92672">...</span>    
    <span style="color:#a6e22e">@Override</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>测试：启动项目，访问：http://localhost:8080/Demo01；控制台输出Demo01的输出语句!</p>
<ul>
<li>
<p>GenericServlet抽象类</p>
<p>将Servlet的其它方法做了默认的空实现，只将Service方法做了抽象！</p>
<p>继承该抽象类只需要实现Service方法即可！</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/Demo02&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Demo02</span> <span style="color:#66d9ef">extends</span> GenericServlet <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">service</span><span style="color:#f92672">(</span>ServletRequest servletRequest<span style="color:#f92672">,</span> ServletResponse servletResponse<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Service&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>测试：启动项目，访问：http://localhost:8080/Demo02；控制台输出Demo02的输出语句 Service</p>
<ul>
<li>
<p>HttpServlet抽象类</p>
<p>对Http协议的封装简化操作，判断请求方式进行对应处理！</p>
<p>继承该抽象类需要实现doGet和doPost方法！</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/Demo03&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Demo03</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;get&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;post&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>get测试：启动项目，访问：http://localhost:8080/Demo03；控制台输出Demo03的输出语句 get</p>
<p>post测试：启动项目，访问：http://localhost:8080/Demo_Form.html；提交表单，控制台输出 post</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;
&lt;<span style="color:#f92672">head</span>&gt;
    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>&gt;
    &lt;<span style="color:#f92672">title</span>&gt;表单 post 提交&lt;/<span style="color:#f92672">title</span>&gt;
&lt;/<span style="color:#f92672">head</span>&gt;
&lt;<span style="color:#f92672">body</span>&gt;
&lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">action</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/Demo03&#34;</span> <span style="color:#a6e22e">method</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;post&#34;</span>&gt;
    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;userName&#34;</span>&gt;&lt;<span style="color:#f92672">br</span>/&gt;
    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;password&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;password&#34;</span>&gt;&lt;<span style="color:#f92672">br</span>/&gt;
    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;提交&#34;</span>&gt;
&lt;/<span style="color:#f92672">form</span>&gt;
&lt;/<span style="color:#f92672">body</span>&gt;
&lt;/<span style="color:#f92672">html</span>&gt;
</code></pre></div><h5 id="servlet访问路径的配置">Servlet访问路径的配置</h5>
<ul>
<li>一个Servlet可以定义多个访问路径 @WebSevlet({“/s1”,”/s2”,”/s3”})</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;{“/s1”,”/s2”,”/s3”}&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Demo</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>
<p>路径定义规则</p>
<p>单级目录：/xxx</p>
<p>多级目录：/xxx/xxx</p>
<p>任意名称：/xxx/*</p>
<p>后缀+任意：*.do</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;*.do&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Demo</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>访问：http://localhost:8080/djfoe.do</p>
<p>问题：启动项目后，总是自动弹出浏览器？</p>
<p>IDEA界面右上角 &ndash;&gt; Tomcat  &ndash;&gt; Edit Configurations  &ndash;&gt; Server   &ndash;&gt; Open browser  &ndash;&gt;  取消勾选After launch</p>
<hr>
<h3 id="第四章">第四章</h3>
<hr>
<h5 id="本章内容-3">本章内容</h5>
<ul>
<li>Request请求</li>
<li>Response响应</li>
<li>用户登录案例</li>
</ul>
<hr>
<h5 id="什么是request和response">什么是Request和Response？</h5>
<ul>
<li>
<p>Request对象用来获取请求消息</p>
</li>
<li>
<p>Response对象用来设置响应消息</p>
</li>
</ul>
<p>他们都是由Tomcat服务器创建的，我们可以使用它们！</p>
<h4 id="41-request">4.1 Request</h4>
<h5 id="request的继承体系">Request的继承体系</h5>
<ul>
<li>ServletRequest（接口）</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/Demo01&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Demo01</span> <span style="color:#66d9ef">extends</span> GenericServlet <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">service</span><span style="color:#f92672">(</span>ServletRequest servletRequest<span style="color:#f92672">,</span> ServletResponse servletResponse<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Service&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>HttpServletRequest（接口）</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/Demo02&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Demo02</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>req<span style="color:#f92672">);</span>  <span style="color:#75715e">//org.apache.catalina.connector.RequestFacade
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>req<span style="color:#f92672">);</span>  <span style="color:#75715e">//org.apache.catalina.connector.RequestFacade
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>RequestFacade（类）由tomcat创建  org.apache.catalina.connector.RequestFacade</li>
</ul>
<h5 id="request的功能">Request的功能</h5>
<ul>
<li>
<p>获取请求行数据：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Get <span style="color:#f92672">/</span>Servlet<span style="color:#f92672">/</span>Demo01<span style="color:#f92672">?</span>name<span style="color:#f92672">=</span>zhangsan Http<span style="color:#f92672">/</span>1<span style="color:#f92672">.</span><span style="color:#a6e22e">1</span>
</code></pre></div></li>
</ul>
<ol>
<li>获取请求方式：String getMethod()；输出：Get</li>
<li>获取虚拟目录：String getContextPath()；输出：/Servlet</li>
<li>获取Servlet路径：String getServletPath()；输出：/Demo01</li>
<li>获取Get方式请求参数：String getQueryString()；输出：name=zhangsan</li>
<li>获取请求Uri：String  GetRequestURI()；输出： /Servlet/Demo01</li>
<li>获取请求Url：String  GetRequestURL()；输出： http://localhost:8080/Servlet/Demo01</li>
<li>获取协议及版本：String GetProtocol()；输出：Http/1.1</li>
<li>获取客户机IP地址：String GetRemoteAddr()</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/Demo01&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Demo01</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        
        <span style="color:#75715e">//获取虚拟目录
</span><span style="color:#75715e"></span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>req<span style="color:#f92672">.</span><span style="color:#a6e22e">getContextPath</span><span style="color:#f92672">());</span>
        <span style="color:#75715e">//获取get请求参数
</span><span style="color:#75715e"></span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>req<span style="color:#f92672">.</span><span style="color:#a6e22e">getQueryString</span><span style="color:#f92672">());</span>
        <span style="color:#75715e">//获取请求的URI
</span><span style="color:#75715e"></span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>req<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequestURI</span><span style="color:#f92672">());</span>
        <span style="color:#75715e">//获取请求的URL
</span><span style="color:#75715e"></span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>req<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequestURL</span><span style="color:#f92672">());</span>

    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        doGet<span style="color:#f92672">(</span>req<span style="color:#f92672">,</span>resp<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>访问：http://localhost:8080/Servlet/Demo01?name=zhangsan 控制台输出结果！</p>
<ul>
<li>获取请求头数据：</li>
</ul>
<p>​    String getHeader(String name)：通过请求头的名称获取请求头的值</p>
<p>​    String getHeaderNames()：获取所有的请求头名称</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//获取请求头的浏览器的信息
</span><span style="color:#75715e"></span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>req<span style="color:#f92672">.</span><span style="color:#a6e22e">getHeader</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;user-agent&#34;</span><span style="color:#f92672">));</span>
</code></pre></div><ul>
<li>获取post请求体数据</li>
</ul>
<p>​    先获取流对象再从流对象中拿数据</p>
<ul>
<li>获取请求参数通用方式（get,post都可用）</li>
</ul>
<ol>
<li>
<p>String getParameter(String name)：根据参数名称获取参数值</p>
</li>
<li>
<p>String[] getParametervalues(String name)：根据参数名称获取参数值数组，通常用于复选框之类</p>
</li>
<li>
<p>Enumeration&lt;String&gt; getParameterNames()：获取所有请求参数的名称</p>
</li>
<li>
<p>Map&lt;String,String[]&gt; getParameterMap()：获取所有参数的map集合</p>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/Demo02&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Demo02</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>

        <span style="color:#75715e">//获取参数名为userName的参数值
</span><span style="color:#75715e"></span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>req<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;userName&#34;</span><span style="color:#f92672">));</span>

        <span style="color:#75715e">//获取hobby参数数组
</span><span style="color:#75715e"></span>        String<span style="color:#f92672">[]</span> hobby<span style="color:#f92672">=</span>req<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameterValues</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;hobby&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>String s <span style="color:#f92672">:</span> hobby<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>s<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        doGet<span style="color:#f92672">(</span>req<span style="color:#f92672">,</span>resp<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;
&lt;<span style="color:#f92672">head</span>&gt;
    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>&gt;
    &lt;<span style="color:#f92672">title</span>&gt;Title&lt;/<span style="color:#f92672">title</span>&gt;
&lt;/<span style="color:#f92672">head</span>&gt;
&lt;<span style="color:#f92672">body</span>&gt;
&lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">action</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/Servlet/Demo02&#34;</span> <span style="color:#a6e22e">method</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;post&#34;</span>&gt;
    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;checkbox&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;hobby&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;game&#34;</span>&gt;游戏&lt;<span style="color:#f92672">br</span>/&gt;
    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;checkbox&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;hobby&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;book&#34;</span>&gt;读书&lt;<span style="color:#f92672">br</span>/&gt;
    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;提交&#34;</span>&gt;
&lt;/<span style="color:#f92672">form</span>&gt;
&lt;/<span style="color:#f92672">body</span>&gt;
&lt;/<span style="color:#f92672">html</span>&gt;
</code></pre></div><p>访问：http://localhost:8080/Servlet/MyForm.html 提交表单，控制台输出结果！</p>
<h5 id="中文乱码问题">中文乱码问题</h5>
<p>Tomcat8已经把get方式的中文乱码问题解决了</p>
<p>Post方式乱码解决：在获取参数前设置request的编码</p>
<p>Request.setCharacterEncoding(“utf-8”)和页面保持一致</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/Demo03&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Demo03</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#75715e">//post乱码问题
</span><span style="color:#75715e"></span>        req<span style="color:#f92672">.</span><span style="color:#a6e22e">setCharacterEncoding</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;utf-8&#34;</span><span style="color:#f92672">);</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>req<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;userName&#34;</span><span style="color:#f92672">));</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        doGet<span style="color:#f92672">(</span>req<span style="color:#f92672">,</span>resp<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;
&lt;<span style="color:#f92672">head</span>&gt;
    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>&gt;
    &lt;<span style="color:#f92672">title</span>&gt;Title&lt;/<span style="color:#f92672">title</span>&gt;
&lt;/<span style="color:#f92672">head</span>&gt;
&lt;<span style="color:#f92672">body</span>&gt;
&lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">action</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/Servlet/Demo03&#34;</span> <span style="color:#a6e22e">method</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;post&#34;</span>&gt;
    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;userName&#34;</span>&gt;&lt;<span style="color:#f92672">br</span>/&gt;
    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;提交&#34;</span>&gt;
&lt;/<span style="color:#f92672">form</span>&gt;
&lt;/<span style="color:#f92672">body</span>&gt;
&lt;/<span style="color:#f92672">html</span>&gt;
</code></pre></div><p>访问：http://localhost:8080/Servlet/MyForm1.html 提交表单，控制台输出结果！</p>
<h5 id="请求转发">请求转发</h5>
<p>一种在服务器内部的资源跳转方式</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">req<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequestDispatcher</span><span style="color:#f92672">(</span>String path<span style="color:#f92672">).</span><span style="color:#a6e22e">forward</span><span style="color:#f92672">(</span>ServletRequest request<span style="color:#f92672">,</span>ServletResponse response<span style="color:#f92672">)</span>
</code></pre></div><p><img src="/img/image-20201228102931546.png" alt="image-20201228102931546"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/Demo04&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Demo04</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#75715e">//请求转发
</span><span style="color:#75715e"></span>        req<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequestDispatcher</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/Demo05&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">forward</span><span style="color:#f92672">(</span>req<span style="color:#f92672">,</span>resp<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>req<span style="color:#f92672">,</span>resp<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/Demo05&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Demo05</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Demo05&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>req<span style="color:#f92672">,</span>resp<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>访问：http://localhost:8080/Servlet/Demo04 控制台输出结果！</p>
<p>请求转发的特点</p>
<ul>
<li>
<p>浏览器地址栏路径不发生变化</p>
</li>
<li>
<p>只能转发到当前服务器内部资源</p>
</li>
<li>
<p>转发是一次请求</p>
</li>
</ul>
<p>Request共享数据</p>
<ul>
<li>
<p>域对象：一个有作用范围的对象，可以在作用范围内共享数据</p>
</li>
<li>
<p>Request域：它的作用范围是一次请求，一般用于在请求转发中共享数据</p>
</li>
</ul>
<p>方法：</p>
<ul>
<li>
<p>Void setAttribute(Sting name,Object obj)：存储数据</p>
</li>
<li>
<p>Object getAttribute(String name)：获取数据的值</p>
</li>
<li>
<p>Void removeAttribute(String name)：通过键移除键值对</p>
</li>
</ul>
<h4 id="42-response对象">4.2 Response对象</h4>
<ul>
<li>
<p>设置响应行状态码；</p>
</li>
<li>
<p>设置响应头信息；</p>
</li>
<li>
<p>设置响应正文；</p>
</li>
</ul>
<h5 id="重定向">重定向</h5>
<p>第一种方式：</p>
<p>​	设置状态码为302：response.setStatus(302);</p>
<p>​	设置响应头location：response.setHeader(&ldquo;location&rdquo;,&quot;/Demo02&rdquo;);</p>
<p>第二种方式</p>
<p>​	一步重定向：response.sendRedirect(&quot;/Demo02&rdquo;);</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/Demo06&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Demo06</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#75715e">//第一种重定向方式
</span><span style="color:#75715e"></span>        resp<span style="color:#f92672">.</span><span style="color:#a6e22e">setStatus</span><span style="color:#f92672">(</span>302<span style="color:#f92672">);</span> <span style="color:#75715e">//设置状态码
</span><span style="color:#75715e"></span>        resp<span style="color:#f92672">.</span><span style="color:#a6e22e">setHeader</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;location&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;/Demo07&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#75715e">//第二种方式
</span><span style="color:#75715e"></span>        resp<span style="color:#f92672">.</span><span style="color:#a6e22e">sendRedirect</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/Demo07&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>req<span style="color:#f92672">,</span>resp<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/Demo07&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Demo07</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Demo07&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>req<span style="color:#f92672">,</span>resp<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><table>
<thead>
<tr>
<th>重定向的特点</th>
<th>转发的特点</th>
</tr>
</thead>
<tbody>
<tr>
<td>地址栏发生变化</td>
<td>转发地址栏路径不变</td>
</tr>
<tr>
<td>重定向可以访问其他站点(服务器)的资源(如百度)</td>
<td>转发只能访问当前服务器下的资源</td>
</tr>
<tr>
<td>重定向是两次请求！不能使用request对象来共享数据</td>
<td>转发是一次请求！可以使用request对象来共享数据</td>
</tr>
</tbody>
</table>
<h5 id="路径">路径</h5>
<ul>
<li>
<p>相对路径：不以/开头，以.开头路径；如：./index.html</p>
<p>规则：找到当前资源和目标资源之间的相对位置关系！</p>
<p>./：当前目录；     ../：后退一级目录</p>
</li>
<li>
<p>绝对路径：通过绝对路径可以确定唯一资源，以/开头的路径；如：http://localhost:8080/servlet/Demo2</p>
<p>等同于 /servlet/Demo2</p>
<p>规则：判断定义的路径是给谁用的？判断请求将来从哪儿发出?</p>
<p>客户端用 需要加虚拟目录，如：超链接、重定向&hellip; 建议虚拟目录动态获取：request.getContextPath()</p>
<p>服务端用 不需要加虚拟目录，如：请求转发</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;
&lt;<span style="color:#f92672">head</span>&gt;
    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>&gt;
    &lt;<span style="color:#f92672">title</span>&gt;Title&lt;/<span style="color:#f92672">title</span>&gt;
&lt;/<span style="color:#f92672">head</span>&gt;
&lt;<span style="color:#f92672">body</span>&gt;
&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./Demo07&#34;</span>&gt;相对路径访问 Demo07&lt;/<span style="color:#f92672">a</span>&gt;
&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/Servlet/Demo07&#34;</span>&gt;绝对路径访问 Demo07&lt;/<span style="color:#f92672">a</span>&gt;
&lt;/<span style="color:#f92672">body</span>&gt;
&lt;/<span style="color:#f92672">html</span>&gt;
</code></pre></div><h5 id="输出字符数据到浏览器">输出字符数据到浏览器</h5>
<ol>
<li>
<p>获取字符输出流</p>
</li>
<li>
<p>输出数据</p>
</li>
</ol>
<p>乱码问题：</p>
<ol>
<li>
<p>设置该流的默认编码</p>
</li>
<li>
<p>告诉浏览器响应体使用的编码</p>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">response<span style="color:#f92672">.</span><span style="color:#a6e22e">setContentType</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;text/html;charset=utf-8&#34;</span><span style="color:#f92672">);</span> 
</code></pre></div><h5 id="服务器输出字符数据到浏览器">服务器输出字符数据到浏览器</h5>
<p>步骤：</p>
<ol>
<li>
<p>获取字符输出流 resp.getWriter()</p>
</li>
<li>
<p>输出数据 w.write(&quot;&quot;)</p>
</li>
</ol>
<p>乱码问题：</p>
<pre><code>1. PrintWriter pw = response.getWriter(); 获取的流的默认编码是ISO-8859-1
2. 设置该流的默认编码 response.setCharacterEncoding(“utf-8”);
</code></pre>
<ol start="3">
<li>告诉浏览器响应体使用的编码 response.setHeader(“content-type”,”text/html;charset=utf-8”);
4. 简单的形式，设置编码；在获取流之前设置：response.setContentType(&ldquo;text/html;charset=utf-8&rdquo;);</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/Demo08&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Demo08</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#75715e">//乱码处理方式一
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//设置response的编码为utf-8
</span><span style="color:#75715e"></span>        resp<span style="color:#f92672">.</span><span style="color:#a6e22e">setCharacterEncoding</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;utf-8&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#75715e">//告诉浏览器让浏览器用utf-8来解析
</span><span style="color:#75715e"></span>        resp<span style="color:#f92672">.</span><span style="color:#a6e22e">setHeader</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;content-type&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;text/html;charset=utf-8&#34;</span><span style="color:#f92672">);</span>

        <span style="color:#75715e">//乱码处理方式二
</span><span style="color:#75715e"></span>        resp<span style="color:#f92672">.</span><span style="color:#a6e22e">setContentType</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;text/html;charset=utf-8&#34;</span><span style="color:#f92672">);</span>

        PrintWriter writer<span style="color:#f92672">=</span>resp<span style="color:#f92672">.</span><span style="color:#a6e22e">getWriter</span><span style="color:#f92672">();</span>
        writer<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;中国&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>req<span style="color:#f92672">,</span>resp<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="输出字节数据到浏览器">输出字节数据到浏览器</h5>
<ol>
<li>
<p>获取字节输出流 ServletOutputStream sos = response.getOutputStream();</p>
</li>
<li>
<p>输出数据  sos.write(&ldquo;你好&rdquo;.getBytes(&ldquo;utf-8&rdquo;));</p>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//乱码处理
</span><span style="color:#75715e"></span>resp<span style="color:#f92672">.</span><span style="color:#a6e22e">setContentType</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;text/html;charset=utf-8&#34;</span><span style="color:#f92672">);</span>

<span style="color:#75715e">//输出字节数据到浏览器
</span><span style="color:#75715e"></span>ServletOutputStream out<span style="color:#f92672">=</span>resp<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">();</span>
out<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;中国&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getBytes</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;utf-8&#34;</span><span style="color:#f92672">));</span>
</code></pre></div><h5 id="servletcontext对象">ServletContext对象</h5>
<ul>
<li>
<p>服务器会为每个应用创建一个ServletContext对象</p>
</li>
<li>
<p>ServletContext对象的创建是在服务器启动时完成的；</p>
</li>
<li>
<p>ServletContext对象的销毁是在服务器关闭时完成的；</p>
</li>
</ul>
<p>获取ServletContext：</p>
<ol>
<li>
<p>通过request对象获取  request.getServletContext();</p>
</li>
<li>
<p>通过HttpServlet获取  this.getServletContext();</p>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/Demo09&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Demo09</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#75715e">//获取ServletContext对象
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//1.request来获取
</span><span style="color:#75715e"></span>        ServletContext context<span style="color:#f92672">=</span>req<span style="color:#f92672">.</span><span style="color:#a6e22e">getServletContext</span><span style="color:#f92672">();</span>
        <span style="color:#75715e">//2.HttpServlet获取
</span><span style="color:#75715e"></span>        ServletContext context1<span style="color:#f92672">=</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getServletContext</span><span style="color:#f92672">();</span>

        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>context<span style="color:#f92672">);</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>context1<span style="color:#f92672">);</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>context<span style="color:#f92672">==</span>context1<span style="color:#f92672">);</span>
        
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>req<span style="color:#f92672">,</span>resp<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="servletcontext功能">ServletContext功能</h5>
<ol>
<li>
<p>域对象：共享数据</p>
<p>setAttribute(String name,Object value)</p>
<p>getAttribute(String name)</p>
<p>removeAttribute(String name)</p>
<p>ServletContext对象范围：所有用户所有请求的数据</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/Demo10&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Demo10</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#75715e">//1.获取ServletContext对象
</span><span style="color:#75715e"></span>        ServletContext context<span style="color:#f92672">=</span>req<span style="color:#f92672">.</span><span style="color:#a6e22e">getServletContext</span><span style="color:#f92672">();</span>
        <span style="color:#75715e">//2.向ServletContext对象中存入数据
</span><span style="color:#75715e"></span>        context<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;msg&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;hello&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
   
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>req<span style="color:#f92672">,</span>resp<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/Demo11&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Demo11</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#75715e">//1.获取ServletContext对象
</span><span style="color:#75715e"></span>        ServletContext context<span style="color:#f92672">=</span>req<span style="color:#f92672">.</span><span style="color:#a6e22e">getServletContext</span><span style="color:#f92672">();</span>
        <span style="color:#75715e">//2.从ServletContext对象中取数据
</span><span style="color:#75715e"></span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>context<span style="color:#f92672">.</span><span style="color:#a6e22e">getAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;msg&#34;</span><span style="color:#f92672">));</span>
    <span style="color:#f92672">}</span>
   
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>req<span style="color:#f92672">,</span>resp<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div></li>
<li>
<p>获取MIME类型</p>
<p>MIME类型：在互联网通信过程中定义的一种文件数据类型</p>
<p>格式：大类型/小类型  text/html image/jpeg</p>
<p>获取：String getMimeType(String file)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//1.获取ServletContext对象
</span><span style="color:#75715e"></span>ServletContext context<span style="color:#f92672">=</span>req<span style="color:#f92672">.</span><span style="color:#a6e22e">getServletContext</span><span style="color:#f92672">();</span>
<span style="color:#75715e">//2.获取文件的MIME类型
</span><span style="color:#75715e"></span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>context<span style="color:#f92672">.</span><span style="color:#a6e22e">getMimeType</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;1.jpg&#34;</span><span style="color:#f92672">));</span>
</code></pre></div></li>
<li>
<p>获取文件的真实(服务器)路径  String getRealPath(String path)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//获取ServletContext对象
</span><span style="color:#75715e"></span>ServletContext context<span style="color:#f92672">=</span>req<span style="color:#f92672">.</span><span style="color:#a6e22e">getServletContext</span><span style="color:#f92672">();</span>
   
<span style="color:#75715e">//web目录下资源访问
</span><span style="color:#75715e"></span>String a <span style="color:#f92672">=</span> context<span style="color:#f92672">.</span><span style="color:#a6e22e">getRealPath</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/a.txt&#34;</span><span style="color:#f92672">);</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>a<span style="color:#f92672">);</span>
   
<span style="color:#75715e">//WEB-INF目录下的资源访问
</span><span style="color:#75715e"></span>String b <span style="color:#f92672">=</span> context<span style="color:#f92672">.</span><span style="color:#a6e22e">getRealPath</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/WEB-INF/b.txt&#34;</span><span style="color:#f92672">);</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>b<span style="color:#f92672">);</span>
   
<span style="color:#75715e">//src目录下的资源访问
</span><span style="color:#75715e"></span>String c <span style="color:#f92672">=</span> context<span style="color:#f92672">.</span><span style="color:#a6e22e">getRealPath</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/WEB-INF/classes/c.txt&#34;</span><span style="color:#f92672">);</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>c<span style="color:#f92672">);</span>
</code></pre></div></li>
</ol>
<h5 id="案例1文件下载">案例1：文件下载</h5>
<ol>
<li>
<p>页面显示超链接</p>
</li>
<li>
<p>点击超链接下载图片而非保存</p>
</li>
<li>
<p>完成图片文件下载</p>
</li>
</ol>
<p>设置响应头类型：content-type</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">response<span style="color:#f92672">.</span><span style="color:#a6e22e">setHeader</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;content-type&#34;</span><span style="color:#f92672">,</span>mimeType<span style="color:#f92672">);</span>
</code></pre></div><p>设置响应头打开方式:content-disposition</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">response<span style="color:#f92672">.</span><span style="color:#a6e22e">setHeader</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;content-disposition&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;attachment;filename=&#34;</span><span style="color:#f92672">+</span>filename<span style="color:#f92672">);</span> 
</code></pre></div><p>分析：</p>
<ol>
<li>
<p>超链接指向的资源如果能够被浏览器解析则在浏览器中展示，如果不能解析则弹出下载提示框：不满足需求！</p>
</li>
<li>
<p>任何资源都必须弹出下载提示框</p>
</li>
<li>
<p>使用响应头设置资源的打开方式：</p>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">content<span style="color:#f92672">-</span>disposition<span style="color:#f92672">:</span>attachment<span style="color:#f92672">;</span>filename<span style="color:#f92672">=</span>xxx
</code></pre></div><p>步骤：</p>
<ol>
<li>
<p>定义页面，编辑超链接href属性，指向Servlet，传递资源名称filename</p>
</li>
<li>
<p>定义Servlet</p>
</li>
<li>
<p>获取文件名称</p>
</li>
<li>
<p>使用字节输入流加载文件进内存</p>
</li>
<li>
<p>指定response的响应头： content-disposition:attachment;filename=xxx</p>
</li>
<li>
<p>将数据写出到response输出流</p>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/Demo14&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Demo14</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#75715e">//1.获取请求参数:文件名
</span><span style="color:#75715e"></span>        String fileName <span style="color:#f92672">=</span> req<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;filename&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#75715e">//用ServletContext获取文件的真实路径
</span><span style="color:#75715e"></span>        ServletContext context<span style="color:#f92672">=</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getServletContext</span><span style="color:#f92672">();</span>
        String realName<span style="color:#f92672">=</span>context<span style="color:#f92672">.</span><span style="color:#a6e22e">getRealPath</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/img/&#34;</span><span style="color:#f92672">+</span>fileName<span style="color:#f92672">);</span>
        <span style="color:#75715e">//获取文件的MIME类型
</span><span style="color:#75715e"></span>        String mimeType<span style="color:#f92672">=</span>context<span style="color:#f92672">.</span><span style="color:#a6e22e">getMimeType</span><span style="color:#f92672">(</span>fileName<span style="color:#f92672">);</span>
        
        <span style="color:#75715e">//2.创建输入流读取该文件
</span><span style="color:#75715e"></span>        FileInputStream input<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> FileInputStream<span style="color:#f92672">(</span>realName<span style="color:#f92672">);</span>
        
        <span style="color:#75715e">//3.获取response的输出流，传输到浏览器并设置header为下载
</span><span style="color:#75715e"></span>        ServletOutputStream out<span style="color:#f92672">=</span>resp<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">();</span>
        resp<span style="color:#f92672">.</span><span style="color:#a6e22e">setHeader</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;content-type&#34;</span><span style="color:#f92672">,</span>mimeType<span style="color:#f92672">);</span>
        resp<span style="color:#f92672">.</span><span style="color:#a6e22e">setHeader</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;content-disposition&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;attachment;filename=&#34;</span><span style="color:#f92672">+</span>fileName<span style="color:#f92672">);</span>
        
        <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> buff <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[</span>1024 <span style="color:#f92672">*</span> 8<span style="color:#f92672">];</span>
        <span style="color:#66d9ef">int</span> len <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">while</span> <span style="color:#f92672">((</span>len <span style="color:#f92672">=</span> input<span style="color:#f92672">.</span><span style="color:#a6e22e">read</span><span style="color:#f92672">(</span>buff<span style="color:#f92672">))</span> <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span>1<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            out<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>buff<span style="color:#f92672">,</span> 0<span style="color:#f92672">,</span> len<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
        input<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
        out<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>req<span style="color:#f92672">,</span> resp<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="43-用户登录案例">4.3 用户登录案例</h4>
<p>需求分析：</p>
<ol>
<li>
<p>编写login.html登录页面username &amp; password 两个输入框</p>
</li>
<li>
<p>登录成功跳转到SuccessServlet展示：登录成功！用户名,欢迎您</p>
</li>
<li>
<p>登录失败跳转到FailServlet展示：登录失败，用户名或密码错误</p>
</li>
</ol>
<h5 id="数据访问层">数据访问层</h5>
<p>MySQL/test数据库/user表</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.dao<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> com.iNuo.pojo.User<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> com.iNuo.util.JDBCUtils<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.dao.DataAccessException<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.jdbc.core.BeanPropertyRowMapper<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.jdbc.core.JdbcTemplate<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserDao</span> <span style="color:#f92672">{</span>
    
    <span style="color:#75715e">//创建jdbcTemplate对象
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> JdbcTemplate jdbcTemplate<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> JdbcTemplate<span style="color:#f92672">(</span>JDBCUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">getDataSource</span><span style="color:#f92672">());</span>

    <span style="color:#75715e">//登录
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">public</span> User <span style="color:#a6e22e">login</span><span style="color:#f92672">(</span>User u<span style="color:#f92672">){</span>
        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
            User user <span style="color:#f92672">=</span> jdbcTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">queryForObject</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;SELECT * FROM USER WHERE NAME=? AND PASSWORD=?&#34;</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> BeanPropertyRowMapper<span style="color:#f92672">&lt;</span>User<span style="color:#f92672">&gt;(</span>User<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">),</span> u<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">(),</span> u<span style="color:#f92672">.</span><span style="color:#a6e22e">getPassword</span><span style="color:#f92672">());</span>
            <span style="color:#66d9ef">return</span> user<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>DataAccessException e<span style="color:#f92672">){</span>
            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="业务逻辑层">业务逻辑层</h5>
<p>实体类：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.pojo<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> Integer id<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String name<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String password<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">public</span> Integer <span style="color:#a6e22e">getId</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> id<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setId</span><span style="color:#f92672">(</span>Integer id<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> id<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getName</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> name<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setName</span><span style="color:#f92672">(</span>String name<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> name<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getPassword</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> password<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setPassword</span><span style="color:#f92672">(</span>String password<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">password</span> <span style="color:#f92672">=</span> password<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><p>登录：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.servlet<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> com.iNuo.dao.UserDao<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> com.iNuo.pojo.User<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> javax.servlet.ServletException<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.annotation.WebServlet<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.http.HttpServlet<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.http.HttpServletRequest<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.http.HttpServletResponse<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.IOException<span style="color:#f92672">;</span>

<span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/LoginServlet&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LoginServlet</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#75715e">//1.获取提交过来的用户名和密码
</span><span style="color:#75715e"></span>        String userName<span style="color:#f92672">=</span>req<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;username&#34;</span><span style="color:#f92672">);</span>
        String passWord<span style="color:#f92672">=</span>req<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;password&#34;</span><span style="color:#f92672">);</span>

        <span style="color:#75715e">//2.创建一个User对象
</span><span style="color:#75715e"></span>        User u<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> User<span style="color:#f92672">();</span>
        u<span style="color:#f92672">.</span><span style="color:#a6e22e">setName</span><span style="color:#f92672">(</span>userName<span style="color:#f92672">);</span>
        u<span style="color:#f92672">.</span><span style="color:#a6e22e">setPassword</span><span style="color:#f92672">(</span>passWord<span style="color:#f92672">);</span>

        <span style="color:#75715e">//3.调用数据访问层的登录方法
</span><span style="color:#75715e"></span>        UserDao userDao<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> UserDao<span style="color:#f92672">();</span>
        User user<span style="color:#f92672">=</span>userDao<span style="color:#f92672">.</span><span style="color:#a6e22e">login</span><span style="color:#f92672">(</span>u<span style="color:#f92672">);</span>

        <span style="color:#75715e">//4.判断登录是否成功
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>user<span style="color:#f92672">!=</span><span style="color:#66d9ef">null</span><span style="color:#f92672">){</span><span style="color:#75715e">//成功
</span><span style="color:#75715e"></span>            <span style="color:#75715e">//将user对象放到request对象中
</span><span style="color:#75715e"></span>            req<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;user&#34;</span><span style="color:#f92672">,</span>user<span style="color:#f92672">);</span>
            <span style="color:#75715e">//用 请求转发 跳转
</span><span style="color:#75715e"></span>            req<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequestDispatcher</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/successServlet&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">forward</span><span style="color:#f92672">(</span>req<span style="color:#f92672">,</span>resp<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span><span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span><span style="color:#75715e">//失败
</span><span style="color:#75715e"></span>            req<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequestDispatcher</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/failServlet&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">forward</span><span style="color:#f92672">(</span>req<span style="color:#f92672">,</span>resp<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>req<span style="color:#f92672">,</span>resp<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.servlet<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> com.iNuo.dao.UserDao<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> com.iNuo.pojo.User<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> javax.servlet.ServletException<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.annotation.WebServlet<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.http.HttpServlet<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.http.HttpServletRequest<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.http.HttpServletResponse<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.IOException<span style="color:#f92672">;</span>

<span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/successServlet&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">successServlet</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        User u<span style="color:#f92672">=(</span>User<span style="color:#f92672">)</span>req<span style="color:#f92672">.</span><span style="color:#a6e22e">getAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;user&#34;</span><span style="color:#f92672">);</span>
        resp<span style="color:#f92672">.</span><span style="color:#a6e22e">setContentType</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;text/html;charset=utf-8&#34;</span><span style="color:#f92672">);</span>
        resp<span style="color:#f92672">.</span><span style="color:#a6e22e">getWriter</span><span style="color:#f92672">().</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;登录成功！欢迎您！&#34;</span><span style="color:#f92672">+</span>u<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>req<span style="color:#f92672">,</span>resp<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.servlet<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> com.iNuo.dao.UserDao<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> com.iNuo.pojo.User<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> javax.servlet.ServletException<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.annotation.WebServlet<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.http.HttpServlet<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.http.HttpServletRequest<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.http.HttpServletResponse<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.IOException<span style="color:#f92672">;</span>

<span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/failServlet&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">failServlet</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        resp<span style="color:#f92672">.</span><span style="color:#a6e22e">setContentType</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;text/html;charset=utf-8&#34;</span><span style="color:#f92672">);</span>
        resp<span style="color:#f92672">.</span><span style="color:#a6e22e">getWriter</span><span style="color:#f92672">().</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;登录失败！用户名或密码不正确！！&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>req<span style="color:#f92672">,</span>resp<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="界面层">界面层</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;
&lt;<span style="color:#f92672">head</span>&gt;
    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>&gt;
    &lt;<span style="color:#f92672">title</span>&gt;登录页面&lt;/<span style="color:#f92672">title</span>&gt;
&lt;/<span style="color:#f92672">head</span>&gt;
&lt;<span style="color:#f92672">body</span>&gt;
&lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">action</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/LoginServlet&#34;</span> <span style="color:#a6e22e">method</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;post&#34;</span>&gt;
    用户名:&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;username&#34;</span>&gt; &lt;<span style="color:#f92672">br</span>&gt;
    密码:&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;password&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;password&#34;</span>&gt;&lt;<span style="color:#f92672">br</span>&gt;

    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;登录&#34;</span>&gt;

&lt;/<span style="color:#f92672">form</span>&gt;
&lt;/<span style="color:#f92672">body</span>&gt;
&lt;/<span style="color:#f92672">html</span>&gt;
</code></pre></div><hr>
<h3 id="第五章">第五章</h3>
<hr>
<h5 id="本章内容-4">本章内容</h5>
<ul>
<li>Cookie</li>
<li>JSP入门</li>
<li>Session</li>
<li>验证码案例</li>
</ul>
<hr>
<h5 id="会话技术">会话技术</h5>
<ul>
<li>
<p>会话：一次会话中包含多次请求和响应</p>
<p>一次会话：浏览器第一次给服务器资源发送请求，会话建立，直到有一方断开为止</p>
</li>
<li>
<p>功能：在一次会话的范围内的多次请求间，共享数据</p>
</li>
<li>
<p>方式：</p>
<p>客户端会话技术：Cookie</p>
<p>服务器端会话技术：Session</p>
</li>
</ul>
<h4 id="51-cookie">5.1 Cookie</h4>
<p>概念：客户端会话技术，将数据保存到客户端</p>
<p><img src="/img/image-20201228103850481.png" alt="image-20201228103850481"></p>
<p>Cookie翻译成中文是小甜点，小饼干的意思。在HTTP中它表示服务器送给客户端浏览器的小甜点。其实Cookie就是一个键和一个值构成的，随着服务器端的响应发送给客户端浏览器。然后客户端浏览器会把Cookie保存起来，当下一次再访问服务器时把Cookie再发送给服务器。</p>
<p>Cookie是由服务器创建，然后通过响应发送给客户端的一个键值对。客户端会保存Cookie，并会标注出Cookie的来源（哪个服务器的Cookie）。当客户端向服务器发出请求时会把所有这个服务器Cookie包含在请求中发送给服务器，这样服务器就可以识别客户端了！</p>
<h5 id="cookie使用步骤">Cookie使用步骤：</h5>
<ol>
<li>
<p>创建Cookie对象，绑定数据  new Cookie(String name, String value)</p>
</li>
<li>
<p>发送Cookie对象  response.addCookie(Cookie cookie)</p>
</li>
<li>
<p>获取Cookie，拿到数据  Cookie[] request.getCookies()</p>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/A_Servlet&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">A_Servlet</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#75715e">//1.创建Cookie
</span><span style="color:#75715e"></span>        Cookie c<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> Cookie<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;张阿三&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#75715e">//2.把Cookie添加到response中
</span><span style="color:#75715e"></span>        resp<span style="color:#f92672">.</span><span style="color:#a6e22e">addCookie</span><span style="color:#f92672">(</span>c<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>req<span style="color:#f92672">,</span>resp<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/B_Servlet&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">B_Servlet</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#75715e">//获取Cookie
</span><span style="color:#75715e"></span>        Cookie<span style="color:#f92672">[]</span> cookies<span style="color:#f92672">=</span>req<span style="color:#f92672">.</span><span style="color:#a6e22e">getCookies</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Cookie cookie <span style="color:#f92672">:</span> cookies<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">//打印Cookie的键
</span><span style="color:#75715e"></span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>cookie<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">());</span>
            <span style="color:#75715e">//打印Cookie的值
</span><span style="color:#75715e"></span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>cookie<span style="color:#f92672">.</span><span style="color:#a6e22e">getValue</span><span style="color:#f92672">());</span>

        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>req<span style="color:#f92672">,</span>resp<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="cookie原理">Cookie原理</h5>
<p>Cookie是通过HTTP请求和响应头在客户端和服务器端传递的！</p>
<p>Cookie的原理基于响应头set-cookie和请求头cookie实现！</p>
<ul>
<li>
<p>请求头：多个Cookie用分号隔开；例：Cookie: a=A; b=B; c=C</p>
</li>
<li>
<p>响应头：一个Cookie对象一个Set-Cookie；例： Set-Cookie: a=A    Set-Cookie: b=B    Set-Cookie: c=C</p>
</li>
</ul>
<p>查看：访问页面，F12打开开发者视图，可察看http请求响应中的cookie与Set-Cookie！</p>
<p><img src="../../../Typora/works/img/image-20210202121414560.png" alt="image-20210202121414560"></p>
<h5 id="cookie细节">Cookie细节</h5>
<ol>
<li>
<p>一次可不可以发送多个cookie?</p>
<p>可以！可以创建多个Cookie对象，使用response调用多次addCookie方法发送cookie即可！</p>
</li>
<li>
<p>cookie在浏览器中保存多长时间？</p>
<p>默认情况下，当浏览器关闭后，Cookie数据被销毁！</p>
<p>持久化存储：setMaxAge(int seconds)</p>
<p>​	正数：将Cookie数据写到硬盘的文件中并指定cookie存活时间，时间到后，cookie文件自动失效！</p>
<p>​	负数：默认值</p>
<p>​	零：删除cookie信息</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//创建Cookie
</span><span style="color:#75715e"></span>        Cookie c<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> Cookie<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;city&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;beijing&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#75715e">//将Cookie保存在客户端的磁盘上 50s,50s后Cookie自动删除
</span><span style="color:#75715e"></span>        c<span style="color:#f92672">.</span><span style="color:#a6e22e">setMaxAge</span><span style="color:#f92672">(</span>50<span style="color:#f92672">);</span>
        <span style="color:#75715e">//默认
</span><span style="color:#75715e"></span>        c<span style="color:#f92672">.</span><span style="color:#a6e22e">setMaxAge</span><span style="color:#f92672">(-</span>7<span style="color:#f92672">);</span>
        <span style="color:#75715e">//删除
</span><span style="color:#75715e"></span>        c<span style="color:#f92672">.</span><span style="color:#a6e22e">setMaxAge</span><span style="color:#f92672">(</span>0<span style="color:#f92672">);</span>
        <span style="color:#75715e">//把Cookie添加到response中
</span><span style="color:#75715e"></span>        resp<span style="color:#f92672">.</span><span style="color:#a6e22e">addCookie</span><span style="color:#f92672">(</span>c<span style="color:#f92672">);</span>
   
   
<span style="color:#75715e">//获取Cookie
</span><span style="color:#75715e"></span>        Cookie<span style="color:#f92672">[]</span> cookies<span style="color:#f92672">=</span>req<span style="color:#f92672">.</span><span style="color:#a6e22e">getCookies</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Cookie cookie <span style="color:#f92672">:</span> cookies<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>cookie<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">().</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;city&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
                <span style="color:#75715e">//打印Cookie的键
</span><span style="color:#75715e"></span>                System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>cookie<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">());</span>
                <span style="color:#75715e">//打印Cookie的值
</span><span style="color:#75715e"></span>                System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>cookie<span style="color:#f92672">.</span><span style="color:#a6e22e">getValue</span><span style="color:#f92672">());</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
</code></pre></div></li>
<li>
<p>cookie能不能存中文？</p>
<p>在tomcat 8 之前 cookie中不能直接存储中文数据，需要将中文数据转码：一般采用URL编码(%E3)</p>
<p>在tomcat 8 之后 cookie支持中文数据。特殊字符还是不支持，建议使用URL编码存储URL解码解析</p>
</li>
<li>
<p>cookie共享问题？</p>
</li>
</ol>
<ul>
<li>
<p>假设在一个tomcat服务器中，部署了多个web项目，那么在这些web项目中cookie能不能共享？</p>
<p>默认情况下cookie不能共享！若要共享，需设置cookie的获取范围：setPath(String path)；</p>
<p>如果要共享，则可以将path设置为根目录&rdquo;/“（默认为当前的虚拟目录！）</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//创建Cookie
</span><span style="color:#75715e"></span>Cookie c<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> Cookie<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;city&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;beijing&#34;</span><span style="color:#f92672">);</span>
c<span style="color:#f92672">.</span><span style="color:#a6e22e">setPath</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/&#34;</span><span style="color:#f92672">);</span>
resp<span style="color:#f92672">.</span><span style="color:#a6e22e">addCookie</span><span style="color:#f92672">(</span>c<span style="color:#f92672">);</span>
</code></pre></div></li>
<li>
<p>不同的tomcat服务器间cookie共享问题？</p>
<p>setDomain(String path)：如果设置一级域名相同，那么多个服务器之间cookie可以共享！</p>
<p>例：setDomain(&quot;.baidu.com&rdquo;)，那么tieba.baidu.com和news.baidu.com中cookie可以共享！</p>
</li>
</ul>
<h5 id="cookie的特点和作用">Cookie的特点和作用</h5>
<p>特点：</p>
<ol>
<li>
<p>cookie存储数据在客户端浏览器</p>
</li>
<li>
<p>浏览器对于单个cookie 的大小有限制(4kb)；对同一个域名下的总cookie数量也有限制(20个)</p>
</li>
</ol>
<p>作用：</p>
<ol>
<li>
<p>cookie一般用于存储少量的不太敏感的数据</p>
</li>
<li>
<p>在不登录的情况下，完成服务器对客户端的身份识别；例：京东购物添加购物车</p>
</li>
</ol>
<h5 id="案例上次访问时间">案例：上次访问时间</h5>
<p>需求：</p>
<ol>
<li>
<p>访问一个Servlet，如果是第一次访问，则提示：您好，欢迎您首次访问。</p>
</li>
<li>
<p>如果不是第一次访问，则提示：欢迎回来，您上次访问时间为:显示时间字符串</p>
</li>
</ol>
<p>分析：可以采用Cookie来完成！</p>
<p>在服务器中的Servlet判断是否有一个名为lastTime的cookie？</p>
<ol>
<li>
<p>有：不是第一次访问！</p>
<p>响应数据：&ldquo;欢迎回来，您上次访问时间为:xxxx年xx月xx日 xx:xx:xx&rdquo;</p>
<p>写回Cookie：lastTime=xxxx年xx月xx日 xx:xx:xx</p>
</li>
<li>
<p>没有：是第一次访问！</p>
<p>响应数据：&ldquo;您好，欢迎您首次访问&rdquo;</p>
<p>写回Cookie：lastTime=xxxx年xx月xx日 xx:xx:xx</p>
</li>
</ol>
<p>代码实现：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/E_Servlet&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">E_Servlet</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        
        Cookie<span style="color:#f92672">[]</span> cookies<span style="color:#f92672">=</span>req<span style="color:#f92672">.</span><span style="color:#a6e22e">getCookies</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">boolean</span> flag<span style="color:#f92672">=</span><span style="color:#66d9ef">false</span><span style="color:#f92672">;</span><span style="color:#75715e">//记录以前是否访问过
</span><span style="color:#75715e"></span>        resp<span style="color:#f92672">.</span><span style="color:#a6e22e">setContentType</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;text/html;charset=utf-8&#34;</span><span style="color:#f92672">);</span>
        
        <span style="color:#75715e">//再次访问
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Cookie cookie <span style="color:#f92672">:</span> cookies<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">//获取最后一次访问时间
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>cookie<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">().</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;lastTime&#34;</span><span style="color:#f92672">)){</span>
                flag<span style="color:#f92672">=</span><span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
                String dataTime<span style="color:#f92672">=</span>cookie<span style="color:#f92672">.</span><span style="color:#a6e22e">getValue</span><span style="color:#f92672">();</span><span style="color:#75715e">//最后一次访问的时间
</span><span style="color:#75715e"></span>                dataTime<span style="color:#f92672">=</span> URLDecoder<span style="color:#f92672">.</span><span style="color:#a6e22e">decode</span><span style="color:#f92672">(</span>dataTime<span style="color:#f92672">,</span><span style="color:#e6db74">&#34;utf-8&#34;</span><span style="color:#f92672">);</span><span style="color:#75715e">//进行解码
</span><span style="color:#75715e"></span>                resp<span style="color:#f92672">.</span><span style="color:#a6e22e">getWriter</span><span style="color:#f92672">().</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;欢迎您，您上次访问的时间为：&#34;</span><span style="color:#f92672">+</span>dataTime<span style="color:#f92672">);</span>

                Date now<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> Date<span style="color:#f92672">();</span>
                SimpleDateFormat dateFormat<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> SimpleDateFormat<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;yyyy-MM-dd HH:mm:ss&#34;</span><span style="color:#f92672">);</span>
                String nowTime<span style="color:#f92672">=</span>dateFormat<span style="color:#f92672">.</span><span style="color:#a6e22e">format</span><span style="color:#f92672">(</span>now<span style="color:#f92672">);</span>
                nowTime<span style="color:#f92672">=</span> URLEncoder<span style="color:#f92672">.</span><span style="color:#a6e22e">encode</span><span style="color:#f92672">(</span>nowTime<span style="color:#f92672">,</span><span style="color:#e6db74">&#34;utf-8&#34;</span><span style="color:#f92672">);</span>
                cookie<span style="color:#f92672">.</span><span style="color:#a6e22e">setValue</span><span style="color:#f92672">(</span>nowTime<span style="color:#f92672">);</span>
                resp<span style="color:#f92672">.</span><span style="color:#a6e22e">addCookie</span><span style="color:#f92672">(</span>cookie<span style="color:#f92672">);</span>
                <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        
        <span style="color:#75715e">//第一次访问
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>cookies<span style="color:#f92672">==</span><span style="color:#66d9ef">null</span><span style="color:#f92672">||</span>cookies<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">==</span>0<span style="color:#f92672">||</span>flag<span style="color:#f92672">==</span><span style="color:#66d9ef">false</span><span style="color:#f92672">){</span>
            Date d1<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> date<span style="color:#f92672">();</span>
            SimpleDateFormat dateFormat<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> SimpleDateFormat<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;yyyy-MM-dd HH:mm:ss&#34;</span><span style="color:#f92672">);</span>
            String n1<span style="color:#f92672">=</span>dateFormat<span style="color:#f92672">.</span><span style="color:#a6e22e">format</span><span style="color:#f92672">(</span>d1<span style="color:#f92672">);</span>
            n1<span style="color:#f92672">=</span>URLEncoder<span style="color:#f92672">.</span><span style="color:#a6e22e">encode</span><span style="color:#f92672">(</span>n1<span style="color:#f92672">,</span><span style="color:#e6db74">&#34;utf-8&#34;</span><span style="color:#f92672">);</span>
            Cookie c<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> Cookie<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;lastTime&#34;</span><span style="color:#f92672">,</span>n1<span style="color:#f92672">);</span>
            resp<span style="color:#f92672">.</span><span style="color:#a6e22e">addCookie</span><span style="color:#f92672">(</span>c<span style="color:#f92672">);</span>
            resp<span style="color:#f92672">.</span><span style="color:#a6e22e">getWriter</span><span style="color:#f92672">().</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;欢迎您，您是第一次访问！&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>req<span style="color:#f92672">,</span>resp<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="52-jsp入门">5.2 JSP入门</h4>
<p>Java Server Pages： java服务器端页面，可以理解为一个特殊的页面，其中既可以指定定义html标签，又可以定义java代码。用于简化书写！例：resp.getWriter().write(&quot;&lt;p&gt;欢迎您，您是第一次访问！&lt;/p&gt;&rdquo;);</p>
<p>JSP本质上就是一个Servlet！项目启动后，会被服务器端当作Servlet类编译成字节码对象！</p>
<ul>
<li>JSP的脚本</li>
</ul>
<ol>
<li>
<p>&lt;% 代码 %&gt;：定义的java代码，service方法中可以定义什么，该脚本中就可以定义什么。</p>
</li>
<li>
<p>&lt;%! 代码 %&gt;：定义的java代码，在jsp转换后的java类的成员位置(不常用，防止共享数据的线程安全问题)</p>
</li>
<li>
<p>&lt;%= 代码 %&gt;：定义的java代码，会输出到页面上，输出语句中可以定义什么，该脚本中就可以定义什么。</p>
</li>
</ol>
<pre><code class="language-jsp" data-lang="jsp">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;$Title$&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
  &lt;%
    System.out.println(&quot;JSP：控制台输出&quot;);
  %&gt;
  &lt;%!
    //用来定义成员变量
    int i=1;
  %&gt;
  &lt;%=&quot;JSP:网页端输出&quot;%&gt;
  &lt;p&gt;HTML:网页端输出&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;

</code></pre><ul>
<li>JSP的内置对象</li>
</ul>
<p>在jsp页面中不需要获取和创建，可以直接使用的对象（9个）来看其中之三</p>
<p>request：封装请求的信息</p>
<p>response：封装响应的信息</p>
<p>out：字符输出流对象，可以将数据输出到页面上！和response.getWriter()类似</p>
<pre><code class="language-jsp" data-lang="jsp">&lt;%
    System.out.println(request.getContextPath());//打印虚拟目录到控制台
    response.getWriter().write(&quot;response输出信息到页面&quot;);
    out.write(&quot;out输出信息到页面&quot;);
  %&gt;
</code></pre><p>response.getWriter()和out.write()的区别：在tomcat服务器真正给客户端做出响应之前，会先找response缓冲区数据，再找out缓冲区数据。所以，response.getWriter()数据输出永远在out.write()之前！一般用out</p>
<h4 id="53-session">5.3 Session</h4>
<p>Session:服务器端会话技术，在一次会话的多次请求间共享数据，将数据保存在服务器端的对象HttpSession中</p>
<h5 id="快速入门">快速入门：</h5>
<ol>
<li>
<p>获取HttpSession对象：HttpSession session = request.getSession();</p>
</li>
<li>
<p>使用HttpSession对象：</p>
<p>Object getAttribute(String name)</p>
<p>void setAttribute(String name, Object value)</p>
<p>void removeAttribute(String name)</p>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/F_Servlet&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">F_Servlet</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#75715e">//1.获取Session
</span><span style="color:#75715e"></span>        HttpSession session<span style="color:#f92672">=</span>req<span style="color:#f92672">.</span><span style="color:#a6e22e">getSession</span><span style="color:#f92672">();</span>
        <span style="color:#75715e">//2.添加属性及值
</span><span style="color:#75715e"></span>        session<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;msg&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;hello&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>req<span style="color:#f92672">,</span>resp<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/G_Servlet&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">G_Servlet</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#75715e">//1.获取Session
</span><span style="color:#75715e"></span>        HttpSession session<span style="color:#f92672">=</span>req<span style="color:#f92672">.</span><span style="color:#a6e22e">getSession</span><span style="color:#f92672">();</span>
        <span style="color:#75715e">//2.获取session内容
</span><span style="color:#75715e"></span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>session<span style="color:#f92672">.</span><span style="color:#a6e22e">getAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;msg&#34;</span><span style="color:#f92672">));</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>req<span style="color:#f92672">,</span>resp<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="session的原理">Session的原理</h5>
<p>Session的实现是依赖于Cookie的!</p>
<p><img src="../../../Typora/works/img/image-20210202175555986.png" alt="image-20210202175555986"></p>
<h5 id="session的细节">Session的细节</h5>
<ol>
<li>
<p>当客户端关闭后，服务器不关闭，两次获取session是否为同一个？</p>
<p>不是同一个！（默认情况下）</p>
<p>如果需要相同，则可以创建Cookie，键为JSESSIONID，设置最大存活时间，让cookie持久化保存。</p>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//获取Session
</span><span style="color:#75715e"></span>HttpSession session<span style="color:#f92672">=</span>req<span style="color:#f92672">.</span><span style="color:#a6e22e">getSession</span><span style="color:#f92672">();</span>
<span style="color:#75715e">//将Session存入Cookie
</span><span style="color:#75715e"></span>Cookie cookie<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> Cookie<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;JSESSIONID&#34;</span><span style="color:#f92672">,</span>session<span style="color:#f92672">.</span><span style="color:#a6e22e">getId</span><span style="color:#f92672">());</span>
cookie<span style="color:#f92672">.</span><span style="color:#a6e22e">setMaxAge</span><span style="color:#f92672">(</span>60<span style="color:#f92672">*</span>60<span style="color:#f92672">);</span>
resp<span style="color:#f92672">.</span><span style="color:#a6e22e">addCookie</span><span style="color:#f92672">(</span>cookie<span style="color:#f92672">);</span>
<span style="color:#75715e">//打印Session对象
</span><span style="color:#75715e"></span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>session<span style="color:#f92672">);</span>
</code></pre></div><ol start="2">
<li>
<p>客户端不关闭，服务器关闭后，两次获取的session是同一个吗？</p>
<p>不是同一个，但是要确保数据不丢失。tomcat自动完成以下工作：</p>
<p>session的钝化：在服务器正常关闭之前，将session对象系列化到硬盘上</p>
<p>session的活化：在服务器启动后，将session文件转化为内存中的session对象即可。</p>
</li>
<li>
<p>session什么时候被销毁？</p>
<p>服务器关闭；</p>
<p>session对象调用invalidate()；</p>
<p>session默认失效时间 30分钟；设置位置：tomcat/conf/web.xml/session-timeout</p>
</li>
</ol>
<h5 id="session的特点">Session的特点</h5>
<ol>
<li>
<p>session用于存储一次会话的多次请求的数据，存在服务器端</p>
</li>
<li>
<p>session可以存储任意类型，任意大小的数据</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>Session</th>
<th>Cookie</th>
</tr>
</thead>
<tbody>
<tr>
<td>Session存储数据在服务器端</td>
<td>Cookie在客户端</td>
</tr>
<tr>
<td>Session没有数据大小限制</td>
<td>Cookie有</td>
</tr>
<tr>
<td>Session数据安全</td>
<td>Cookie相对于不安全</td>
</tr>
</tbody>
</table>
<h4 id="54-验证码案例">5.4 验证码案例</h4>
<h5 id="案例需求">案例需求：</h5>
<ol>
<li>
<p>访问带有验证码的登录页面login.jsp</p>
</li>
<li>
<p>用户输入用户名，密码以及验证码。</p>
<p>如果用户名和密码输入有误，跳转登录页面，提示:用户名或密码错误</p>
<p>如果验证码输入有误，跳转登录页面，提示：验证码错误</p>
<p>如果全部输入正确，则跳转到主页success.jsp，显示：用户名,欢迎您</p>
</li>
</ol>
<h5 id="业务逻辑层-1">业务逻辑层：</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.Servlet<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> ...

<span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/loginServlet&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">loginServlet</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>

        <span style="color:#75715e">//1.获取到用户名，密码和验证码
</span><span style="color:#75715e"></span>        String userName <span style="color:#f92672">=</span> req<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;userName&#34;</span><span style="color:#f92672">);</span>
        String passWord <span style="color:#f92672">=</span> req<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;passWord&#34;</span><span style="color:#f92672">);</span>
        String checkCode <span style="color:#f92672">=</span> req<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;checkCode&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#75715e">//2.比较验证码是否正确
</span><span style="color:#75715e"></span>        HttpSession session <span style="color:#f92672">=</span> req<span style="color:#f92672">.</span><span style="color:#a6e22e">getSession</span><span style="color:#f92672">();</span>
        <span style="color:#75715e">//忽略大小写的比较
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>checkCode<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">((</span>String<span style="color:#f92672">)</span> session<span style="color:#f92672">.</span><span style="color:#a6e22e">getAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;checkCode_session&#34;</span><span style="color:#f92672">)))</span> <span style="color:#f92672">{</span>
            session<span style="color:#f92672">.</span><span style="color:#a6e22e">removeAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;checkCode_session&#34;</span><span style="color:#f92672">);</span>
            <span style="color:#75715e">//3.验证用户名和密码
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>userName<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;zhangsan&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span> passWord<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;123&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
                session<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;user&#34;</span><span style="color:#f92672">,</span> userName<span style="color:#f92672">);</span>
                <span style="color:#75715e">//重定向 跳转页面
</span><span style="color:#75715e"></span>                resp<span style="color:#f92672">.</span><span style="color:#a6e22e">sendRedirect</span><span style="color:#f92672">(</span>req<span style="color:#f92672">.</span><span style="color:#a6e22e">getContextPath</span><span style="color:#f92672">()</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/success.jsp&#34;</span><span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
                req<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;error_message&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;用户名或密码错误！&#34;</span><span style="color:#f92672">);</span>
                <span style="color:#75715e">//请求转发 跳转页面
</span><span style="color:#75715e"></span>                req<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequestDispatcher</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/login.jsp&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">forward</span><span style="color:#f92672">(</span>req<span style="color:#f92672">,</span> resp<span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
            req<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;error_message&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;验证码错误！&#34;</span><span style="color:#f92672">);</span>
            <span style="color:#75715e">//请求转发 跳转页面
</span><span style="color:#75715e"></span>            req<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequestDispatcher</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/login.jsp&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">forward</span><span style="color:#f92672">(</span>req<span style="color:#f92672">,</span> resp<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>req<span style="color:#f92672">,</span> resp<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.Servlet<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> ...

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * 验证码
</span><span style="color:#75715e"> */</span>
<span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/CheckCodeServlet&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CheckCodeServlet</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest request<span style="color:#f92672">,</span> HttpServletResponse response<span style="color:#f92672">)</span><span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
		
		<span style="color:#75715e">//服务器通知浏览器不要缓存
</span><span style="color:#75715e"></span>		response<span style="color:#f92672">.</span><span style="color:#a6e22e">setHeader</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;pragma&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;no-cache&#34;</span><span style="color:#f92672">);</span>
		response<span style="color:#f92672">.</span><span style="color:#a6e22e">setHeader</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;cache-control&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;no-cache&#34;</span><span style="color:#f92672">);</span>
		response<span style="color:#f92672">.</span><span style="color:#a6e22e">setHeader</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;expires&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;0&#34;</span><span style="color:#f92672">);</span>
		
		<span style="color:#75715e">//在内存中创建一个长80，宽30的图片，默认黑色背景
</span><span style="color:#75715e"></span>		<span style="color:#75715e">//参数一：长
</span><span style="color:#75715e"></span>		<span style="color:#75715e">//参数二：宽
</span><span style="color:#75715e"></span>		<span style="color:#75715e">//参数三：颜色
</span><span style="color:#75715e"></span>		<span style="color:#66d9ef">int</span> width <span style="color:#f92672">=</span> 80<span style="color:#f92672">;</span>
		<span style="color:#66d9ef">int</span> height <span style="color:#f92672">=</span> 30<span style="color:#f92672">;</span>
		BufferedImage image <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedImage<span style="color:#f92672">(</span>width<span style="color:#f92672">,</span>height<span style="color:#f92672">,</span>BufferedImage<span style="color:#f92672">.</span><span style="color:#a6e22e">TYPE_INT_RGB</span><span style="color:#f92672">);</span>
		
		<span style="color:#75715e">//获取画笔
</span><span style="color:#75715e"></span>		Graphics g <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span><span style="color:#a6e22e">getGraphics</span><span style="color:#f92672">();</span>
		<span style="color:#75715e">//设置画笔颜色为灰色
</span><span style="color:#75715e"></span>		g<span style="color:#f92672">.</span><span style="color:#a6e22e">setColor</span><span style="color:#f92672">(</span>Color<span style="color:#f92672">.</span><span style="color:#a6e22e">GRAY</span><span style="color:#f92672">);</span>
		<span style="color:#75715e">//填充图片
</span><span style="color:#75715e"></span>		g<span style="color:#f92672">.</span><span style="color:#a6e22e">fillRect</span><span style="color:#f92672">(</span>0<span style="color:#f92672">,</span>0<span style="color:#f92672">,</span> width<span style="color:#f92672">,</span>height<span style="color:#f92672">);</span>
		
		<span style="color:#75715e">//产生4个随机验证码，12Ey
</span><span style="color:#75715e"></span>		String checkCode <span style="color:#f92672">=</span> getCheckCode<span style="color:#f92672">();</span>
		<span style="color:#75715e">//将验证码放入HttpSession中
</span><span style="color:#75715e"></span>		request<span style="color:#f92672">.</span><span style="color:#a6e22e">getSession</span><span style="color:#f92672">().</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;CHECKCODE_SERVER&#34;</span><span style="color:#f92672">,</span>checkCode<span style="color:#f92672">);</span>
		
		<span style="color:#75715e">//设置画笔颜色为黄色
</span><span style="color:#75715e"></span>		g<span style="color:#f92672">.</span><span style="color:#a6e22e">setColor</span><span style="color:#f92672">(</span>Color<span style="color:#f92672">.</span><span style="color:#a6e22e">YELLOW</span><span style="color:#f92672">);</span>
		<span style="color:#75715e">//设置字体的小大
</span><span style="color:#75715e"></span>		g<span style="color:#f92672">.</span><span style="color:#a6e22e">setFont</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Font<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;黑体&#34;</span><span style="color:#f92672">,</span>Font<span style="color:#f92672">.</span><span style="color:#a6e22e">BOLD</span><span style="color:#f92672">,</span>24<span style="color:#f92672">));</span>
		<span style="color:#75715e">//向图片上写入验证码
</span><span style="color:#75715e"></span>		g<span style="color:#f92672">.</span><span style="color:#a6e22e">drawString</span><span style="color:#f92672">(</span>checkCode<span style="color:#f92672">,</span>15<span style="color:#f92672">,</span>25<span style="color:#f92672">);</span>
		
		<span style="color:#75715e">//将内存中的图片输出到浏览器
</span><span style="color:#75715e"></span>		<span style="color:#75715e">//参数一：图片对象
</span><span style="color:#75715e"></span>		<span style="color:#75715e">//参数二：图片的格式，如PNG,JPG,GIF
</span><span style="color:#75715e"></span>		<span style="color:#75715e">//参数三：图片输出到哪里去
</span><span style="color:#75715e"></span>		ImageIO<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>image<span style="color:#f92672">,</span><span style="color:#e6db74">&#34;PNG&#34;</span><span style="color:#f92672">,</span>response<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">());</span>
	<span style="color:#f92672">}</span>
	<span style="color:#75715e">/**
</span><span style="color:#75715e">	 * 产生4位随机字符串 
</span><span style="color:#75715e">	 */</span>
	<span style="color:#66d9ef">private</span> String <span style="color:#a6e22e">getCheckCode</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
		String base <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;0123456789ABCDEFGabcdefg&#34;</span><span style="color:#f92672">;</span>
		<span style="color:#66d9ef">int</span> size <span style="color:#f92672">=</span> base<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">();</span>
		Random r <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Random<span style="color:#f92672">();</span>
		StringBuffer sb <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> StringBuffer<span style="color:#f92672">();</span>
		<span style="color:#66d9ef">for</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i<span style="color:#f92672">=</span>1<span style="color:#f92672">;</span>i<span style="color:#f92672">&lt;=</span>4<span style="color:#f92672">;</span>i<span style="color:#f92672">++){</span>
			<span style="color:#75715e">//产生0到size-1的随机值
</span><span style="color:#75715e"></span>			<span style="color:#66d9ef">int</span> index <span style="color:#f92672">=</span> r<span style="color:#f92672">.</span><span style="color:#a6e22e">nextInt</span><span style="color:#f92672">(</span>size<span style="color:#f92672">);</span>
			<span style="color:#75715e">//在base字符串中获取下标为index的字符
</span><span style="color:#75715e"></span>			<span style="color:#66d9ef">char</span> c <span style="color:#f92672">=</span> base<span style="color:#f92672">.</span><span style="color:#a6e22e">charAt</span><span style="color:#f92672">(</span>index<span style="color:#f92672">);</span>
			<span style="color:#75715e">//将c放入到StringBuffer中去
</span><span style="color:#75715e"></span>			sb<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span>c<span style="color:#f92672">);</span>
		<span style="color:#f92672">}</span>
		<span style="color:#66d9ef">return</span> sb<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">();</span>
	<span style="color:#f92672">}</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest request<span style="color:#f92672">,</span> HttpServletResponse response<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
		<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>request<span style="color:#f92672">,</span>response<span style="color:#f92672">);</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="界面层-1">界面层：</h5>
<pre><code class="language-jsp" data-lang="jsp">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;登录页面&lt;/title&gt;
    &lt;script&gt;
        window.onload=function () {
            document.getElementById(&quot;img&quot;).onclick=function(){
                document.getElementById(&quot;img&quot;).src=&quot;/loginTest/CheckCodeServlet?now=&quot;+new Date().getTime();
            }

        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;form action=&quot;/loginTest/loginServlet&quot; method=&quot;post&quot;&gt;
    用户名：&lt;input type=&quot;text&quot; name=&quot;userName&quot;&gt;&lt;br/&gt;
    密码：&lt;input type=&quot;password&quot; name=&quot;passWord&quot;&gt;&lt;br/&gt;
    验证码：&lt;input type=&quot;text&quot; name=&quot;checkCode&quot;&gt;&lt;img id=&quot;img&quot; src=&quot;/loginTest/CheckCodeServlet&quot;&gt;&lt;br/&gt;
    &lt;input type=&quot;submit&quot; value=&quot;登录&quot;&gt;
&lt;/form&gt;
&lt;%=request.getAttribute(&quot;error_message&quot;)!=null?request.getAttribute(&quot;error_message&quot;):&quot;&quot;%&gt;
&lt;/body&gt;
&lt;/html&gt;

</code></pre><pre><code class="language-jsp" data-lang="jsp">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;登录成功页面&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;%=session.getAttribute(&quot;user&quot;)%&gt;欢迎您！
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>访问：http://localhost:8080/loginTest/login.jsp</p>
<hr>
<h3 id="第六章">第六章</h3>
<hr>
<h5 id="本章内容-5">本章内容</h5>
<ul>
<li>
<p>JSP</p>
</li>
<li>
<p>MVC开发模式</p>
</li>
<li>
<p>EL表达式</p>
</li>
<li>
<p>JSTL标签</p>
</li>
</ul>
<hr>
<h4 id="61-jsp">6.1 JSP</h4>
<h5 id="jsp指令">Jsp指令</h5>
<p>作用：用于配置JSP页面，导入资源文件</p>
<p>格式：&lt;%@ 指令名称 属性名1=属性值1 属性名2=属性值2 &hellip; %&gt;</p>
<p>分类：</p>
<ol>
<li>
<p>page ： 配置JSP页面的</p>
<p>contentType：等同于response.setContentType()设置响应体的mime类型以及字符集；设置当前jsp页面的编码（只能是高级的IDE才能生效，使用低级工具，则需要设置pageEncoding属性设置当前页面的字符集）</p>
<p>import：导包</p>
<p>errorPage：当前页面发生异常后，会自动跳转到指定的错误页面</p>
<p>isErrorPage：标识当前页面是否为错误页面？true：是，可以使用内置对象exception；false：否，默认</p>
</li>
<li>
<p>include ： 页面包含的。导入页面的资源文件&lt;%@include file=&quot;top.jsp&rdquo;%&gt;</p>
</li>
<li>
<p>taglib ： 导入资源&lt;%@ taglib prefix=&quot;c&rdquo; uri=&quot;http://java.sun.com/jsp/jstl/core&rdquo; %&gt;其中，prefix为前缀，自定义的</p>
</li>
</ol>
<h5 id="jsp注释">Jsp注释</h5>
<ol>
<li>
<p>html注释： <!-- raw HTML omitted -->只能注释html代码片段</p>
</li>
<li>
<p>jsp注释：&lt;%&ndash; &ndash;%&gt;可以注释所有，推荐使用！</p>
</li>
</ol>
<pre><code class="language-jsp" data-lang="jsp">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; import=&quot;java.util.Random&quot; errorPage=&quot;error.jsp&quot; isErrorPage=&quot;false&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;$Title$&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;

  &lt;%--  导入页面资源文件top.jsp--%&gt;
  &lt;%@ include file=&quot;top.jsp&quot;%&gt;

  &lt;%
    //获取随机变量i
    Random rand =new Random(25);
    int i=rand.nextInt(10);
    //出错；除零
    int j = i/0;
  %&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre><h5 id="jsp内置对象">Jsp内置对象</h5>
<p>在jsp页面中不需要创建，直接使用的对象！一共有9个：</p>
<table>
<thead>
<tr>
<th>变量名</th>
<th>真实类型</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>pageContext</td>
<td>PageContext</td>
<td>当前页面共享数据，还可以获取其他八个内置对象</td>
</tr>
<tr>
<td>request</td>
<td>HttpServletRequest</td>
<td>一次请求访问的多个资源(转发)</td>
</tr>
<tr>
<td>session</td>
<td>HttpSession</td>
<td>一次会话的多个请求间</td>
</tr>
<tr>
<td>application</td>
<td>ServletContext</td>
<td>所有用户间共享数据</td>
</tr>
<tr>
<td>response</td>
<td>HttpServletResponse</td>
<td>响应对象</td>
</tr>
<tr>
<td>page</td>
<td>Object</td>
<td>当前页面(Servlet)的对象 this</td>
</tr>
<tr>
<td>out</td>
<td>JspWriter</td>
<td>输出对象，数据输出到页面上</td>
</tr>
<tr>
<td>config</td>
<td>ServletConfig</td>
<td>Servlet的配置对象</td>
</tr>
<tr>
<td>exception</td>
<td>Throwable</td>
<td>异常对象</td>
</tr>
</tbody>
</table>
<pre><code class="language-jsp" data-lang="jsp">&lt;%pageContext.setAttribute(&quot;msg&quot;,&quot;hello&quot;);%&gt;
&lt;%=pageContext.getAttribute(&quot;msg&quot;)%&gt;
</code></pre><h4 id="62-mvc开发模式">6.2 MVC开发模式</h4>
<h5 id="jsp演变历史">Jsp演变历史</h5>
<ol>
<li>
<p>早期：只有servlet，只能使用response输出标签数据，非常麻烦！</p>
</li>
<li>
<p>后来：Jsp简化了Servlet的开发，但如果过度使用jsp，在jsp中即写大量的java代码又写html表，造成难于维护，难于分工协作！</p>
</li>
<li>
<p>再后来：java的web开发，借鉴mvc开发模式，使得程序的设计更加合理性！</p>
</li>
</ol>
<h5 id="mvc开发者模式">MVC开发者模式</h5>
<table>
<thead>
<tr>
<th>模块简写</th>
<th>模块名称</th>
<th>实现工具</th>
<th>模块作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>M</td>
<td>Model，模型</td>
<td>JavaBean</td>
<td>完成具体的业务操作，如：查询数据库，封装对象</td>
</tr>
<tr>
<td>V</td>
<td>View，视图</td>
<td>JSP</td>
<td>渲染&amp;展示数据</td>
</tr>
<tr>
<td>C</td>
<td>Controller，控制器</td>
<td>Servlet</td>
<td>获取用户的输入&amp;调用模型&amp;将数据交给视图进行展示</td>
</tr>
</tbody>
</table>
<p><img src="../../../Typora/works/img/image-20210203100537211.png" alt="image-20210203100537211"></p>
<h5 id="mvc的优缺点">MVC的优缺点</h5>
<p>优点：</p>
<ul>
<li>
<p>耦合性低，方便维护，可以利于分工协作</p>
</li>
<li>
<p>重用性高</p>
</li>
</ul>
<p>缺点：</p>
<ul>
<li>使得项目架构变得复杂，对开发人员要求高</li>
</ul>
<h4 id="64-el表达式">6.4 EL表达式</h4>
<p>概念：Expression Language 表达式语言</p>
<p>作用：替换和简化jsp页面中java代码的编写</p>
<p>语法：${表达式}</p>
<h5 id="el表达式的使用">EL表达式的使用</h5>
<ol>
<li>
<p>运算</p>
<p>运算符：</p>
<p>​	算数运算符： + - \ /(div) %(mod)</p>
<p>​	比较运算符： &gt; &lt; &gt;= &lt;= == !=</p>
<p>​	逻辑运算符： &amp;&amp;(and) ||(or) !(not)</p>
<p>​	空运算符： empty；功能是用于判断字符串、集合、数组对象是否为null或者长度是否为0</p>
<pre><code> ${empty list}：判断字符串、集合、数组对象是否为null或者长度为0

 ${not empty str}：表示判断字符串、集合、数组对象是否不为null 并且 长度&gt;0
</code></pre>
<pre><code class="language-jsp" data-lang="jsp">&lt;%--  运算--%&gt;
${(3+4)*5}
</code></pre></li>
<li>
<p>获取值，el表达式只能从域对象中获取值：</p>
<p>${域名称.键名}：从指定域中获取指定键的值</p>
<p>​	域名称：</p>
<p>​	pageScope &ndash;&gt; pageContext</p>
<p>​	requestScope  &ndash;&gt; request</p>
<p>​	sessionScope  &ndash;&gt; session</p>
<p>​	applicationScope &ndash;&gt; application（ServletContext）</p>
<p>${键名}：表示依次从最小的域中查找是否有该键对应的值，直到找到为止。</p>
<pre><code class="language-jsp" data-lang="jsp">&lt;%--  获取值--%&gt;
&lt;%
request.setAttribute(&quot;name&quot;,&quot;iNuo&quot;);
session.setAttribute(&quot;name&quot;,&quot;sNan&quot;);
%&gt;
${requestScope.name}
${name} &lt;%--  输出：iNuo--%&gt;
</code></pre></li>
<li>
<p>获取对象、List集合、Map集合的值</p>
<p>对象：${域名称.键名.属性名}，本质上会去调用对象的getter方法</p>
<p>List集合：${域名称.键名[索引]}</p>
<p>Map集合：</p>
<p>${域名称.键名.key名称}</p>
<p>${域名称.键名[&ldquo;key名称&rdquo;]}</p>
<pre><code class="language-jsp" data-lang="jsp">&lt;%--  获取对象、List集合、Map集合的值--%&gt;
  &lt;%
    User u=new User();
    u.setName(&quot;zhangsanf&quot;);
    u.setAge(102);
    request.setAttribute(&quot;user&quot;,u);
       
    List list=new ArrayList();
    list.add(&quot;abc&quot;);
    list.add(&quot;xyz&quot;);
    request.setAttribute(&quot;list&quot;,list);
   
    Map map=new HashMap();
    map.put(&quot;name&quot;,&quot;xiaozhang&quot;);
    map.put(&quot;addr&quot;,&quot;beijing&quot;);
    request.setAttribute(&quot;map&quot;,map);
  %&gt;
  ${user.name}
  ${list[0]}
  ${map.name}
</code></pre></li>
<li>
<p>pageContext获取其它内置对象（获取虚拟目录）</p>
<p>el表达式中有11个隐式对象；pageContext 获取jsp其他八个内置对象</p>
<pre><code class="language-jsp" data-lang="jsp">&lt;%--  动态获取虚拟目录--%&gt;
  ${pageContext.request.contextPath}
</code></pre></li>
</ol>
<h4 id="65-jstl">6.5 JSTL</h4>
<p>JavaServer Pages Tag Library JSP标准标签库，用于简化和替换jsp页面上的java代码！</p>
<p>使用步骤：</p>
<ol>
<li>
<p>导入jstl相关jar包；javax.servlet.jsp.jstl.jar、jstl-impl.jar</p>
</li>
<li>
<p>引入标签库；taglib指令： &lt;%@ taglib %&gt;</p>
</li>
<li>
<p>使用标签；例：If标签 foreach标签</p>
</li>
</ol>
<p>常用的JSTL标签：</p>
<ol>
<li>
<p>if：相当于java代码的if语句</p>
<p>属性：test 必须属性，接受boolean表达式</p>
</li>
</ol>
<p>​         如果表达式为true，则显示if标签体内容，如果为false，则不显示标签体内容</p>
<p>​         一般情况下，test属性值会结合el表达式一起使用</p>
<p>​      注意：c:if标签没有else情况，想要else情况，则可以在定义一个c:if标签</p>
<ol start="2">
<li>
<p>choose：相当于java代码的switch语句</p>
<p>使用choose标签声明      相当于switch声明</p>
<p>使用when标签做判断      相当于case</p>
</li>
</ol>
<p>​       使用otherwise标签做其他情况的声明   相当于default</p>
<ol start="3">
<li>foreach：相当于java代码的for语句</li>
</ol>
<pre><code class="language-jsp" data-lang="jsp">&lt;%@ page import=&quot;java.util.ArrayList&quot; %&gt;
&lt;%@ page import=&quot;com.iNuo.Jsp.User&quot; %&gt;
&lt;%@ page import=&quot;java.util.List&quot; %&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;JSP标准标签库&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;%--if语句：相当于java代码的if语句--%&gt;
&lt;c:if test=&quot;true&quot;&gt;
    输出此内容到浏览器页面！
&lt;/c:if&gt;

&lt;%--foreach：相当于java代码的for语句--%&gt;
&lt;c:forEach begin=&quot;1&quot; end=&quot;10&quot; var=&quot;i&quot; varStatus=&quot;s&quot;&gt;
    ${i}
    ${s.index}---${s.count}
&lt;/c:forEach&gt;

&lt;%--foreach遍历集合--%&gt;
&lt;%
    List&lt;User&gt; list=new ArrayList&lt;User&gt;();
    User u1=new User();
    u1.setId(1);
    u1.setName(&quot;zhnagsan&quot;);
    u1.setAge(23);
    User u2=new User();
    u2.setId(2);
    u2.setName(&quot;slijan&quot;);
    u2.setAge(43);
    list.add(u1);
    list.add(u2);
    request.setAttribute(&quot;list&quot;,list);
%&gt;
&lt;c:forEach items=&quot;${list}&quot; var=&quot;str&quot; varStatus=&quot;s&quot;&gt;
    ${str.name}---${str.age}
    ${s.index}---${s.count}
&lt;/c:forEach&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><h5 id="隔行变色表格案例">隔行变色表格案例</h5>
<p>需求：在request域中有一个存有User对象的List集合。需要使用jstl+el将list集合数据展示到jsp页面的表格table中，要求隔行变色</p>
<pre><code class="language-jsp" data-lang="jsp">&lt;%@ page import=&quot;java.util.ArrayList&quot; %&gt;
&lt;%@ page import=&quot;com.iNuo.Jsp.User&quot; %&gt;
&lt;%@ page import=&quot;java.util.List&quot; %&gt;
&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;隔行变色表格&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;%
//  创建对象列表
    List&lt;User&gt; list=new ArrayList&lt;User&gt;();
    User u1=new User();
    u1.setId(1);
    u1.setName(&quot;zhnagsan&quot;);
    u1.setAge(23);
    User u2=new User();
    u2.setId(2);
    u2.setName(&quot;slijan&quot;);
    u2.setAge(43);
    list.add(u1);
    list.add(u2);
    request.setAttribute(&quot;list&quot;,list);
%&gt;
&lt;table&gt;
    &lt;tr&gt;
        &lt;td&gt;编号&lt;/td&gt;
        &lt;td&gt;姓名&lt;/td&gt;
        &lt;td&gt;年龄&lt;/td&gt;
    &lt;/tr&gt;
    &lt;c:forEach items=&quot;${list}&quot; var=&quot;str&quot; varStatus=&quot;s&quot;&gt;
        &lt;c:if test=&quot;${s.count%2==0}&quot;&gt;
            &lt;tr style=&quot;background-color: pink&quot;&gt;
                &lt;td&gt;${str.id}&lt;/td&gt;
                &lt;td&gt;${str.name}&lt;/td&gt;
                &lt;td&gt;${str.age}&lt;/td&gt;
            &lt;/tr&gt;
        &lt;/c:if&gt;
        &lt;c:if test=&quot;${s.count%2!=0}&quot;&gt;
            &lt;tr style=&quot;background-color:yellowgreen&quot;&gt;
                &lt;td&gt;${str.id}&lt;/td&gt;
                &lt;td&gt;${str.name}&lt;/td&gt;
                &lt;td&gt;${str.age}&lt;/td&gt;
            &lt;/tr&gt;
        &lt;/c:if&gt;
    &lt;/c:forEach&gt;
&lt;/table&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<h3 id="第七章">第七章</h3>
<hr>
<h5 id="本章内容-6">本章内容</h5>
<ul>
<li>Filter过滤器</li>
<li>登录过滤案例</li>
<li>Listener监听器</li>
<li>三层构架</li>
<li>登录&amp;增删改查案例</li>
</ul>
<hr>
<h4 id="71-filter过滤器">7.1 Filter过滤器</h4>
<p>当访问服务器的资源时，过滤器可以将请求拦截下来，完成一些特殊的功能！</p>
<p>作用： 一般用于完成通用的操作。如：登录验证、统一编码处理、敏感字符过滤&hellip;</p>
<p><img src="../../../Typora/works/img/image-20210203161010729.png" alt="image-20210203161010729"></p>
<h5 id="快速入门-1">快速入门</h5>
<ol>
<li>
<p>定义一个类，实现接口Filter</p>
</li>
<li>
<p>复写方法</p>
</li>
<li>
<p>配置拦截路径</p>
</li>
</ol>
<p>代码：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@WebFilter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/*&#34;</span><span style="color:#f92672">)</span> <span style="color:#75715e">// * 表示所有请求都会被过滤器拦截
</span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">A_Filter</span> <span style="color:#66d9ef">implements</span> Filter <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">init</span><span style="color:#f92672">(</span>FilterConfig filterConfig<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException <span style="color:#f92672">{</span>

    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doFilter</span><span style="color:#f92672">(</span>ServletRequest servletRequest<span style="color:#f92672">,</span> ServletResponse servletResponse<span style="color:#f92672">,</span> FilterChain filterChain<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">,</span> ServletException <span style="color:#f92672">{</span>
        <span style="color:#75715e">//过滤
</span><span style="color:#75715e"></span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;doFilter&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#75715e">//放行
</span><span style="color:#75715e"></span>        filterChain<span style="color:#f92672">.</span><span style="color:#a6e22e">doFilter</span><span style="color:#f92672">(</span>servletRequest<span style="color:#f92672">,</span>servletResponse<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">destroy</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>

    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="过滤器的细节">过滤器的细节</h5>
<ol>
<li>
<p>web.xml配置；等同于注解：@WebServlet(&quot;/*&quot;)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;filter&gt;</span>
    <span style="color:#f92672">&lt;filter-name&gt;</span>myFilter<span style="color:#f92672">&lt;/filter-name&gt;</span>
    <span style="color:#f92672">&lt;filter-class&gt;</span>com.iNuo.Filter.A_Filter<span style="color:#f92672">&lt;/filter-class&gt;</span>
<span style="color:#f92672">&lt;/filter&gt;</span>
<span style="color:#f92672">&lt;filter-mapping&gt;</span>
 <span style="color:#f92672">&lt;filter-name&gt;</span>myFilter<span style="color:#f92672">&lt;/filter-name&gt;</span>
 <span style="color:#f92672">&lt;url-pattern&gt;</span>/*<span style="color:#f92672">&lt;/url-pattern&gt;</span>
<span style="color:#f92672">&lt;/filter-mapping&gt;</span>
</code></pre></div></li>
<li>
<p>过滤器执行流程</p>
<p>执行过滤器</p>
<p>执行放行后的资源</p>
<p>回来执行过滤器放行代码下边的代码</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doFilter</span><span style="color:#f92672">(</span>ServletRequest servletRequest<span style="color:#f92672">,</span> ServletResponse servletResponse<span style="color:#f92672">,</span> FilterChain filterChain<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">,</span> ServletException <span style="color:#f92672">{</span>
        <span style="color:#75715e">//过滤
</span><span style="color:#75715e"></span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;doFilter&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#75715e">//放行
</span><span style="color:#75715e"></span>        filterChain<span style="color:#f92672">.</span><span style="color:#a6e22e">doFilter</span><span style="color:#f92672">(</span>servletRequest<span style="color:#f92672">,</span>servletResponse<span style="color:#f92672">);</span>
        <span style="color:#75715e">//返回
</span><span style="color:#75715e"></span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;doFilter返回&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
</code></pre></div></li>
<li>
<p>过滤器生命周期方法</p>
<p>init：在服务器启动后，会创建Filter对象，然后调用init方法。只执行一次。用于加载资源！</p>
<p>doFilter：每一次请求被拦截资源时，会执行。执行多次！</p>
<p>destroy：在服务器关闭后，Filter对象被销毁。如果服务器是正常关闭，则会执行destroy方法。只执行一次。用于释放资源！</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@WebFilter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/*&#34;</span><span style="color:#f92672">)</span> <span style="color:#75715e">// * 表示所有请求都会被过滤器拦截
</span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">A_Filter</span> <span style="color:#66d9ef">implements</span> Filter <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">init</span><span style="color:#f92672">(</span>FilterConfig filterConfig<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;init...&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
   
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doFilter</span><span style="color:#f92672">(</span>ServletRequest servletRequest<span style="color:#f92672">,</span> ServletResponse servletResponse<span style="color:#f92672">,</span> FilterChain filterChain<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">,</span> ServletException <span style="color:#f92672">{</span>
        <span style="color:#75715e">//过滤
</span><span style="color:#75715e"></span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;doFilter&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#75715e">//放行
</span><span style="color:#75715e"></span>        filterChain<span style="color:#f92672">.</span><span style="color:#a6e22e">doFilter</span><span style="color:#f92672">(</span>servletRequest<span style="color:#f92672">,</span>servletResponse<span style="color:#f92672">);</span>
        <span style="color:#75715e">//返回
</span><span style="color:#75715e"></span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;doFilter返回&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
   
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">destroy</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;destroy...&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div></li>
<li>
<p>过滤器配置详解</p>
<p>拦截路径配置：</p>
<table>
<thead>
<tr>
<th>拦截对象</th>
<th>拦截路径配置</th>
<th>拦截效果</th>
</tr>
</thead>
<tbody>
<tr>
<td>具体资源路径</td>
<td>/index.jsp</td>
<td>只有访问index.jsp资源时，过滤器才会被执行</td>
</tr>
<tr>
<td>拦截目录</td>
<td>/user/*</td>
<td>访问/user下的所有资源时，过滤器都会被执行</td>
</tr>
<tr>
<td>后缀名拦截</td>
<td>*.jsp</td>
<td>访问所有后缀名为jsp资源时，过滤器都会被执行</td>
</tr>
<tr>
<td>拦截所有资源</td>
<td>/*</td>
<td>访问所有资源时，过滤器都会被执行</td>
</tr>
</tbody>
</table>
<p>拦截方式配置：资源被访问的方式！</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>执行</th>
<th>参数</th>
</tr>
</thead>
<tbody>
<tr>
<td>注解配置</td>
<td>设置dispatcherTypes属性</td>
<td>REQUEST：默认浏览器直接请求资源；<!-- raw HTML omitted -->FORWARD：转发访问资源；<!-- raw HTML omitted -->INCLUDE：包含访问资源；<!-- raw HTML omitted -->ERROR：错误跳转资源；<!-- raw HTML omitted -->ASYNC：异步访问资源；</td>
</tr>
<tr>
<td>web.xml配置</td>
<td>设置&lt;dispatcher&gt;标签</td>
<td></td>
</tr>
</tbody>
</table>
<p>​</p>
</li>
<li>
<p>过滤器链(配置多个过滤器)</p>
</li>
</ol>
<p>执行顺序：如果有两个过滤器：过滤器1和过滤器2</p>
<ol>
<li>
<p>过滤器1</p>
</li>
<li>
<p>过滤器2</p>
</li>
<li>
<p>资源执行</p>
</li>
<li>
<p>过滤器2</p>
</li>
<li>
<p>过滤器1</p>
</li>
</ol>
<p>过滤器先后顺序问题：</p>
<ol>
<li>
<p>注解配置：按照类名的字符串比较规则比较，值小的先执行！例：AFilter 和 BFilter，AFilter就先执行了。</p>
</li>
<li>
<p>web.xml配置：&lt;filter-mapping&gt;谁定义在上边，谁先执行！</p>
</li>
</ol>
<h4 id="72-登录过滤案例">7.2 登录过滤案例</h4>
<p>需求：</p>
<ol>
<li>
<p>访问前面5.4验证码案例的资源。验证其是否登录</p>
</li>
<li>
<p>如果登录了，则直接放行。</p>
</li>
<li>
<p>如果没有登录，则跳转到登录页面，提示&quot;您尚未登录，请先登录&rdquo;。</p>
</li>
</ol>
<p>过滤实现代码：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.Servlet.Filter<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> ...

<span style="color:#a6e22e">@WebFilter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/*&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">loginFilter</span> <span style="color:#66d9ef">implements</span> Filter <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">init</span><span style="color:#f92672">(</span>FilterConfig filterConfig<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException <span style="color:#f92672">{</span>
        
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doFilter</span><span style="color:#f92672">(</span>ServletRequest servletRequest<span style="color:#f92672">,</span> ServletResponse servletResponse<span style="color:#f92672">,</span> FilterChain filterChain<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">,</span> ServletException <span style="color:#f92672">{</span>
        <span style="color:#75715e">//获取当前请求的URI
</span><span style="color:#75715e"></span>        HttpServletRequest request<span style="color:#f92672">=(</span>HttpServletRequest<span style="color:#f92672">)</span>servletRequest<span style="color:#f92672">;</span>
        String uri<span style="color:#f92672">=</span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequestURI</span><span style="color:#f92672">();</span>
        <span style="color:#75715e">//判断并放行 需要放行的资源
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>uri<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/login.jsp&#34;</span><span style="color:#f92672">)||</span>uri<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;loginServlet&#34;</span><span style="color:#f92672">)||</span>uri<span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;CheckCodeServlet&#34;</span><span style="color:#f92672">)){</span>
            filterChain<span style="color:#f92672">.</span><span style="color:#a6e22e">doFilter</span><span style="color:#f92672">(</span>servletRequest<span style="color:#f92672">,</span>servletResponse<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span><span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">//通过判断session有没有值来判断有没有登录
</span><span style="color:#75715e"></span>            HttpSession session<span style="color:#f92672">=</span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">getSession</span><span style="color:#f92672">();</span>
            <span style="color:#75715e">//已经登录
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>session<span style="color:#f92672">.</span><span style="color:#a6e22e">getAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;user&#34;</span><span style="color:#f92672">)!=</span><span style="color:#66d9ef">null</span><span style="color:#f92672">){</span>
                filterChain<span style="color:#f92672">.</span><span style="color:#a6e22e">doFilter</span><span style="color:#f92672">(</span>servletRequest<span style="color:#f92672">,</span>servletResponse<span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span><span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
                request<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;error_message&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;没有登录&#34;</span><span style="color:#f92672">);</span>
                <span style="color:#75715e">//请求转发
</span><span style="color:#75715e"></span>                request<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequestDispatcher</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/login.jsp&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">forward</span><span style="color:#f92672">(</span>servletRequest<span style="color:#f92672">,</span>servletResponse<span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">destroy</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>

    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>访问：http://localhost:8080/loginTest/login.jsp</p>
<h4 id="73-listener监听器">7.3 Listener监听器</h4>
<p>web的三大组件之一</p>
<p>当事件源上发生某个事件后，执行监听器代码</p>
<p>ServletContextListener：监听ServletContext对象的创建和销毁</p>
<p>方法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//ServletContext对象创建后会调用该方法
</span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">contextInitialized</span><span style="color:#f92672">(</span>ServletContextEvent sce<span style="color:#f92672">)</span> 
    
<span style="color:#75715e">//ServletContext对象被销毁之前会调用该方法
</span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">contextDestroyed</span><span style="color:#f92672">(</span>ServletContextEvent sce<span style="color:#f92672">)</span> 
</code></pre></div><p>步骤：</p>
<ol>
<li>
<p>定义一个类A_Listener，实现ServletContextListener接口</p>
</li>
<li>
<p>复写方法</p>
</li>
<li>
<p>配置</p>
<p>web.xml配置</p>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;listener&gt;</span>
        <span style="color:#f92672">&lt;listener-class&gt;</span>com.iNuo.Listener.A_Listener<span style="color:#f92672">&lt;/listener-class&gt;</span>
    <span style="color:#f92672">&lt;/listener&gt;</span>
</code></pre></div><p>​	  注解配置</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@WebListener</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">A_Listener</span> <span style="color:#66d9ef">implements</span> ServletContextListener <span style="color:#f92672">{</span>
</code></pre></div><h5 id="案例">案例：</h5>
<p>Listener监听器的使用：启动服务器的同时，加载配置文件到内存中！</p>
<p>要加载的文件：applicationContext.xml</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
<span style="color:#f92672">&lt;Bean&gt;&lt;/Bean&gt;</span>
</code></pre></div><p>配置要加载的文件：web.xml</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span style="color:#f92672">&lt;web-app</span> <span style="color:#a6e22e">xmlns=</span><span style="color:#e6db74">&#34;http://xmlns.jcp.org/xml/ns/javaee&#34;</span>
         <span style="color:#a6e22e">xmlns:xsi=</span><span style="color:#e6db74">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
         <span style="color:#a6e22e">xsi:schemaLocation=</span><span style="color:#e6db74">&#34;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&#34;</span>
         <span style="color:#a6e22e">version=</span><span style="color:#e6db74">&#34;3.1&#34;</span><span style="color:#f92672">&gt;</span>

    <span style="color:#f92672">&lt;context-param&gt;</span>
        <span style="color:#f92672">&lt;param-name&gt;</span>myparam<span style="color:#f92672">&lt;/param-name&gt;</span>
        <span style="color:#f92672">&lt;param-value&gt;</span>/WEB-INF/classes/applicationContext.xml<span style="color:#f92672">&lt;/param-value&gt;</span>
    <span style="color:#f92672">&lt;/context-param&gt;</span>
<span style="color:#f92672">&lt;/web-app&gt;</span>
</code></pre></div><p>业务逻辑实现需求：A_Listener.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.Listener<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> ...

<span style="color:#a6e22e">@WebListener</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">A_Listener</span> <span style="color:#66d9ef">implements</span> ServletContextListener <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">contextInitialized</span><span style="color:#f92672">(</span>ServletContextEvent servletContextEvent<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;servletContext创建了&#34;</span><span style="color:#f92672">);</span>

<span style="color:#75715e">//        当ServletContext对象创建的时候（服务器启动的时候）把web.xml中配置的文件加载到内存！
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//获取servletContext对象
</span><span style="color:#75715e"></span>        ServletContext context<span style="color:#f92672">=</span>servletContextEvent<span style="color:#f92672">.</span><span style="color:#a6e22e">getServletContext</span><span style="color:#f92672">();</span>
        String path<span style="color:#f92672">=</span>context<span style="color:#f92672">.</span><span style="color:#a6e22e">getInitParameter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;myparam&#34;</span><span style="color:#f92672">);</span>
        String realpath<span style="color:#f92672">=</span>context<span style="color:#f92672">.</span><span style="color:#a6e22e">getRealPath</span><span style="color:#f92672">(</span>path<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
            FileInputStream input<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> FileInputStream<span style="color:#f92672">(</span>realpath<span style="color:#f92672">);</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>input<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>FileNotFoundException e<span style="color:#f92672">){</span>
            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">contextDestroyed</span><span style="color:#f92672">(</span>ServletContextEvent servletContextEvent<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;servletContext被销毁了&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="74-三层架构">7.4 三层架构</h4>
<ul>
<li>
<p>界面层(表示层)：用户看的见界面。用户可以通过界面上的组件和服务器进行交互</p>
</li>
<li>
<p>业务逻辑层：处理业务逻辑的。</p>
</li>
<li>
<p>数据访问层：操作数据存储文件。</p>
</li>
</ul>
<p><img src="../../../Typora/works/img/image-20210203194452462.png" alt="image-20210203194452462"></p>
<h5 id="三层案例">三层案例</h5>
<p>需求：将数据库中的用户列表显示在浏览器！</p>
<p><img src="/img/image-20201228105451390.png" alt="image-20201228105451390"></p>
<p>三层构架分析：</p>
<p><img src="../../../Typora/works/img/image-20210203200854439.png" alt="image-20210203200854439"></p>
<p>目录结构：</p>
<p><img src="../../../Typora/works/img/image-20210203233324227.png" alt="image-20210203233324227"></p>
<p>代码实现：</p>
<ul>
<li>表现层web</li>
</ul>
<p>index.jsp</p>
<pre><code class="language-jsp" data-lang="jsp">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;$Title$&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
  &lt;h3&gt;从这里开始！&lt;/h3&gt;
  &lt;h4&gt;&lt;a href=&quot;${pageContext.request.contextPath}/UserListServlet&quot;&gt;用户列表&lt;/a&gt;&lt;/h4&gt;
  &lt;/body&gt;
&lt;/html&gt;

</code></pre><p>UserListServlet.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.web<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> <span style="color:#960050;background-color:#1e0010">。。。</span>

<span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/UserListServlet&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserListServlet</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#75715e">//创建业务逻辑层对象
</span><span style="color:#75715e"></span>        UserService userService<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> UserServiceImpl<span style="color:#f92672">();</span>
        <span style="color:#75715e">//查询所有用户
</span><span style="color:#75715e"></span>        List<span style="color:#f92672">&lt;</span>User<span style="color:#f92672">&gt;</span> users<span style="color:#f92672">=</span>userService<span style="color:#f92672">.</span><span style="color:#a6e22e">findUser</span><span style="color:#f92672">();</span>
        <span style="color:#75715e">//将users放入req中
</span><span style="color:#75715e"></span>        req<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;users&#34;</span><span style="color:#f92672">,</span>users<span style="color:#f92672">);</span>
        <span style="color:#75715e">//请求转发
</span><span style="color:#75715e"></span>        req<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequestDispatcher</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/list.jsp&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">forward</span><span style="color:#f92672">(</span>req<span style="color:#f92672">,</span>resp<span style="color:#f92672">);</span>

    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>req<span style="color:#f92672">,</span>resp<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>list.jsp</p>
<pre><code class="language-jsp" data-lang="jsp">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;显示页面&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;table&gt;
    &lt;tr&gt;&lt;td&gt;编号&lt;/td&gt;&lt;td&gt;姓名&lt;/td&gt;&lt;td&gt;密码&lt;/td&gt;&lt;/tr&gt;
    &lt;c:forEach items=&quot;${users}&quot; var=&quot;user&quot;&gt;
    &lt;tr&gt;&lt;td&gt;${user.id}&lt;/td&gt;&lt;td&gt;${user.name}&lt;/td&gt;&lt;td&gt;${user.password}&lt;/td&gt;&lt;/tr&gt;
    &lt;/c:forEach&gt;
&lt;/table&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><ul>
<li>业务逻辑层service</li>
</ul>
<p>UserService.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.service<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> com.iNuo.pojo.User<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.List<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">UserService</span> <span style="color:#f92672">{</span>
    List<span style="color:#f92672">&lt;</span>User<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">findUser</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>UserServiceImpl.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.service.impl<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> com.iNuo.dao.UserDao<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> com.iNuo.dao.impl.UserDaoImpl<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> com.iNuo.pojo.User<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> com.iNuo.service.UserService<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> java.util.List<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserServiceImpl</span> <span style="color:#66d9ef">implements</span> UserService <span style="color:#f92672">{</span>

    <span style="color:#75715e">//创建数据访问层对象
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> UserDao userDao<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> UserDaoImpl<span style="color:#f92672">();</span>

    <span style="color:#75715e">/*
</span><span style="color:#75715e">    * 查询所有用户
</span><span style="color:#75715e">    */</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> List<span style="color:#f92672">&lt;</span>User<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">findUser</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> userDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findUser</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><p>User.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.pojo<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> Integer id<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String name<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String password<span style="color:#f92672">;</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">toString</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;User{&#34;</span> <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;id=&#34;</span> <span style="color:#f92672">+</span> id <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;, name=&#39;&#34;</span> <span style="color:#f92672">+</span> name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;\&#39;&#39;</span> <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;, password=&#39;&#34;</span> <span style="color:#f92672">+</span> password <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;\&#39;&#39;</span> <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#39;}&#39;</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> Integer <span style="color:#a6e22e">getId</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> id<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setId</span><span style="color:#f92672">(</span>Integer id<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> id<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getName</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> name<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setName</span><span style="color:#f92672">(</span>String name<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> name<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getPassword</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> password<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setPassword</span><span style="color:#f92672">(</span>String password<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">password</span> <span style="color:#f92672">=</span> password<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>数据访问层dao</li>
</ul>
<p>UserDao.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.dao<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> com.iNuo.pojo.User<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.List<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">UserDao</span> <span style="color:#f92672">{</span>
    List<span style="color:#f92672">&lt;</span>User<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">findUser</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>

</code></pre></div><p>UserDaoImpl.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.dao.impl<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> com.iNuo.dao.UserDao<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> com.iNuo.pojo.User<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> com.iNuo.util.JDBCUtils<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.jdbc.core.BeanPropertyRowMapper<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.jdbc.core.JdbcTemplate<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> java.util.List<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserDaoImpl</span> <span style="color:#66d9ef">implements</span> UserDao <span style="color:#f92672">{</span>

    <span style="color:#75715e">//创建JdbcTemplate对象
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> JdbcTemplate jdbcTemplate<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> JdbcTemplate<span style="color:#f92672">(</span>JDBCUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">getDataSource</span><span style="color:#f92672">());</span>

    <span style="color:#75715e">/*
</span><span style="color:#75715e">     * 查询所有用户
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> List<span style="color:#f92672">&lt;</span>User<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">findUser</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> jdbcTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">query</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;select * from user&#34;</span><span style="color:#f92672">,</span><span style="color:#66d9ef">new</span> BeanPropertyRowMapper<span style="color:#f92672">&lt;</span>User<span style="color:#f92672">&gt;(</span>User<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">));</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>访问：http://localhost:8080/Level/index.jsp</p>
<h4 id="75-登录增删改查案例">7.5 登录&amp;增删改查案例</h4>
<p>需求：登录和用户信息的增删改查操作</p>
<p>技术选型：Servlet+JSP+MySQL+JDBCTempleat+Duird+BeanUtilS+tomcat</p>
<p><img src="/img/image-20201228105516084.png" alt="image-20201228105516084"></p>
<h5 id="项目剖析">项目剖析：</h5>
<p>三层架构：</p>
<p><img src="../../../Typora/works/img/image-20210204122443594.png" alt="image-20210204122443594"></p>
<p>技术实现：</p>
<ul>
<li>
<p>数据库设计</p>
</li>
<li>
<p>登录实现</p>
</li>
<li>
<p>登录验证</p>
</li>
<li>
<p>查询列表</p>
</li>
<li>
<p>分页实现</p>
</li>
<li>
<p>添加实现</p>
</li>
<li>
<p>删除实现</p>
</li>
<li>
<p>修改实现</p>
</li>
</ul>
<h5 id="数据库设计">数据库设计</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> <span style="color:#75715e">/*!32312 IF NOT EXISTS*/</span><span style="color:#f92672">`</span>chapter7<span style="color:#f92672">`</span> <span style="color:#75715e">/*!40100 DEFAULT CHARACTER SET utf8 */</span>;

USE <span style="color:#f92672">`</span>chapter7<span style="color:#f92672">`</span>;

<span style="color:#75715e">/*Table structure for table `user` */</span>

<span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">EXISTS</span> <span style="color:#f92672">`</span><span style="color:#66d9ef">user</span><span style="color:#f92672">`</span>;

<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#f92672">`</span><span style="color:#66d9ef">user</span><span style="color:#f92672">`</span> (
  <span style="color:#f92672">`</span>id<span style="color:#f92672">`</span> int(<span style="color:#ae81ff">11</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> AUTO_INCREMENT,
  <span style="color:#f92672">`</span>name<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span>gender<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">5</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span>age<span style="color:#f92672">`</span> int(<span style="color:#ae81ff">11</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span>address<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">32</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span>qq<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span>email<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">50</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span>userName<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">50</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span>password<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">50</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> (<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span>)
) ENGINE<span style="color:#f92672">=</span>InnoDB AUTO_INCREMENT<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8;

<span style="color:#75715e">/*Data for the table `user` */</span>

<span style="color:#66d9ef">insert</span>  <span style="color:#66d9ef">into</span> <span style="color:#f92672">`</span><span style="color:#66d9ef">user</span><span style="color:#f92672">`</span>(<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>name<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>gender<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>age<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>address<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>qq<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>email<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>userName<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>password<span style="color:#f92672">`</span>) <span style="color:#66d9ef">values</span>
(<span style="color:#ae81ff">1</span>,<span style="color:#e6db74">&#39;张三&#39;</span>,<span style="color:#e6db74">&#39;男&#39;</span>,<span style="color:#ae81ff">13</span>,<span style="color:#e6db74">&#39;陕西&#39;</span>,<span style="color:#e6db74">&#39;12345&#39;</span>,<span style="color:#e6db74">&#39;zhangsan@itcast.cn&#39;</span>,<span style="color:#e6db74">&#39;zhangsan&#39;</span>,<span style="color:#e6db74">&#39;123456&#39;</span>),
(<span style="color:#ae81ff">2</span>,<span style="color:#e6db74">&#39;李四&#39;</span>,<span style="color:#e6db74">&#39;女&#39;</span>,<span style="color:#ae81ff">15</span>,<span style="color:#e6db74">&#39;北京&#39;</span>,<span style="color:#e6db74">&#39;88888&#39;</span>,<span style="color:#e6db74">&#39;ls@itcast.cn&#39;</span>,<span style="color:#e6db74">&#39;lisi&#39;</span>,<span style="color:#e6db74">&#39;123456&#39;</span>);
</code></pre></div><h5 id="登录实现">登录实现</h5>
<p>数据访问层</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.dao<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> com.iNuo.pojo.User<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">UserDao</span> <span style="color:#f92672">{</span>
    User <span style="color:#a6e22e">findUserByNameAndPwd</span><span style="color:#f92672">(</span>String userName<span style="color:#f92672">,</span>String password<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.dao.impl<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> <span style="color:#960050;background-color:#1e0010">。。。</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserDaoImpl</span> <span style="color:#66d9ef">implements</span> UserDao <span style="color:#f92672">{</span>

    <span style="color:#75715e">//创建JdbcTemplate对象
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> JdbcTemplate jdbcTemplate<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> JdbcTemplate<span style="color:#f92672">(</span>JDBCUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">getDataSource</span><span style="color:#f92672">());</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> User <span style="color:#a6e22e">findUserByNameAndPwd</span><span style="color:#f92672">(</span>String userName<span style="color:#f92672">,</span> String password<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">return</span> jdbcTemplate<span style="color:#f92672">.</span><span style="color:#a6e22e">queryForObject</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;select * from user where userName=? and password=?&#34;</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> BeanPropertyRowMapper<span style="color:#f92672">&lt;</span>User<span style="color:#f92672">&gt;(</span>User<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">),</span> userName<span style="color:#f92672">,</span> password<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">){</span>
            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.util<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> <span style="color:#960050;background-color:#1e0010">。。。</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * JDBC工具类 使用Durid连接池
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">JDBCUtils</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> DataSource ds <span style="color:#f92672">;</span>

    <span style="color:#66d9ef">static</span> <span style="color:#f92672">{</span>

        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">//1.加载配置文件
</span><span style="color:#75715e"></span>            Properties pro <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Properties<span style="color:#f92672">();</span>
            <span style="color:#75715e">//使用ClassLoader加载配置文件，获取字节输入流
</span><span style="color:#75715e"></span>            InputStream is <span style="color:#f92672">=</span> JDBCUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getClassLoader</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getResourceAsStream</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;druid.properties&#34;</span><span style="color:#f92672">);</span>
            pro<span style="color:#f92672">.</span><span style="color:#a6e22e">load</span><span style="color:#f92672">(</span>is<span style="color:#f92672">);</span>

            <span style="color:#75715e">//2.初始化连接池对象
</span><span style="color:#75715e"></span>            ds <span style="color:#f92672">=</span> DruidDataSourceFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">createDataSource</span><span style="color:#f92672">(</span>pro<span style="color:#f92672">);</span>

        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * 获取连接池对象
</span><span style="color:#75715e">     */</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> DataSource <span style="color:#a6e22e">getDataSource</span><span style="color:#f92672">(){</span>
        <span style="color:#66d9ef">return</span> ds<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>


    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * 获取连接Connection对象
</span><span style="color:#75715e">     */</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> Connection <span style="color:#a6e22e">getConnection</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> SQLException <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span>  ds<span style="color:#f92672">.</span><span style="color:#a6e22e">getConnection</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">driverClassName<span style="color:#f92672">=</span>com<span style="color:#f92672">.</span><span style="color:#a6e22e">mysql</span><span style="color:#f92672">.</span><span style="color:#a6e22e">jc</span><span style="color:#f92672">.</span><span style="color:#a6e22e">jdbc</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Driver</span>
url<span style="color:#f92672">=</span>jdbc<span style="color:#f92672">:</span>mysql<span style="color:#f92672">:</span><span style="color:#75715e">///chapter7
</span><span style="color:#75715e"></span>username<span style="color:#f92672">=</span>root
password<span style="color:#f92672">=</span>123456
<span style="color:#960050;background-color:#1e0010">#</span> 初始化连接数量
initialSize<span style="color:#f92672">=</span>5
<span style="color:#960050;background-color:#1e0010">#</span> 最大连接数
maxActive<span style="color:#f92672">=</span>10
<span style="color:#960050;background-color:#1e0010">#</span> 最大等待时间
maxWait<span style="color:#f92672">=</span>3000
</code></pre></div><p>业务逻辑层</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.service<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> com.iNuo.pojo.User<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">UserService</span> <span style="color:#f92672">{</span>
    User <span style="color:#a6e22e">findUserByNameAndPwd</span><span style="color:#f92672">(</span>String userName<span style="color:#f92672">,</span> String password<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.service.impl<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> <span style="color:#960050;background-color:#1e0010">。。。</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserServiceImpl</span> <span style="color:#66d9ef">implements</span> UserService <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">private</span> UserDao userDao<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> UserDaoImpl<span style="color:#f92672">();</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> User <span style="color:#a6e22e">findUserByNameAndPwd</span><span style="color:#f92672">(</span>String userName<span style="color:#f92672">,</span> String password<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>

        <span style="color:#66d9ef">return</span> userDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findUserByNameAndPwd</span><span style="color:#f92672">(</span>userName<span style="color:#f92672">,</span>password<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.pojo<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> id<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String name<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String gender<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> age<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String address<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String qq<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String email<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">private</span> String userName<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String password<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getUserName</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> userName<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">toString</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;User{&#34;</span> <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;id=&#34;</span> <span style="color:#f92672">+</span> id <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;, name=&#39;&#34;</span> <span style="color:#f92672">+</span> name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;\&#39;&#39;</span> <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;, gender=&#39;&#34;</span> <span style="color:#f92672">+</span> gender <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;\&#39;&#39;</span> <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;, age=&#34;</span> <span style="color:#f92672">+</span> age <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;, address=&#39;&#34;</span> <span style="color:#f92672">+</span> address <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;\&#39;&#39;</span> <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;, qq=&#39;&#34;</span> <span style="color:#f92672">+</span> qq <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;\&#39;&#39;</span> <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;, email=&#39;&#34;</span> <span style="color:#f92672">+</span> email <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;\&#39;&#39;</span> <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;, userName=&#39;&#34;</span> <span style="color:#f92672">+</span> userName <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;\&#39;&#39;</span> <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;, password=&#39;&#34;</span> <span style="color:#f92672">+</span> password <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;\&#39;&#39;</span> <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#39;}&#39;</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setUserName</span><span style="color:#f92672">(</span>String userName<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">userName</span> <span style="color:#f92672">=</span> userName<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getPassword</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> password<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

   <span style="color:#75715e">//其余略。。。
</span><span style="color:#75715e"></span>
<span style="color:#f92672">}</span>
</code></pre></div><p>表现层</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.web.servlet<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> <span style="color:#960050;background-color:#1e0010">。。。</span>

<span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/LoginServlet&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LoginServlet</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#75715e">//获取验证码
</span><span style="color:#75715e"></span>        String verifycode<span style="color:#f92672">=</span>req<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;verifycode&#34;</span><span style="color:#f92672">);</span>
        String code<span style="color:#f92672">=(</span>String<span style="color:#f92672">)</span>req<span style="color:#f92672">.</span><span style="color:#a6e22e">getSession</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;CHECKCODE_SERVER&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#75715e">//如果填写的验证码和生成的验证码相同
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>verifycode<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span>code<span style="color:#f92672">)){</span>
            <span style="color:#75715e">//验证用户名和密码
</span><span style="color:#75715e"></span>            UserService userService<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> UserServiceImpl<span style="color:#f92672">();</span>
            String userName<span style="color:#f92672">=</span>req<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;userName&#34;</span><span style="color:#f92672">);</span><span style="color:#75715e">//用户名
</span><span style="color:#75715e"></span>            String password<span style="color:#f92672">=</span>req<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;password&#34;</span><span style="color:#f92672">);</span><span style="color:#75715e">//密码
</span><span style="color:#75715e"></span>            <span style="color:#75715e">//调用业务逻辑层的方法
</span><span style="color:#75715e"></span>            User user<span style="color:#f92672">=</span>userService<span style="color:#f92672">.</span><span style="color:#a6e22e">findUserByNameAndPwd</span><span style="color:#f92672">(</span>userName<span style="color:#f92672">,</span>password<span style="color:#f92672">);</span>

            <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>user<span style="color:#f92672">!=</span><span style="color:#66d9ef">null</span><span style="color:#f92672">){</span><span style="color:#75715e">//登录成功
</span><span style="color:#75715e"></span>                <span style="color:#75715e">//记录session（用它来判断访问其他资源的时候有没有登录？）
</span><span style="color:#75715e"></span>                req<span style="color:#f92672">.</span><span style="color:#a6e22e">getSession</span><span style="color:#f92672">().</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;user&#34;</span><span style="color:#f92672">,</span>user<span style="color:#f92672">);</span>
                <span style="color:#75715e">//重定向 跳转页面
</span><span style="color:#75715e"></span>                resp<span style="color:#f92672">.</span><span style="color:#a6e22e">sendRedirect</span><span style="color:#f92672">(</span>req<span style="color:#f92672">.</span><span style="color:#a6e22e">getContextPath</span><span style="color:#f92672">()+</span><span style="color:#e6db74">&#34;/index.jsp&#34;</span><span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span><span style="color:#66d9ef">else</span><span style="color:#f92672">{</span>
                req<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;error_msg&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;用户名或密码错误&#34;</span><span style="color:#f92672">);</span>
                <span style="color:#75715e">//请求转发 跳转页面
</span><span style="color:#75715e"></span>                req<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequestDispatcher</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/login.jsp&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">forward</span><span style="color:#f92672">(</span>req<span style="color:#f92672">,</span>resp<span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span><span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
            req<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;error_msg&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;验证码错误&#34;</span><span style="color:#f92672">);</span>
            <span style="color:#75715e">//请求转发 跳转页面
</span><span style="color:#75715e"></span>            req<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequestDispatcher</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/login.jsp&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">forward</span><span style="color:#f92672">(</span>req<span style="color:#f92672">,</span>resp<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>req<span style="color:#f92672">,</span>resp<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.web.servlet<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> <span style="color:#960050;background-color:#1e0010">。。。</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * 验证码
</span><span style="color:#75715e"> */</span>
<span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/CheckCodeServlet&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CheckCodeServlet</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest request<span style="color:#f92672">,</span> HttpServletResponse response<span style="color:#f92672">)</span><span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
		
		<span style="color:#75715e">//服务器通知浏览器不要缓存
</span><span style="color:#75715e"></span>		response<span style="color:#f92672">.</span><span style="color:#a6e22e">setHeader</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;pragma&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;no-cache&#34;</span><span style="color:#f92672">);</span>
		response<span style="color:#f92672">.</span><span style="color:#a6e22e">setHeader</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;cache-control&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;no-cache&#34;</span><span style="color:#f92672">);</span>
		response<span style="color:#f92672">.</span><span style="color:#a6e22e">setHeader</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;expires&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;0&#34;</span><span style="color:#f92672">);</span>
		
		<span style="color:#75715e">//在内存中创建一个长80，宽30的图片，默认黑色背景
</span><span style="color:#75715e"></span>		<span style="color:#75715e">//参数一：长
</span><span style="color:#75715e"></span>		<span style="color:#75715e">//参数二：宽
</span><span style="color:#75715e"></span>		<span style="color:#75715e">//参数三：颜色
</span><span style="color:#75715e"></span>		<span style="color:#66d9ef">int</span> width <span style="color:#f92672">=</span> 80<span style="color:#f92672">;</span>
		<span style="color:#66d9ef">int</span> height <span style="color:#f92672">=</span> 30<span style="color:#f92672">;</span>
		BufferedImage image <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedImage<span style="color:#f92672">(</span>width<span style="color:#f92672">,</span>height<span style="color:#f92672">,</span>BufferedImage<span style="color:#f92672">.</span><span style="color:#a6e22e">TYPE_INT_RGB</span><span style="color:#f92672">);</span>
		
		<span style="color:#75715e">//获取画笔
</span><span style="color:#75715e"></span>		Graphics g <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span><span style="color:#a6e22e">getGraphics</span><span style="color:#f92672">();</span>
		<span style="color:#75715e">//设置画笔颜色为灰色
</span><span style="color:#75715e"></span>		g<span style="color:#f92672">.</span><span style="color:#a6e22e">setColor</span><span style="color:#f92672">(</span>Color<span style="color:#f92672">.</span><span style="color:#a6e22e">GRAY</span><span style="color:#f92672">);</span>
		<span style="color:#75715e">//填充图片
</span><span style="color:#75715e"></span>		g<span style="color:#f92672">.</span><span style="color:#a6e22e">fillRect</span><span style="color:#f92672">(</span>0<span style="color:#f92672">,</span>0<span style="color:#f92672">,</span> width<span style="color:#f92672">,</span>height<span style="color:#f92672">);</span>
		
		<span style="color:#75715e">//产生4个随机验证码，12Ey
</span><span style="color:#75715e"></span>		String checkCode <span style="color:#f92672">=</span> getCheckCode<span style="color:#f92672">();</span>
		<span style="color:#75715e">//将验证码放入HttpSession中
</span><span style="color:#75715e"></span>		request<span style="color:#f92672">.</span><span style="color:#a6e22e">getSession</span><span style="color:#f92672">().</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;CHECKCODE_SERVER&#34;</span><span style="color:#f92672">,</span>checkCode<span style="color:#f92672">);</span>
		
		<span style="color:#75715e">//设置画笔颜色为黄色
</span><span style="color:#75715e"></span>		g<span style="color:#f92672">.</span><span style="color:#a6e22e">setColor</span><span style="color:#f92672">(</span>Color<span style="color:#f92672">.</span><span style="color:#a6e22e">YELLOW</span><span style="color:#f92672">);</span>
		<span style="color:#75715e">//设置字体的小大
</span><span style="color:#75715e"></span>		g<span style="color:#f92672">.</span><span style="color:#a6e22e">setFont</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Font<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;黑体&#34;</span><span style="color:#f92672">,</span>Font<span style="color:#f92672">.</span><span style="color:#a6e22e">BOLD</span><span style="color:#f92672">,</span>24<span style="color:#f92672">));</span>
		<span style="color:#75715e">//向图片上写入验证码
</span><span style="color:#75715e"></span>		g<span style="color:#f92672">.</span><span style="color:#a6e22e">drawString</span><span style="color:#f92672">(</span>checkCode<span style="color:#f92672">,</span>15<span style="color:#f92672">,</span>25<span style="color:#f92672">);</span>
		
		<span style="color:#75715e">//将内存中的图片输出到浏览器
</span><span style="color:#75715e"></span>		<span style="color:#75715e">//参数一：图片对象
</span><span style="color:#75715e"></span>		<span style="color:#75715e">//参数二：图片的格式，如PNG,JPG,GIF
</span><span style="color:#75715e"></span>		<span style="color:#75715e">//参数三：图片输出到哪里去
</span><span style="color:#75715e"></span>		ImageIO<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>image<span style="color:#f92672">,</span><span style="color:#e6db74">&#34;PNG&#34;</span><span style="color:#f92672">,</span>response<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">());</span>
	<span style="color:#f92672">}</span>
	<span style="color:#75715e">/**
</span><span style="color:#75715e">	 * 产生4位随机字符串 
</span><span style="color:#75715e">	 */</span>
	<span style="color:#66d9ef">private</span> String <span style="color:#a6e22e">getCheckCode</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
		String base <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;0123456789ABCDEFGabcdefg&#34;</span><span style="color:#f92672">;</span>
		<span style="color:#66d9ef">int</span> size <span style="color:#f92672">=</span> base<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">();</span>
		Random r <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Random<span style="color:#f92672">();</span>
		StringBuffer sb <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> StringBuffer<span style="color:#f92672">();</span>
		<span style="color:#66d9ef">for</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i<span style="color:#f92672">=</span>1<span style="color:#f92672">;</span>i<span style="color:#f92672">&lt;=</span>4<span style="color:#f92672">;</span>i<span style="color:#f92672">++){</span>
			<span style="color:#75715e">//产生0到size-1的随机值
</span><span style="color:#75715e"></span>			<span style="color:#66d9ef">int</span> index <span style="color:#f92672">=</span> r<span style="color:#f92672">.</span><span style="color:#a6e22e">nextInt</span><span style="color:#f92672">(</span>size<span style="color:#f92672">);</span>
			<span style="color:#75715e">//在base字符串中获取下标为index的字符
</span><span style="color:#75715e"></span>			<span style="color:#66d9ef">char</span> c <span style="color:#f92672">=</span> base<span style="color:#f92672">.</span><span style="color:#a6e22e">charAt</span><span style="color:#f92672">(</span>index<span style="color:#f92672">);</span>
			<span style="color:#75715e">//将c放入到StringBuffer中去
</span><span style="color:#75715e"></span>			sb<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span>c<span style="color:#f92672">);</span>
		<span style="color:#f92672">}</span>
		<span style="color:#66d9ef">return</span> sb<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">();</span>
	<span style="color:#f92672">}</span>
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest request<span style="color:#f92672">,</span> HttpServletResponse response<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
		<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>request<span style="color:#f92672">,</span>response<span style="color:#f92672">);</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><pre><code class="language-jsp" data-lang="jsp">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;

&lt;html lang=&quot;zh-CN&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;/&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;/&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;/&gt;
    &lt;title&gt;管理员登录&lt;/title&gt;

    &lt;!-- 1. 导入CSS的全局样式 --&gt;
    &lt;link href=&quot;css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;
    &lt;!-- 2. jQuery导入，建议使用1.9以上的版本 --&gt;
    &lt;script src=&quot;js/jquery-2.1.0.min.js&quot;&gt;&lt;/script&gt;
    &lt;!-- 3. 导入bootstrap的js文件 --&gt;
    &lt;script src=&quot;js/bootstrap.min.js&quot;&gt;&lt;/script&gt;
    &lt;script type=&quot;text/javascript&quot;&gt;
        function refreshCode() {
            var code=document.getElementById(&quot;vcode&quot;); //获取验证码图片对象
            code.src=&quot;${pageContext.request.contextPath}/CheckCodeServlet&quot;+new Date().getTime(); //防止从缓存中取图片
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&quot;container&quot; style=&quot;width: 400px;&quot;&gt;
    &lt;h3 style=&quot;text-align: center;&quot;&gt;管理员登录&lt;/h3&gt;
    &lt;form action=&quot;${pageContext.request.contextPath}/LoginServlet&quot; method=&quot;post&quot;&gt;
        &lt;div class=&quot;form-group&quot;&gt;
            &lt;label for=&quot;user&quot;&gt;用户名：&lt;/label&gt;
            &lt;input type=&quot;text&quot; name=&quot;userName&quot; class=&quot;form-control&quot; id=&quot;user&quot; placeholder=&quot;请输入用户名&quot;/&gt;
        &lt;/div&gt;

        &lt;div class=&quot;form-group&quot;&gt;
            &lt;label for=&quot;password&quot;&gt;密码：&lt;/label&gt;
            &lt;input type=&quot;password&quot; name=&quot;password&quot; class=&quot;form-control&quot; id=&quot;password&quot; placeholder=&quot;请输入密码&quot;/&gt;
        &lt;/div&gt;

        &lt;div class=&quot;form-inline&quot;&gt;
            &lt;label for=&quot;vcode&quot;&gt;验证码：&lt;/label&gt;
            &lt;input type=&quot;text&quot; name=&quot;verifycode&quot; class=&quot;form-control&quot; id=&quot;verifycode&quot; placeholder=&quot;请输入验证码&quot; style=&quot;width: 120px;&quot;/&gt;
            &lt;a href=&quot;javascript:refreshCode()&quot;&gt;&lt;img src=&quot;${pageContext.request.contextPath}/CheckCodeServlet&quot; title=&quot;看不清点击刷新&quot; id=&quot;vcode&quot;/&gt;&lt;/a&gt;
        &lt;/div&gt;
        &lt;hr/&gt;
        &lt;div class=&quot;form-group&quot; style=&quot;text-align: center;&quot;&gt;
            &lt;input class=&quot;btn btn btn-primary&quot; type=&quot;submit&quot; value=&quot;登录&quot;&gt;
        &lt;/div&gt;
    &lt;/form&gt;

    &lt;!-- 出错显示的信息框 --&gt;
    &lt;div class=&quot;alert alert-warning alert-dismissible&quot; role=&quot;alert&quot;&gt;
        &lt;button type=&quot;button&quot; class=&quot;close&quot; data-dismiss=&quot;alert&quot; &gt;
            &lt;span&gt;&amp;times;&lt;/span&gt;&lt;/button&gt;
        &lt;strong&gt;${error_msg}&lt;/strong&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><h5 id="登录验证">登录验证</h5>
<p>数据访问层</p>
<p>业务逻辑层</p>
<p>表现层</p>
<h5 id="查询列表">查询列表</h5>
<p>数据访问层</p>
<p>业务逻辑层</p>
<p>表现层</p>
<h5 id="分页实现">分页实现</h5>
<p>数据访问层</p>
<p>业务逻辑层</p>
<p>表现层</p>
<h5 id="添加实现">添加实现</h5>
<p>数据访问层</p>
<p>业务逻辑层</p>
<p>表现层</p>
<h5 id="删除实现">删除实现</h5>
<p>数据访问层</p>
<p>业务逻辑层</p>
<p>表现层</p>
<h5 id="修改实现">修改实现</h5>
<p>数据访问层</p>
<p>业务逻辑层</p>
<p>表现层</p>
<hr>
<h3 id="第八章">第八章</h3>
<hr>
<h5 id="本章内容-7">本章内容</h5>
<ul>
<li>AJAX</li>
<li>JSON</li>
<li>案例：校验用户名是否存在</li>
</ul>
<hr>
<h4 id="81-ajax">8.1 AJAX</h4>
<p>Ajax (ASynchronous JavaScript And XML)：异步的JavaScript 和 XML！</p>
<p>Ajax 是一种在无需重新加载整个网页的情况下，能够更新部分网页的技术！</p>
<h5 id="异步和同步">异步和同步：</h5>
<ul>
<li>
<p>同步：客户端必须等待服务器端的响应。在等待的期间客户端不能做其他操作。</p>
</li>
<li>
<p>异步：客户端不需要等待服务器端的响应。在服务器处理请求的过程中，客户端可以进行其他的操作。</p>
</li>
</ul>
<h5 id="ajax实现方式">AJAX实现方式</h5>
<ol>
<li>
<p>原生的JS实现方式（了解）</p>
</li>
<li>
<p>JQeury实现方式：</p>
<p>1）$.ajax()：发送请求</p>
<p>2）$.get()：发送get请求</p>
<p>3）$.post()：发送post请求</p>
</li>
</ol>
<p>实现方式：</p>
<ol>
<li>原生的JS实现方式（了解）</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">script</span><span style="color:#f92672">&gt;</span>
    <span style="color:#75715e">//1.创建核心对象
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">xmlhttp</span>;

    <span style="color:#66d9ef">if</span> (window.<span style="color:#a6e22e">XMLHttpRequest</span>) {<span style="color:#75715e">// code for IE7+, Firefox, Chrome, Opera, Safari
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">xmlhttp</span><span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> <span style="color:#a6e22e">XMLHttpRequest</span>();
    } <span style="color:#66d9ef">else</span> {<span style="color:#75715e">// code for IE6, IE5
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">xmlhttp</span><span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ActiveXObject</span>(<span style="color:#e6db74">&#34;Microsoft.XMLHTTP&#34;</span>);
    }

    <span style="color:#75715e">//2. 建立连接
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/* 参数：
</span><span style="color:#75715e">    1. 请求方式：GET、POST
</span><span style="color:#75715e">             get方式，请求参数在URL后边拼接。send方法为空参
</span><span style="color:#75715e">             post方式，请求参数在send方法中定义
</span><span style="color:#75715e">    2. 请求的URL：
</span><span style="color:#75715e">    3. 同步或异步请求：true（异步）或 false（同步）
</span><span style="color:#75715e">    */</span>
    <span style="color:#a6e22e">xmlhttp</span>.<span style="color:#a6e22e">open</span>(<span style="color:#e6db74">&#34;GET&#34;</span>,<span style="color:#e6db74">&#34;ajaxServlet?username=tom&#34;</span>,<span style="color:#66d9ef">true</span>);

    <span style="color:#75715e">//3.发送请求
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">xmlhttp</span>.<span style="color:#a6e22e">send</span>();

    <span style="color:#75715e">//4.接受并处理来自服务器的响应结果
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//获取方式 ：xmlhttp.responseText
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//什么时候获取？当服务器响应成功后再获取
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//当xmlhttp对象的就绪状态改变时，触发事件onreadystatechange。
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">xmlhttp</span>.<span style="color:#a6e22e">onreadystatechange</span><span style="color:#f92672">=</span><span style="color:#66d9ef">function</span>() {
        <span style="color:#75715e">//判断readyState就绪状态是否为4，判断status响应状态码是否为200
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">xmlhttp</span>.<span style="color:#a6e22e">readyState</span><span style="color:#f92672">==</span><span style="color:#ae81ff">4</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">xmlhttp</span>.<span style="color:#a6e22e">status</span><span style="color:#f92672">==</span><span style="color:#ae81ff">200</span>) {
            <span style="color:#75715e">//获取服务器的响应结果
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">responseText</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">xmlhttp</span>.<span style="color:#a6e22e">responseText</span>;
            <span style="color:#a6e22e">alert</span>(<span style="color:#a6e22e">responseText</span>);
        }
    }    
<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/script&gt;</span>
</code></pre></div><ol start="2">
<li>JQeury实现方式</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">script</span><span style="color:#f92672">&gt;</span>
    <span style="color:#75715e">// 1. $.ajax()  
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// 语法：$.ajax({键值对});使用$.ajax()发送异步请求
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">$</span>.<span style="color:#a6e22e">ajax</span>({
        <span style="color:#a6e22e">url</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#34;AjaxServlet01&#34;</span> , <span style="color:#75715e">// 请求路径
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#34;POST&#34;</span> , <span style="color:#75715e">//请求方式
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span>{<span style="color:#e6db74">&#34;username&#34;</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#34;jack&#34;</span>,<span style="color:#e6db74">&#34;age&#34;</span><span style="color:#f92672">:</span><span style="color:#ae81ff">23</span>},<span style="color:#75715e">//请求参数
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">success</span><span style="color:#f92672">:</span><span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">data</span>) {
            <span style="color:#a6e22e">alert</span>(<span style="color:#a6e22e">data</span>);
        },<span style="color:#75715e">//响应成功后的回调函数
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">error</span><span style="color:#f92672">:</span><span style="color:#66d9ef">function</span> () {
            <span style="color:#a6e22e">alert</span>(<span style="color:#e6db74">&#34;出错啦...&#34;</span>)
        },<span style="color:#75715e">//表示如果请求响应出现错误，会执行的回调函数
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">dataType</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#34;text&#34;</span><span style="color:#75715e">//设置接受到的响应数据的格式
</span><span style="color:#75715e"></span>    });
<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/script&gt;</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">script</span><span style="color:#f92672">&gt;</span>
    <span style="color:#75715e">//2. $.get()：发送get请求
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// 语法：$.get(url, [data], [callback], [type])
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// 参数：
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// url：请求路径
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// data：请求参数
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// callback：回调函数
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// type：响应结果的类型
</span><span style="color:#75715e"></span>
    <span style="color:#a6e22e">$</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;/AjaxServlet01&#34;</span>,{<span style="color:#a6e22e">name</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#34;zhangsan&#34;</span>,<span style="color:#a6e22e">age</span><span style="color:#f92672">:</span><span style="color:#ae81ff">32</span>},<span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">data</span>) {
        <span style="color:#a6e22e">alert</span>(<span style="color:#a6e22e">data</span>);
    },<span style="color:#e6db74">&#34;text&#34;</span>);
<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/script&gt;</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">script</span><span style="color:#f92672">&gt;</span>
    <span style="color:#75715e">//3. $.post()：发送post请求
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// 语法：$.post(url, [data], [callback], [type])
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// 参数：
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// url：请求路径
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// data：请求参数
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// callback：回调函数
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// type：响应结果的类型
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">$</span>.<span style="color:#a6e22e">post</span>(<span style="color:#e6db74">&#34;/AjaxServlet01&#34;</span>,{<span style="color:#a6e22e">name</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#34;zhangsan&#34;</span>,<span style="color:#a6e22e">age</span><span style="color:#f92672">:</span><span style="color:#ae81ff">32</span>},<span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">data</span>) {
        <span style="color:#a6e22e">alert</span>(<span style="color:#a6e22e">data</span>);
    },<span style="color:#e6db74">&#34;text&#34;</span>);
<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/script&gt;</span>
</code></pre></div><h4 id="82-json">8.2 JSON</h4>
<p>概念： JavaScript Object Notation  JavaScript对象表示法！</p>
<p>JSON 现在多用于存储和交换文本信息的语法，进行数据的传输！JSON 比 XML 更小、更快，更易解析。</p>
<h5 id="语法">语法</h5>
<ol>
<li>
<p>数据在名称/值对中</p>
</li>
<li>
<p>数据由逗号分隔</p>
</li>
<li>
<p>花括号保存对象</p>
</li>
<li>
<p>方括号保存数组</p>
</li>
</ol>
<p>JSON值的取值类型：</p>
<ol>
<li>
<p>数字（整数或浮点数）</p>
</li>
<li>
<p>字符串（在双引号中）</p>
</li>
<li>
<p>逻辑值（true 或 false）</p>
</li>
<li>
<p>数组（在方括号中） {&ldquo;persons&rdquo;:[{},{}]}</p>
</li>
<li>
<p>对象（在花括号中） {&ldquo;address&rdquo;:{&ldquo;province&rdquo;：&ldquo;陕西&rdquo;&hellip;.}}</p>
</li>
<li>
<p>null</p>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">script</span><span style="color:#f92672">&gt;</span>
        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">person</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">name</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#34;张三&#34;</span>,<span style="color:#a6e22e">age</span><span style="color:#f92672">:</span><span style="color:#ae81ff">23</span>,<span style="color:#a6e22e">gender</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#34;男&#34;</span>};
        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">persons</span><span style="color:#f92672">=</span>[{<span style="color:#a6e22e">name</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#34;张三&#34;</span>,<span style="color:#a6e22e">age</span><span style="color:#f92672">:</span><span style="color:#ae81ff">23</span>,<span style="color:#a6e22e">gender</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#34;男&#34;</span>},{<span style="color:#a6e22e">name</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#34;李四&#34;</span>,<span style="color:#a6e22e">age</span><span style="color:#f92672">:</span><span style="color:#ae81ff">33</span>,<span style="color:#a6e22e">gender</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#34;男&#34;</span>}]
<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/script&gt;</span>
</code></pre></div><h5 id="json获取数据">JSON获取数据</h5>
<ul>
<li>
<p>json对象.键名；例：person.name</p>
</li>
<li>
<p>json对象[&ldquo;键名&rdquo;]；例：person[&ldquo;name&rdquo;]</p>
</li>
<li>
<p>数组对象[索引]； 例：persons[0].age</p>
</li>
<li>
<p>遍历； for in 循环</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">&lt;</span>script<span style="color:#f92672">&gt;</span>
        var person<span style="color:#f92672">={</span>name<span style="color:#f92672">:</span><span style="color:#e6db74">&#34;张三&#34;</span><span style="color:#f92672">,</span>age<span style="color:#f92672">:</span>23<span style="color:#f92672">,</span>gender<span style="color:#f92672">:</span><span style="color:#e6db74">&#34;男&#34;</span><span style="color:#f92672">};</span>
        var persons<span style="color:#f92672">=[{</span>name<span style="color:#f92672">:</span><span style="color:#e6db74">&#34;张三&#34;</span><span style="color:#f92672">,</span>age<span style="color:#f92672">:</span>23<span style="color:#f92672">,</span>gender<span style="color:#f92672">:</span><span style="color:#e6db74">&#34;男&#34;</span><span style="color:#f92672">},{</span>name<span style="color:#f92672">:</span><span style="color:#e6db74">&#34;李四&#34;</span><span style="color:#f92672">,</span>age<span style="color:#f92672">:</span>33<span style="color:#f92672">,</span>gender<span style="color:#f92672">:</span><span style="color:#e6db74">&#34;男&#34;</span><span style="color:#f92672">}]</span>
                
        
        <span style="color:#75715e">//获取person对象中所有的键和值
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//for in 循环
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span>var key in person<span style="color:#f92672">){</span>
            <span style="color:#75715e">//alert(key + &#34;:&#34; + person.key); //这样的方式获取不行。因为相当于 person.&#34;name&#34;
</span><span style="color:#75715e"></span>            alert<span style="color:#f92672">(</span>key<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;:&#34;</span><span style="color:#f92672">+</span>person<span style="color:#f92672">[</span>key<span style="color:#f92672">]);</span>
        <span style="color:#f92672">}</span>

        <span style="color:#75715e">//获取persons中的所有值
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>var i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> persons<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
            var p <span style="color:#f92672">=</span> persons<span style="color:#f92672">[</span>i<span style="color:#f92672">];</span>
            <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span>var key in p<span style="color:#f92672">){</span>
                alert<span style="color:#f92672">(</span>key<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;:&#34;</span><span style="color:#f92672">+</span>p<span style="color:#f92672">[</span>key<span style="color:#f92672">]);</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">&lt;/</span>script<span style="color:#f92672">&gt;</span>
</code></pre></div><h5 id="java对象转json">JAVA对象转JSON</h5>
<p>JSON解析器：</p>
<p>常见的解析器：Jsonlib，Gson，fastjson，jackson</p>
<ol>
<li>
<p>导入jackson的相关jar包</p>
<p>jackson-annotations-2.2.3.jar，jackson-core-2.2.3.jar，jackson-databind-2.2.3.jar</p>
</li>
<li>
<p>创建Jackson核心对象 ObjectMapper</p>
</li>
<li>
<p>调用ObjectMapper的相关方法进行转换</p>
</li>
</ol>
<p>转换方法：writeValue(参数，obj)；</p>
<p>​       参数：</p>
<p>​             File：将obj对象转换为JSON字符串，并保存到指定的文件中</p>
<p>​             Writer：将obj对象转换为JSON字符串，并将json数据填充到字符输出流中</p>
<p>​             OutputStream：将obj对象转换为JSON字符串，并将json数据填充到字节输出流中</p>
<p>​             writeValueAsString(obj)：将对象转为json字符串</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//Java对象转Json字符串
</span><span style="color:#75715e"></span>
        <span style="color:#75715e">//创建对象
</span><span style="color:#75715e"></span>        Person p<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> Person<span style="color:#f92672">();</span>
        p<span style="color:#f92672">.</span><span style="color:#a6e22e">setName</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;iNuo&#34;</span><span style="color:#f92672">);</span>
        p<span style="color:#f92672">.</span><span style="color:#a6e22e">setAge</span><span style="color:#f92672">(</span>25<span style="color:#f92672">);</span>

        <span style="color:#75715e">//jackson的核心对象，用来完成转换
</span><span style="color:#75715e"></span>        ObjectMapper mapper<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> ObjectMapper<span style="color:#f92672">();</span>
        <span style="color:#75715e">//转换
</span><span style="color:#75715e"></span>        String json<span style="color:#f92672">=</span>mapper<span style="color:#f92672">.</span><span style="color:#a6e22e">writeValueAsString</span><span style="color:#f92672">(</span>p<span style="color:#f92672">);</span>
        <span style="color:#75715e">//转换并保存
</span><span style="color:#75715e"></span>        mapper<span style="color:#f92672">.</span><span style="color:#a6e22e">writeValue</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;src/com/iNuo/json/json.txt&#34;</span><span style="color:#f92672">),</span>p<span style="color:#f92672">);</span>
        <span style="color:#75715e">//转换并保存到文件输出流中
</span><span style="color:#75715e"></span>        mapper<span style="color:#f92672">.</span><span style="color:#a6e22e">writeValue</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> FileWriter<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;src/com/iNuo/json/json1.txt&#34;</span><span style="color:#f92672">),</span>p<span style="color:#f92672">);</span>
        <span style="color:#75715e">//打印输出
</span><span style="color:#75715e"></span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>json<span style="color:#f92672">);</span>
</code></pre></div><p>注解：</p>
<p>​	@JsonIgnore：排除属性。</p>
<p>​	@JsonFormat：属性值得格式化</p>
<p>​    @JsonFormat(pattern = &ldquo;yyyy-MM-dd&rdquo;)</p>
<p>复杂java对象转换</p>
<p>​	List：数组</p>
<p>​	Map：对象格式一致</p>
<h5 id="json数据转java对象">JSON数据转JAVA对象</h5>
<p>​	1）导入jackson的相关jar包</p>
<p>​	2）创建Jackson核心对象 ObjectMapper</p>
<p>​	3）调用ObjectMapper的相关方法进行转换</p>
<p>​	4）readValue(json字符串数据,Class)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//Json字符串转Java对象
</span><span style="color:#75715e"></span>    String json1<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{\&#34;name\&#34;:\&#34;iNuo\&#34;,\&#34;age\&#34;:25}&#34;</span><span style="color:#f92672">;</span>
    ObjectMapper mapper1<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> ObjectMapper<span style="color:#f92672">();</span>
    Person p1<span style="color:#f92672">=</span>mapper1<span style="color:#f92672">.</span><span style="color:#a6e22e">readValue</span><span style="color:#f92672">(</span>json1<span style="color:#f92672">,</span>Person<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>p1<span style="color:#f92672">);</span>
</code></pre></div><h4 id="83-案例校验用户名是否存在">8.3 案例：校验用户名是否存在</h4>
<p>服务器响应的数据，在客户端使用时，要想当做json数据格式使用。有两种解决方案：</p>
<ol>
<li>
<p>$.get(type)：将最后一个参数type指定为&quot;json&rdquo;</p>
</li>
<li>
<p>在服务器端设置MIME类型</p>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">response<span style="color:#f92672">.</span><span style="color:#a6e22e">setContentType</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;application/json;charset=utf-8&#34;</span><span style="color:#f92672">);</span>
</code></pre></div><p>代码实现：</p>
<p>register.html</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;
&lt;<span style="color:#f92672">head</span>&gt;
    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>&gt;
    &lt;<span style="color:#f92672">title</span>&gt;注册页面&lt;/<span style="color:#f92672">title</span>&gt;
    &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;js/jquery-3.3.1.min.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
    &lt;<span style="color:#f92672">script</span>&gt;
        <span style="color:#a6e22e">$</span>(<span style="color:#66d9ef">function</span> () {
            <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#userName&#34;</span>).<span style="color:#a6e22e">blur</span>(<span style="color:#66d9ef">function</span>(){
                <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">userName</span><span style="color:#f92672">=</span><span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#userName&#34;</span>).<span style="color:#a6e22e">val</span>();
                <span style="color:#75715e">//{isExist:true,msg:&#34;此用户太受欢迎，请换一个！&#34;}
</span><span style="color:#75715e"></span>                <span style="color:#a6e22e">$</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;findUserServlet&#34;</span>,{<span style="color:#a6e22e">userName</span><span style="color:#f92672">:</span><span style="color:#a6e22e">userName</span>},<span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">data</span>) {
                    <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#message&#34;</span>).<span style="color:#a6e22e">html</span>(<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">msg</span>);
                    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">isExist</span>){ <span style="color:#75715e">//如果用户已经存在
</span><span style="color:#75715e"></span>                        <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#message&#34;</span>).<span style="color:#a6e22e">css</span>(<span style="color:#e6db74">&#34;color&#34;</span>,<span style="color:#e6db74">&#34;red&#34;</span>);
                    }<span style="color:#66d9ef">else</span> {
                        <span style="color:#a6e22e">$</span>(<span style="color:#e6db74">&#34;#message&#34;</span>).<span style="color:#a6e22e">css</span>(<span style="color:#e6db74">&#34;color&#34;</span>,<span style="color:#e6db74">&#34;green&#34;</span>);
                    }
                },<span style="color:#e6db74">&#34;json&#34;</span>)
            })
        })
    &lt;/<span style="color:#f92672">script</span>&gt;
&lt;/<span style="color:#f92672">head</span>&gt;
&lt;<span style="color:#f92672">body</span>&gt;
用户名：&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;userName&#34;</span>&gt;&lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;message&#34;</span>&gt;&lt;/<span style="color:#f92672">span</span>&gt;&lt;<span style="color:#f92672">br</span>/&gt;
密码：&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;password&#34;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;pwd&#34;</span>&gt;&lt;<span style="color:#f92672">br</span>/&gt;
&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;注册&#34;</span>&gt;
&lt;/<span style="color:#f92672">body</span>&gt;
&lt;/<span style="color:#f92672">html</span>&gt;
</code></pre></div><p>findUserServlet.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.servlet<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> ...

<span style="color:#a6e22e">@WebServlet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/findUserServlet&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">findUserServlet</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest request<span style="color:#f92672">,</span> HttpServletResponse response<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#75715e">//获取用户名
</span><span style="color:#75715e"></span>        String userName<span style="color:#f92672">=</span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;userName&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#75715e">//调用业务逻辑层-调用数据访问层，判断用户是否存在，这里我们简化一下
</span><span style="color:#75715e"></span>        HashMap<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span>Object<span style="color:#f92672">&gt;</span> map<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Object<span style="color:#f92672">&gt;();</span>
        response<span style="color:#f92672">.</span><span style="color:#a6e22e">setContentType</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;application/json;charset=utf-8&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;tom&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>userName<span style="color:#f92672">)){</span> <span style="color:#75715e">//如果该用户已经存在
</span><span style="color:#75715e"></span>            map<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;isExist&#34;</span><span style="color:#f92672">,</span><span style="color:#66d9ef">true</span><span style="color:#f92672">);</span>
            map<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;msg&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;此用户名太受欢迎，请更换一个！&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span><span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
            map<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;isExist&#34;</span><span style="color:#f92672">,</span><span style="color:#66d9ef">false</span><span style="color:#f92672">);</span>
            map<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;msg&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;该用户名可用！&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>

        <span style="color:#75715e">//将map的数据转换为json并放入输出流
</span><span style="color:#75715e"></span>        ObjectMapper mapper<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> ObjectMapper<span style="color:#f92672">();</span>
        mapper<span style="color:#f92672">.</span><span style="color:#a6e22e">writeValue</span><span style="color:#f92672">(</span>response<span style="color:#f92672">.</span><span style="color:#a6e22e">getWriter</span><span style="color:#f92672">(),</span>map<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest request<span style="color:#f92672">,</span> HttpServletResponse response<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        doPost<span style="color:#f92672">(</span>request<span style="color:#f92672">,</span>response<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div></div>
  
</article></main>
<footer class="footer">
  <span>&copy; 2021 <a href="https://xshi000.github.io/">及时当勉励，岁月不待人！@iNuo</a></span>
  <span>&middot;</span>
  <span>Powered by <a href="https://gohugo.io/" rel="noopener" target="_blank">Hugo️️</a>️</span>
  <span>&middot;</span>
  <span>Theme️ <a href="https://github.com/nanxiaobei/hugo-paper" rel="noopener" target="_blank">Paper</a></span>
</footer>
<script src="https://xshi000.github.io/highlight.min.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>
</body>
</html>

