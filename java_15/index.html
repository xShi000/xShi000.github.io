<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <title>极简Java十五：MyBatis框架 - 及时当勉励，岁月不待人！@iNuo</title>
    
    <meta name="description" content="第一章  本章内容  Mybatis介绍 Mybatis框架 Mybatis入门案例   什么是框架？   是一个应用程序的半成品
  提供可重用的公共结构
  按一定规则组织的一组组件
  例：写简历，使用模板不用考虑布局、排版等，提高效率，可专心在简历内容上，结构统一，便于人事阅读，新手也可以作出专业的简历。
使用框架的好处   不用再考虑公共问题
  专心在业务实现上
  结构统一，易于学习、维护
  新手也可写出好程序
  主流框架：  SSH：Spring &#43; Strucs2 &#43; Hibernate SSM：Spring &#43; SpringMVC &#43; Mybatis  1.1 Mybatis介绍 MyBatis是一个优秀的持久层框架，它对jdbc的操作数据库的过程进行封装，使开发者只需要关注 SQL 本身，而不需要花费精力去处理例如注册驱动、创建connection、创建statement、手动设置参数、结果集检索等jdbc繁杂的过程代码。
Jdbc的问题： Sql语句在代码中硬编码，造成代码不易维护，实际应用sql变化的可能较大，sql变动需要改变java代码。
public static void main(String[] args) { Connection connection = null; PreparedStatement preparedStatement = null; ResultSet resultSet = null; try { //加载数据库驱动  Class.">
    <meta name="author" content="">
    
    <link href="https://xshi000.github.io/an-old-hope.min.css" rel="stylesheet">
    <link href="https://xshi000.github.io/style.css" rel="stylesheet">
    <link href="https://xshi000.github.io/custom.css" rel="stylesheet">
    
    <link rel="apple-touch-icon" href="https://xshi000.github.io/apple-touch-icon.png">
    <link rel="icon" href="https://xshi000.github.io/favicon.ico">
    <meta name="generator" content="Hugo 0.65.3" />
    
    
    
    <script>
      function setTheme() {
        const time = new Date();

        const prev = localStorage.getItem('date');
        const date = String(time.getMonth() + 1) + '.' + String(time.getDate());

        const now = time.getTime();
        let sunrise;
        let sunset;

        function setBodyClass() {
          if (now > sunrise && now < sunset) return;
          document.body.classList.add('dark');
        }

        if (date !== prev) {
          fetch('https://api.ipgeolocation.io/astronomy?apiKey=5ed37d85103e4defa5df4c5298ed5215')
            .then(res => res.json())
            .then(data => {
              sunrise = data.sunrise.split(':').map(Number);
              sunset = data.sunset.split(':').map(Number);
            })
            .catch(() => {
              sunrise = [7, 0];
              sunset = [19, 0];
            })
            .finally(() => {
              sunrise = time.setHours(sunrise[0], sunrise[1], 0);
              sunset = time.setHours(sunset[0], sunset[1], 0);
              setBodyClass();
              localStorage.setItem('sunrise', sunrise);
              localStorage.setItem('sunset', sunset);
            });
          localStorage.setItem('date', date);
        } else {
          sunrise = Number(localStorage.getItem('sunrise'));
          sunset = Number(localStorage.getItem('sunset'));
          setBodyClass();
        }
      }
    </script>
  </head>
  <body class="single">
    <script>
      setTheme();
    </script>
    <header class="header">
      <nav class="nav">
        <p class="logo"><a href="https://xshi000.github.io/">及时当勉励，岁月不待人！@iNuo</a></p>
      </nav>
    </header>
    <main class="main">


<article class="post-single">
  <header class="post-header">
    <h1 class="post-title">极简Java十五：MyBatis框架</h1>
    <div class="post-meta">February 6, 2021</div>
  </header>
  <div class="post-content"><hr>
<h3 id="第一章">第一章</h3>
<hr>
<h5 id="本章内容">本章内容</h5>
<ul>
<li>Mybatis介绍</li>
<li>Mybatis框架</li>
<li>Mybatis入门案例</li>
</ul>
<hr>
<h5 id="什么是框架">什么是框架？</h5>
<ul>
<li>
<p>是一个应用程序的半成品</p>
</li>
<li>
<p>提供可重用的公共结构</p>
</li>
<li>
<p>按一定规则组织的一组组件</p>
</li>
</ul>
<p>例：写简历，使用模板不用考虑布局、排版等，提高效率，可专心在简历内容上，结构统一，便于人事阅读，新手也可以作出专业的简历。</p>
<h5 id="使用框架的好处">使用框架的好处</h5>
<ul>
<li>
<p>不用再考虑公共问题</p>
</li>
<li>
<p>专心在业务实现上</p>
</li>
<li>
<p>结构统一，易于学习、维护</p>
</li>
<li>
<p>新手也可写出好程序</p>
</li>
</ul>
<h5 id="主流框架">主流框架：</h5>
<ul>
<li>SSH：Spring + Strucs2 + Hibernate</li>
<li>SSM：Spring + SpringMVC + Mybatis</li>
</ul>
<h4 id="11-mybatis介绍">1.1 Mybatis介绍</h4>
<p>MyBatis是一个优秀的持久层框架，它对jdbc的操作数据库的过程进行封装，使开发者只需要关注 SQL 本身，而不需要花费精力去处理例如注册驱动、创建connection、创建statement、手动设置参数、结果集检索等jdbc繁杂的过程代码。</p>
<h5 id="jdbc的问题">Jdbc的问题：</h5>
<p>Sql语句在代码中硬编码，造成代码不易维护，实际应用sql变化的可能较大，sql变动需要改变java代码。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>

        Connection connection <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        PreparedStatement preparedStatement <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        ResultSet resultSet <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        
        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">//加载数据库驱动
</span><span style="color:#75715e"></span>            Class<span style="color:#f92672">.</span><span style="color:#a6e22e">forName</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;com.mysql.jdbc.Driver&#34;</span><span style="color:#f92672">);</span>
            <span style="color:#75715e">//通过驱动管理类获取数据库链接
</span><span style="color:#75715e"></span>            connection <span style="color:#f92672">=</span> DriverManager<span style="color:#f92672">.</span><span style="color:#a6e22e">getConnection</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;jdbc:mysql://localhost:3306/mybatis?characterEncoding=utf-8&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;root&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;root&#34;</span><span style="color:#f92672">);</span>
            <span style="color:#75715e">//定义sql语句 ?表示占位符
</span><span style="color:#75715e"></span>            String sql <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;select * from user where username = ?&#34;</span><span style="color:#f92672">;</span>
            <span style="color:#75715e">//获取预处理statement
</span><span style="color:#75715e"></span>            preparedStatement <span style="color:#f92672">=</span> connection<span style="color:#f92672">.</span><span style="color:#a6e22e">prepareStatement</span><span style="color:#f92672">(</span>sql<span style="color:#f92672">);</span>
            <span style="color:#75715e">//设置参数，第一个参数为sql语句中参数的序号（从1开始），第二个参数为设置的参数值
</span><span style="color:#75715e"></span>            preparedStatement<span style="color:#f92672">.</span><span style="color:#a6e22e">setString</span><span style="color:#f92672">(</span>1<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;王五&#34;</span><span style="color:#f92672">);</span>
            <span style="color:#75715e">//向数据库发出sql执行查询，查询出结果集
</span><span style="color:#75715e"></span>            resultSet <span style="color:#f92672">=</span> preparedStatement<span style="color:#f92672">.</span><span style="color:#a6e22e">executeQuery</span><span style="color:#f92672">();</span>
            <span style="color:#75715e">//遍历查询结果集
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span>resultSet<span style="color:#f92672">.</span><span style="color:#a6e22e">next</span><span style="color:#f92672">()){</span>
                System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>resultSet<span style="color:#f92672">.</span><span style="color:#a6e22e">getString</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;id&#34;</span><span style="color:#f92672">)+</span><span style="color:#e6db74">&#34; &#34;</span><span style="color:#f92672">+</span>resultSet<span style="color:#f92672">.</span><span style="color:#a6e22e">getString</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;username&#34;</span><span style="color:#f92672">));</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span><span style="color:#66d9ef">finally</span><span style="color:#f92672">{</span>
            <span style="color:#75715e">//释放资源
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>resultSet<span style="color:#f92672">!=</span><span style="color:#66d9ef">null</span><span style="color:#f92672">){</span>
                <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
                    resultSet<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
                <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>SQLException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    <span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e"></span>                    e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
            <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>preparedStatement<span style="color:#f92672">!=</span><span style="color:#66d9ef">null</span><span style="color:#f92672">){</span>
                <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
                    preparedStatement<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
                <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>SQLException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    <span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e"></span>                    e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
            <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>connection<span style="color:#f92672">!=</span><span style="color:#66d9ef">null</span><span style="color:#f92672">){</span>
                <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
                    connection<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
                <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>SQLException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    <span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e"></span>                    e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
</code></pre></div><h4 id="12-mybatis架构">1.2 Mybatis架构</h4>
<p><img src="/img/clip_image002-1608952061129.jpg" alt="img"></p>
<h4 id="13-mybatis入门案例">1.3 MyBatis入门案例</h4>
<p>需求：查询图书表book中的记录数</p>
<h5 id="第一步创建maven工程">第一步：创建maven工程</h5>
<p>新建——项目——maven——MybatisDemo</p>
<h5 id="第二步添加依赖">第二步：添加依赖：</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;dependencies&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>org.mybatis<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>mybatis<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;version&gt;</span>3.5.0<span style="color:#f92672">&lt;/version&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>mysql<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>mysql-connector-java<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;version&gt;</span>5.1.46<span style="color:#f92672">&lt;/version&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>log4j<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>log4j<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;version&gt;</span>1.2.17<span style="color:#f92672">&lt;/version&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>junit<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>junit<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;version&gt;</span>4.12<span style="color:#f92672">&lt;/version&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
<span style="color:#f92672">&lt;/dependencies&gt;</span>
</code></pre></div><h5 id="第三步在resources下创建mybatis核心配置文件sqlmapconfigxml">第三步：在resources下创建MyBatis核心配置文件：SqlMapConfig.xml</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span style="color:#75715e">&lt;!DOCTYPE configuration PUBLIC &#34;-//mybatis.org//DTD Config 3.0//EN&#34; &#34;http://mybatis.org/dtd/mybatis-3-config.dtd&#34;&gt;</span>
<span style="color:#f92672">&lt;configuration&gt;</span>
<span style="color:#75715e">&lt;!--    可配置多套环境变量，用default指定id即可--&gt;</span>
    <span style="color:#f92672">&lt;environments</span> <span style="color:#a6e22e">default=</span><span style="color:#e6db74">&#34;development&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;environment</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;development&#34;</span><span style="color:#f92672">&gt;</span>
            <span style="color:#75715e">&lt;!--用jdbc做事务控制  --&gt;</span>
            <span style="color:#f92672">&lt;transactionManager</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;JDBC&#34;</span> <span style="color:#f92672">/&gt;</span>
            <span style="color:#75715e">&lt;!--数据库连接池  --&gt;</span>
            <span style="color:#f92672">&lt;dataSource</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;POOLED&#34;</span><span style="color:#f92672">&gt;</span>
                <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;driver&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;com.mysql.jdbc.Driver&#34;</span> <span style="color:#f92672">/&gt;</span>
                <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;url&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;jdbc:mysql://localhost:3306/db2&#34;</span> <span style="color:#f92672">/&gt;</span>
                <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;username&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;root&#34;</span> <span style="color:#f92672">/&gt;</span>
                <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;password&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;123456&#34;</span> <span style="color:#f92672">/&gt;</span>
            <span style="color:#f92672">&lt;/dataSource&gt;</span>
        <span style="color:#f92672">&lt;/environment&gt;</span>
    <span style="color:#f92672">&lt;/environments&gt;</span>
<span style="color:#f92672">&lt;/configuration&gt;</span>
</code></pre></div><h5 id="第四步在resources下创建sql映射文件-cominuodaobookmapperxml">第四步：在resources下创建sql映射文件 com/iNuo/dao/BookMapper.xml</h5>
<p>注：创建目录时，一步一步创建，不可一次创建！</p>
<p>创建sql映射文件BookMapper.xml</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
<span style="color:#75715e">&lt;!DOCTYPE mapper PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34; &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;</span>

<span style="color:#f92672">&lt;mapper</span> <span style="color:#a6e22e">namespace=</span><span style="color:#e6db74">&#34;com.iNuo.dao&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;findBookCount&#34;</span>   <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;int&#34;</span><span style="color:#f92672">&gt;</span>
	    select count(*) from user
    <span style="color:#f92672">&lt;/select&gt;</span>
<span style="color:#f92672">&lt;/mapper&gt;</span>
</code></pre></div><p>namespace ：命名空间，用于隔离sql语句！</p>
<h5 id="第五步加载映射文件">第五步：加载映射文件</h5>
<p>mybatis框架需要加载映射文件，将BookMapper.xml添加在SqlMapConfig.xml，如下</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;mappers&gt;&lt;mapper</span> <span style="color:#a6e22e">resource=</span><span style="color:#e6db74">&#34;com/iNuo/dao/BookMapper.xml&#34;</span><span style="color:#f92672">/&gt;&lt;/mappers&gt;</span>
</code></pre></div><h5 id="第六步测试">第六步：测试</h5>
<p>在test/java下创建com/iNuo/test/MybatisTest.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.test<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> ...

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MybatisTest</span> <span style="color:#f92672">{</span>

    <span style="color:#a6e22e">@Test</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>
        <span style="color:#75715e">//1.加载Mybatis的核心配置文件
</span><span style="color:#75715e"></span>        String resource <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mybatis-config.xml&#34;</span><span style="color:#f92672">;</span>
        InputStream is <span style="color:#f92672">=</span> Resources<span style="color:#f92672">.</span><span style="color:#a6e22e">getResourceAsStream</span><span style="color:#f92672">(</span>resource<span style="color:#f92672">);</span>
        <span style="color:#75715e">//2.创建会话工厂
</span><span style="color:#75715e"></span>        SqlSessionFactory factory <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SqlSessionFactoryBuilder<span style="color:#f92672">().</span><span style="color:#a6e22e">build</span><span style="color:#f92672">(</span>is<span style="color:#f92672">);</span>
        <span style="color:#75715e">//3.创建会话
</span><span style="color:#75715e"></span>        SqlSession session <span style="color:#f92672">=</span> factory<span style="color:#f92672">.</span><span style="color:#a6e22e">openSession</span><span style="color:#f92672">();</span>
        <span style="color:#75715e">//4.执行sql语句
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">int</span> count <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span><span style="color:#a6e22e">selectOne</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;com.iNuo.dao.findBookCount&#34;</span><span style="color:#f92672">);</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>count<span style="color:#f92672">);</span>
        <span style="color:#75715e">//5.关闭会话
</span><span style="color:#75715e"></span>        session<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="项目优化">项目优化</h5>
<p>使用数据访问层改造程序</p>
<p>在main/java下，创建com.iNuo.dao.BookDao接口：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.dao<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">BookDao</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">findBookCount</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>创建实现类impl/BookDaoImpl.java:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.dao.impl<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> ...

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BookDaoImpl</span> <span style="color:#66d9ef">implements</span> BookDao <span style="color:#f92672">{</span>
    <span style="color:#75715e">//创建会话工厂
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> SqlSessionFactory factory<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">BookDaoImpl</span><span style="color:#f92672">(</span>SqlSessionFactory factory<span style="color:#f92672">){</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">factory</span><span style="color:#f92672">=</span>factory<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">findBookCount</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        
        <span style="color:#75715e">//创建会话
</span><span style="color:#75715e"></span>        SqlSession session <span style="color:#f92672">=</span> factory<span style="color:#f92672">.</span><span style="color:#a6e22e">openSession</span><span style="color:#f92672">();</span>
        <span style="color:#75715e">//执行sql语句
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">int</span> count <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span><span style="color:#a6e22e">selectOne</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;com.iNuo.dao.findBookCount&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#75715e">//5.关闭会话
</span><span style="color:#75715e"></span>        session<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
        
        <span style="color:#66d9ef">return</span> count<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><p>在test/java/com/iNuo/test下，创建测试类MybatisTest1.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.test<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> ...

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MybatisTest1</span> <span style="color:#f92672">{</span>
    
    <span style="color:#a6e22e">@Test</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>
        <span style="color:#75715e">//1.加载Mybatis的核心配置文件
</span><span style="color:#75715e"></span>        InputStream inputStream <span style="color:#f92672">=</span> Resources<span style="color:#f92672">.</span><span style="color:#a6e22e">getResourceAsStream</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;mybatis-config.xml&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#75715e">//2.创建会话工厂
</span><span style="color:#75715e"></span>        SqlSessionFactory factory <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SqlSessionFactoryBuilder<span style="color:#f92672">().</span><span style="color:#a6e22e">build</span><span style="color:#f92672">(</span>inputStream<span style="color:#f92672">);</span>
        <span style="color:#75715e">//3.创建数据访问层对象
</span><span style="color:#75715e"></span>        BookDao bookDao<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> BookDaoImpl<span style="color:#f92672">(</span>factory<span style="color:#f92672">);</span>
        <span style="color:#75715e">//4.执行方法
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">int</span> count <span style="color:#f92672">=</span> bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findBookCount</span><span style="color:#f92672">();</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>count<span style="color:#f92672">);</span>
        <span style="color:#75715e">//5.关闭流
</span><span style="color:#75715e"></span>        inputStream<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>优化：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.test<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> <span style="color:#960050;background-color:#1e0010">。。。</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MybatisTest1</span> <span style="color:#f92672">{</span>
    
    <span style="color:#66d9ef">private</span> InputStream inputStream<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> BookDao bookDao<span style="color:#f92672">;</span>
    
    <span style="color:#a6e22e">@Before</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">init</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>
        <span style="color:#75715e">//1.加载Mybatis的核心配置文件
</span><span style="color:#75715e"></span>        inputStream <span style="color:#f92672">=</span> Resources<span style="color:#f92672">.</span><span style="color:#a6e22e">getResourceAsStream</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;mybatis-config.xml&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#75715e">//2.创建会话工厂
</span><span style="color:#75715e"></span>        SqlSessionFactory factory <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SqlSessionFactoryBuilder<span style="color:#f92672">().</span><span style="color:#a6e22e">build</span><span style="color:#f92672">(</span>inputStream<span style="color:#f92672">);</span>
        <span style="color:#75715e">//3.创建数据访问层对象
</span><span style="color:#75715e"></span>        bookDao<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> BookDaoImpl<span style="color:#f92672">(</span>factory<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Test</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>
        <span style="color:#75715e">//4.执行方法
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">int</span> count <span style="color:#f92672">=</span> bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findBookCount</span><span style="color:#f92672">();</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>count<span style="color:#f92672">);</span>
        <span style="color:#75715e">//5.关闭流
</span><span style="color:#75715e"></span>        inputStream<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="动态代理方式实现">动态代理方式实现</h5>
<p>我们可以用动态代理的方式进一步简化：</p>
<p>开发规范：动态代理开发方法只需要程序员编写Mapper接口（相当于Dao接口），由Mybatis框架根据接口定义创建接口的动态代理对象，代理对象的方法体同上边Dao接口实现类方法！</p>
<h5 id="第一步创建maven工程-1">第一步：创建maven工程</h5>
<p>新建——项目——maven——MybatisDemo</p>
<h5 id="第二步添加依赖-1">第二步：添加依赖：</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;dependencies&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>org.mybatis<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>mybatis<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;version&gt;</span>3.5.0<span style="color:#f92672">&lt;/version&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>mysql<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>mysql-connector-java<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;version&gt;</span>5.1.46<span style="color:#f92672">&lt;/version&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>log4j<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>log4j<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;version&gt;</span>1.2.17<span style="color:#f92672">&lt;/version&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>junit<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>junit<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;version&gt;</span>4.12<span style="color:#f92672">&lt;/version&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
<span style="color:#f92672">&lt;/dependencies&gt;</span>
</code></pre></div><h5 id="第三步在resources下创建mybatis核心配置文件sqlmapconfigxml-1">第三步：在resources下创建MyBatis核心配置文件：SqlMapConfig.xml</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span style="color:#75715e">&lt;!DOCTYPE configuration PUBLIC &#34;-//mybatis.org//DTD Config 3.0//EN&#34; &#34;http://mybatis.org/dtd/mybatis-3-config.dtd&#34;&gt;</span>
<span style="color:#f92672">&lt;configuration&gt;</span>
<span style="color:#75715e">&lt;!--    可配置多套环境变量，用default指定id即可--&gt;</span>
    <span style="color:#f92672">&lt;environments</span> <span style="color:#a6e22e">default=</span><span style="color:#e6db74">&#34;development&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;environment</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;development&#34;</span><span style="color:#f92672">&gt;</span>
            <span style="color:#75715e">&lt;!--用jdbc做事务控制  --&gt;</span>
            <span style="color:#f92672">&lt;transactionManager</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;JDBC&#34;</span> <span style="color:#f92672">/&gt;</span>
            <span style="color:#75715e">&lt;!--数据库连接池  --&gt;</span>
            <span style="color:#f92672">&lt;dataSource</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;POOLED&#34;</span><span style="color:#f92672">&gt;</span>
                <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;driver&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;com.mysql.jdbc.Driver&#34;</span> <span style="color:#f92672">/&gt;</span>
                <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;url&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;jdbc:mysql://localhost:3306/db2&#34;</span> <span style="color:#f92672">/&gt;</span>
                <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;username&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;root&#34;</span> <span style="color:#f92672">/&gt;</span>
                <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;password&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;123456&#34;</span> <span style="color:#f92672">/&gt;</span>
            <span style="color:#f92672">&lt;/dataSource&gt;</span>
        <span style="color:#f92672">&lt;/environment&gt;</span>
    <span style="color:#f92672">&lt;/environments&gt;</span>
<span style="color:#f92672">&lt;/configuration&gt;</span>
</code></pre></div><h5 id="第四步在mainjava下创建数据访问层接口-cominuodaobookdaojava">第四步：在main/java下创建数据访问层接口 com/iNuo/dao/BookDao.java</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.dao<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">BookDao</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">findBookCount</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="第五步在resources下创建sql映射文件-cominuodaobookdaoxml与上同名">第五步：在resources下创建sql映射文件 com/iNuo/dao/BookDao.xml（与上同名）</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
<span style="color:#75715e">&lt;!DOCTYPE mapper PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34; &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;</span>

<span style="color:#f92672">&lt;mapper</span> <span style="color:#a6e22e">namespace=</span><span style="color:#e6db74">&#34;com.iNuo.dao.BookDao&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;findBookCount&#34;</span>   <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;int&#34;</span><span style="color:#f92672">&gt;</span>
	    select count(*) from user
    <span style="color:#f92672">&lt;/select&gt;</span>
<span style="color:#f92672">&lt;/mapper&gt;</span>
</code></pre></div><p>namespace ：命名空间，用于隔离sql语句！</p>
<h5 id="第六步加载映射文件">第六步：加载映射文件</h5>
<p>mybatis框架需要加载映射文件，将BookDao.xml添加在SqlMapConfig.xml，如下</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;mappers&gt;&lt;mapper</span> <span style="color:#a6e22e">resource=</span><span style="color:#e6db74">&#34;com/iNuo/dao/BookDao.xml&#34;</span><span style="color:#f92672">/&gt;&lt;/mappers&gt;</span>
</code></pre></div><h5 id="第七步测试">第七步：测试</h5>
<p>在test/java下创建com/iNuo/test/MybatisTest.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.test<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> <span style="color:#960050;background-color:#1e0010">。。。</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MybatisTest</span> <span style="color:#f92672">{</span>
    
    <span style="color:#a6e22e">@Test</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>
        <span style="color:#75715e">//1.加载Mybatis的核心配置文件
</span><span style="color:#75715e"></span>        String resource <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mybatis-config.xml&#34;</span><span style="color:#f92672">;</span>
        InputStream inputStream <span style="color:#f92672">=</span> Resources<span style="color:#f92672">.</span><span style="color:#a6e22e">getResourceAsStream</span><span style="color:#f92672">(</span>resource<span style="color:#f92672">);</span>
        <span style="color:#75715e">//2.创建会话工厂
</span><span style="color:#75715e"></span>        SqlSessionFactory factory <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SqlSessionFactoryBuilder<span style="color:#f92672">().</span><span style="color:#a6e22e">build</span><span style="color:#f92672">(</span>inputStream<span style="color:#f92672">);</span>
        <span style="color:#75715e">//3.创建会话
</span><span style="color:#75715e"></span>        SqlSession session <span style="color:#f92672">=</span> factory<span style="color:#f92672">.</span><span style="color:#a6e22e">openSession</span><span style="color:#f92672">();</span>
        <span style="color:#75715e">//4.创建实现了BookDao接口的类的对象
</span><span style="color:#75715e"></span>        BookDao bookDao<span style="color:#f92672">=</span>session<span style="color:#f92672">.</span><span style="color:#a6e22e">getMapper</span><span style="color:#f92672">(</span>BookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
        <span style="color:#75715e">//5.执行方法
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">int</span> count <span style="color:#f92672">=</span> bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findBookCount</span><span style="color:#f92672">();</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>count<span style="color:#f92672">);</span>
        <span style="color:#75715e">//6.关闭会话
</span><span style="color:#75715e"></span>        inputStream<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
        session<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>优化：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.test<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> .<span style="color:#960050;background-color:#1e0010">。。</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MybatisTest</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">private</span> InputStream inputStream<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> SqlSession session<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> BookDao bookDao<span style="color:#f92672">;</span>
    
    <span style="color:#a6e22e">@Before</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">init</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>
        <span style="color:#75715e">//1.加载Mybatis的核心配置文件
</span><span style="color:#75715e"></span>        String resource <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mybatis-config.xml&#34;</span><span style="color:#f92672">;</span>
        inputStream <span style="color:#f92672">=</span> Resources<span style="color:#f92672">.</span><span style="color:#a6e22e">getResourceAsStream</span><span style="color:#f92672">(</span>resource<span style="color:#f92672">);</span>
        <span style="color:#75715e">//2.创建会话工厂
</span><span style="color:#75715e"></span>        SqlSessionFactory factory <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SqlSessionFactoryBuilder<span style="color:#f92672">().</span><span style="color:#a6e22e">build</span><span style="color:#f92672">(</span>inputStream<span style="color:#f92672">);</span>
        <span style="color:#75715e">//3.创建会话
</span><span style="color:#75715e"></span>        session <span style="color:#f92672">=</span> factory<span style="color:#f92672">.</span><span style="color:#a6e22e">openSession</span><span style="color:#f92672">();</span>
        <span style="color:#75715e">//4.创建实现了BookDao接口的类的对象
</span><span style="color:#75715e"></span>        bookDao<span style="color:#f92672">=</span>session<span style="color:#f92672">.</span><span style="color:#a6e22e">getMapper</span><span style="color:#f92672">(</span>BookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    <span style="color:#a6e22e">@Test</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>
        
        <span style="color:#75715e">//5.执行方法
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">int</span> count <span style="color:#f92672">=</span> bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findBookCount</span><span style="color:#f92672">();</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>count<span style="color:#f92672">);</span>
        
    <span style="color:#f92672">}</span>
    
    <span style="color:#a6e22e">@After</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">destroy</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>
        <span style="color:#75715e">//6.关闭资源
</span><span style="color:#75715e"></span>        inputStream<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
        session<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><hr>
<h3 id="第二章">第二章</h3>
<hr>
<h5 id="本章内容-1">本章内容</h5>
<ul>
<li>mybatis实现CRUD</li>
</ul>
<hr>
<h4 id="mybatis实习增删改查">Mybatis实习增删改查</h4>
<p>注意事项：</p>
<ol>
<li>持久层接口和持久层接口的映射配置必须在相同的包下</li>
<li>持久层映射配置中mapper标签的namespace属性取值必须是持久层接口的全限定类名</li>
<li>sql语句的配置标签<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->的id属性必须和持久层接口的方法名相同</li>
</ol>
<h5 id="根据id查询图书">根据id查询图书</h5>
<p>在main/java下新建实体类com/iNuo/pojo/Book.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.pojo<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Book</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> Integer bid<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String bname<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> Integer price<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String author<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> Date pdate<span style="color:#f92672">;</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">toString</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Book{&#34;</span> <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;bid=&#34;</span> <span style="color:#f92672">+</span> bid <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;, bname=&#39;&#34;</span> <span style="color:#f92672">+</span> bname <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;\&#39;&#39;</span> <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;, price=&#34;</span> <span style="color:#f92672">+</span> price <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;, author=&#39;&#34;</span> <span style="color:#f92672">+</span> author <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;\&#39;&#39;</span> <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;, pdate=&#34;</span> <span style="color:#f92672">+</span> pdate <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#39;}&#39;</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> Integer <span style="color:#a6e22e">getBid</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> bid<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setBid</span><span style="color:#f92672">(</span>Integer bid<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">bid</span> <span style="color:#f92672">=</span> bid<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">//其余略。。。
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</code></pre></div><p>在main/java/com/iNuo/dao/BookDao中，添加方法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.dao<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">BookDao</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">findBookCount</span><span style="color:#f92672">();</span>
    Book <span style="color:#a6e22e">findBookById</span><span style="color:#f92672">(</span>Integer id<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>在resources/com/iNuo/dao/BookDao.xml中，添加sql语句</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
<span style="color:#75715e">&lt;!DOCTYPE mapper PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34; &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;</span>

<span style="color:#f92672">&lt;mapper</span> <span style="color:#a6e22e">namespace=</span><span style="color:#e6db74">&#34;com.iNuo.dao.BookDao&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;findBookCount&#34;</span>   <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;int&#34;</span><span style="color:#f92672">&gt;</span>
	    select count(*) from book
    <span style="color:#f92672">&lt;/select&gt;</span>

    <span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;findBookCount&#34;</span>  <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;Integer&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;com.iNuo.pojo.Book&#34;</span><span style="color:#f92672">&gt;</span>
	    select * from book where bid=#{id}
    <span style="color:#f92672">&lt;/select&gt;</span>
<span style="color:#f92672">&lt;/mapper&gt;</span>
</code></pre></div><ul>
<li>
<p>resultType 属性：用于指定结果集的类型。</p>
</li>
<li>
<p>parameterType 属性：用于指定传入参数的类型。</p>
</li>
<li>
<p>sql 语句中使用#{} 字符 ：</p>
<p>它代表占位符，相当于原来 jdbc 部分所学的，都是用于执行语句时替换实际的数据。具体的数据是由#{}里面的内容决定的。</p>
<p>#{} 中内容的写法：#{}可以接收简单类型值或pojo属性值。 如果parameterType传输单个简单类型值，#{}括号中可以是value或其它名称。</p>
</li>
</ul>
<p>在test/java/com/iNuo/test/MybatisTest.java中，添加测试方法testDo1</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.test<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> ...

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MybatisTest</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">private</span> InputStream inputStream<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> SqlSession session<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> BookDao bookDao<span style="color:#f92672">;</span>

    <span style="color:#a6e22e">@Before</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">init</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>
        <span style="color:#75715e">//1.加载Mybatis的核心配置文件
</span><span style="color:#75715e"></span>        String resource <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mybatis-config.xml&#34;</span><span style="color:#f92672">;</span>
        inputStream <span style="color:#f92672">=</span> Resources<span style="color:#f92672">.</span><span style="color:#a6e22e">getResourceAsStream</span><span style="color:#f92672">(</span>resource<span style="color:#f92672">);</span>
        <span style="color:#75715e">//2.创建会话工厂
</span><span style="color:#75715e"></span>        SqlSessionFactory factory <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SqlSessionFactoryBuilder<span style="color:#f92672">().</span><span style="color:#a6e22e">build</span><span style="color:#f92672">(</span>inputStream<span style="color:#f92672">);</span>
        <span style="color:#75715e">//3.创建会话
</span><span style="color:#75715e"></span>        session <span style="color:#f92672">=</span> factory<span style="color:#f92672">.</span><span style="color:#a6e22e">openSession</span><span style="color:#f92672">();</span>
        <span style="color:#75715e">//4.创建实现了BookDao接口的类的对象
</span><span style="color:#75715e"></span>        bookDao<span style="color:#f92672">=</span>session<span style="color:#f92672">.</span><span style="color:#a6e22e">getMapper</span><span style="color:#f92672">(</span>BookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    <span style="color:#a6e22e">@Test</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>

        <span style="color:#75715e">//5.执行方法
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">int</span> count <span style="color:#f92672">=</span> bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findBookCount</span><span style="color:#f92672">();</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>count<span style="color:#f92672">);</span>

    <span style="color:#f92672">}</span>
    <span style="color:#a6e22e">@Test</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo1</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>

        <span style="color:#75715e">//5.执行方法
</span><span style="color:#75715e"></span>        Book book<span style="color:#f92672">=</span>bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findBookById</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>book<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">());</span>

    <span style="color:#f92672">}</span>
    <span style="color:#a6e22e">@After</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">destroy</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>
        <span style="color:#75715e">//6.关闭资源
</span><span style="color:#75715e"></span>        inputStream<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
        session<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="添加图书">添加图书</h5>
<p>在main/java/com/iNuo/dao/BookDao中，添加方法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.dao<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">BookDao</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">findBookCount</span><span style="color:#f92672">();</span>
    Book <span style="color:#a6e22e">findBookById</span><span style="color:#f92672">(</span>Integer id<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">saveBook</span><span style="color:#f92672">(</span>Book book<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>在resources/com/iNuo/dao/BookDao.xml中，添加sql语句</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
<span style="color:#75715e">&lt;!DOCTYPE mapper PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34; &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;</span>

<span style="color:#f92672">&lt;mapper</span> <span style="color:#a6e22e">namespace=</span><span style="color:#e6db74">&#34;com.iNuo.dao.BookDao&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;findBookCount&#34;</span>   <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;int&#34;</span><span style="color:#f92672">&gt;</span>
	    select count(*) from book
    <span style="color:#f92672">&lt;/select&gt;</span>

    <span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;findBookCount&#34;</span>  <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;Integer&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;com.iNuo.pojo.Book&#34;</span><span style="color:#f92672">&gt;</span>
	    select * from book where bid=#{id}
    <span style="color:#f92672">&lt;/select&gt;</span>
    
    <span style="color:#f92672">&lt;insert</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;saveBook&#34;</span> <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;com.iNuo.pojo.Book&#34;</span><span style="color:#f92672">&gt;</span>
        insert into book(bname,price,author,pdate) values (#{bname},#{price},#{author},#{pdate})
    <span style="color:#f92672">&lt;/insert&gt;</span>
<span style="color:#f92672">&lt;/mapper&gt;</span>
</code></pre></div><p>在test/java/com/iNuo/test/MybatisTest.java中，添加测试方法testDo2</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo2</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>

    <span style="color:#75715e">//5.创建book对象并赋值
</span><span style="color:#75715e"></span>    Book book <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Book<span style="color:#f92672">();</span>
    book<span style="color:#f92672">.</span><span style="color:#a6e22e">setBname</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;红楼梦&#34;</span><span style="color:#f92672">);</span>
    book<span style="color:#f92672">.</span><span style="color:#a6e22e">setPrice</span><span style="color:#f92672">(</span>34<span style="color:#f92672">);</span>
    book<span style="color:#f92672">.</span><span style="color:#a6e22e">setAuthor</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;曹雪芹&#34;</span><span style="color:#f92672">);</span>
    book<span style="color:#f92672">.</span><span style="color:#a6e22e">setPdate</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> SimpleDateFormat<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;yyyy-MM-dd&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">parse</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;1788-03-21&#34;</span><span style="color:#f92672">));</span>
    <span style="color:#75715e">//6.执行方法
</span><span style="color:#75715e"></span>    bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">saveBook</span><span style="color:#f92672">(</span>book<span style="color:#f92672">);</span>
    <span style="color:#75715e">//7.提交事务
</span><span style="color:#75715e"></span>    session<span style="color:#f92672">.</span><span style="color:#a6e22e">commit</span><span style="color:#f92672">();</span>
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;添加成功！&#34;</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="添加图书获取自增列bid">添加图书获取自增列bid</h5>
<p>新增用户后，同时还要返回当前新增用户的id值，因为id是由数据库的自动增长来实现的，所以就相当于我们要在新增后将自动增长auto_increment的值返回。</p>
<p>在main/java/com/iNuo/dao/BookDao中，添加方法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.dao<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">BookDao</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">findBookCount</span><span style="color:#f92672">();</span>
    Book <span style="color:#a6e22e">findBookById</span><span style="color:#f92672">(</span>Integer id<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">saveBook</span><span style="color:#f92672">(</span>Book book<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">saveBookGetId</span><span style="color:#f92672">(</span>Book book<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>在resources/com/iNuo/dao/BookDao.xml中，添加sql语句</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;insert</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;saveBookGetId&#34;</span> <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;com.iNuo.pojo.Book&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;selectKey</span> <span style="color:#a6e22e">keyColumn=</span><span style="color:#e6db74">&#34;bid&#34;</span> <span style="color:#a6e22e">keyProperty=</span><span style="color:#e6db74">&#34;bid&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;int&#34;</span><span style="color:#f92672">&gt;</span>
            select LAST_INSERT_ID()
        <span style="color:#f92672">&lt;/selectKey&gt;</span>
        insert into book(bname,price,author,pdate) values (#{bname},#{price},#{author},#{pdate})
<span style="color:#f92672">&lt;/insert&gt;</span>
</code></pre></div><p>添加selectKey实现将主键返回</p>
<ul>
<li>
<p>keyProperty:返回的主键存储在pojo中的哪个属性</p>
</li>
<li>
<p>order：selectKey的执行顺序，是相对与insert语句来说，由于mysql的自增原理执行完insert语句之后才将主键生成，所以这里selectKey的执行顺序为after</p>
</li>
<li>
<p>resultType:返回的主键是什么类型</p>
</li>
<li>
<p>LAST_INSERT_ID():是mysql的函数，返回auto_increment自增列新记录id值</p>
</li>
</ul>
<p>在test/java/com/iNuo/test/MybatisTest.java中，添加测试方法testDo3</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo3</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>

    <span style="color:#75715e">//5.创建book对象并赋值
</span><span style="color:#75715e"></span>    Book book <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Book<span style="color:#f92672">();</span>
    book<span style="color:#f92672">.</span><span style="color:#a6e22e">setBname</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;红楼梦&#34;</span><span style="color:#f92672">);</span>
    book<span style="color:#f92672">.</span><span style="color:#a6e22e">setPrice</span><span style="color:#f92672">(</span>34<span style="color:#f92672">);</span>
    book<span style="color:#f92672">.</span><span style="color:#a6e22e">setAuthor</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;曹雪芹&#34;</span><span style="color:#f92672">);</span>
    book<span style="color:#f92672">.</span><span style="color:#a6e22e">setPdate</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> SimpleDateFormat<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;yyyy-MM-dd&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">parse</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;1788-03-21&#34;</span><span style="color:#f92672">));</span>
    <span style="color:#75715e">//6.执行方法
</span><span style="color:#75715e"></span>    bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">saveBookGetId</span><span style="color:#f92672">(</span>book<span style="color:#f92672">);</span>
    <span style="color:#75715e">//7.提交事务
</span><span style="color:#75715e"></span>    session<span style="color:#f92672">.</span><span style="color:#a6e22e">commit</span><span style="color:#f92672">();</span>
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;添加成功！&#34;</span><span style="color:#f92672">);</span>
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>book<span style="color:#f92672">.</span><span style="color:#a6e22e">getBid</span><span style="color:#f92672">());</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="修改图书">修改图书</h5>
<p>在main/java/com/iNuo/dao/BookDao中，添加方法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">updateBook</span><span style="color:#f92672">(</span>Book book<span style="color:#f92672">);</span>
</code></pre></div><p>在resources/com/iNuo/dao/BookDao.xml中，添加sql语句</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;update</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;updateBook&#34;</span> <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;com.iNuo.pojo.Book&#34;</span><span style="color:#f92672">&gt;</span>
        update book set bname=#{bname},price=#{price},author=#{author},pdate=#{pdate} where bid=#{bid}
<span style="color:#f92672">&lt;/update&gt;</span>
</code></pre></div><p>在test/java/com/iNuo/test/MybatisTest.java中，添加测试方法testDo4</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"> <span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo4</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>

    <span style="color:#75715e">//5.通过id查找book对象并修改值
</span><span style="color:#75715e"></span>    Book book <span style="color:#f92672">=</span> bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findBookById</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
    book<span style="color:#f92672">.</span><span style="color:#a6e22e">setBname</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;红楼梦&#34;</span><span style="color:#f92672">);</span>
    book<span style="color:#f92672">.</span><span style="color:#a6e22e">setPrice</span><span style="color:#f92672">(</span>34<span style="color:#f92672">);</span>
    book<span style="color:#f92672">.</span><span style="color:#a6e22e">setAuthor</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;曹雪芹&#34;</span><span style="color:#f92672">);</span>
    book<span style="color:#f92672">.</span><span style="color:#a6e22e">setPdate</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> SimpleDateFormat<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;yyyy-MM-dd&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">parse</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;1788-03-21&#34;</span><span style="color:#f92672">));</span>
    <span style="color:#75715e">//6.执行方法
</span><span style="color:#75715e"></span>    bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">updateBook</span><span style="color:#f92672">(</span>book<span style="color:#f92672">);</span>
    <span style="color:#75715e">//7.提交事务
</span><span style="color:#75715e"></span>    session<span style="color:#f92672">.</span><span style="color:#a6e22e">commit</span><span style="color:#f92672">();</span>
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;修改成功！&#34;</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="删除图书">删除图书</h5>
<p>在main/java/com/iNuo/dao/BookDao中，添加方法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">deleteBook</span><span style="color:#f92672">(</span>Integer id<span style="color:#f92672">);</span>
</code></pre></div><p>在resources/com/iNuo/dao/BookDao.xml中，添加sql语句</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;delete</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;deleteBook&#34;</span> <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;Integer&#34;</span><span style="color:#f92672">&gt;</span>
        delete from book where bin=#{bid}
<span style="color:#f92672">&lt;/delete&gt;</span>
</code></pre></div><p>在test/java/com/iNuo/test/MybatisTest.java中，添加测试方法testDo5</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"> <span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo5</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>
    <span style="color:#75715e">//5.执行方法
</span><span style="color:#75715e"></span>    bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">deleteBook</span><span style="color:#f92672">(</span>14<span style="color:#f92672">);</span>
    <span style="color:#75715e">//6.提交事务
</span><span style="color:#75715e"></span>    session<span style="color:#f92672">.</span><span style="color:#a6e22e">commit</span><span style="color:#f92672">();</span>
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;删除成功！&#34;</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="图书模糊查询">图书模糊查询</h5>
<p>在main/java/com/iNuo/dao/BookDao中，添加方法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">List<span style="color:#f92672">&lt;</span>Book<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">findBookByName</span><span style="color:#f92672">(</span>String name<span style="color:#f92672">);</span>
</code></pre></div><p>在resources/com/iNuo/dao/BookDao.xml中，添加sql语句</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;findBookByName&#34;</span> <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;String&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;com.iNuo.pojo.Book&#34;</span><span style="color:#f92672">&gt;</span>
        select * from book where bname like #{bname}
<span style="color:#f92672">&lt;/select&gt;</span>
</code></pre></div><p>在test/java/com/iNuo/test/MybatisTest.java中，添加测试方法testDo6</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo6</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>

    <span style="color:#75715e">//5.执行方法
</span><span style="color:#75715e"></span>    List<span style="color:#f92672">&lt;</span>Book<span style="color:#f92672">&gt;</span> list<span style="color:#f92672">=</span>bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findBookByName</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;%童%&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span>Book book<span style="color:#f92672">:</span>list<span style="color:#f92672">){</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>book<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="图书模糊查询2">图书模糊查询2</h5>
<p>在main/java/com/iNuo/dao/BookDao中，添加方法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">List<span style="color:#f92672">&lt;</span>Book<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">findBookByName2</span><span style="color:#f92672">(</span>String name<span style="color:#f92672">);</span>
</code></pre></div><p>在resources/com/iNuo/dao/BookDao.xml中，添加sql语句</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;findBookByName2&#34;</span> <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;String&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;com.iNuo.pojo.Book&#34;</span><span style="color:#f92672">&gt;</span>
        select * from book where bname like &#39;%${value}%&#39;
<span style="color:#f92672">&lt;/select&gt;</span>
</code></pre></div><p>在test/java/com/iNuo/test/MybatisTest.java中，添加测试方法testDo7</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"> <span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo7</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>

    <span style="color:#75715e">//5.执行方法
</span><span style="color:#75715e"></span>    List<span style="color:#f92672">&lt;</span>Book<span style="color:#f92672">&gt;</span> list<span style="color:#f92672">=</span>bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findBookByName2</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;童&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span>Book book<span style="color:#f92672">:</span>list<span style="color:#f92672">){</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>book<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="heading"></h5>
<p>#{}：表示一个占位符号，通过#{}可以实现preparedStatement向占位符中设置值，自动进行java类型和jdbc类型转换，#{}可以有效防止sql注入。 #{}可以接收简单类型值或pojo属性值。 如果parameterType传输单个简单类型值，#{}括号中可以是value或其它名称。</p>
<p>${}：表示拼接sql串，通过${}可以将parameterType 传入的内容拼接在sql中且不进行jdbc类型转换， ${}可以接收简单类型值或pojo属性值，如果parameterType传输单个简单类型值，${}括号中只能是value</p>
<h5 id="mybatis-与-jdbc-编程的比较">Mybatis 与 JDBC 编程的比较</h5>
<ol>
<li>
<p>数据库连接、创建、释放频繁造成系统资源浪费从而影响系统性能，如果使用数据库连接池可解决此问题！</p>
<p>解决：在sqlMapConfig.xml中配置数据连接池，使用连接池管理数据库连接。</p>
</li>
<li>
<p>sql语句写在代码中造成代码不易维护，实际应用sql变化的可能较大，sql变动需要改变java代码！</p>
<p>解决：将sql语句配置在XXXmapper.xml文件中与java代码分离。</p>
</li>
<li>
<p>向sql语句传参数麻烦，因为sql语句的where条件不一定，可能多也可能少，占位符需要和参数对应！</p>
<p>解决：Mybatis自动将java对象映射至sql语句，通过statement中的parameterType定义输入参数的类型。</p>
</li>
<li>
<p>对结果集解析麻烦，sql变化导致解析代码变化，且解析前需要遍历，如果能将数据库记录封装成pojo对象解析比较方便。</p>
<p>解决：Mybatis自动将sql执行结果映射至java对象，通过statement中的resultType定义输出结果的类型。</p>
</li>
</ol>
<hr>
<h3 id="第三章">第三章</h3>
<hr>
<h5 id="本章内容-2">本章内容：</h5>
<ul>
<li>parameterType 配置参数</li>
<li>Mybatis的输出结果封装</li>
<li>SqlMapConfig.xml 配置文件</li>
</ul>
<hr>
<h4 id="31-parametertype-配置参数">3.1 parameterType 配置参数</h4>
<p>SQL 语句传参，是通过标签的 parameterType 属性来设定。该属性的取值可以是基本类型，引用类型（例:String 类型），还可以是实体类类型（POJO 类）同时也可以使用实体类的包装类，本章节将介绍如何使用实体类的包装类作为参数传递。</p>
<ul>
<li>
<p>基本类型和 String：可以直接写类型名称，也可以使用包名 . 类名的方式；例 ：java.lang.String。</p>
</li>
<li>
<p>实体类类型：目前只能使用全限定类名。</p>
</li>
</ul>
<p>究其原因，是 mybaits 在加载时已经把常用的数据类型注册了别名，从而我们在使用时可以不写包名，而我们的是实体类并没有注册别名，所以必须写全限定类名。在后面将讲解如何注册实体类的别名。</p>
<h5 id="pojo包装类作为参数">pojo包装类作为参数：</h5>
<p>开发中通过 pojo 传递查询条件 ，查询条件是综合的查询条件，不仅包括图书查询条件还包括其它的查询条件（比如将图书类型也作为查询条件），这时可以使用包装对象传递输入参数。</p>
<p>需求：根据图书名查询图书信息，查询条件放到 QueryVo 的 book 属性中</p>
<p>在main/java/com/iNuo/pojo下编写 QueryVo</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.pojo<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">QueryVo</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> Book book<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">public</span> Book <span style="color:#a6e22e">getBook</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> book<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setBook</span><span style="color:#f92672">(</span>Book book<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">book</span> <span style="color:#f92672">=</span> book<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>在持久层接口BookDao中添加方法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">List<span style="color:#f92672">&lt;</span>Book<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">findBookByName02</span><span style="color:#f92672">(</span>QueryVo vo<span style="color:#f92672">);</span>
</code></pre></div><p>在持久层映射文件中配置;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!-- 根据图书类型名和价格模糊查询，参数变成一个 QueryVo 对象了 --&gt;</span>
<span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;findBookByName02&#34;</span> <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;com.iNuo.pojo.QueryVo&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;com.iNuo.pojo.Book&#34;</span><span style="color:#f92672">&gt;</span>
    select * from book where bname like #{book.bname}
<span style="color:#f92672">&lt;/select&gt;</span>
</code></pre></div><p>测试：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo8</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>

    <span style="color:#75715e">//5.创建包装类对象并赋值
</span><span style="color:#75715e"></span>    QueryVo vo<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> QueryVo<span style="color:#f92672">();</span>
    Book book<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> Book<span style="color:#f92672">();</span>
    book<span style="color:#f92672">.</span><span style="color:#a6e22e">setBname</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;%童%&#34;</span><span style="color:#f92672">);</span>
    vo<span style="color:#f92672">.</span><span style="color:#a6e22e">setBook</span><span style="color:#f92672">(</span>book<span style="color:#f92672">);</span>
    <span style="color:#75715e">//6.执行方法
</span><span style="color:#75715e"></span>    List<span style="color:#f92672">&lt;</span>Book<span style="color:#f92672">&gt;</span> list<span style="color:#f92672">=</span>bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findBookByName02</span><span style="color:#f92672">(</span>vo<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span>Book book1<span style="color:#f92672">:</span>list<span style="color:#f92672">){</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>book1<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="32-mybatis的输出结果封装">3.2 Mybatis的输出结果封装</h4>
<h5 id="resulttype-配置结果类型">resultType 配置结果类型</h5>
<p>resultType 属性可以指定结果集的类型，它支持基本类型和实体类类型。</p>
<p>在前面的 CRUD 案例中已经对此属性进行过应用了。需要注意的是，它和 parameterType 一样，如果注册过类型别名的，可以直接使用别名。没有注册过的必须使用全限定类名。例如：我们的实体类此时必须是全限定类名</p>
<p>注：当resultType是实体类名称时，实体类中的属性名称必须和查询语句中的列名保持一致，否则无法实现封装。</p>
<p>考虑：前面学习过通过图书名查询图书，返回的是一个pojo类型，当实体类中的属性名和数据表中的字段名不一样时应该如何做呢？</p>
<p>修改实体类BookInfo</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.pojo<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BookInfo</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> Integer bookid<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String bookname<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> Integer bookprice<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String bookauthor<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> Date bookpdate<span style="color:#f92672">;</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">toString</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;BookInfo{&#34;</span> <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;bookid=&#34;</span> <span style="color:#f92672">+</span> bookid <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;, bookname=&#39;&#34;</span> <span style="color:#f92672">+</span> bookname <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;\&#39;&#39;</span> <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;, bookprice=&#34;</span> <span style="color:#f92672">+</span> bookprice <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;, bookauthor=&#39;&#34;</span> <span style="color:#f92672">+</span> bookauthor <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;\&#39;&#39;</span> <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;, bookpdate=&#34;</span> <span style="color:#f92672">+</span> bookpdate <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#39;}&#39;</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    
    <span style="color:#66d9ef">public</span> Integer <span style="color:#a6e22e">getBookid</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> bookid<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setBookid</span><span style="color:#f92672">(</span>Integer bookid<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">bookid</span> <span style="color:#f92672">=</span> bookid<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">//其余略。。。
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</code></pre></div><p>BookDao中添加方法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">List<span style="color:#f92672">&lt;</span>BookInfo<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">findBookByName03</span><span style="color:#f92672">(</span>String name<span style="color:#f92672">);</span>
</code></pre></div><p>修改映射配置：使用别名查询</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!-- 配置查询所有操作 --&gt;</span>
<span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;findBookByName03&#34;</span> <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;String&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;com.iNuo.pojo.BookInfo&#34;</span><span style="color:#f92672">&gt;</span>
    select bid as bookid,bname as bookname,price as bookprice,author as bookauthor,pdate as bookpdate from book where bname like #{bname}
<span style="color:#f92672">&lt;/select&gt;</span>
</code></pre></div><p>测试：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"> <span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo9</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>

    <span style="color:#75715e">//5.执行方法
</span><span style="color:#75715e"></span>    List<span style="color:#f92672">&lt;</span>BookInfo<span style="color:#f92672">&gt;</span> list<span style="color:#f92672">=</span>bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findBookByName03</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;%童%&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span>BookInfo bookInfo<span style="color:#f92672">:</span>list<span style="color:#f92672">){</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>bookInfo<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>思考：如果我们的查询字段很多，都使用别名的话写起来岂不是很麻烦，有没有别的解决办法呢？</p>
<p>破解：可以使用resultMap！</p>
<h5 id="resultmap结果类型">resultMap结果类型</h5>
<p>resultMap 标签可以建立查询的列名和实体类的属性名称不一致时建立对应关系。从而实现封装。</p>
<p>在 select 标签中使用 resultMap 属性指定引用即可。同时 resultMap 可以实现将查询结果映射为复杂类型的 pojo，比如在查询结果映射对象中包括 pojo 和 list 实现一对一查询和一对多查询。</p>
<p>再来实现根据书名查询图书：</p>
<p>在BookDao中添加方法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">List<span style="color:#f92672">&lt;</span>BookInfo<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">findBookByName04</span><span style="color:#f92672">(</span>String name<span style="color:#f92672">);</span>
</code></pre></div><p>定义 resultMap</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!-- 建立 BookInfo 实体和数据库表的对应关系
</span><span style="color:#75715e">    id 属性：给定一个唯一标识，是给查询 select 标签引用的。
</span><span style="color:#75715e">    type 属性：指定实体类的全限定类名	
</span><span style="color:#75715e">--&gt;</span>
<span style="color:#f92672">&lt;resultMap</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;bookMap&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;com.iNuo.pojo.BookInfo&#34;</span><span style="color:#f92672">&gt;</span>
<span style="color:#75715e">&lt;!--
</span><span style="color:#75715e">    id 标签：用于指定主键字段
</span><span style="color:#75715e">    result 标签：用于指定非主键字段
</span><span style="color:#75715e">    column 属性：用于指定数据库列名
</span><span style="color:#75715e">    property 属性：用于指定实体类属性名称
</span><span style="color:#75715e">--&gt;</span>
   <span style="color:#f92672">&lt;id</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;bid&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;bookid&#34;</span><span style="color:#f92672">&gt;&lt;/id&gt;</span>
   <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;bname&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;bookname&#34;</span><span style="color:#f92672">&gt;&lt;/result&gt;</span>
   <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;price&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;bookprice&#34;</span><span style="color:#f92672">&gt;&lt;/result&gt;</span>
   <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;author&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;bookauthor&#34;</span><span style="color:#f92672">&gt;&lt;/result&gt;</span>
   <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;pdate&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;bookpdate&#34;</span><span style="color:#f92672">&gt;&lt;/result&gt;</span>
 <span style="color:#f92672">&lt;/resultMap&gt;</span>
</code></pre></div><p>映射配置</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!-- 配置查询所有操作 --&gt;</span>
<span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;findBookByName04&#34;</span> <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;String&#34;</span> <span style="color:#a6e22e">resultMap=</span><span style="color:#e6db74">&#34;bookMap&#34;</span><span style="color:#f92672">&gt;</span>
   select * from book where bname like #{bname}
<span style="color:#f92672">&lt;/select&gt;</span>
</code></pre></div><p>测试：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo10</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>

    <span style="color:#75715e">//5.执行方法
</span><span style="color:#75715e"></span>    List<span style="color:#f92672">&lt;</span>BookInfo<span style="color:#f92672">&gt;</span> list<span style="color:#f92672">=</span>bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findBookByName04</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;%童%&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span>BookInfo bookInfo<span style="color:#f92672">:</span>list<span style="color:#f92672">){</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>bookInfo<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="加入log4j日志">加入log4j日志</h5>
<p>将log4j的配置文件log4j.properties拷贝到resources下</p>
<ul>
<li>
<p>输出详细的项目运行信息</p>
</li>
<li>
<p>发布项目的运行监测（将日志保存在文档中，因为没有控制台！）</p>
</li>
</ul>
<h4 id="33-sqlmapconfigxml-配置文件">3.3 SqlMapConfig.xml 配置文件</h4>
<h5 id="sqlmapconfigxml-中配置的内容和顺序">SqlMapConfig.xml 中配置的内容和顺序</h5>
<ol>
<li>
<p>properties （属性）</p>
<p>​	property</p>
</li>
<li>
<p>settings（全局配置参数）</p>
<p>​	setting</p>
</li>
<li>
<p>typeAliases （类型别名）</p>
<p>​	typeAliase</p>
<p>​	package</p>
</li>
<li>
<p>typeHandlers（类型处理器）</p>
</li>
<li>
<p>objectFactory（对象工厂）</p>
</li>
<li>
<p>plugins（插件）</p>
</li>
<li>
<p>environments（环境集合属性对象）</p>
<p>​	environment（环境子属性对象）</p>
<p>​			transactionManager（事务管理）</p>
<p>​			dataSource（数据源）</p>
</li>
<li>
<p>mappers （映射器）</p>
<p>​	mapper</p>
<p>​	package</p>
</li>
</ol>
<h5 id="properties-属性">properties （属性）</h5>
<p>在使用 properties 标签配置时，我们可以采用两种方式指定属性配置。</p>
<p>第一种</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;properties&gt;</span>
    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;jdbc.driver&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;com.mysql.jdbc.Driver&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;jdbc.url&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;jdbc:mysql://localhost:3306/mybatis&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;jdbc.username&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;root&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;jdbc.password&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;123456&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/properties&gt;</span>
</code></pre></div><p>此时我们的 dataSource 标签就变成了引用上面的配置</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;dataSource</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;POOLED&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;driver&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;${jdbc.driver}&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;url&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;${jdbc.url}&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;username&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;${jdbc.username}&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;password&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;${jdbc.password}&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/dataSource&gt;</span>
</code></pre></div><p>第二种</p>
<p>在 resources 下定义 db.properties 文件</p>
<pre><code class="language-properties" data-lang="properties">jdbc.driver=com.mysql.jdbc.Driver
jdbc.url=jdbc:mysql://localhost:3306/mybatis
jdbc.username=root
jdbc.password=123456
</code></pre><p>在SqlMapConfig.xml中，引入db.properties 文件</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!-- 配置连接数据库的信息
</span><span style="color:#75715e">resource 属性：用于指定 properties 配置文件的位置，要求配置文件必须在类路径下
</span><span style="color:#75715e">resource=&#34;db.properties&#34;
</span><span style="color:#75715e">--&gt;</span>
<span style="color:#f92672">&lt;properties</span> <span style="color:#a6e22e">resource=</span><span style="color:#e6db74">&#34;db.properties&#34;</span><span style="color:#f92672">&gt;&lt;/properties&gt;</span>
</code></pre></div><h5 id="typealiases-类型别名">typeAliases （类型别名）</h5>
<p>Mybatis 支持默认别名，所以也可以采用自定义别名方式来开发。</p>
<p>自定义别名：</p>
<p>在 SqlMapConfig.xml 中配置：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;typeAliases&gt;</span>
    <span style="color:#75715e">&lt;!-- 单个别名定义 --&gt;</span>
    <span style="color:#f92672">&lt;typeAlias</span> <span style="color:#a6e22e">alias=</span><span style="color:#e6db74">&#34;Book&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;com.iNuo.pojo.Book&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#75715e">&lt;!-- 批量别名定义，扫描整个包下的类，别名为类名（首字母大写或小写都可以） --&gt;</span>
    <span style="color:#f92672">&lt;package</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;com.iNuo.pojo&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/typeAliases&gt;</span>
</code></pre></div><h5 id="mappers-映射器">mappers （映射器）</h5>
<p>将sql语句某个文件映射到核心配置文件中</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;mapper</span> <span style="color:#a6e22e">resource=</span><span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">/&gt;</span>
</code></pre></div><p>使用相对于类路径的资源</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;mapper</span> <span style="color:#a6e22e">resource=</span><span style="color:#e6db74">&#34;com/iNuo/dao/BookDao.xml&#34;</span> <span style="color:#f92672">/&gt;</span>
</code></pre></div><p>将sql语句某些文件映射到核心配置文件中</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;package</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">/&gt;</span>
</code></pre></div><p>注册指定包下的所有 mapper 接口</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;package</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;com.iNuo.dao&#34;</span><span style="color:#f92672">/&gt;</span>
</code></pre></div><p>注意：此种方法要求 marpper 接口名称和 mapper 映射文件名称相同，且放在同一个目录中.</p>
<hr>
<h3 id="第四章">第四章</h3>
<hr>
<h5 id="本章内容-3">本章内容</h5>
<ul>
<li>动态Sql</li>
<li>多表查询</li>
</ul>
<hr>
<h4 id="41-动态sql">4.1 动态Sql</h4>
<p>Mybatis 的映射文件中，有些业务逻辑较为复杂， SQL 是动态变化的，此时一般的 SQL 就不能满足要求了。</p>
<h5 id="动态-sql-之-if-标签">动态 SQL 之 &lt;if&gt; 标签</h5>
<p>根据实体类的不同取值，使用不同的 SQL 语句来进行查询。比如在 bname 不为空时可以根据bname 查询，如果price 不为空时还要加入图书价格作为条件。这种情况就属于多条件组合查询。</p>
<p>持久层 Dao接口</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">List<span style="color:#f92672">&lt;</span>Book<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">findBookByQuery</span><span style="color:#f92672">(</span>Book book<span style="color:#f92672">);</span>
</code></pre></div><p>持久层 Dao 映射配置</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;findBookByQuery&#34;</span> <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;Book&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;Book&#34;</span><span style="color:#f92672">&gt;</span>
   select * from book where 1=1
   <span style="color:#f92672">&lt;if</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;bname!=null and bname !=&#39;&#39;&#34;</span><span style="color:#f92672">&gt;</span>
     and bname like #{bname}
   <span style="color:#f92672">&lt;/if&gt;</span>
   <span style="color:#f92672">&lt;if</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;price!=null and price!=&#39;&#39;&#34;</span><span style="color:#f92672">&gt;</span>
     and price &gt; #{price}
   <span style="color:#f92672">&lt;/if&gt;</span>
<span style="color:#f92672">&lt;/select&gt;</span>
</code></pre></div><p>注意：&lt;if&gt;标签的 test 属性中写的是对象的属性名，如果是包装类的对象要使用 OGNL 表达式的写法。</p>
<p>另外要注意 where 1=1 的作用，保留where关键字，不论if结果如何都能确保sql语句成立！</p>
<p>测试：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo11</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>
    <span style="color:#75715e">//创建book对象
</span><span style="color:#75715e"></span>    Book book<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> Book<span style="color:#f92672">();</span>
    book<span style="color:#f92672">.</span><span style="color:#a6e22e">setBname</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;%童%&#34;</span><span style="color:#f92672">);</span>
    book<span style="color:#f92672">.</span><span style="color:#a6e22e">setPrice</span><span style="color:#f92672">(</span>30<span style="color:#f92672">);</span>
    <span style="color:#75715e">//5.执行方法
</span><span style="color:#75715e"></span>    List<span style="color:#f92672">&lt;</span>Book<span style="color:#f92672">&gt;</span> list<span style="color:#f92672">=</span>bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findBookByQuery</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;%童%&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span>Book Book1<span style="color:#f92672">:</span>list<span style="color:#f92672">){</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>Book1<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="动态-sql-之-where-标签">动态 SQL 之 &lt;where&gt; 标签</h5>
<p>为了简化上面 where 1=1 的条件拼装，我们可以采用&lt;where&gt;标签来简化开发</p>
<p>持久层 Dao 映射配置</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!-- 根据图书信息查询 --&gt;</span>
<span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;findBookByQuery&#34;</span> <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;Book&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;Book&#34;</span><span style="color:#f92672">&gt;</span>
   select * from book
   <span style="color:#f92672">&lt;where&gt;</span>
       <span style="color:#f92672">&lt;if</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;bname!=null and bname !=&#39;&#39;&#34;</span><span style="color:#f92672">&gt;</span>
         and bname like #{bname}
       <span style="color:#f92672">&lt;/if&gt;</span>
       <span style="color:#f92672">&lt;if</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;price!=null and price!=&#39;&#39;&#34;</span><span style="color:#f92672">&gt;</span>
         and price &gt; #{price}
       <span style="color:#f92672">&lt;/if&gt;</span>
   <span style="color:#f92672">&lt;/where&gt;</span>
 <span style="color:#f92672">&lt;/select&gt;</span>
</code></pre></div><h5 id="动态-sql-之foreach-标签">动态 SQL 之&lt;foreach&gt; 标签</h5>
<p>传入多个 id 查询图书信息，用下边sql 实现：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> BOOK <span style="color:#66d9ef">WHERE</span> bid <span style="color:#66d9ef">IN</span> (<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">89</span>,<span style="color:#ae81ff">16</span>)
</code></pre></div><p>这样在进行范围查询时，就要将一个集合中的值，作为参数动态添加进来。如何进行参数的传递呢？</p>
<p>在实体类中添加一个 QV 类，类中加入一个 List 集合用于封装参数</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.pojo<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">QV</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> List<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;</span> bids<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">public</span> List<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getBids</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> bids<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setBids</span><span style="color:#f92672">(</span>List<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;</span> bids<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">bids</span> <span style="color:#f92672">=</span> bids<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>持久层 Dao 接口</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">List<span style="color:#f92672">&lt;</span>Book<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">findBookByQV</span><span style="color:#f92672">(</span>QV qv<span style="color:#f92672">);</span>
</code></pre></div><p>持久层 Dao 映射 配置</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;findBookByQV&#34;</span> <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;QV&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;Book&#34;</span><span style="color:#f92672">&gt;</span>
   select * from book
   <span style="color:#f92672">&lt;where&gt;</span>
       <span style="color:#f92672">&lt;if</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;bids!=null and bids.size()&gt;0&#34;</span><span style="color:#f92672">&gt;</span>
         <span style="color:#f92672">&lt;foreach</span> <span style="color:#a6e22e">collection=</span><span style="color:#e6db74">&#34;bids&#34;</span> <span style="color:#a6e22e">open=</span><span style="color:#e6db74">&#34;bid in(&#34;</span> <span style="color:#a6e22e">close=</span><span style="color:#e6db74">&#34;)&#34;</span> <span style="color:#a6e22e">separator=</span><span style="color:#e6db74">&#34;,&#34;</span> <span style="color:#a6e22e">item=</span><span style="color:#e6db74">&#34;bid&#34;</span><span style="color:#f92672">&gt;</span>
         #{bid}
         <span style="color:#f92672">&lt;/foreach&gt;</span>
       <span style="color:#f92672">&lt;/if&gt;</span>
   <span style="color:#f92672">&lt;/where&gt;</span>
<span style="color:#f92672">&lt;/select&gt;</span>
</code></pre></div><p>SQL 语句：select 字段 from Book where bid in (?)</p>
<p>&lt;foreach&gt;标签用于遍历集合，它的属性：</p>
<ul>
<li>
<p>collection：代表要遍历的集合元素，注意编写时不要写#{}</p>
</li>
<li>
<p>open：代表语句的开始部分</p>
</li>
<li>
<p>close：代表结束部分</p>
</li>
<li>
<p>item：代表遍历集合的每个元素，生成的变量名</p>
</li>
<li>
<p>sperator：代表分隔符</p>
</li>
</ul>
<p>测试:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"> <span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo12</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>
    <span style="color:#75715e">//创建qv对象
</span><span style="color:#75715e"></span>    QV qv <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> QV<span style="color:#f92672">();</span>
    List<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;</span> list <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;();</span>
    list<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
    list<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>2<span style="color:#f92672">);</span>
    list<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>13<span style="color:#f92672">);</span>
    qv<span style="color:#f92672">.</span><span style="color:#a6e22e">setBids</span><span style="color:#f92672">(</span>list<span style="color:#f92672">);</span>
    <span style="color:#75715e">//5.执行方法
</span><span style="color:#75715e"></span>    List<span style="color:#f92672">&lt;</span>Book<span style="color:#f92672">&gt;</span> list<span style="color:#f92672">=</span>bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findBookByQV</span><span style="color:#f92672">(</span>qv<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span>Book Book<span style="color:#f92672">:</span>list<span style="color:#f92672">){</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>Book<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>Mybatis 中简化编写的 SQL 片段</p>
<p>Sql 中可将重复的 sql 提取出来，使用时用 include 引用即可，最终达到 sql 重用的目的</p>
<p>定义代码片段:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!-- 抽取重复的语句代码片段 --&gt;</span>
<span style="color:#f92672">&lt;sql</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;defaultSql&#34;</span><span style="color:#f92672">&gt;</span>
	select * from user
<span style="color:#f92672">&lt;/sql&gt;</span>
</code></pre></div><p>引用代码片段</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!-- 配置查询所有操作 --&gt;</span>
<span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;findAll&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;user&#34;</span><span style="color:#f92672">&gt;</span>
	<span style="color:#f92672">&lt;include</span> <span style="color:#a6e22e">refid=</span><span style="color:#e6db74">&#34;defaultSql&#34;</span><span style="color:#f92672">&gt;&lt;/include&gt;</span>
<span style="color:#f92672">&lt;/select&gt;</span>

<span style="color:#75715e">&lt;!-- 根据 id 查询 --&gt;</span>
<span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;findById&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;User&#34;</span> <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;int&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;include</span> <span style="color:#a6e22e">refid=</span><span style="color:#e6db74">&#34;defaultSql&#34;</span><span style="color:#f92672">&gt;&lt;/include&gt;</span>
    where id = #{uid}
<span style="color:#f92672">&lt;/select&gt;</span> 
</code></pre></div><h4 id="42-多表查询">4.2 多表查询</h4>
<p>本次案例主要以最为简单的图书和类型来分析Mybatis多表关系。</p>
<p>图书为Book 表，类型为Category表。一个类型（Category）可以有多本图书（Book）。具体关系如下：</p>
<p>book表：</p>
<p><img src="/img/image-20210206165350308.png" alt="image-20210206165350308"></p>
<p>category表：</p>
<p><img src="/img/image-20210206165419971.png" alt="image-20210206165419971"></p>
<h5 id="一对一查询-多对一">一对一查询( 多对一)</h5>
<p>需求：查询所有图书信息，关联查询图书类型信息。</p>
<p>注意：因为一本图书对应一个类型，所以从查询图书信息出发关联查询类型信息为一对一查询。如果从类型信息出发查询类型下的图书信息则为一对多查询，因为一个类型可以有多本图书！</p>
<p>方式一</p>
<p>定义图书类型信息的 实体类</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.pojo<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Category</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> Integer cid<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String cname<span style="color:#f92672">;</span>

    <span style="color:#75715e">//get set 略
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>

</code></pre></div><p>要执行的sql语句</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> book.<span style="color:#f92672">*</span>,category.cname <span style="color:#66d9ef">from</span> book,category <span style="color:#66d9ef">where</span> book.cid <span style="color:#f92672">=</span> category.cid
</code></pre></div><p>定义 BookCategory类</p>
<p>为了能够封装上面 SQL 语句的查询结果，定义 BookCategory 类中要包含图书信息同时还要包含图书类型信息，所以我们在定义 BookCategory 类时可以继承 Book 类。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.pojo<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BookCategory</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> Integer cid<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String cname<span style="color:#f92672">;</span>

    <span style="color:#75715e">//get set 略
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</code></pre></div><p>定义BookDao接口</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.dao<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">BookDao</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">public</span> List<span style="color:#f92672">&lt;</span>BookCategory<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">findAlBook</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>定义BookDao.xml</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
<span style="color:#75715e">&lt;!DOCTYPE mapper PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34; &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;</span>

<span style="color:#f92672">&lt;mapper</span> <span style="color:#a6e22e">namespace=</span><span style="color:#e6db74">&#34;com.iNuo.dao.BookDao&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;findAlBook&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;BookCategory&#34;</span><span style="color:#f92672">&gt;</span>
        select bname,cname from book,category where book.cid = category.cid
   <span style="color:#f92672">&lt;/select&gt;</span>
<span style="color:#f92672">&lt;/mapper&gt;</span>
</code></pre></div><p>测试：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.test<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> <span style="color:#960050;background-color:#1e0010">。。。</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MybatisTest</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">private</span> InputStream inputStream<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> SqlSession session<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> BookDao bookDao<span style="color:#f92672">;</span>

    <span style="color:#a6e22e">@Before</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">init</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>
        <span style="color:#75715e">//1.加载Mybatis的核心配置文件
</span><span style="color:#75715e"></span>        String resource <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mybatis-config.xml&#34;</span><span style="color:#f92672">;</span>
        inputStream <span style="color:#f92672">=</span> Resources<span style="color:#f92672">.</span><span style="color:#a6e22e">getResourceAsStream</span><span style="color:#f92672">(</span>resource<span style="color:#f92672">);</span>
        <span style="color:#75715e">//2.创建会话工厂
</span><span style="color:#75715e"></span>        SqlSessionFactory factory <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SqlSessionFactoryBuilder<span style="color:#f92672">().</span><span style="color:#a6e22e">build</span><span style="color:#f92672">(</span>inputStream<span style="color:#f92672">);</span>
        <span style="color:#75715e">//3.创建会话
</span><span style="color:#75715e"></span>        session <span style="color:#f92672">=</span> factory<span style="color:#f92672">.</span><span style="color:#a6e22e">openSession</span><span style="color:#f92672">();</span>
        <span style="color:#75715e">//4.创建实现了BookDao接口的类的对象
</span><span style="color:#75715e"></span>        bookDao<span style="color:#f92672">=</span>session<span style="color:#f92672">.</span><span style="color:#a6e22e">getMapper</span><span style="color:#f92672">(</span>BookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    <span style="color:#a6e22e">@Test</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>

        <span style="color:#75715e">//5.执行方法
</span><span style="color:#75715e"></span>        List<span style="color:#f92672">&lt;</span>BookCategory<span style="color:#f92672">&gt;</span> lists <span style="color:#f92672">=</span> bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findAllBook</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span>BookCategory list<span style="color:#f92672">:</span>lists<span style="color:#f92672">){</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;图书名：&#34;</span><span style="color:#f92672">+</span>list<span style="color:#f92672">.</span><span style="color:#a6e22e">getBname</span><span style="color:#f92672">()+</span><span style="color:#e6db74">&#34;图书类型：&#34;</span><span style="color:#f92672">+</span>list<span style="color:#f92672">.</span><span style="color:#a6e22e">getCname</span><span style="color:#f92672">());</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
    <span style="color:#a6e22e">@After</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">destroy</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>
        <span style="color:#75715e">//6.关闭资源
</span><span style="color:#75715e"></span>        inputStream<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
        session<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>小结：</p>
<p>定义专门的 pojo 类作为输出类型，其中定义了 sql 查询结果集所有的字段。此方法较为简单，企业中使用普遍。</p>
<p>方式二：</p>
<p>使用 resultMap，定义专门的 resultMap 用于映射一对一查询结果。</p>
<p>通过面向对象的(has a)关系可以得知，我们可以在 Book 类中加入一个 Category 类的对象来代表这个书是哪个类型的。</p>
<p>修改 Book，在 Book 类中加入 Category 类的对象作为 Book 类的一个属性</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.pojo<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Book</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> Integer bid<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String bname<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> Integer price<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String author<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> Date pdate<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> Category category<span style="color:#f92672">;</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">toString</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Book{&#34;</span> <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;bid=&#34;</span> <span style="color:#f92672">+</span> bid <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;, bname=&#39;&#34;</span> <span style="color:#f92672">+</span> bname <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;\&#39;&#39;</span> <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;, price=&#34;</span> <span style="color:#f92672">+</span> price <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;, author=&#39;&#34;</span> <span style="color:#f92672">+</span> author <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;\&#39;&#39;</span> <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;, pdate=&#34;</span> <span style="color:#f92672">+</span> pdate <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#39;}&#39;</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> Category <span style="color:#a6e22e">getCategory</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> category<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setCategory</span><span style="color:#f92672">(</span>Category category<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">category</span> <span style="color:#f92672">=</span> category<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    <span style="color:#75715e">//其余getset略
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</code></pre></div><p>添加 BookDao 接口中的方法</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">List<span style="color:#f92672">&lt;</span>Book<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">findAll</span><span style="color:#f92672">();</span>
</code></pre></div><p>注意：第二种方式，将返回值改为了 Book 类型。因为 Book 类中包含了一个 Category 类的对象，它可以封装图书所对应的类型信息。</p>
<p>重新定义 BookDao.xml 文件</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;resultMap</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;bookResult&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;Book&#34;</span><span style="color:#f92672">&gt;</span>     
    <span style="color:#f92672">&lt;id</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;bid&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;bid&#34;</span><span style="color:#f92672">&gt;&lt;/id&gt;</span>     
    <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;bname&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;bname&#34;</span><span style="color:#f92672">&gt;&lt;/result&gt;</span>     
    <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;author&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;author&#34;</span><span style="color:#f92672">&gt;&lt;/result&gt;</span>     
    <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;price&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;price&#34;</span><span style="color:#f92672">&gt;&lt;/result&gt;</span>     
    <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;pdate&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;pdate&#34;</span><span style="color:#f92672">&gt;&lt;/result&gt;</span>     
    <span style="color:#f92672">&lt;association</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;category&#34;</span> <span style="color:#a6e22e">javaType=</span><span style="color:#e6db74">&#34;Category&#34;</span><span style="color:#f92672">&gt;</span>         
        <span style="color:#f92672">&lt;id</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;cid&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;cid&#34;</span><span style="color:#f92672">&gt;&lt;/id&gt;</span>         
        <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;cname&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;cname&#34;</span><span style="color:#f92672">&gt;&lt;/result&gt;</span>     
    <span style="color:#f92672">&lt;/association&gt;</span> 
<span style="color:#f92672">&lt;/resultMap&gt;</span>   

<span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;findAll&#34;</span> <span style="color:#a6e22e">resultMap=</span><span style="color:#e6db74">&#34;bookResult&#34;</span><span style="color:#f92672">&gt;</span>     
    select bname,cname from book,category where book.cid = category.cid
<span style="color:#f92672">&lt;/select&gt;</span>
</code></pre></div><p>测试：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo1</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>

    <span style="color:#75715e">//5.执行方法
</span><span style="color:#75715e"></span>    List<span style="color:#f92672">&lt;</span>Book<span style="color:#f92672">&gt;</span> lists <span style="color:#f92672">=</span> bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findAll</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span>Book list<span style="color:#f92672">:</span>lists<span style="color:#f92672">){</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;图书名：&#34;</span><span style="color:#f92672">+</span>list<span style="color:#f92672">.</span><span style="color:#a6e22e">getBname</span><span style="color:#f92672">()+</span><span style="color:#e6db74">&#34;图书类型：&#34;</span><span style="color:#f92672">+</span>list<span style="color:#f92672">.</span><span style="color:#a6e22e">getCategory</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getCname</span><span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="一对多查询">一对多查询</h5>
<p>需求：查询所有图书类型名及类型对应的图书名。</p>
<p>分析：类型信息和图书信息为一对多关系，并且查询过程中如果类型没有图书，此时也要将类型信息查询出来，我们想到了左外连接查询比较合适。</p>
<p>编写 SQL 语句</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> bname,cname <span style="color:#66d9ef">FROM</span> category <span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> book <span style="color:#66d9ef">ON</span> book.cid <span style="color:#f92672">=</span> category.cid
</code></pre></div><p>Category 类入 加入 List&lt;Book&gt;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.pojo<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Category</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> Integer cid<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String cname<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> List<span style="color:#f92672">&lt;</span>Book<span style="color:#f92672">&gt;</span> books<span style="color:#f92672">;</span>
	<span style="color:#75715e">//getset略
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</code></pre></div><p>持久层 Dao 接口 中加入查询方法</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.dao<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">CategoryDao</span> <span style="color:#f92672">{</span>
    List<span style="color:#f92672">&lt;</span>Category<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">findAllCategory</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>用户持久层 Dao 映射文件 配置</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span> 
<span style="color:#75715e">&lt;!DOCTYPE mapper PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34; &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;</span> 
<span style="color:#f92672">&lt;mapper</span> <span style="color:#a6e22e">namespace=</span><span style="color:#e6db74">&#34;com.iNuo.dao.CategoryDao&#34;</span><span style="color:#f92672">&gt;</span>     
    <span style="color:#f92672">&lt;resultMap</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;categoryMap&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;Category&#34;</span><span style="color:#f92672">&gt;</span>         
        <span style="color:#f92672">&lt;id</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;cid&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;cid&#34;</span><span style="color:#f92672">&gt;&lt;/id&gt;</span>         
        <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;cname&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;cname&#34;</span><span style="color:#f92672">&gt;&lt;/result&gt;</span>         
        <span style="color:#f92672">&lt;collection</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;books&#34;</span> <span style="color:#a6e22e">ofType=</span><span style="color:#e6db74">&#34;Book&#34;</span><span style="color:#f92672">&gt;</span>             
            <span style="color:#f92672">&lt;id</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;bid&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;bid&#34;</span><span style="color:#f92672">&gt;&lt;/id&gt;</span>             
            <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;bname&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;bname&#34;</span><span style="color:#f92672">&gt;&lt;/result&gt;</span>             
            <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;author&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;author&#34;</span><span style="color:#f92672">&gt;&lt;/result&gt;</span>             
            <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;price&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;price&#34;</span><span style="color:#f92672">&gt;&lt;/result&gt;</span>             
            <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;pdate&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;pdate&#34;</span><span style="color:#f92672">&gt;&lt;/result&gt;</span>         
        <span style="color:#f92672">&lt;/collection&gt;</span>     
    <span style="color:#f92672">&lt;/resultMap&gt;</span>     
    <span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;findAllCategory&#34;</span> <span style="color:#a6e22e">resultMap=</span><span style="color:#e6db74">&#34;categoryMap&#34;</span> <span style="color:#f92672">&gt;</span>         
        SELECT bname,cname FROM category LEFT JOIN book ON book.cid = category.cid     <span style="color:#f92672">&lt;/select&gt;</span> 
<span style="color:#f92672">&lt;/mapper&gt;</span>
</code></pre></div><ul>
<li>
<p>collection：部分定义了类型关联的图书信息。表示关联查询结果集</p>
</li>
<li>
<p>property=&quot;books&rdquo; ：关联查询的结果集存储在 Category 对象的上哪个属性。</p>
</li>
<li>
<p>ofType=&quot;Book&rdquo; ：指定关联查询的结果集中的对象类型即List中的对象类型。此处可以使用别名，也可以使用全限定名。</p>
</li>
</ul>
<p>测试:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo2</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>

    <span style="color:#75715e">//5.执行方法
</span><span style="color:#75715e"></span>    List<span style="color:#f92672">&lt;</span>Category<span style="color:#f92672">&gt;</span> list <span style="color:#f92672">=</span> CategoryDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findAllCategory</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span>Category category<span style="color:#f92672">:</span>list<span style="color:#f92672">){</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;图书类型：&#34;</span><span style="color:#f92672">+</span>category<span style="color:#f92672">.</span><span style="color:#a6e22e">getCname</span><span style="color:#f92672">());</span>
        List<span style="color:#f92672">&lt;</span>Book<span style="color:#f92672">&gt;</span> lstBook<span style="color:#f92672">=</span>category<span style="color:#f92672">.</span><span style="color:#a6e22e">getBooks</span><span style="color:#f92672">();</span> <span style="color:#75715e">//获取该类型下的图书
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span>Book book<span style="color:#f92672">:</span>lstBook<span style="color:#f92672">){</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;图书名：&#34;</span><span style="color:#f92672">+</span>book<span style="color:#f92672">.</span><span style="color:#a6e22e">getBname</span><span style="color:#f92672">());</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="多表查询之-多对多">多表查询之 多对多</h5>
<p>实现 Book 到 Orders 多对多！多对多关系可以看成是双向的一对多关系。</p>
<p>在 MySQL 数据库中添加订单表，图书订单的中间表如下：</p>
<p>订单表orders：</p>
<p><img src="/img/image-20210206170250316.png" alt="image-20210206170250316"></p>
<p>图书订单中间表book_order：</p>
<p><img src="/img/image-20210206170258608.png" alt="image-20210206170258608"></p>
<p>需求：实现查询所有订单和订单中的图书信息。</p>
<p>分析：查询订单我们需要用到orders表，但订单包含的图书信息我们并不能直接找到，而是要通过中间表(book_order 表)才能关联到图书信息。</p>
<p>下面是实现的 SQL 语句：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> book.bname,orders.<span style="color:#f92672">`</span>createDate<span style="color:#f92672">`</span> <span style="color:#66d9ef">FROM</span> book,orders,book_order <span style="color:#66d9ef">WHERE</span> book.bid <span style="color:#f92672">=</span> book_order.bid <span style="color:#66d9ef">AND</span> orders.<span style="color:#f92672">`</span>oid<span style="color:#f92672">`</span> <span style="color:#f92672">=</span> book_order.<span style="color:#f92672">`</span>oid<span style="color:#f92672">`</span>
</code></pre></div><p>编写订单实体类，并添加books属性</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.pojo<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> java.util.Date<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Orders</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> Integer oid<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> Date createDate<span style="color:#f92672">;</span>
	<span style="color:#66d9ef">private</span> List<span style="color:#f92672">&lt;</span>Book<span style="color:#f92672">&gt;</span> books<span style="color:#f92672">;</span>
    <span style="color:#75715e">//getset略
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>

</code></pre></div><p>同时给图书实体类添加orders属性</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.pojo<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Book</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> Integer bid<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String bname<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> Integer price<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String author<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> Date pdate<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> Category category<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> List<span style="color:#f92672">&lt;</span>Orders<span style="color:#f92672">&gt;</span> orders<span style="color:#f92672">;</span>
    
    <span style="color:#75715e">//getset略
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</code></pre></div><p>编写 持久层 接口</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.dao<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">OrdersDao</span> <span style="color:#f92672">{</span>
        List<span style="color:#f92672">&lt;</span>Orders<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">findOrders</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>编写映射文件</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
<span style="color:#75715e">&lt;!DOCTYPE mapper PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34; &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;</span>
<span style="color:#f92672">&lt;mapper</span> <span style="color:#a6e22e">namespace=</span><span style="color:#e6db74">&#34;com.iNuo.dao.OrdersDao&#34;</span><span style="color:#f92672">&gt;</span>    
    <span style="color:#f92672">&lt;resultMap</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;ordersMap&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;orders&#34;</span><span style="color:#f92672">&gt;</span>        
        <span style="color:#f92672">&lt;id</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;oid&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;oid&#34;</span><span style="color:#f92672">&gt;&lt;/id&gt;</span>        
        <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;createDate&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;createDate&#34;</span><span style="color:#f92672">&gt;&lt;/result&gt;</span>
        <span style="color:#f92672">&lt;collection</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;books&#34;</span> <span style="color:#a6e22e">ofType=</span><span style="color:#e6db74">&#34;book&#34;</span><span style="color:#f92672">&gt;</span>            
            <span style="color:#f92672">&lt;id</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;bid&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;bid&#34;</span><span style="color:#f92672">&gt;&lt;/id&gt;</span>            
            <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;bname&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;bname&#34;</span><span style="color:#f92672">&gt;&lt;/result&gt;</span>            
            <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;author&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;author&#34;</span><span style="color:#f92672">&gt;&lt;/result&gt;</span>            
            <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;price&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;price&#34;</span><span style="color:#f92672">&gt;&lt;/result&gt;</span>            
            <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;pdate&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;pdate&#34;</span><span style="color:#f92672">&gt;&lt;/result&gt;</span>        
        <span style="color:#f92672">&lt;/collection&gt;</span>    
    <span style="color:#f92672">&lt;/resultMap&gt;</span>    
    <span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;findOrders&#34;</span> <span style="color:#a6e22e">resultMap=</span><span style="color:#e6db74">&#34;ordersMap&#34;</span> <span style="color:#f92672">&gt;</span>        
        SELECT bname,createDate FROM book,orders,book_order WHERE book.bid = book_order.bid AND orders.`oid` = book_order.`oid`    
    <span style="color:#f92672">&lt;/select&gt;</span>
<span style="color:#f92672">&lt;/mapper&gt;</span>
</code></pre></div><p>编写测试类</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo3</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>

    <span style="color:#75715e">//5.执行方法
</span><span style="color:#75715e"></span>    List<span style="color:#f92672">&lt;</span>Orders<span style="color:#f92672">&gt;</span> list <span style="color:#f92672">=</span> OrdersDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findAllOrders</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span>Orders orders<span style="color:#f92672">:</span>list<span style="color:#f92672">){</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;下单时间：&#34;</span><span style="color:#f92672">+</span>orders<span style="color:#f92672">.</span><span style="color:#a6e22e">getCreateDate</span><span style="color:#f92672">());</span>
        List<span style="color:#f92672">&lt;</span>Book<span style="color:#f92672">&gt;</span> lstBook<span style="color:#f92672">=</span>orders<span style="color:#f92672">.</span><span style="color:#a6e22e">getBooks</span><span style="color:#f92672">();</span> <span style="color:#75715e">//获取该订单下的图书
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span>Book book<span style="color:#f92672">:</span>lstBook<span style="color:#f92672">){</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;图书名：&#34;</span><span style="color:#f92672">+</span>book<span style="color:#f92672">.</span><span style="color:#a6e22e">getBname</span><span style="color:#f92672">());</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><hr>
<h3 id="第五章">第五章</h3>
<hr>
<h5 id="本章内容-4">本章内容</h5>
<ul>
<li>延迟加载</li>
<li>缓存</li>
</ul>
<hr>
<h4 id="51-延迟加载">5.1 延迟加载</h4>
<p>通过前面的学习，我们已经掌握了 Mybatis 中一对一，一对多，多对多关系的配置及实现，可以实现对象的关联查询。实际开发过程中很多时候我们并不需要总是在加载图书类型时就一定要加载该类型下的图书。这就是我们所说的延迟加载。</p>
<h5 id="何为延迟加载">何为延迟加载?</h5>
<p>延迟加载：在需要用到数据时才进行加载，不需要用到数据时就不加载数据，延迟加载也称懒加载</p>
<p>需求：现在要显示图书类型名，点击按钮时再显示类型下的所有图书。</p>
<p>一次性的把图书类型和图书查询出来，Sql语句如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> book.<span style="color:#f92672">*</span>,cname <span style="color:#66d9ef">FROM</span> book,category <span style="color:#66d9ef">WHERE</span> book.cid <span style="color:#f92672">=</span> category.cid
</code></pre></div><p>这样做可以完成功能，但是我们只是需要显示图书类型，点击的时候才显示类型的图书，如果能做到开始只查询类型，点击按钮的时候再查询该类型的图书，就不需要进行两表联查了，可以提高查询的效率，也比较节省内存，这就是延迟加载。</p>
<h5 id="延迟加载如何实现">延迟加载如何实现？</h5>
<ol>
<li>在类型实体类里面添加一个属性存放该类型下的图书</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Category</span> <span style="color:#f92672">{</span>
   <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> cid<span style="color:#f92672">;</span>
   <span style="color:#66d9ef">private</span> String cname<span style="color:#f92672">;</span>
   <span style="color:#66d9ef">private</span> List<span style="color:#f92672">&lt;</span>Book<span style="color:#f92672">&gt;</span> books<span style="color:#f92672">;</span>
	<span style="color:#75715e">//省略get set
</span><span style="color:#75715e"></span> <span style="color:#f92672">}</span>
</code></pre></div><ol start="2">
<li>创建数据访问层接口CategoryDao:</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.dao<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">CategoryDao</span> <span style="color:#f92672">{</span>
    List<span style="color:#f92672">&lt;</span>Category<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">findAllCategory</span><span style="color:#f92672">();</span>
    Book <span style="color:#a6e22e">findBookByCid</span><span style="color:#f92672">(</span>Integer cid<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><ol start="3">
<li>映射文件CategoryDao.xml</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span> 
<span style="color:#75715e">&lt;!DOCTYPE mapper PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34; &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;</span> 
<span style="color:#f92672">&lt;mapper</span> <span style="color:#a6e22e">namespace=</span><span style="color:#e6db74">&#34;com.iNuo.dao.CategoryDao&#34;</span><span style="color:#f92672">&gt;</span>     
    <span style="color:#f92672">&lt;resultMap</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;categoryMap&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;Category&#34;</span><span style="color:#f92672">&gt;</span>         
        <span style="color:#f92672">&lt;id</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;cid&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;cid&#34;</span><span style="color:#f92672">&gt;&lt;/id&gt;</span>         
        <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;cname&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;cname&#34;</span><span style="color:#f92672">&gt;&lt;/result&gt;</span>         
        <span style="color:#f92672">&lt;collection</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;books&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;cid&#34;</span> <span style="color:#a6e22e">select=</span><span style="color:#e6db74">&#34;findBookByCid&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;/collection&gt;</span>     
    <span style="color:#f92672">&lt;/resultMap&gt;</span>     
    <span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;findAllCategory&#34;</span> <span style="color:#a6e22e">resultMap=</span><span style="color:#e6db74">&#34;categoryMap&#34;</span><span style="color:#f92672">&gt;</span>         
        select * from category     
    <span style="color:#f92672">&lt;/select&gt;</span>      
    <span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34; findBookByCid &#34;</span> <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;Integer&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;Book&#34;</span><span style="color:#f92672">&gt;</span>
        select * from book where cid = #{cid}     
    <span style="color:#f92672">&lt;/select&gt;</span> 
<span style="color:#f92672">&lt;/mapper&gt;</span>
</code></pre></div><p>只有我们点击类型的时候才需要查询该类型下的图书，所以这里我们没有用两表联查，而是将类型表的查询语句和图书表的查询语句分开。</p>
<p>重点来看下这个配置：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;collection</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;books&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;cid&#34;</span> <span style="color:#a6e22e">select=</span><span style="color:#e6db74">&#34; findBookByCid&#34;</span><span style="color:#f92672">&gt;</span>
<span style="color:#f92672">&lt;/collection&gt;</span>
</code></pre></div><p>collection，association是支持延迟加载的！</p>
<ul>
<li>select属性表示要执行的sql语句</li>
<li>column表示执行sql语句要传的参数，该参数为select ***** from category查询出来的字段cid</li>
<li>property=”books”表示查询出来的结果给到books属性。</li>
</ul>
<ol start="4">
<li>在mybatis的核心配置文件中配置</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;settings&gt;</span>
   <span style="color:#f92672">&lt;setting</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;lazyLoadingEnabled&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">/&gt;</span>
   <span style="color:#f92672">&lt;setting</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;aggressiveLazyLoading&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;false&#34;</span><span style="color:#f92672">&gt;&lt;/setting&gt;</span>
 <span style="color:#f92672">&lt;/settings&gt;</span>
</code></pre></div><p>注意：这个配置必须写在properties配置的后面，typeAliases的前面。</p>
<ul>
<li>
<p>将lazyLoadingEnabled设置为true表示开启延迟加载，默认为false.</p>
</li>
<li>
<p>将aggressiveLazyLoading设置为false表示按需加载，默认为true</p>
</li>
</ul>
<p>关于这两个设置后面再详加探讨</p>
<ol start="5">
<li>测试：</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo4</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>

    <span style="color:#75715e">//查询所有的图书类型
</span><span style="color:#75715e"></span>    List<span style="color:#f92672">&lt;</span>Category<span style="color:#f92672">&gt;</span> listCategory <span style="color:#f92672">=</span> CategoryDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findAllCategory</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span>Category category<span style="color:#f92672">:</span>listCategory<span style="color:#f92672">){</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>category<span style="color:#f92672">.</span><span style="color:#a6e22e">getCname</span><span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>执行看看日志：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">DEBUG <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> <span style="color:#f92672">-</span> <span style="color:#f92672">==&gt;</span> Preparing<span style="color:#f92672">:</span> select <span style="color:#f92672">*</span> from category 
DEBUG <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> <span style="color:#f92672">-</span> <span style="color:#f92672">==&gt;</span> Parameters<span style="color:#f92672">:</span> 
DEBUG <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> <span style="color:#f92672">-</span> <span style="color:#f92672">&lt;==</span>   Total<span style="color:#f92672">:</span> 4
武侠
童话
爱情
悬疑
</code></pre></div><p>这段代码只涉及到了图书类型，并未涉及到图书部分，所以只执行了select * from category从类型表中查询出类型信息。</p>
<p>再来测试这段代码：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo4</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>

    <span style="color:#75715e">//查询所有的图书类型
</span><span style="color:#75715e"></span>    List<span style="color:#f92672">&lt;</span>Category<span style="color:#f92672">&gt;</span> listCategory <span style="color:#f92672">=</span> CategoryDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findAllCategory</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span>Category category<span style="color:#f92672">:</span>listCategory<span style="color:#f92672">){</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>category<span style="color:#f92672">.</span><span style="color:#a6e22e">getCname</span><span style="color:#f92672">());</span>

        <span style="color:#75715e">//获取类型下的图书
</span><span style="color:#75715e"></span>        List<span style="color:#f92672">&lt;</span>Book<span style="color:#f92672">&gt;</span> list<span style="color:#f92672">=</span>category<span style="color:#f92672">.</span><span style="color:#a6e22e">getBooks</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span>Book book<span style="color:#f92672">:</span>list<span style="color:#f92672">){</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>book<span style="color:#f92672">.</span><span style="color:#a6e22e">getBname</span><span style="color:#f92672">());</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>执行看看日志：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">DEBUG <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> <span style="color:#f92672">-</span> <span style="color:#f92672">==&gt;</span> Preparing<span style="color:#f92672">:</span> select <span style="color:#f92672">*</span> from category 
DEBUG <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> <span style="color:#f92672">-</span> <span style="color:#f92672">==&gt;</span> Parameters<span style="color:#f92672">:</span> 
DEBUG <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> <span style="color:#f92672">-</span> <span style="color:#f92672">&lt;==</span>   Total<span style="color:#f92672">:</span> 4
武侠
DEBUG <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> <span style="color:#f92672">-</span> <span style="color:#f92672">==&gt;</span> Preparing<span style="color:#f92672">:</span> select <span style="color:#f92672">*</span> from book where cid <span style="color:#f92672">=</span> <span style="color:#f92672">?</span> 
DEBUG <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> <span style="color:#f92672">-</span> <span style="color:#f92672">==&gt;</span> Parameters<span style="color:#f92672">:</span> 1<span style="color:#f92672">(</span>Integer<span style="color:#f92672">)</span>
DEBUG <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> <span style="color:#f92672">-</span> <span style="color:#f92672">&lt;==</span>   Total<span style="color:#f92672">:</span> 3
神雕侠侣
童话大王
射雕英雄传
</code></pre></div><p>这里执行了两个sql语句：Select * from category 和 Select * from book where cid = ?</p>
<p>对比这两段代码，可以看到， 只有当执行List&lt;Book&gt; lstBook = category.getBooks();这行代码的时候才会去执行sql语句Select * from book where cid = ?。这就是延迟加载里的按需执行sql语句，只有在需要的时候才会去执行。</p>
<p>回顾一下第三个步骤中的配置：</p>
<p>此时lazyLoadingEnabled设置为true, aggressiveLazyLoading设置为false，表示延迟加载开启，按需加载也开启。分析一下在这种配置下代码的每一步都做了什么：</p>
<ol>
<li>
<p>List&lt;Category&gt; list = categoryDao.findCategory();执行到这行代码的时候从数据库中查询图书类型的信息。</p>
</li>
<li>
<p>System.out.println(category.getCname());执行这行代码的时候因为图书类型信息已经被查询出来，所以不需要再和数据库交互。</p>
</li>
<li>
<p>List&lt;Book&gt; lstBook = category.getBooks();执行这行代码的时候从数据库中查询该类型下图书的信息。</p>
</li>
</ol>
<p>如果将lazyLoadingEnabled设置为true, aggressiveLazyLoading设置为true,表示延迟加载开启，按需加载关闭，代码每一步都做了什么呢？</p>
<ol>
<li>
<p>List&lt;Category&gt; list = categoryDao.findCategory();执行到这行代码的时候从数据库中查询图书类型的信息。</p>
</li>
<li>
<p>System.<em>out</em>.println(category.getCname());执行这行代码的时候，需要加载图书类型的属性“类型名”，因为将按需加载关闭，所以此时会把Category的所有属性都加载进来，包括List&lt;Book&gt; books,会去数据库中查询图书的信息。</p>
</li>
<li>
<p>List&lt;Book&gt; lstBook = category.getBooks();执行这行代码的时候因为图书的信息已经被加载进来，不需要查询数据库。</p>
</li>
</ol>
<p>如果将lazyLoadingEnabled设置为false，相当于关闭了延迟加载，此时无论aggressiveLazyLoading是true还是false都会在执行List&lt;Category&gt; list = categoryDao.findCategory();的时候将类型和图书的信息都查询出来。</p>
<p>总结一下：</p>
<p>一：延迟加载就是按需加载，在需要查询的时候再去查询，使用延迟加载可以避免表连接查询，表连接查询比单表查询的效率低，但是它需要多次与数据库进行交互，所以延迟加载并不是银弹，使用需谨慎。</p>
<p>二：关于延迟加载有两个重要的设置：lazyLoadingEnabled表示延迟加载是否开启，如果设置为true表示开启，此时还需要设置aggressiveLazyLoading为false,才能做到按需加载，如果aggressiveLazyLoading设置为true则按需加载关闭，此时只要加载了某个属性就会将所有属性都加载。</p>
<ul>
<li>
<p>lazyLoadingEnabled的默认值为false</p>
</li>
<li>
<p>aggressiveLazyLoading的默认值为true</p>
</li>
</ul>
<h4 id="52-mybatis-缓存">5.2 Mybatis 缓存</h4>
<p>像大多数的持久化框架一样，Mybatis 也提供了缓存策略，通过缓存策略来减少数据库的查询次数，从而提高性能。Mybatis 中缓存分为一级缓存，二级缓存，如下所示：</p>
<p><img src="/img/image-20210206203008654.png" alt="image-20210206203008654"></p>
<h5 id="mybatis-一级缓存">Mybatis 一级缓存</h5>
<p>一级缓存是 SqlSession 级别的缓存，只要 SqlSession 没有 flush 或 close，它就存在。</p>
<p>编写持久层 Dao 接口</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">BookDao</span> <span style="color:#f92672">{</span>
   Book <span style="color:#a6e22e">findBookById</span><span style="color:#f92672">(</span>Integer id<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>编写 持久层 映射文件</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;mapper</span> <span style="color:#a6e22e">namespace=</span><span style="color:#e6db74">&#34;com.iNuo.dao.BookDao&#34;</span> <span style="color:#f92672">&gt;</span>
   <span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;findBookById&#34;</span> <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;Integer&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;book&#34;</span><span style="color:#f92672">&gt;</span>
       select * from book where bid=#{id}
    <span style="color:#f92672">&lt;/select&gt;</span>
<span style="color:#f92672">&lt;/mapper&gt;</span>
</code></pre></div><p>编写测试方法</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo5</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>
    Book book1<span style="color:#f92672">=</span>bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findBookById</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>book1<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">());</span>
    Book book2<span style="color:#f92672">=</span>bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findBookById</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>book2<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">());</span>
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>book1<span style="color:#f92672">==</span>book2<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>测试结果如下：</p>
<pre><code>DEBUG [main] - ==&gt; Preparing: select * from book where bid=? 
DEBUG [main] - ==&gt; Parameters: 1(Integer)
DEBUG [main] - &lt;==   Total: 1
cn.yihao.pojo.Book@14a50707
cn.yihao.pojo.Book@14a50707
true
</code></pre><p>我们可以发现，虽然在上面的代码中我们查询了两次，但最后只执行了一次数据库操作，这就是 Mybatis 提供给我们的一级缓存在起作用了。因为一级缓存的存在，导致第二次查询 id为41的记录时，并没有发出sql语句从数据库中查询数据，而是从一级缓存中查询。</p>
<h5 id="一级缓存的分析">一级缓存的分析</h5>
<p>一级缓存是 SqlSession 范围的缓存，当调用 SqlSession 的修改，添加，删除，commit()，close()等方法时，就会清空一级缓存。</p>
<p><img src="/img/image-20210206204003264.png" alt="image-20210206204003264"></p>
<p>第一次发起查询图书 id 为 1 的图书信息，先去找缓存中是否有 id 为 1 的图书信息，如果没有，从数据库查询用户信息。得到图书信息，将图书信息存储到一级缓存中。</p>
<p>如果 sqlSession 去执行 commit 操作（执行插入、更新、删除），清空 SqlSession 中的一级缓存，这样做的目的为了让缓存中存储的是最新的信息，避免脏读。</p>
<p>第二次发起查询图书 id 为 1 的用户信息，先去找缓存中是否有 id 为 1 的图书信息，缓存中有，直接从缓存中获取用户信息。</p>
<p>测试一级缓存的清空</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">\* 测试一级缓存
</span><span style="color:#75715e">*/</span>

<span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo5</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>
    Book book1<span style="color:#f92672">=</span>bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findBookById</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
    session<span style="color:#f92672">.</span><span style="color:#a6e22e">clearCache</span><span style="color:#f92672">();</span> <span style="color:#75715e">//清空缓存
</span><span style="color:#75715e"></span>    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>book1<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">());</span>
    Book book2<span style="color:#f92672">=</span>bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findBookById</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>book2<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">());</span>
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>book1<span style="color:#f92672">==</span>book2<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>当执行sqlSession.close()后，再次获取sqlSession并查询id=41的User对象时，又重新执行了sql语句，从数据库进行了查询操作。</p>
<h5 id="mybatis-二级缓存了解">Mybatis 二级缓存（了解）</h5>
<p>二级缓存是 mapper 映射级别的缓存，多个 SqlSession 去操作同一个 Mapper 映射的 sql 语句，多个sqlSession 可以共用二级缓存，二级缓存是跨 SqlSession 的。不常用，一般使用第三方缓存Redis</p>
<p>Redis是一个开源的底层使用C语言编写的key-value存储数据库。可用于缓存、事件发布订阅、高速队列等场景。而且支持丰富的数据类型：string(字符串)、hash(哈希)、list(列表)、set(无序集合)、zset(sorted set：有序集合)</p>
<p>Redis在项目中的应用场景</p>
<ul>
<li>
<p>缓存数据：最常用，对经常需要查询且变动不是很频繁的数据 常称作热点数据。</p>
</li>
<li>
<p>消息队列：相当于消息订阅系统，比如ActiveMQ、RocketMQ。如果对数据有较高一致性要求时，还是建议使用MQ)</p>
</li>
<li>
<p>计数器：比如统计点击率、点赞率，redis具有原子性，可以避免并发问题</p>
</li>
<li>
<p>电商网站信息：大型电商平台初始化页面数据的缓存。比如去哪儿网购买机票的时候首页的价格和你点进去的价格会有差异。</p>
</li>
<li>
<p>热点数据：比如新闻网站实时热点、微博热搜等，需要频繁更新。总数据量比较大的时候直接从数据库查询会影响性能</p>
</li>
</ul>
<hr>
<h3 id="第六章">第六章</h3>
<hr>
<h5 id="本章内容-5">本章内容</h5>
<ul>
<li>Mybatis注解开发</li>
</ul>
<hr>
<p>这几年来注解开发越来越流行，Mybatis 也可以使用注解开发方式，这样我们就可以减少编写 Mapper 映射文件了。本次我们先围绕一些基本的 CRUD 来学习，再学习复杂映射关系及延迟加载。</p>
<h5 id="mybatis的常用注解说明">mybatis的常用注解说明</h5>
<p>​	@Insert:实现新增</p>
<p>​	@Update:实现更新</p>
<p>​	@Delete:实现删除</p>
<p>​	@Select:实现查询</p>
<p>​	@Result:实现结果集封装</p>
<p>​	@Results:可以与@Result 一起使用，封装多个结果集</p>
<p>​	@ResultMap:实现引用@Results 定义的封装</p>
<p>​	@One:实现一对一结果集封装</p>
<p>​	@Many:实现一对多结果集封装</p>
<p>​	@SelectProvider: 实现动态 SQL 映射</p>
<h5 id="使用-mybatis-注解实现基本-crud">使用 Mybatis 注解实现基本 CRUD</h5>
<p>单表的 CRUD 操作是最基本的操作，前面我们的学习都是基于 Mybaits 的映射文件来实现的</p>
<p>编写实体类</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.pojo<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Book</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> Integer bid<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String bname<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> Integer price<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String author<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> Date pdate<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> Category category<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> List<span style="color:#f92672">&lt;</span>Orders<span style="color:#f92672">&gt;</span> orders<span style="color:#f92672">;</span>
<span style="color:#960050;background-color:#1e0010">…</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>注意：此处我们故意和数据库表的列名不一致。</p>
<p>用注解方式开发持久层接口</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.dao<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">BookDao</span> <span style="color:#f92672">{</span>

    <span style="color:#a6e22e">@Select</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;select * from book&#34;</span><span style="color:#f92672">)</span>
    List<span style="color:#f92672">&lt;</span>Book<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">findAllBook</span><span style="color:#f92672">();</span>

    <span style="color:#a6e22e">@select</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;select * from book where bid=#{bid}&#34;</span><span style="color:#f92672">)</span>
    Book <span style="color:#a6e22e">findBookById</span><span style="color:#f92672">(</span>Integer bid<span style="color:#f92672">);</span>

    <span style="color:#a6e22e">@Insert</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;insert into book values(null,#{bname},#{price},#{author},#{pdate},#{cid})&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#a6e22e">@SelectKey</span><span style="color:#f92672">(</span>keyProperty<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bid&#34;</span><span style="color:#f92672">,</span>keyColumn<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bid&#34;</span><span style="color:#f92672">,</span>resultType<span style="color:#f92672">=</span>Integer<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span>before<span style="color:#f92672">=</span><span style="color:#66d9ef">false</span><span style="color:#f92672">,</span>statement<span style="color:#f92672">={</span><span style="color:#e6db74">&#34;select last_insert_id()&#34;</span><span style="color:#f92672">})</span>
    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">saveBook</span><span style="color:#f92672">(</span>Book book<span style="color:#f92672">);</span>


    <span style="color:#a6e22e">@Update</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;update book set bname=#{bname},price=#{price},author=#{author},pdate=#{pdate},cid=#{cid} where bid=#{bid}&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">updateBook</span><span style="color:#f92672">(</span>Book book<span style="color:#f92672">);</span>


    <span style="color:#a6e22e">@Delete</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;delete from book where bid=#{bid}&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">deleteBook</span><span style="color:#f92672">(</span>Integer id<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>

</code></pre></div><p>通过注解方式，我们就不需要再去编写 BookDao.xml 映射文件了。</p>
<p>编写 SqlMapConfig 配置文件</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">&lt;?</span>xml version<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1.0&#34;</span> encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span><span style="color:#f92672">?&gt;</span>
<span style="color:#f92672">&lt;!</span>DOCTYPE configuration PUBLIC <span style="color:#e6db74">&#34;-//mybatis.org//DTD Config 3.0//EN&#34;</span> <span style="color:#e6db74">&#34;http://mybatis.org/dtd/mybatis-3-config.dtd&#34;</span><span style="color:#f92672">&gt;</span>
<span style="color:#f92672">&lt;</span>configuration<span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;</span>properties resource<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;db.properties&#34;</span><span style="color:#f92672">&gt;&lt;/</span>properties<span style="color:#f92672">&gt;</span>
    
    <span style="color:#f92672">&lt;</span>environments <span style="color:#66d9ef">default</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;development&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;</span>environment id<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;development&#34;</span><span style="color:#f92672">&gt;</span>
            <span style="color:#f92672">&lt;!--</span>用jdbc做事务控制  <span style="color:#f92672">--&gt;</span>
            <span style="color:#f92672">&lt;</span>transactionManager type<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;JDBC&#34;</span> <span style="color:#f92672">/&gt;</span>
            <span style="color:#f92672">&lt;!--</span>数据库连接池  <span style="color:#f92672">--&gt;</span>
            <span style="color:#f92672">&lt;</span>dataSource type<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;POOLED&#34;</span><span style="color:#f92672">&gt;</span>
                <span style="color:#f92672">&lt;</span>property name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;driver&#34;</span> value<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;${driver}&#34;</span> <span style="color:#f92672">/&gt;</span>
                <span style="color:#f92672">&lt;</span>property name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span> value<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;${url}&#34;</span> <span style="color:#f92672">/&gt;</span>
                <span style="color:#f92672">&lt;</span>property name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;username&#34;</span> value<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;${username}&#34;</span> <span style="color:#f92672">/&gt;</span>
                <span style="color:#f92672">&lt;</span>property name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;password&#34;</span> value<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;${password}&#34;</span> <span style="color:#f92672">/&gt;</span>
            <span style="color:#f92672">&lt;/</span>dataSource<span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;/</span>environment<span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;/</span>environments<span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;</span>mappers<span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;</span><span style="color:#f92672">package</span> name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;com.iNuo.dao&#34;</span><span style="color:#f92672">&gt;&lt;/</span>package<span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;/</span>mappers<span style="color:#f92672">&gt;</span>

<span style="color:#f92672">&lt;/</span>configuration<span style="color:#f92672">&gt;</span>
</code></pre></div><p>编写测试方法</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.test<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> ...

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MybatisTest</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">private</span> InputStream inputStream<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> SqlSession session<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> BookDao bookDao<span style="color:#f92672">;</span>

    <span style="color:#a6e22e">@Before</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">init</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>
        <span style="color:#75715e">//1.加载Mybatis的核心配置文件
</span><span style="color:#75715e"></span>        String resource <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mybatis-config.xml&#34;</span><span style="color:#f92672">;</span>
        inputStream <span style="color:#f92672">=</span> Resources<span style="color:#f92672">.</span><span style="color:#a6e22e">getResourceAsStream</span><span style="color:#f92672">(</span>resource<span style="color:#f92672">);</span>
        <span style="color:#75715e">//2.创建会话工厂
</span><span style="color:#75715e"></span>        SqlSessionFactory factory <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SqlSessionFactoryBuilder<span style="color:#f92672">().</span><span style="color:#a6e22e">build</span><span style="color:#f92672">(</span>inputStream<span style="color:#f92672">);</span>
        <span style="color:#75715e">//3.创建会话
</span><span style="color:#75715e"></span>        session <span style="color:#f92672">=</span> factory<span style="color:#f92672">.</span><span style="color:#a6e22e">openSession</span><span style="color:#f92672">();</span>
        <span style="color:#75715e">//4.创建实现了BookDao接口的类的对象
</span><span style="color:#75715e"></span>        bookDao<span style="color:#f92672">=</span>session<span style="color:#f92672">.</span><span style="color:#a6e22e">getMapper</span><span style="color:#f92672">(</span>BookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    <span style="color:#a6e22e">@Test</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>
        <span style="color:#75715e">//5.执行方法
</span><span style="color:#75715e"></span>        List<span style="color:#f92672">&lt;</span>Book<span style="color:#f92672">&gt;</span> lists <span style="color:#f92672">=</span> bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findAllBook</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span>Book list<span style="color:#f92672">:</span>lists<span style="color:#f92672">){</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;图书名：&#34;</span><span style="color:#f92672">+</span>list<span style="color:#f92672">.</span><span style="color:#a6e22e">getBname</span><span style="color:#f92672">());</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
    <span style="color:#a6e22e">@Test</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo1</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>
        <span style="color:#75715e">//5.执行方法
</span><span style="color:#75715e"></span>        Book book <span style="color:#f92672">=</span> bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findBookById</span><span style="color:#f92672">();</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>book<span style="color:#f92672">.</span><span style="color:#a6e22e">getBname</span><span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo2</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>
        Book book<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> Book<span style="color:#f92672">();</span>
        book<span style="color:#f92672">.</span><span style="color:#a6e22e">setCid</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
        book<span style="color:#f92672">.</span><span style="color:#a6e22e">setBname</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;神雕&#34;</span><span style="color:#f92672">);</span>
        book<span style="color:#f92672">.</span><span style="color:#a6e22e">setPrice</span><span style="color:#f92672">(</span>34<span style="color:#f92672">);</span>
        book<span style="color:#f92672">.</span><span style="color:#a6e22e">setAuthor</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;金庸&#34;</span><span style="color:#f92672">);</span>
        book<span style="color:#f92672">.</span><span style="color:#a6e22e">setPdate</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> SimpleDateFormat<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;yyyy-MM-dd&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">parse</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;1834-03-23&#34;</span><span style="color:#f92672">));</span>
        bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">saveBook</span><span style="color:#f92672">(</span>book<span style="color:#f92672">);</span>
        session<span style="color:#f92672">.</span><span style="color:#a6e22e">commit</span><span style="color:#f92672">();</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;添加成功&#34;</span><span style="color:#f92672">);</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>book<span style="color:#f92672">.</span><span style="color:#a6e22e">getBid</span><span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo3</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>
        Book book<span style="color:#f92672">=</span>bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findBookById</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
        book<span style="color:#f92672">.</span><span style="color:#a6e22e">setPrice</span><span style="color:#f92672">(</span>34<span style="color:#f92672">);</span>
        bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">updateBook</span><span style="color:#f92672">(</span>book<span style="color:#f92672">);</span>
        session<span style="color:#f92672">.</span><span style="color:#a6e22e">commit</span><span style="color:#f92672">();</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;修改成功&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo4</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>
        bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">deleteBook</span><span style="color:#f92672">(</span>3<span style="color:#f92672">);</span>
        session<span style="color:#f92672">.</span><span style="color:#a6e22e">commit</span><span style="color:#f92672">();</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;删除成功&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    <span style="color:#a6e22e">@After</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">destroy</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>
        <span style="color:#75715e">//6.关闭资源
</span><span style="color:#75715e"></span>        inputStream<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
        session<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="使用注解实现复杂关系映射开发">使用注解实现复杂关系映射开发</h5>
<p>实现复杂关系映射之前我们可以在映射文件中通过配置&lt;resultMap&gt;来实现，在使用注解开发时我们需要借助@Results 注解，@Result 注解，@One 注解，@Many 注解。</p>
<p>复杂关系映射的注解说明：</p>
<ul>
<li>@Results注解：代替的是标签&lt;resultMap&gt; 该注解中可以使用单个@Result 注解，也可以使用@Result 集合</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Results</span><span style="color:#960050;background-color:#1e0010">（</span><span style="color:#f92672">{</span><span style="color:#a6e22e">@Result</span><span style="color:#960050;background-color:#1e0010">（），</span><span style="color:#a6e22e">@Result</span><span style="color:#960050;background-color:#1e0010">（）</span><span style="color:#f92672">}</span><span style="color:#960050;background-color:#1e0010">）</span>或<span style="color:#a6e22e">@Results</span><span style="color:#960050;background-color:#1e0010">（</span><span style="color:#a6e22e">@Result</span><span style="color:#960050;background-color:#1e0010">（））</span>
</code></pre></div><ul>
<li>
<p>@Resutl 注解：代替了&lt;id&gt;标签和&lt;result&gt;标签</p>
<p>@Result中 属性介绍：</p>
<p>​	id 是否是主键字段</p>
<p>​	column 数据库的列名</p>
<p>​	property 需要装配的属性名</p>
<p>​	one 需要使用的@One 注解（@Result（one=@One）（）））</p>
<p>​	many 需要使用的@Many 注解（@Result（many=@many）（）））</p>
</li>
<li>
<p>@One注解（一对一）代替了&lt;assocation&gt;标签，是多表查询的关键，在注解中用来指定子查询返回单一对象。</p>
<p>@One注解属性介绍：</p>
<p>​	select指定用来多表查询的sqlmapper</p>
<p>​	fetchType 会覆盖全局的配置参数 lazyLoadingEnabled。。使用格式：</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Result</span><span style="color:#f92672">(</span>column<span style="color:#f92672">=</span><span style="color:#e6db74">&#34; &#34;</span><span style="color:#f92672">,</span>property<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">,</span>one<span style="color:#f92672">=</span><span style="color:#a6e22e">@One</span><span style="color:#f92672">(</span>select<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">))</span>
</code></pre></div><ul>
<li>@Many注解（多对一）代替了&lt;Collection&gt;标签,是多表查询的关键，在注解中用来指定子查询返回对象集合。</li>
</ul>
<p>​     注意：聚集元素用来处理“一对多”的关系。需要指定映射的 Java 实体类的属性，属性的 javaType</p>
<p>（一般为 ArrayList）但是注解中可以不定义；使用格式：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Result</span><span style="color:#f92672">(</span>property<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">,</span>column<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">,</span>many<span style="color:#f92672">=</span><span style="color:#a6e22e">@Many</span><span style="color:#f92672">(</span>select<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">))</span>
</code></pre></div><h5 id="实现">实现</h5>
<p>创建实体BookInfo，故意使其属性名与数据库字段名不一致</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.iNuo.pojo<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BookInfo</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> Integer bookId<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String bookName<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> Integer bookPrice<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String bookauthor<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> Date bookpdate<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> Integer bookCid<span style="color:#f92672">;</span>
    <span style="color:#960050;background-color:#1e0010">。。。</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>用注解方式开发持久层接口</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Select</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;select * from book&#34;</span><span style="color:#f92672">)</span>
<span style="color:#a6e22e">@Results</span><span style="color:#f92672">(</span>id<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bookMap&#34;</span><span style="color:#f92672">,</span>value<span style="color:#f92672">={</span>
    <span style="color:#a6e22e">@Result</span><span style="color:#f92672">(</span>id<span style="color:#f92672">=</span><span style="color:#66d9ef">true</span><span style="color:#f92672">,</span>column<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bid&#34;</span><span style="color:#f92672">,</span>property<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bookId&#34;</span><span style="color:#f92672">),</span>
    <span style="color:#a6e22e">@Result</span><span style="color:#f92672">(</span>column<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bname&#34;</span><span style="color:#f92672">,</span>property<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bookName&#34;</span><span style="color:#f92672">),</span>
    <span style="color:#a6e22e">@Result</span><span style="color:#f92672">(</span>column<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;price&#34;</span><span style="color:#f92672">,</span>property<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bookprice&#34;</span><span style="color:#f92672">),</span>
    <span style="color:#a6e22e">@Result</span><span style="color:#f92672">(</span>column<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;author&#34;</span><span style="color:#f92672">,</span>property<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bookauthor&#34;</span><span style="color:#f92672">),</span>
    <span style="color:#a6e22e">@Result</span><span style="color:#f92672">(</span>column<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;pdate&#34;</span><span style="color:#f92672">,</span>property<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bookpdate&#34;</span><span style="color:#f92672">),</span>
    <span style="color:#a6e22e">@Result</span><span style="color:#f92672">(</span>column<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;cid&#34;</span><span style="color:#f92672">,</span>property<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bookcid&#34;</span><span style="color:#f92672">)</span>
<span style="color:#f92672">})</span>
List<span style="color:#f92672">&lt;</span>BookInfo<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">findAllBook1</span><span style="color:#f92672">();</span>
</code></pre></div><p>测试：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDo5</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">{</span>
    List<span style="color:#f92672">&lt;</span>BookInfo<span style="color:#f92672">&gt;</span> list<span style="color:#f92672">=</span>bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findAllBook1</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">for</span><span style="color:#f92672">(</span>BookInfo bookInfo<span style="color:#f92672">:</span>list<span style="color:#f92672">){</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>bookInfo<span style="color:#f92672">.</span><span style="color:#a6e22e">getBookName</span><span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="使用注解实现一对一复杂关系映射及延迟加载">使用注解实现一对一复杂关系映射及延迟加载</h5>
<p>需求：加载图书信息时并且加载该图书的类型信息，根据情况可实现延迟加载。（注解方式实现）</p>
<p>添加Book实体类及Category实体类同前</p>
<p>添加Book的持久层接口并使用注解配置</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">BookDao</span> <span style="color:#f92672">{</span>
<span style="color:#a6e22e">@Select</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;select * from book&#34;</span><span style="color:#f92672">)</span>
<span style="color:#a6e22e">@Results</span><span style="color:#f92672">(</span>id <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;lazyLoadingMap&#34;</span><span style="color:#f92672">,</span>value <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
        <span style="color:#a6e22e">@Result</span><span style="color:#f92672">(</span>id <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">,</span>column <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bid&#34;</span><span style="color:#f92672">,</span>property <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bid&#34;</span><span style="color:#f92672">),</span>
        <span style="color:#a6e22e">@Result</span><span style="color:#f92672">(</span>column <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bname&#34;</span><span style="color:#f92672">,</span>property <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bname&#34;</span><span style="color:#f92672">),</span>
        <span style="color:#a6e22e">@Result</span><span style="color:#f92672">(</span>column <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cid&#34;</span><span style="color:#f92672">,</span>property <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cid&#34;</span><span style="color:#f92672">),</span>
        <span style="color:#a6e22e">@Result</span><span style="color:#f92672">(</span>column <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cid&#34;</span><span style="color:#f92672">,</span>property <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;category&#34;</span><span style="color:#f92672">,</span>
                one <span style="color:#f92672">=</span> <span style="color:#a6e22e">@One</span><span style="color:#f92672">(</span>select<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;com.iNuo.dao.UserDao.findCategoryById&#34;</span><span style="color:#f92672">,</span>fetchType <span style="color:#f92672">=</span> FetchType<span style="color:#f92672">.</span><span style="color:#a6e22e">LAZY</span><span style="color:#f92672">))</span>
<span style="color:#f92672">})</span>
List<span style="color:#f92672">&lt;</span>book<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">findBookBylazyLoading</span><span style="color:#f92672">();</span>
<span style="color:#a6e22e">@Select</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;select * from category where cid = #{cid}&#34;</span><span style="color:#f92672">)</span>
Category <span style="color:#a6e22e">findCategoryById</span><span style="color:#f92672">(</span>Integer id<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>测试一对一关联及延迟加载</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">test7</span><span style="color:#f92672">(){</span>
    SqlSession session <span style="color:#f92672">=</span> sqlSessionFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">openSession</span><span style="color:#f92672">();</span>
    BookDao bookDao <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span><span style="color:#a6e22e">getMapper</span><span style="color:#f92672">(</span>BookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>

    List<span style="color:#f92672">&lt;</span>book<span style="color:#f92672">&gt;</span> us <span style="color:#f92672">=</span>  bookDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findBookBylazyLoading</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>book c<span style="color:#f92672">:</span>us<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>c<span style="color:#f92672">.</span><span style="color:#a6e22e">getBname</span><span style="color:#f92672">());</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>c<span style="color:#f92672">.</span><span style="color:#a6e22e">getCategory</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getCname</span><span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>
    session<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="用注解实现一对多复杂关系映射">用注解实现一对多复杂关系映射:</h5>
<p>需求：查询类型信息时，也要查询他的图书列表。使用注解方式实现。</p>
<p>实体类同前。</p>
<p>编写用户的持久层接口并使用注解配置</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">UserDao</span> <span style="color:#f92672">{</span>
<span style="color:#a6e22e">@Select</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;select * from category&#34;</span><span style="color:#f92672">)</span>
<span style="color:#a6e22e">@Results</span><span style="color:#f92672">(</span>id <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;categoryBookResultMap&#34;</span><span style="color:#f92672">,</span>value <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
        <span style="color:#a6e22e">@Result</span><span style="color:#f92672">(</span>id <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">,</span>column <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cid&#34;</span><span style="color:#f92672">,</span>property <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cid&#34;</span><span style="color:#f92672">),</span>
        <span style="color:#a6e22e">@Result</span><span style="color:#f92672">(</span>column <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cname&#34;</span><span style="color:#f92672">,</span>property <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cname&#34;</span><span style="color:#f92672">),</span>
        <span style="color:#a6e22e">@Result</span><span style="color:#f92672">(</span>column <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cid&#34;</span><span style="color:#f92672">,</span>property <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;books&#34;</span><span style="color:#f92672">,</span>many <span style="color:#f92672">=</span> <span style="color:#a6e22e">@Many</span><span style="color:#f92672">(</span>select <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;com.iNuo.dao.UserDao.findBookByCid&#34;</span><span style="color:#f92672">,</span>fetchType <span style="color:#f92672">=</span> FetchType<span style="color:#f92672">.</span><span style="color:#a6e22e">LAZY</span><span style="color:#f92672">))</span>
<span style="color:#f92672">})</span>
List<span style="color:#f92672">&lt;</span>Category<span style="color:#f92672">&gt;</span>  <span style="color:#a6e22e">findCategoryWithMap</span><span style="color:#f92672">();</span>
<span style="color:#a6e22e">@Select</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;select * from book where cid = #{cid}&#34;</span><span style="color:#f92672">)</span>
List<span style="color:#f92672">&lt;</span>book<span style="color:#f92672">&gt;</span>  <span style="color:#a6e22e">findBookByCid</span><span style="color:#f92672">(</span>Integer cid<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>添加测试方法</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">test6</span><span style="color:#f92672">(){</span>
    SqlSession session <span style="color:#f92672">=</span> sqlSessionFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">openSession</span><span style="color:#f92672">();</span>
    UserDao userDao <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span><span style="color:#a6e22e">getMapper</span><span style="color:#f92672">(</span>UserDao<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>

    List<span style="color:#f92672">&lt;</span>Category<span style="color:#f92672">&gt;</span> us <span style="color:#f92672">=</span>  userDao<span style="color:#f92672">.</span><span style="color:#a6e22e">findCategoryWithMap</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Category c<span style="color:#f92672">:</span>us<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>c<span style="color:#f92672">.</span><span style="color:#a6e22e">getCname</span><span style="color:#f92672">());</span>
        List<span style="color:#f92672">&lt;</span>book<span style="color:#f92672">&gt;</span> lstBook <span style="color:#f92672">=</span> c<span style="color:#f92672">.</span><span style="color:#a6e22e">getBooks</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>book book <span style="color:#f92672">:</span> lstBook<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>book<span style="color:#f92672">.</span><span style="color:#a6e22e">getBname</span><span style="color:#f92672">());</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
    session<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="heading-1"></h3>
<h3 id="heading-2"></h3>
<h3 id="heading-3"></h3>
</div>
  
</article></main>
<footer class="footer">
  <span>&copy; 2021 <a href="https://xshi000.github.io/">及时当勉励，岁月不待人！@iNuo</a></span>
  <span>&middot;</span>
  <span>Powered by <a href="https://gohugo.io/" rel="noopener" target="_blank">Hugo️️</a>️</span>
  <span>&middot;</span>
  <span>Theme️ <a href="https://github.com/nanxiaobei/hugo-paper" rel="noopener" target="_blank">Paper</a></span>
</footer>
<script src="https://xshi000.github.io/highlight.min.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>
</body>
</html>

