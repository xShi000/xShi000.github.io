<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <title>极简Java十八：Oracle数据库 - 及时当勉励，岁月不待人！@iNuo</title>
    
    <meta name="description" content="第一章  本章内容  oracle介绍[了解] Oracle安装[了解] Oracle体系结构[理解] 创建表空间[理解] 用户[理解] Oracle数据类型[应用] 表的管理 Scott用户下的表结构[了解] 单行函数[应用] 多行函数（聚合函数） 分组统计 多表查询[应用] 子查询[应用] Rownum与分页查询 [应用]   ​
1.1 oracle介绍[了解] ORACLE 数据库系统是美国ORACLE 公司（甲骨文）提供的以分布式数据库为核心的一组软件产品，是目前最流行的客户/服务器(CLIENT/SERVER)或 B/S 体系结构的数据库之一。比如：SilverStream 就是基于数据库的一种中间件。ORACLE 数据库是目前世界上使用最为广泛的数据库管理系统，作为一个通用的数据库系统，它具有完整的数据管理功能；作为一个关系数据库，它是一个完备关系的产品；作为分布式数据库它实现了分布式处理功能。但它的所有知识，只要在一种机型上学习了ORACLE 知识，便能在各种类型的机器上使用它。
1.2 Oracle安装[了解]   安装全套Oracle 软件的XP 虚拟机，直接在虚拟机中学习 (推荐使用)
  安装到本地电脑
  1.3 Oracle体系结构[理解] ​ 1. 数据库 Oracle 数据库是数据的物理存储，包括（数据文件ORA/DBF、控制文件、联机日志、参数文件）。
Oracle 数据库的概念和其它数据库不一样，这里的数据库是一个操作系统，只有一个库。可以看作是Oracle 就只有一个大数据库，它是以用户为一个单位的，而其它的是以数据库为一个单位！
2. 实例 一个Oracle 实例(Oracle Instance)有一系列的后台进程(Backguound Processes)和内存结构(Memory tructures)组成。一个数据库可以有n 个实例。
3. 用户 用户是在实例下建立的。不同实例可以建相同名字的用户。
4. 表空间 表空间是Oracle 对物理数据库上相关数据文件（ORA/DBF 文件）的逻辑映射。">
    <meta name="author" content="">
    
    <link href="https://xshi000.github.io/an-old-hope.min.css" rel="stylesheet">
    <link href="https://xshi000.github.io/style.css" rel="stylesheet">
    <link href="https://xshi000.github.io/custom.css" rel="stylesheet">
    
    <link rel="apple-touch-icon" href="https://xshi000.github.io/apple-touch-icon.png">
    <link rel="icon" href="https://xshi000.github.io/favicon.ico">
    <meta name="generator" content="Hugo 0.65.3" />
    
    
    
    <script>
      function setTheme() {
        const time = new Date();

        const prev = localStorage.getItem('date');
        const date = String(time.getMonth() + 1) + '.' + String(time.getDate());

        const now = time.getTime();
        let sunrise;
        let sunset;

        function setBodyClass() {
          if (now > sunrise && now < sunset) return;
          document.body.classList.add('dark');
        }

        if (date !== prev) {
          fetch('https://api.ipgeolocation.io/astronomy?apiKey=5ed37d85103e4defa5df4c5298ed5215')
            .then(res => res.json())
            .then(data => {
              sunrise = data.sunrise.split(':').map(Number);
              sunset = data.sunset.split(':').map(Number);
            })
            .catch(() => {
              sunrise = [7, 0];
              sunset = [19, 0];
            })
            .finally(() => {
              sunrise = time.setHours(sunrise[0], sunrise[1], 0);
              sunset = time.setHours(sunset[0], sunset[1], 0);
              setBodyClass();
              localStorage.setItem('sunrise', sunrise);
              localStorage.setItem('sunset', sunset);
            });
          localStorage.setItem('date', date);
        } else {
          sunrise = Number(localStorage.getItem('sunrise'));
          sunset = Number(localStorage.getItem('sunset'));
          setBodyClass();
        }
      }
    </script>
  </head>
  <body class="single">
    <script>
      setTheme();
    </script>
    <header class="header">
      <nav class="nav">
        <p class="logo"><a href="https://xshi000.github.io/">及时当勉励，岁月不待人！@iNuo</a></p>
      </nav>
    </header>
    <main class="main">


<article class="post-single">
  <header class="post-header">
    <h1 class="post-title">极简Java十八：Oracle数据库</h1>
    <div class="post-meta">February 9, 2021</div>
  </header>
  <div class="post-content"><hr>
<h3 id="第一章">第一章</h3>
<hr>
<h5 id="本章内容">本章内容</h5>
<ul>
<li>oracle介绍[了解]</li>
<li>Oracle安装[了解]</li>
<li>Oracle体系结构[理解]</li>
<li>创建表空间[理解]</li>
<li>用户[理解]</li>
<li>Oracle数据类型[应用]</li>
<li>表的管理</li>
<li>Scott用户下的表结构[了解]</li>
<li>单行函数[应用]</li>
<li>多行函数（聚合函数）</li>
<li>分组统计</li>
<li>多表查询[应用]</li>
<li>子查询[应用]</li>
<li>Rownum与分页查询 [应用]</li>
</ul>
<hr>
<p>​</p>
<h4 id="11-oracle介绍了解">1.1 oracle介绍[了解]</h4>
<p>ORACLE <a href="http://baike.baidu.com/view/7809.htm">数据库系统</a>是美国ORACLE 公司（甲骨文）提供的以<a href="http://baike.baidu.com/view/68389.htm">分布式数据库</a>为核心的一组软件产品，是目前最流行的客户/服务器(CLIENT/SERVER)或 B/S <a href="http://baike.baidu.com/view/1188494.htm">体系结构</a>的数据库之一。比如：SilverStream 就是基于数据库的一种中间件。ORACLE 数据库是目前世界上使用最为广泛的<a href="http://baike.baidu.com/view/68446.htm">数据</a><a href="http://baike.baidu.com/view/68446.htm">库管理系统</a>，作为一个通用的<a href="http://baike.baidu.com/view/7809.htm">数据库系统</a>，它具有完整的<a href="http://baike.baidu.com/view/14717.htm">数据管理</a>功能；作为一个关系数据库，它是一个完备关系的产品；作为<a href="http://baike.baidu.com/view/68389.htm">分布式数据库</a>它实现了<a href="http://baike.baidu.com/view/185352.htm">分布式处理</a>功能。但它的所有知识，只要在一种机型上学习了ORACLE 知识，便能在各种类型的机器上使用它。</p>
<h4 id="12-oracle安装了解">1.2 Oracle安装[了解]</h4>
<ul>
<li>
<p>安装全套Oracle 软件的XP 虚拟机，直接在虚拟机中学习 (推荐使用)</p>
</li>
<li>
<p>安装到本地电脑</p>
</li>
</ul>
<h4 id="13-oracle体系结构理解">1.3 Oracle体系结构[理解]</h4>
<p>​              <img src="/img/clip_image002-1609034348052.jpg" alt="img"></p>
<h5 id="1--数据库">1.  数据库</h5>
<p>Oracle 数据库是数据的物理存储，包括（数据文件ORA/DBF、控制文件、联机日志、参数文件）。</p>
<p>Oracle 数据库的概念和其它数据库不一样，这里的数据库是一个操作系统，只有一个库。可以看作是Oracle 就只有一个大数据库，它是以用户为一个单位的，而其它的是以数据库为一个单位！</p>
<h5 id="2-实例">2. 实例</h5>
<p>一个Oracle 实例(Oracle  Instance)有一系列的后台进程(Backguound Processes)和内存结构(Memory tructures)组成。一个数据库可以有n 个实例。</p>
<h5 id="3---用户">3.   用户</h5>
<p>用户是在实例下建立的。不同实例可以建相同名字的用户。</p>
<h5 id="4--表空间">4.  表空间</h5>
<p>表空间是Oracle 对物理数据库上相关数据文件（ORA/DBF 文件）的逻辑映射。</p>
<p>一个数据库在逻辑上被划分成一到若干个表空间，每个表空间包含了在逻辑上相关联的一组结构。每个数据库至少有一个表空间(称之为system 表空间)。每个表空间由同一磁盘上的一个或多个文件组成，这些文件叫数据文件(datafile)。一个数据文件只能属于一个表空间。</p>
<p>​         <img src="/img/clip_image004-1609034348054.jpg" alt="img"></p>
<h5 id="5---数据文件dbfora">5.   数据文件（dbf/ora）</h5>
<p>数据文件是数据库的物理存储单位。</p>
<p>数据库的数据是存储在表空间中的，真正是在某一个或者多个数据文件中。而一个表空间可以由一个或多个数据文件组成，一个数据文件只能属于一个表空间。一旦数据文件被加入到某个表空间后，就不能删除这个文件，如果要删除某个数据文件，只能删除其所属于的表空间才行。</p>
<p>表的数据，是由用户放入某一个表空间的，而这个表空间会随机把这些表数据放到一个或者多个数据文件中。</p>
<p>由于oracle 的数据库不是普通的概念，oracle 是由用户和表空间对数据进行管理和存放的。但是表不是有表空间去查询的，而是由用户去查的。因为不同用户可以在同一个表空间建立同一个名字的表！这里区分就是用户了！</p>
<p><img src="/img/clip_image008-1609034348054.gif" alt="img"></p>
<h4 id="14-创建表空间理解">1.4 创建表空间[理解]</h4>
<p>表空间：ORACLE 数据库的逻辑单元。</p>
<p>数据库&mdash;表空间   一个表空间可以与多个数据文件（物理结构）关联</p>
<p>一个数据库下可以建立多个表空间，一个表空间可以建立多个用户、一个用户下可以建立多个表。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">create</span> tablespace ts datafile 
<span style="color:#e6db74">&#39;F:\Oracle\ts.dbf&#39;</span> <span style="color:#66d9ef">size</span> <span style="color:#ae81ff">100</span>m
autoextend <span style="color:#66d9ef">on</span> <span style="color:#66d9ef">next</span> <span style="color:#ae81ff">10</span>m
</code></pre></div><ul>
<li>
<p>ts：表空间名称</p>
</li>
<li>
<p>datafile：指定表空间对应的数据文件</p>
</li>
<li>
<p>size：后定义的是表空间的初始大小</p>
</li>
<li>
<p>autoextend on：自动增长，当表空间存储都占满时，自动增长</p>
</li>
<li>
<p>next：后指定的是一次自动增长的大小。</p>
</li>
</ul>
<h4 id="15-用户理解">1.5 用户[理解]</h4>
<h5 id="6-创建用户"><strong>6.</strong> 创建用户</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">user</span> iNuo identified <span style="color:#66d9ef">by</span> password <span style="color:#66d9ef">default</span> tablespace ts
</code></pre></div><ul>
<li>
<p>identified by 后边是用户的密码</p>
</li>
<li>
<p>default tablespace 后边是表空间名称</p>
</li>
</ul>
<p>oracle 数据库与其它数据库产品的区别在于：表和其它的数据库对象都是存储在用户下的！</p>
<h5 id="7-用户赋权限"><strong>7.</strong> 用户赋权限</h5>
<p>新创建的用户没有任何权限，登陆后会提示</p>
<p><img src="/img/image-20201227102508903.png" alt="image-20201227102508903"></p>
<p>Oracle 中已存在三个重要的角色：connect 角色，resource 角色，dba 角色。</p>
<ul>
<li>
<p>CONNECT 角色： &ndash;是授予最终用户的典型权利，最基本的</p>
<p>ALTER SESSION &ndash;修改会话</p>
<p>CREATE CLUSTER &ndash;建立聚簇</p>
<p>CREATE DATABASE LINK &ndash;建立数据库链接</p>
<p>CREATE SEQUENCE &ndash;建立序列</p>
<p>CREATE SESSION &ndash;建立会话</p>
<p>CREATE SYNONYM &ndash;建立同义词</p>
<p>CREATE VIEW &ndash;建立视图</p>
</li>
<li>
<p>RESOURCE 角色： &ndash;是授予开发人员的</p>
<p>CREATE CLUSTER &ndash;建立聚簇</p>
<p>CREATE PROCEDURE &ndash;建立过程</p>
<p>CREATE SEQUENCE &ndash;建立序列</p>
<p>CREATE TABLE &ndash;建表</p>
<p>CREATE TRIGGER &ndash;建立触发器</p>
<p>CREATE TYPE &ndash;建立类型</p>
</li>
<li>
<p>DBA 角色：拥有全部特权，是系统最高权限，只有 DBA 才可以创建数据库结构，并且系统权限也需要DBA 授出，且DBA 用户可以操作全体用户的任意基表，包括删除</p>
<p>进入 system 用户下给用户赋予 dba 权限，否则无法正常登陆！</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">grant</span> dba <span style="color:#66d9ef">to</span> iNuo
</code></pre></div><h4 id="16-oracle数据类型应用">1.6 Oracle数据类型[应用]</h4>
<table>
<thead>
<tr>
<th>No</th>
<th>数据类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Varchar，varchar2</td>
<td>表示一个字符串</td>
</tr>
<tr>
<td>2</td>
<td>NUMBER</td>
<td>NUMBER(n)表示一个整数，长度是n  <!-- raw HTML omitted -->NUMBER(m,n)表示一个小数，总长度是 m，小数是n，整数是m-n</td>
</tr>
<tr>
<td>3</td>
<td>DATA</td>
<td>表示日期类型</td>
</tr>
<tr>
<td>4</td>
<td>CLOB</td>
<td>大对象，表示大文本数据类型，可存 4G</td>
</tr>
<tr>
<td>5</td>
<td>BLOB</td>
<td>大对象，表示二进制数据，可存  4G</td>
</tr>
</tbody>
</table>
<h4 id="17-表的管理">1.7 表的管理</h4>
<h5 id="1-建表">1. 建表：</h5>
<p>语法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">Create</span> <span style="color:#66d9ef">table</span> <span style="color:#960050;background-color:#1e0010">表名</span>(

  <span style="color:#960050;background-color:#1e0010">字段</span><span style="color:#ae81ff">1</span>  <span style="color:#960050;background-color:#1e0010">数据类型</span>  [default默认值],
  <span style="color:#960050;background-color:#1e0010">字段</span><span style="color:#ae81ff">2</span>  <span style="color:#960050;background-color:#1e0010">数据类型</span>  [default默认值],
  <span style="color:#960050;background-color:#1e0010">…</span>

)
</code></pre></div><p>范例：创建person表</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">Create</span> <span style="color:#66d9ef">table</span> person(

  pid  number(<span style="color:#ae81ff">10</span>),
  name varchar2<span style="color:#960050;background-color:#1e0010">（</span><span style="color:#ae81ff">10</span><span style="color:#960050;background-color:#1e0010">）</span>,
  gender number(<span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">default</span> <span style="color:#ae81ff">1</span>,
  birthday date

);

<span style="color:#75715e">-- 插入数据
</span><span style="color:#75715e"></span><span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> person(pid, name, gender, birthday) <span style="color:#66d9ef">values</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;张三&#39;</span>, <span style="color:#ae81ff">1</span>, to_date(<span style="color:#e6db74">&#39;1999-12-22&#39;</span>, <span style="color:#e6db74">&#39;yyyy-MM-dd&#39;</span>));
</code></pre></div><h5 id="2-表删除">2. 表删除</h5>
<p>语法：DROP TABLE 表名</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">table</span> person
</code></pre></div><p>​</p>
<h5 id="3-表的修改">3. 表的修改</h5>
<p>在 sql 中使用alter 可以修改表</p>
<ul>
<li>添加语法：ALTER TABLE 表名称 ADD(列名 1 类型 [DEFAULT 默认值]，列名 1  类型</li>
</ul>
<p>[DEFAULT 默认值]&hellip;)</p>
<ul>
<li>修改语法：ALTER TABLE 表名称 MODIFY(列名 1 类型 [DEFAULT 默认值]，列名 1 类型</li>
</ul>
<p>[DEFAULT 默认值]&hellip;)</p>
<ul>
<li>修改列名: ALTER TABLE 表名称 RENAME 列名 1 TO 列名 2</li>
</ul>
<p>范例：在person 表中增加列address</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> person <span style="color:#66d9ef">add</span>(address varchar2(<span style="color:#ae81ff">10</span>));
</code></pre></div><p>范例：把person 表的address 列的长度修改成 20 长度</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> person <span style="color:#66d9ef">modify</span>(address varchar2(<span style="color:#ae81ff">20</span>));
</code></pre></div><h5 id="4-数据库表数据的更新">4. 数据库表数据的更新</h5>
<ol>
<li>INSERT（增加）</li>
</ol>
<p>标准写法：INSERT  INTO 表名[(列名 1，列名 2，&hellip;)]VALUES(值 1，值 2，&hellip;)</p>
<p>简单写法：INSERT  INTO 表名 VALUES(值 1，值 2，&hellip;)（不建议）</p>
<p>注意：使用简单的写法必须按照表中的字段的顺序来插入值，而且如果有为空的字段使用null</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> person <span style="color:#66d9ef">values</span>(<span style="color:#ae81ff">2</span>,<span style="color:#e6db74">&#39;李四&#39;</span>,<span style="color:#ae81ff">1</span>,<span style="color:#66d9ef">null</span>,<span style="color:#e6db74">&#39;北京育新&#39;</span>);
</code></pre></div><ol start="2">
<li>UPDATE（修改）</li>
</ol>
<p>全部修改：UPDATE 表名 SET 列名 1=值 1，列名 2=值 2，&hellip;.</p>
<p>局部修改：UPDATE 表名 SET 列名 1=值 1，列名 2=值 2，&hellip;.WHERE 修改条件；</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">update</span> person <span style="color:#66d9ef">set</span> name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;张三&#34;</span> <span style="color:#66d9ef">where</span> pid<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>
</code></pre></div><ol start="3">
<li>DELETE（删除）</li>
</ol>
<p>语法 : DELETE FROM 表名  WHERE 删除条件;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">delete</span> person <span style="color:#66d9ef">where</span> pid<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>
</code></pre></div><p>在删除语句中如果不指定删除条件的话就会删除所有的数据</p>
<p>因为oracle 的事务对数据库的变更的处理，我们必须做提交事务才能让数据真正的插入到数据库中，在同样在执行完数据库变更的操作后还可以把事务进行回滚，这样就不会插入到数据库。如果事务提交后则不可以再回滚。</p>
<ul>
<li>
<p>提交：commit</p>
</li>
<li>
<p>回滚：rollback</p>
</li>
</ul>
<h5 id="5-序列">5. 序列</h5>
<p>在很多数据库中都存在一个自动增长的列，如果现在要想在 oracle 中完成自动增长的功能，则只能依靠序列完成，所有的自动增长操作，需要用户手工完成处理。</p>
<p>语法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> SEQUENCE <span style="color:#960050;background-color:#1e0010">序列名</span>
[<span style="color:#66d9ef">INCREMENT</span> <span style="color:#66d9ef">BY</span> n] [<span style="color:#66d9ef">START</span> <span style="color:#66d9ef">WITH</span> n]
[<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#66d9ef">MAXVALUE</span><span style="color:#f92672">/</span> <span style="color:#66d9ef">MINVALUE</span> n<span style="color:#f92672">|</span>NOMAXVALUE<span style="color:#960050;background-color:#1e0010">}</span>] [<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#66d9ef">CYCLE</span><span style="color:#f92672">|</span>NOCYCLE<span style="color:#960050;background-color:#1e0010">}</span>]
[<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#66d9ef">CACHE</span> n<span style="color:#f92672">|</span>NOCACHE<span style="color:#960050;background-color:#1e0010">}</span>];
</code></pre></div><p>范例：创建一个 seqpersonid 的序列,验证自动增长的操作</p>
<pre><code class="language-plsql" data-lang="plsql">CREATE SEQUENCE seqpersonid;
</code></pre><p>序列创建完成之后，所有的自动增长应该由用户自己处理，所以在序列中提供了以下的两种操作：</p>
<ul>
<li>
<p>nextval：取得序列的下一个内容</p>
</li>
<li>
<p>currval：取得序列的当前内容</p>
</li>
</ul>
<pre><code class="language-plsql" data-lang="plsql">select seqpersonid.nextval from dual; 
select seqpersonid.currval from dual;
</code></pre><p>在插入数据时需要自增的主键中可以这样使用</p>
<p>​       <img src="/img/clip_image013-1609034348056.jpg" alt="img"></p>
<p>在实际项目中每一张表会配一个序列，但是表和序列是没有必然的联系的，一个序列被哪一张表使用都可以，但是我们一般都是一张表用一个序列。序列的管理一般使用工具来管理。</p>
<h4 id="18-scott用户下的表结构了解">1.8 Scott用户下的表结构[了解]</h4>
<p>解锁用户：</p>
<pre><code class="language-plsql" data-lang="plsql">alter user scott account unlock;
</code></pre><p>解锁密码：</p>
<pre><code class="language-plsql" data-lang="plsql">alter user scott identified by tiger;
</code></pre><p><img src="/img/clip_image015-1609034348056.jpg" alt="img"></p>
<p><img src="/img/clip_image017-1609034348057.jpg" alt="img"></p>
<h4 id="19-单行函数应用">1.9 单行函数[应用]</h4>
<h5 id="1-字符函数">1. 字符函数</h5>
<p>接收字符输入返回字符或者数值，dual  是伪表</p>
<p>把小写的字符转换成大写的字符：upper(&lsquo;smith&rsquo;)</p>
<p>​     <img src="/img/clip_image019-1609034348057.jpg" alt="img"></p>
<p>把大写字符变成小写字符：lower(&lsquo;SMITH&rsquo;)</p>
<p>​     <img src="/img/clip_image021-1609034348057.jpg" alt="img"></p>
<p>作业：</p>
<p>根据API 学习，首字母大写函数、字符串链接函数、字符串截取函数、字符串替换函数、获取字符串长度函数等。</p>
<h5 id="2---数值函数">2.   数值函数</h5>
<p>四舍五入函数：ROUND()</p>
<p>默认情况下ROUND  四舍五入取整，可以自己指定保留的位数。</p>
<p>​	<img src="/img/clip_image023-1609034348057.jpg" alt="img"></p>
<p>​	<img src="/img/image-20201227104025517.png" alt="image-20201227104025517"></p>
<p>作业：</p>
<p>根据API学习，数值截取函数，取余函数等</p>
<h5 id="3-日期函数">3. 日期函数</h5>
<p>Oracle中提供了很多和日期相关的函数，包括日期的加减，在日期加减时有一些规律</p>
<p>范例：查询雇员的进入公司的周数。
分析：查询雇员进入公司的天数(sysdate – 入职日期)/7 就是周数</p>
<p>​	<img src="/img/clip_image027-1609034348057.jpg" alt="img"></p>
<p>获得两个时间段中的月数：MONTHS_BETWEEN()</p>
<p>范例：查询所有雇员进入公司的月数</p>
<p>​	<img src="/img/image-20201227104552905.png" alt="image-20201227104552905"></p>
<h5 id="4-转换函数">4. 转换函数</h5>
<p>TO_CHAR：字符串转换函数</p>
<p>范例：查询所有的雇员将年月日分开，此时可以使用TO_CHAR函数来拆分，拆分时需要使用通配符</p>
<ul>
<li>
<p>年：y，  年是四位使用yyyy</p>
</li>
<li>
<p>月：m，月是两位使用mm</p>
</li>
<li>
<p>日：d， 日是两位使用dd</p>
<p><img src="/img/image-20201227104645266.png" alt="image-20201227104645266"></p>
<p>注：结果中 10 以下的月前面被被补了前导零，可以使用fm 去掉前导零</p>
</li>
</ul>
<p><img src="/img/image-20201227104734979.png" alt="image-20201227104734979"></p>
<p>TO_DATE：日期转换函数；TO_DATE可以把字符串的数据转换成日期类型</p>
<p><img src="/img/image-20201227104851283.png" alt="image-20201227104851283"></p>
<h5 id="5-通用函数">5. 通用函数</h5>
<p>空值处理nvl</p>
<p>案例：查询所有雇员的年薪</p>
<p><img src="/img/image-20201227105703936.png" alt="image-20201227105703936"></p>
<p>我们发现很多员工的年薪是空的，原因是很多员工的奖金是 null，null 和任何数值计算都是null，这时我们可以使用nvl 来处理。</p>
<p><img src="/img/image-20201227105744809.png" alt="image-20201227105744809"></p>
<p>Decode函数</p>
<p>该函数类似 if&hellip; else if &hellip; esle</p>
<p>语法：DECODE(col/expression,[search1,result1],[search2,result2]&hellip;[default])</p>
<ul>
<li>
<p>Col/expression：列名或表达式</p>
</li>
<li>
<p>Search1,Search2&hellip;：用于比较条件</p>
</li>
<li>
<p>Result1，result2&hellip;：返回值</p>
</li>
</ul>
<p><img src="/img/image-20201227110105976.png" alt="image-20201227110105976"></p>
<p>范例：查询出所有雇员的值为的中文名</p>
<p><img src="/img/clip_image037.jpg" alt="img"></p>
<p>case when函数</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CASE</span> expr <span style="color:#66d9ef">WHEN</span> comparison_expr1 <span style="color:#66d9ef">THEN</span> return_expr1
[<span style="color:#66d9ef">WHEN</span> comparison_expr2 <span style="color:#66d9ef">THEN</span> return_expr2
<span style="color:#66d9ef">WHEN</span> comparison_exprn <span style="color:#66d9ef">THEN</span> return_exprn
<span style="color:#66d9ef">ELSE</span> else_expr]
<span style="color:#66d9ef">END</span>
</code></pre></div><pre><code class="language-plsql" data-lang="plsql">Select ename,
case
when job = 'ANALYST' then '分析员'
when job = 'PRESIDENT' then '总裁'
when job = 'SALESMAN' then '销售'
Else '无业'
End
	From emp 
</code></pre><p><img src="/img/image-20201227110451194.png" alt="image-20201227110451194"></p>
<h4 id="110-多行函数聚合函数">1.10 多行函数（聚合函数）</h4>
<ol>
<li>统计记录数</li>
</ol>
<p>范例：查询出所有员工的记录数</p>
<p>​	<img src="/img/image-20201227110551320.png" alt="image-20201227110551320"></p>
<p>不建议使用count(*)，可以使用一个具体的列以免影响性能。</p>
<p>​	<img src="/img/image-20201227110811408.png" alt="image-20201227110811408"></p>
<ol start="2">
<li>最小值查询 min()</li>
</ol>
<p>范例：查询出来员工最低工资</p>
<p><img src="/img/image-20201227110927115.png" alt="image-20201227110927115"></p>
<ol start="3">
<li>
<p>最大值查询max()</p>
<p>范例：查询出员工的最高工资</p>
<p>​	<img src="/img/image-20201227111059119.png" alt="image-20201227111059119"></p>
</li>
<li>
<p>查询平均值</p>
<p>范例：查询出所有员工的平均工资</p>
<p>​	<img src="/img/image-20201227111403780.png" alt="image-20201227111403780"></p>
</li>
<li>
<p>求和函数sum()</p>
</li>
</ol>
<p>范例：查询出 20 号部门的员工的工资总和</p>
<pre><code class="language-plsql" data-lang="plsql">select sum(sal) from emp t where t.deptno=20
</code></pre><h4 id="111-分组统计">1.11 分组统计</h4>
<p>分组统计需要使用 GROUP BY 来分组</p>
<p>语法：SELECT * |列名 FROM 表名 {WEHRE 查询条件}   {GROUP BY 分组字段} ORDER BY 列名 1 ASC|DESC，列名 2&hellip;ASC|DESC</p>
<p>范例：查询每个部门的人数</p>
<p>​	<img src="/img/image-20201227111626720.png" alt="image-20201227111626720"></p>
<p>范例：查询出每个部门的平均工资</p>
<p>​	<img src="/img/image-20201227111713171.png" alt="image-20201227111713171"></p>
<p>注：select 后可出现的内容只能是 分组的字段或字段的聚合函数！</p>
<p>​</p>
<h4 id="112-多表查询应用">1.12 多表查询[应用]</h4>
<h5 id="多表连接基本查询">多表连接基本查询</h5>
<p>使用一张以上的表做查询就是多表查询</p>
<p>语法： SELECT {DISTINCT} *|列名.. FROM 表名 别名，表名1 别名 {WHERE 限制条件 ORDER BY 排序字段 ASC|DESC&hellip;}</p>
<p>范例：查询出雇员的编号，姓名，部门的编号和名称，地址</p>
<p><img src="/img/image-20201227111858469.png" alt="image-20201227111858469"></p>
<p>范例：查询出每个员工的上级领导（自连接查询）</p>
<p>​	<img src="/img/image-20201227111952556.png" alt="image-20201227111952556"></p>
<p>范例：在上一个例子的基础上查询该员工的部门名称</p>
<p>分析：只要在上一个例子基础上再加一张表的关联，使用deptno来做关联字段即可</p>
<p>​	<img src="/img/image-20201227112128624.png" alt="image-20201227112128624"></p>
<p>分析：emp 表中的 mgr 字段是当前雇员的上级领导的编号，所以该字段对 emp 表产生了自身关联，可以使用 mgr 字段和empno 来关联</p>
<p>范例：查询出每个员工编号，姓名，部门名称，工资等级和他的上级领导的姓名，工资等级</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> e.empno,e.ename, decode(s.grade,
                <span style="color:#ae81ff">1</span>,<span style="color:#e6db74">&#39;一级&#39;</span>,
                <span style="color:#ae81ff">2</span>,<span style="color:#e6db74">&#39;二级&#39;</span>,
                <span style="color:#ae81ff">3</span>,<span style="color:#e6db74">&#39;三级&#39;</span>,
                <span style="color:#ae81ff">4</span>,<span style="color:#e6db74">&#39;四级&#39;</span>,
                <span style="color:#ae81ff">5</span>,<span style="color:#e6db74">&#39;五级&#39;</span>) grade,d.dname,e1.empno,e1.ename,decode(s1.grade,
                        <span style="color:#ae81ff">1</span>,<span style="color:#e6db74">&#39;一级&#39;</span>,
                		<span style="color:#ae81ff">2</span>,<span style="color:#e6db74">&#39;二级&#39;</span>,
                		<span style="color:#ae81ff">3</span>,<span style="color:#e6db74">&#39;三级&#39;</span>,
                		<span style="color:#ae81ff">4</span>,<span style="color:#e6db74">&#39;四级&#39;</span>,
                		<span style="color:#ae81ff">5</span>,<span style="color:#e6db74">&#39;五级&#39;</span>) grade1
                <span style="color:#66d9ef">from</span> emp e,emp e1,dept d,salgrade s, salgrade s1
                <span style="color:#66d9ef">where</span> e.mgr<span style="color:#f92672">=</span>e1.empno
                <span style="color:#66d9ef">and</span> e.deptno<span style="color:#f92672">=</span>d.deptno
                <span style="color:#66d9ef">and</span> e.sal <span style="color:#66d9ef">between</span> s.losal <span style="color:#66d9ef">and</span> s.hisal
                <span style="color:#66d9ef">and</span> e1.sal <span style="color:#66d9ef">between</span> s1.losal <span style="color:#66d9ef">and</span> s1.hisal
                      )
</code></pre></div><p>​     <img src="/img/clip_image051.jpg" alt="img"></p>
<p>​</p>
<h5 id="外连接左右连接">外连接（左右连接）</h5>
<p>右连接：当我们在做基本连接查询的时候，查询出所有的部门下的员工，我们发现编号为 40 的部门下没有员工，但是要求把该部门也展示出来，我们发现上面的基本查询是办不到的，这个时候就要用到右外连接！</p>
<p><img src="/img/image-20201227112555932.png" alt="image-20201227112555932"></p>
<p>使用(+)表示左连接或者右连接，当(+)在左边表的关联条件字段上时是右连接，如果是在右边表的关联条件字段上就是左连接。</p>
<p>范例：查询出所有员工的上级领导</p>
<p>分析：我们发现使用我们以前的做法发现 KING 的上级领导没有被展示，我们需要使用左右连接把他查询出来</p>
<p>​         <img src="/img/clip_image055-1609034348059.jpg" alt="img"></p>
<h5 id="分组连接查询">分组连接查询</h5>
<p>范例1：按部门分组，查询出部门名称和部门的员工数量</p>
<p>范例2：查询出部门人数大于 5 人的部门</p>
<p>范例3：查询出部门平均工资大于 2000 的部门</p>
<p>​      <img src="/img/clip_image057.jpg" alt="img"></p>
<h4 id="113-子查询应用">1.13 子查询[应用]</h4>
<p>子查询：在一个查询的内部还包括另一个查询，则此查询称为子查询。</p>
<p>Sql 的任何位置都可以加入子查询。</p>
<p>范例：查询比 7654 工资高的雇员</p>
<p>分析：查询出 7654 员工的工资是多少，把它作为条件</p>
<p>​         <img src="/img/clip_image059.jpg" alt="img"></p>
<p>范例：查询出比雇员7654的工资高，同时从事和7788的工作一样的员工</p>
<p>​	<img src="/img/image-20201227113243423.png" alt="image-20201227113243423"></p>
<p>范例：要求查询每个部门的最低工资和最低工资的雇员和部门名称</p>
<p>​	<img src="/img/image-20201227113309625.png" alt="image-20201227113309625"></p>
<p>在返回多条记录的子查询可以把它的结果集当作一张表，给起个别名，如图中的a。</p>
<h4 id="114-rownum与分页查询-应用">1.14 Rownum与分页查询 [应用]</h4>
<p>ROWNUM：表示行号，实际上是一个列，但是这个列是一个伪列，此列可以在每张表中出现。</p>
<p>范例：查询emp表带有rownum列</p>
<p>​	<img src="/img/image-20201227113539092.png" alt="image-20201227113539092"></p>
<p>我们可以根据rownum来取结果集的前几行，比如前5行</p>
<p>​	<img src="/img/image-20201227113719820.png" alt="image-20201227113719820"></p>
<p>但是我们不能取到中间几行，因为rownum不支持大于号，只支持小于号，如果想实现我们的需求怎么办呢？</p>
<p>答案是：使用子查询，也正是oracle分页的做法。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> (<span style="color:#66d9ef">select</span> rownum r,emp.<span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> emp) b <span style="color:#66d9ef">where</span> b.r<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">5</span> <span style="color:#66d9ef">and</span> b.r<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">11</span>
</code></pre></div><p>​</p>
<hr>
<h3 id="第二章">第二章</h3>
<hr>
<h5 id="本章内容-1">本章内容</h5>
<ul>
<li>视图[应用]</li>
<li>索引[应用]</li>
<li>pl/sql 基本语法[了解]</li>
<li>存储过程[理解]</li>
<li>存储函数[理解]</li>
<li>java程序调用存储过程</li>
</ul>
<hr>
<p>​</p>
<h4 id="21-视图应用">2.1 视图[应用]</h4>
<p>视图：是从一个或多个表导出的虚拟的表，其内容由查询定义。具有普通表的结构，但是不实现数据存储。</p>
<p>作用：</p>
<p>​	①简化了操作，把经常使用的数据定义为视图。</p>
<p>​	②安全性，用户只能查询和修改能看到的数据。</p>
<p>​	③逻辑上的独立性，屏蔽了真实表的结构带来的影响。</p>
<p>视图就是封装了一条复杂查询的语句。</p>
<p>语法1：CREATE VIEW 视图名称 AS 子查询</p>
<p>范例：建立一个视图，此视图包括了20部门的全部员工信息</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">view</span> empvd20 <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> emp t <span style="color:#66d9ef">where</span> t.deptno<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>
</code></pre></div><p>视图创建完毕就可以使用视图来查询，查询出来的都是20部门</p>
<p>​	<img src="/img/image-20201227115528186.png" alt="image-20201227115528186"></p>
<p>语法2：CREATE OR REPLACE VIEW 视图名称 AS 子查询</p>
<p>如果视图已经存在我们可以使用语法2来创建视图，这样已有的视图会被覆盖。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">or</span> <span style="color:#66d9ef">replace</span> <span style="color:#66d9ef">view</span> empvd20 <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> emp t <span style="color:#66d9ef">where</span> t.deptno<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>
</code></pre></div><p>那么视图可以修改吗？</p>
<p>​	<img src="/img/image-20201227115828815.png" alt="image-20201227115828815"></p>
<p>​	<img src="/img/clip_image004-1609034568788.jpg" alt="img"></p>
<p>我们尝试着修改视图但是发现是视图所查询的表的字段值被修改了。所以我们一般不会去修改视图。</p>
<p>我们可以设置视图为只读。</p>
<p>语法 3：CREATE OR REPLACE VIEW 视图名称 AS 子查询 WITH READ ONLY</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">or</span> <span style="color:#66d9ef">replace</span> <span style="color:#66d9ef">view</span> empvd20 <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> emp t <span style="color:#66d9ef">where</span> t.deptno <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span> <span style="color:#66d9ef">with</span> <span style="color:#66d9ef">read</span> <span style="color:#66d9ef">only</span> 
</code></pre></div><p>尝试修改，失败！！</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">update</span> empvd20 t <span style="color:#66d9ef">set</span> t.EMPNO<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;史密斯&#39;</span>;
</code></pre></div><p>​	<img src="/img/image-20201227120135387.png" alt="image-20201227120135387"></p>
<h4 id="22-索引应用">2.2 索引[应用]</h4>
<p>索引是用于加速数据存取的数据对象。合理的使用索引可以大大降低 i/o 次数,从而提高数据访问性能。</p>
<p>为什么添加了索引之后，会加快查询速度呢？</p>
<p><strong>图书馆</strong>：如果杂乱地放书的话检索起来就非常困难,所以将书分类，然后再建一个箱子，箱子里面放卡片，卡片里面可以按类查询,按书名查或者类别查,这样的话速度会快很多很多，这个就有点像索引。索引的好处就是提高你找到书的速度，但是正是因为你建了索引，就应该有人专门来维护索引，维护索引是要有时间精力的开销的，也就是说索引是不能乱建的，所以建索引有个原则：如果有一个字段如果不经常查询，就不要去建索引。现在把书变成我们的表，把卡片变成我们的索引，就知道为什么索引会快，为什么会有开销。</p>
<p>索引有很多种，主要介绍常用的几种:</p>
<p>1． 单列索引</p>
<p>单列索引是基于单个列所建立的索引，比如:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">index</span> <span style="color:#960050;background-color:#1e0010">索引名</span> <span style="color:#66d9ef">on</span> <span style="color:#960050;background-color:#1e0010">表名</span>(<span style="color:#960050;background-color:#1e0010">列名</span>)
<span style="color:#66d9ef">Create</span> <span style="color:#66d9ef">index</span> emp_idx  <span style="color:#66d9ef">on</span> emp(ename)
</code></pre></div><p>2． 复合索引</p>
<p>复合索引是基于两个列或多个列的索引。在同一张表上可以有多个索引，但是要求列的组合必须不同,比如：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">Create</span> <span style="color:#66d9ef">index</span> emp_idx1 <span style="color:#66d9ef">on</span> emp(ename,job); 
<span style="color:#66d9ef">Create</span> <span style="color:#66d9ef">index</span> emp_idx1 <span style="color:#66d9ef">on</span> emp(job,ename);
</code></pre></div><p>索引的使用原则：</p>
<ul>
<li>
<p>在大表上建立索引才有意义</p>
</li>
<li>
<p>在 where 子句后面或者是连接条件上的字段建立索引</p>
</li>
<li>
<p>表中数据修改频率高时不建议建立索引</p>
</li>
</ul>
<h4 id="23-plsql-基本语法了解">2.3 pl/sql 基本语法[了解]</h4>
<p>什么是PL/SQL?</p>
<p>PL/SQL（Procedure Language/SQL） 是Oracle 对sql 语言的过程化扩展，指在SQL 命令语言中增加了过程处理语句（如分支、循环等），使 SQL 语言具有过程处理能力。把 SQL 语言的数据操纵能力与过程语言的数据处理能力结合起来，使得PLSQL 面向过程但比过程语言简单、高效、灵活和实用。</p>
<p>范例 1：为职工涨工资，每人涨 10％的工资。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">update</span> emp <span style="color:#66d9ef">set</span> sal<span style="color:#f92672">=</span>sal<span style="color:#f92672">*</span><span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">1</span>
</code></pre></div><p>范例 2：按职工的职称长工资,总裁涨 1000 元,经理涨800 元，其他人员涨 400 元。</p>
<p>这样的需求我们就无法使用一条 SQL 来实现，需要借助其他程序来帮助完成，也可以使用 pl/sql。</p>
<h5 id="1plsql-程序语法">1.pl/sql 程序语法</h5>
<p>程序语法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">declare</span> 
	<span style="color:#960050;background-color:#1e0010">说明部分（变量说明，游标申明，例外说明</span> <span style="color:#960050;background-color:#1e0010">〕</span>
<span style="color:#66d9ef">begin</span>
	<span style="color:#960050;background-color:#1e0010">语句序列</span>	<span style="color:#960050;background-color:#1e0010">（</span>DML <span style="color:#960050;background-color:#1e0010">语句〕…</span>
<span style="color:#66d9ef">exception</span>
	<span style="color:#960050;background-color:#1e0010">例外处理语句</span>
<span style="color:#66d9ef">End</span>;
</code></pre></div><h5 id="2常量和变量定义">2.常量和变量定义</h5>
<p>在程序的声明阶段可以来定义常量和变量。</p>
<ul>
<li>
<p>变量的基本类型</p>
<p>oracle 中的建表时字段的变量如 char, varchar2, date, number, boolean, long</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">varl  char(<span style="color:#ae81ff">15</span>);
Psal  number(<span style="color:#ae81ff">9</span>,<span style="color:#ae81ff">2</span>);
</code></pre></div><p>​	说明变量名、数据类型和长度后用分号结束说明语句。</p>
<ul>
<li>常量定义</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">married constant boolean:<span style="color:#f92672">=</span><span style="color:#66d9ef">true</span>
</code></pre></div><ul>
<li>引用变量</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">Myname  emp.ename<span style="color:#f92672">%</span><span style="color:#66d9ef">type</span>;
</code></pre></div><p>引用型变量，即my_name 的类型与emp 表中 ename 列的类型一样，在 sql 中使用into 来赋值</p>
<pre><code class="language-plsql" data-lang="plsql">declare
	emprec emp.ename%type; 
begin
	select t.ename into emprec from emp t where t.empno = 7369;
	dbms_output.put_line(emprec); -- 输出打印
end;
</code></pre><ul>
<li>记录型变量</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">Emprec  emp<span style="color:#f92672">%</span>rowtype
</code></pre></div><p>记录变量分量的引用 emp_rec.ename:='ADAMS&rsquo;;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">declare</span>
	p emp<span style="color:#f92672">%</span>rowtype;
<span style="color:#66d9ef">begin</span>
	<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">into</span> p <span style="color:#66d9ef">from</span> emp t <span style="color:#66d9ef">where</span> t.empno <span style="color:#f92672">=</span> <span style="color:#ae81ff">7369</span>; 
	dbms_output.put_line(p.ename <span style="color:#f92672">||</span> <span style="color:#e6db74">&#39; &#39;</span> <span style="color:#f92672">||</span> p.sal); <span style="color:#75715e">-- || 连接符
</span><span style="color:#75715e"></span><span style="color:#66d9ef">end</span>;
</code></pre></div><h5 id="3-if分支">3. if分支</h5>
<p>语法 1：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">IF</span> <span style="color:#960050;background-color:#1e0010">条件</span> <span style="color:#66d9ef">THEN</span> <span style="color:#960050;background-color:#1e0010">语句</span> <span style="color:#ae81ff">1</span>;
<span style="color:#960050;background-color:#1e0010">语句</span><span style="color:#ae81ff">2</span>; 
<span style="color:#66d9ef">END</span> <span style="color:#66d9ef">IF</span>;
</code></pre></div><p>范例 1：如果从控制台输入 1 则输出我是 1</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">Declare</span>
    <span style="color:#75715e">-- 定义变量从键盘的输入
</span><span style="color:#75715e"></span>    pnum number:<span style="color:#f92672">=&amp;</span>num; 
<span style="color:#66d9ef">begin</span>
    <span style="color:#66d9ef">if</span> pnum <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">then</span>
    	dbms_output.put_line(<span style="color:#e6db74">&#39;我是1&#39;</span>); 
    <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">if</span>;
<span style="color:#66d9ef">end</span>;
</code></pre></div><p>语法 2：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">IF</span> <span style="color:#960050;background-color:#1e0010">条件</span> <span style="color:#66d9ef">THEN</span>  <span style="color:#960050;background-color:#1e0010">语句序列</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">；</span>
<span style="color:#66d9ef">ELSE</span> <span style="color:#960050;background-color:#1e0010">语句序列</span><span style="color:#ae81ff">2</span><span style="color:#960050;background-color:#1e0010">；</span>
<span style="color:#66d9ef">END</span> <span style="color:#66d9ef">IF</span><span style="color:#960050;background-color:#1e0010">；</span>
</code></pre></div><p>范例 2：如果从控制台输入 1 则输出我是 1 否则输出我不是 1</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">declare</span>
	mynum number:<span style="color:#f92672">=&amp;</span>num; 
<span style="color:#66d9ef">begin</span>
    <span style="color:#66d9ef">if</span> mynum <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">then</span>
    	dbms_output.put_line(<span style="color:#e6db74">&#39;我是1&#39;</span>); 
    <span style="color:#66d9ef">else</span>
    	dbms_output.put_line(<span style="color:#e6db74">&#39;我不是1&#39;</span>);
    <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">if</span>; 
<span style="color:#66d9ef">end</span>;
</code></pre></div><p>语法 3：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">IF</span> <span style="color:#960050;background-color:#1e0010">条件</span> <span style="color:#66d9ef">THEN</span> <span style="color:#960050;background-color:#1e0010">语句</span>;
<span style="color:#66d9ef">ELSIF</span> <span style="color:#960050;background-color:#1e0010">语句</span> <span style="color:#66d9ef">THEN</span> <span style="color:#960050;background-color:#1e0010">语句</span>;
<span style="color:#66d9ef">ELSE</span>  <span style="color:#960050;background-color:#1e0010">语句</span>;
<span style="color:#66d9ef">END</span> <span style="color:#66d9ef">IF</span>;
</code></pre></div><p>范例 3:判断人的不同年龄段 18 岁以下是未成年人，18 岁以上 40 以下是成年人，40 以上是老年人</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">declare</span>
	mynum number:<span style="color:#f92672">=&amp;</span>num; 
<span style="color:#66d9ef">begin</span>
    <span style="color:#66d9ef">if</span> mynum <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">18</span> <span style="color:#66d9ef">then</span>
    	dbms_output.put_line(<span style="color:#e6db74">&#39;未成年人&#39;</span>); 
    <span style="color:#66d9ef">elsif</span> mynum <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">18</span> <span style="color:#66d9ef">and</span> mynum <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">40</span> <span style="color:#66d9ef">then</span>
    	dbms_output.put_line(<span style="color:#e6db74">&#39;中年人&#39;</span>); 
    <span style="color:#66d9ef">elsif</span> mynum <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">40</span> <span style="color:#66d9ef">then</span>
    	dbms_output.put_line(<span style="color:#e6db74">&#39;老年人&#39;</span>);
    <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">if</span>; 
<span style="color:#66d9ef">end</span>;
</code></pre></div><h5 id="4loop-循环语句">4.LOOP 循环语句</h5>
<p>语法 1：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">WHILE  total  <span style="color:#f92672">&lt;=</span> 25000  LOOP                                  
    <span style="color:#f92672">..</span> <span style="color:#f92672">.</span>

total <span style="color:#f92672">:</span> <span style="color:#f92672">=</span> total <span style="color:#f92672">+</span> salary<span style="color:#f92672">;</span>   <span style="color:#f92672">--</span> <span style="color:#f92672">:=</span> 赋值语句
END LOOP<span style="color:#f92672">;</span>
</code></pre></div><p>范例: 使用语法 1 输出 1 到 10 的数字</p>
<pre><code class="language-plsql" data-lang="plsql">declare
    step number := 1;
begin
    while step&lt;=10 loop
        dbms_output.put_line(step);
		step:=step+1;
	end loop;
end;
</code></pre><p>语法 2：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Loop
EXIT <span style="color:#f92672">[</span>when 条件<span style="color:#f92672">];</span>

<span style="color:#960050;background-color:#1e0010">……</span> End loop
</code></pre></div><p>范例: 使用语法 1 输出 1 到 10 的数字</p>
<pre><code class="language-plsql" data-lang="plsql">declare
    step number := 1;
begin
    loop
    	exit when step&gt;10;
        dbms_output.put_line(step);
		step:=step+1;
	end loop;
end;
</code></pre><p>语法 3：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">FOR I IN 1 <span style="color:#f92672">.</span> <span style="color:#f92672">.</span> 3 LOOP
语句序列<span style="color:#f92672">;</span>
END LOOP<span style="color:#f92672">;</span>
</code></pre></div><p>范例: 使用语法 1 输出 1 到 10 的数字</p>
<pre><code class="language-plsql" data-lang="plsql">declare
    step number := 1;
begin
    for step in 1 .. 10 loop
        dbms_output.put_line(step);
	end loop;
end;
</code></pre><h5 id="5-游标cursor">5. 游标Cursor</h5>
<p>在写 java 程序中有集合的概念，那么在 pl/sql 中也会用到多条记录，这时候我们就要用到游标，游标可以存储查询返回的多条数据。</p>
<p>游标：位于内存中的 &ldquo;临时表&rdquo;。 具体如下：游标是从数据表中提取出来的数据，以 <strong>临时表</strong> 的形式存放到内存中，在游标中有一个 <strong>数据指针</strong>， <strong>在初始状态下指向的是首记录</strong>，利用 fetch 语句可以移动该指针，从而对游标中的数据进行各种操作，然后将操作结果写回到数据库中。</p>
<p><img src="/img/clip_image008-1609034568788.jpg" alt="img"></p>
<p>语法：CURSOR  游标名 [ (参数名 数据类型,参数名 数据类型,&hellip;)]  IS SELECT  语句;</p>
<pre><code class="language-plsql" data-lang="plsql">cursor c1 is select ename from emp;
</code></pre><p>游标的使用步骤：</p>
<ul>
<li>
<p>打开游标：open c1;    (打开游标执行查询)</p>
</li>
<li>
<p>取一行游标的值：fetch c1 into pjob;  (取一行到变量中)</p>
</li>
<li>
<p>关闭游标：close  c1;  (关闭游标释放资源)</p>
</li>
<li>
<p>游标的结束方式  exit when c1%notfound</p>
</li>
</ul>
<p>注意： 上面的pjob 必须与emp 表中的job 列类型一致！定义：pjob  emp.empjob%type;</p>
<p>范例 1：使用游标方式输出emp 表中的员工编号和姓名</p>
<pre><code class="language-plsql" data-lang="plsql">declare 
	cursor pc is select * from emp; 
    pemp emp%rowtype;
begin
    open pc; 
    loop
        fetch pc into pemp;
    	exit when pc%notfound;
		dbms_output.put_line(pemp.empno || ' ' || pemp.ename); 
	end loop;
	close pc; 
end;
</code></pre><p>游标的作用：</p>
<ul>
<li>用来查询数据库，获取记录集合（结果集）的指针，可以让开发者 一次访问一行结果集， 在每条结果集上作操作。</li>
<li>用 ‘牺牲内存’ 来提升 SQL 执行效率，适用于 <strong>大数据处理</strong>。</li>
</ul>
<p>范例 2：按员工的工种涨工资,总裁 1000 元，经理涨 800 元其他人员涨 400 元。</p>
<pre><code class="language-plsql" data-lang="plsql">-- 备份出一张新表为myemp;
create table myemp as select * from emp;
declare 
	cursor pc is select * from myemp; 
	addsal myemp.sal%type; 
	pemp  myemp%rowtype;
begin
    open pc; 
	loop
    	fetch pc into pemp;
		exit when pc%notfound;
		if pemp.job = 'PRESIDENT' then addsal := 1000;
		elsif pemp.job = 'MANAGER' then addsal := 800;
        else addsal := 400;
        end if;
		update myemp t set t.sal = t.sal + addsal where t.empno = pemp.empno;
	end loop; 
	close pc;
end;
</code></pre><p>范例 ：写一段PL/SQL 程序，为部门号为 10 的员工涨工资。</p>
<pre><code class="language-plsql" data-lang="plsql">declare
    cursor pc(dno myemp.deptno%type) is
    select empno from myemp where deptno = dno; 
	pno myemp.empno%type;
begin
    open pc(10); 
	loop
    	fetch pc into pno;
		exit when pc%notfound;
		update myemp t set t.sal = t.sal + 1000 where t.empno = pno; 
	end loop;
	close pc; 
end;
</code></pre><h4 id="24-存储过程理解">2.4 存储过程[理解]</h4>
<p>存储过程（Stored  Procedure）是在大型数据库系统中，一组为了完成特定功能的 SQL  语句集，经编译后存储在数据库中，用户通过指定存储过程的名字并给出参数（如果该存储过程带有参数）来执行它。存储过程是数据库中的一个重要对象，任何一个设计良好的数据库应用程序都应该用到存储过程。</p>
<p>创建存储过程语法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">create <span style="color:#f92672">[</span>or replace<span style="color:#f92672">]</span> PROCEDURE 过程名<span style="color:#f92672">[(</span>参数名 in<span style="color:#f92672">/</span>out 数据类型<span style="color:#f92672">)]</span> AS
begin
	PLSQL 子程序体<span style="color:#960050;background-color:#1e0010">；</span>
End<span style="color:#f92672">;</span>
</code></pre></div><p>或者</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">create <span style="color:#f92672">[</span>or replace<span style="color:#f92672">]</span> PROCEDURE 过程名<span style="color:#f92672">[(</span>参数名 in<span style="color:#f92672">/</span>out 数据类型<span style="color:#f92672">)]</span> is
begin
	PLSQL 子程序体<span style="color:#960050;background-color:#1e0010">；</span>
End 过程名<span style="color:#f92672">;</span>
</code></pre></div><p>范例：创建一个输出helloword 的存储过程</p>
<pre><code class="language-plsql" data-lang="plsql">create or replace procedure helloworld is 
begin
	dbms_output.put_line('helloworld'); 
end helloworld;
</code></pre><p>调用存储过程，在plsql 中调用存储过程</p>
<pre><code class="language-plsql" data-lang="plsql">begin
    -- Call the procedure
    helloworld; 
end;
</code></pre><p>范例 2：给指定的员工涨 100 工资，并打印出涨前和涨后的工资分析：我们需要使用带有参数的存储过程</p>
<pre><code class="language-plsql" data-lang="plsql">create or replace procedure addSal1(eno in number) is pemp myemp%rowtype;
begin
	select * into pemp from myemp where empno = eno; 
	update myemp set sal = sal + 100 where empno = eno;
	dbms_output.put_line(' 涨工资前' || pemp.sal || ' 涨工资后' || (pemp.sal + 100));
end addSal1;
</code></pre><p>调用</p>
<pre><code class="language-plsql" data-lang="plsql">begin
	-- Call the procedure 
    addsal1(eno =&gt; 7902); 
	commit;
end;
</code></pre><h4 id="25-存储函数理解">2.5 存储函数[理解]</h4>
<pre><code class="language-plsql" data-lang="plsql">create or replace function 函数名(Name in type, Name in type, ...) return 数据类型 is 
	结果变量 数据类型; 
begin
	return(结果变量);
end 函数名;
</code></pre><p>存储过程和存储函数的区别？</p>
<p>一般来讲，过程和函数的区别在于函数可以有一个返回值；而过程没有返回值。</p>
<p>但过程和函数都可以通过out 指定一个或多个输出参数。可以利用 out 参数，在过程和函数中实现返回多个值。</p>
<p>范例：使用存储函数来查询指定员工的年薪</p>
<pre><code class="language-plsql" data-lang="plsql">create or replace function empincome(eno in emp.empno%type) return number is
    psal  emp.sal%type; 
	pcomm emp.comm%type;
begin
    select t.sal,t.comm into psal,pcomm from emp t where t.empno = eno; 
	return psal * 12 + nvl(pcomm, 0);
end;
</code></pre><p>调用存储函数：</p>
<pre><code class="language-plsql" data-lang="plsql">select empincome(7369) from dual
</code></pre><p>使用存储过程来替换上面的例子</p>
<pre><code class="language-plsql" data-lang="plsql">create or replace procedure empincomep(eno in emp.empno%type, income out number) is
    psal emp.sal%type; 
	pcomm emp.comm%type;
begin
    select t.sal, t.comm into psal, pcomm from emp t where t.empno= eno;
	income:= psal*12+nvl(pcomm,0); 
end empincomep;
</code></pre><p>调用：</p>
<pre><code class="language-plsql" data-lang="plsql">declare
	income number; 
begin
	empincomep(7369, income);
	dbms_output.put_line(income); 
end;
</code></pre><p>​</p>
<h4 id="26-java程序调用存储过程">2.6 java程序调用存储过程</h4>
<h5 id="连接oracle">连接oracle:</h5>
<ol>
<li>Pom引入依赖坐标</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;dependencies&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>com.oracle<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>ojdbc14<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;version&gt;</span>10.2.0.4.0<span style="color:#f92672">&lt;/version&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>junit<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>junit<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;version&gt;</span>4.12<span style="color:#f92672">&lt;/version&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
<span style="color:#f92672">&lt;/dependencies&gt;</span>
</code></pre></div><ol start="2">
<li>编写测试方法</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">javaCallOracle</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
    <span style="color:#75715e">//加载数据库驱动
</span><span style="color:#75715e"></span>    Class<span style="color:#f92672">.</span><span style="color:#a6e22e">forName</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;oracle.jdbc.driver.OracleDriver&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#75715e">//得到Connection连接
</span><span style="color:#75715e"></span>    Connection connection <span style="color:#f92672">=</span> DriverManager<span style="color:#f92672">.</span><span style="color:#a6e22e">getConnection</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;jdbc:oracle:thin:@192.168.125.6:1521:orcl&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;scott&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;tiger&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#75715e">//得到预编译的Statement对象
</span><span style="color:#75715e"></span>    PreparedStatement pstm <span style="color:#f92672">=</span> connection<span style="color:#f92672">.</span><span style="color:#a6e22e">prepareStatement</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;select * from emp where empno = ?&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#75715e">//给参数赋值
</span><span style="color:#75715e"></span>    pstm<span style="color:#f92672">.</span><span style="color:#a6e22e">setObject</span><span style="color:#f92672">(</span>1<span style="color:#f92672">,</span> 7788<span style="color:#f92672">);</span>
    <span style="color:#75715e">//执行数据库查询操作
</span><span style="color:#75715e"></span>    ResultSet rs <span style="color:#f92672">=</span> pstm<span style="color:#f92672">.</span><span style="color:#a6e22e">executeQuery</span><span style="color:#f92672">();</span>
    <span style="color:#75715e">//输出结果
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span>rs<span style="color:#f92672">.</span><span style="color:#a6e22e">next</span><span style="color:#f92672">()){</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>rs<span style="color:#f92672">.</span><span style="color:#a6e22e">getString</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ename&#34;</span><span style="color:#f92672">));</span>
    <span style="color:#f92672">}</span>
    <span style="color:#75715e">//释放资源
</span><span style="color:#75715e"></span>    rs<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
    pstm<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
    connection<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="实现过程的调用">实现过程的调用</h5>
<p>调用过程</p>
<ol>
<li>存储过程定义</li>
</ol>
<pre><code class="language-plsql" data-lang="plsql">--统计年薪的过程
create or replace procedure proc_countyearsal(eno in number,esal out number)as 
begin
    select sal*12+nvl(comm,0) into esal from emp where empno=eno; 
end;

--调用
declare
    esal number; 
begin
    proc_countyearsal(7839,esal); 
	dbms_output.put_line(esal);
end;
</code></pre><ol start="2">
<li>存储过程调用</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e"> * java调用存储过程
</span><span style="color:#75715e"> *   {call &lt;procedure-name&gt;[(&lt;arg1&gt;,&lt;arg2&gt;, ...)]}   调用存储过程使用
</span><span style="color:#75715e"> * @throws Exception
</span><span style="color:#75715e"> */</span>
<span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">javaCallProcedure</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
    <span style="color:#75715e">//加载数据库驱动
</span><span style="color:#75715e"></span>    Class<span style="color:#f92672">.</span><span style="color:#a6e22e">forName</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;oracle.jdbc.driver.OracleDriver&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#75715e">//得到Connection连接
</span><span style="color:#75715e"></span>    Connection connection <span style="color:#f92672">=</span> DriverManager<span style="color:#f92672">.</span><span style="color:#a6e22e">getConnection</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;jdbc:oracle:thin:@192.168.125.6:1521:orcl&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;scott&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;tiger&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#75715e">//得到预编译的Statement对象
</span><span style="color:#75715e"></span>    CallableStatement pstm <span style="color:#f92672">=</span> connection<span style="color:#f92672">.</span><span style="color:#a6e22e">prepareCall</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;{call proc_countyearsal(?, ?)}&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#75715e">//给参数赋值
</span><span style="color:#75715e"></span>    pstm<span style="color:#f92672">.</span><span style="color:#a6e22e">setObject</span><span style="color:#f92672">(</span>1<span style="color:#f92672">,</span> 7788<span style="color:#f92672">);</span>
    pstm<span style="color:#f92672">.</span><span style="color:#a6e22e">registerOutParameter</span><span style="color:#f92672">(</span>2<span style="color:#f92672">,</span> OracleTypes<span style="color:#f92672">.</span><span style="color:#a6e22e">NUMBER</span><span style="color:#f92672">);</span>
    <span style="color:#75715e">//执行数据库查询操作
</span><span style="color:#75715e"></span>    pstm<span style="color:#f92672">.</span><span style="color:#a6e22e">execute</span><span style="color:#f92672">();</span>
    <span style="color:#75715e">//输出结果[第二个参数]
</span><span style="color:#75715e"></span>    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>pstm<span style="color:#f92672">.</span><span style="color:#a6e22e">getObject</span><span style="color:#f92672">(</span>2<span style="color:#f92672">));</span>
    <span style="color:#75715e">//释放资源
</span><span style="color:#75715e"></span>    pstm<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
    connection<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
</code></pre></div></div>
  
</article></main>
<footer class="footer">
  <span>&copy; 2021 <a href="https://xshi000.github.io/">及时当勉励，岁月不待人！@iNuo</a></span>
  <span>&middot;</span>
  <span>Powered by <a href="https://gohugo.io/" rel="noopener" target="_blank">Hugo️️</a>️</span>
  <span>&middot;</span>
  <span>Theme️ <a href="https://github.com/nanxiaobei/hugo-paper" rel="noopener" target="_blank">Paper</a></span>
</footer>
<script src="https://xshi000.github.io/highlight.min.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>
</body>
</html>

