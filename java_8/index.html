<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <title>极简Java八：MySql数据库 - 及时当勉励，岁月不待人！@iNuo</title>
    
    <meta name="description" content="第一章  本章内容  学习目标 数据库的介绍 数据库的安装与卸载 数据库服务的启动与登录 SQL 的概念 DDL 操作数据库 DDL 操作表结构 DML 操作表中的数据 DQL 查询表中的数据   1.1 学习目标   能够理解数据库的概念
  能够安装 MySQL 数据库
  能够启动,关闭及登录 MySQL
  能够使用 SQL 语句操作数据库
  能够使用 SQL 语句操作表结构
  能够使用 SQL 语句进行数据的添加修改和删除的操作
  能够使用 SQL 语句简单查询数据
  1.2 数据库的介绍 数据库概述 数据的存储方式
  Java 中创建对象： Student s = new Student(1, &ldquo;张三&rdquo;) 存在内存中">
    <meta name="author" content="">
    
    <link href="https://xshi000.github.io/an-old-hope.min.css" rel="stylesheet">
    <link href="https://xshi000.github.io/style.css" rel="stylesheet">
    <link href="https://xshi000.github.io/custom.css" rel="stylesheet">
    
    <link rel="apple-touch-icon" href="https://xshi000.github.io/apple-touch-icon.png">
    <link rel="icon" href="https://xshi000.github.io/favicon.ico">
    <meta name="generator" content="Hugo 0.65.3" />
    
    
    
    <script>
      function setTheme() {
        const time = new Date();

        const prev = localStorage.getItem('date');
        const date = String(time.getMonth() + 1) + '.' + String(time.getDate());

        const now = time.getTime();
        let sunrise;
        let sunset;

        function setBodyClass() {
          if (now > sunrise && now < sunset) return;
          document.body.classList.add('dark');
        }

        if (date !== prev) {
          fetch('https://api.ipgeolocation.io/astronomy?apiKey=5ed37d85103e4defa5df4c5298ed5215')
            .then(res => res.json())
            .then(data => {
              sunrise = data.sunrise.split(':').map(Number);
              sunset = data.sunset.split(':').map(Number);
            })
            .catch(() => {
              sunrise = [7, 0];
              sunset = [19, 0];
            })
            .finally(() => {
              sunrise = time.setHours(sunrise[0], sunrise[1], 0);
              sunset = time.setHours(sunset[0], sunset[1], 0);
              setBodyClass();
              localStorage.setItem('sunrise', sunrise);
              localStorage.setItem('sunset', sunset);
            });
          localStorage.setItem('date', date);
        } else {
          sunrise = Number(localStorage.getItem('sunrise'));
          sunset = Number(localStorage.getItem('sunset'));
          setBodyClass();
        }
      }
    </script>
  </head>
  <body class="single">
    <script>
      setTheme();
    </script>
    <header class="header">
      <nav class="nav">
        <p class="logo"><a href="https://xshi000.github.io/">及时当勉励，岁月不待人！@iNuo</a></p>
      </nav>
    </header>
    <main class="main">


<article class="post-single">
  <header class="post-header">
    <h1 class="post-title">极简Java八：MySql数据库</h1>
    <div class="post-meta">January 26, 2021</div>
  </header>
  <div class="post-content"><hr>
<h3 id="第一章">第一章</h3>
<hr>
<h5 id="本章内容">本章内容</h5>
<ul>
<li>学习目标</li>
<li>数据库的介绍</li>
<li>数据库的安装与卸载</li>
<li>数据库服务的启动与登录</li>
<li>SQL 的概念</li>
<li>DDL 操作数据库</li>
<li>DDL 操作表结构</li>
<li>DML 操作表中的数据</li>
<li>DQL 查询表中的数据</li>
</ul>
<hr>
<h4 id="11-学习目标">1.1 学习目标</h4>
<ol>
<li>
<p>能够理解数据库的概念</p>
</li>
<li>
<p>能够安装 MySQL 数据库</p>
</li>
<li>
<p>能够启动,关闭及登录 MySQL</p>
</li>
<li>
<p>能够使用 SQL 语句操作数据库</p>
</li>
<li>
<p>能够使用 SQL 语句操作表结构</p>
</li>
<li>
<p>能够使用 SQL 语句进行数据的添加修改和删除的操作</p>
</li>
<li>
<p>能够使用 SQL 语句简单查询数据</p>
</li>
</ol>
<h4 id="12-数据库的介绍">1.2 数据库的介绍</h4>
<h5 id="数据库概述">数据库概述</h5>
<p>数据的存储方式</p>
<ul>
<li>
<p>Java 中创建对象： Student s = new Student(1, &ldquo;张三&rdquo;) 存在内存中</p>
</li>
<li>
<p>学习了 Java IO 流：把数据保存到文件中</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>存储位置</th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody>
<tr>
<td>内存</td>
<td>速度快</td>
<td>不能永久保存，数据是临时状态。</td>
</tr>
<tr>
<td>文件</td>
<td>数据可以永久保存</td>
<td>操作数据不方便，查询某个数据。</td>
</tr>
<tr>
<td>数据库</td>
<td>1)  数据可以永久保存  <!-- raw HTML omitted -->2)  查询速度快  <!-- raw HTML omitted -->3)  对数据的管理方便</td>
<td>占用资源，需要购买。</td>
</tr>
</tbody>
</table>
<p>什么是数据库</p>
<p>​	1)   存储数据的仓库</p>
<p>​	2)   本质上是一个文件系统，还是以文件的方式存在服务器的电脑上的。</p>
<h5 id="常见数据库排行榜">常见数据库排行榜</h5>
<p>​         <img src="/img/clip_image002-1608725672790.jpg" alt="img"></p>
<ul>
<li>MySQL：开源免费的数据库，小型的数据库，已经被 Oracle 收购了。MySQL6.x 版本也开始收费。后来 Sun</li>
</ul>
<p>公司收购了 MySQL，而 Sun 公司又被 Oracle 收购</p>
<ul>
<li>Oracle：收费的大型数据库，Oracle 公司的产品。</li>
</ul>
<p>​     <img src="/img/clip_image004-1608725672793.jpg" alt="img"></p>
<ul>
<li>
<p>DB2 ：IBM 公司的数据库产品,收费的。常应用在银行系统中。</p>
</li>
<li>
<p>SQL Server：MicroSoft 公司收费的中型的数据库。C#、.net 等语言常使用。</p>
</li>
</ul>
<p>​     <img src="/img/clip_image006-1608725672793.jpg" alt="img"></p>
<ul>
<li>SQLite: 嵌入式的小型数据库，应用在手机端，如：Android。</li>
</ul>
<p>为什么选择 MySQL</p>
<p>​	1)   免费</p>
<p>​	2)   功能强大</p>
<h4 id="13-数据库的安装与卸载">1.3 数据库的安装与卸载</h4>
<p>安装过程分成两个部分：</p>
<p>​	1)  文件解压和复制过程，默认的安装目录：</p>
<p>​	2)  安装好以后必须对 MySQL 服务器进行配置在 mysql 中管理员的名字：root</p>
<h5 id="数据库的安装">数据库的安装</h5>
<h5 id="mysql的安装">MYSQL的安装</h5>
<p>１、打开下载的mysql安装文件mysql-5.5.27-win32.zip，双击解压缩，运行“setup.exe”。</p>
<p><img src="/img/clip_image002-1608725048928.jpg" alt="img"></p>
<p>２、选择安装类型，有“Typical（默认）”、“Complete（完全）”、“Custom（用户自定义）”三个选项，选择“Custom”，按“next”键继续。</p>
<p><img src="/img/clip_image006-1608725048931.jpg" alt="img"></p>
<p>３、点选“Browse”，手动指定安装目录。</p>
<p><img src="/img/clip_image008.jpg" alt="img"></p>
<p>４、填上安装目录，我的是“F:\Server\MySQL\MySQL Server 5.0”，也建议不要放在与操作系统同一分区，这样可以防止系统备份还原的时候，数据被清空。按“OK”继续。</p>
<p><img src="/img/clip_image010.jpg" alt="img"></p>
<p>确认一下先前的设置，如果有误，按“Back”返回重做。按“Install”开始安装。</p>
<p><img src="/img/clip_image012-1608725048932.jpg" alt="img"></p>
<p><img src="/img/clip_image014.jpg" alt="img"></p>
<p><img src="/img/clip_image016-1608725048932.jpg" alt="img"></p>
<p>５、正在安装中，请稍候，直到出现下面的界面, 则完成MYSQL的安装</p>
<p><img src="/img/clip_image018-1608725048932.jpg" alt="img"></p>
<h5 id="mysql的配置">MYSQL的配置</h5>
<p>１、安装完成了，出现如下界面将进入mysql配置向导。</p>
<p><img src="/img/clip_image020.jpg" alt="img"></p>
<p>２、选择配置方式，“Detailed Configuration（手动精确配置）”、“Standard Configuration（标准配置）”，我们选择“Detailed Configuration”，方便熟悉配置过程。</p>
<p><img src="/img/clip_image022.jpg" alt="img"></p>
<p>３、选择服务器类型，“Developer Machine（开发测试类，mysql占用很少资源）”、“Server Machine（服务器类型，mysql占用较多资源）”、“Dedicated MySQL Server Machine（专门的数据库服务器，mysql占用所有可用资源）”</p>
<p><img src="/img/clip_image024.jpg" alt="img"></p>
<p>４、选择mysql数据库的大致用途，“Multifunctional Database（通用多功能型，好）”、“Transactional Database Only（服务器类型，专注于事务处理，一般）”、“Non-Transactional Database Only（非事务处理型，较简单，主要做一些监控、记数用，对MyISAM数据类型的支持仅限于non-transactional），按“Next”继续。</p>
<p><img src="/img/clip_image026.jpg" alt="img"></p>
<p>５、选择网站并发连接数，同时连接的数目，“Decision Support(DSS)/OLAP（20个左右）”、“Online Transaction Processing(OLTP)（500个左右）”、“Manual Setting（手动设置，自己输一个数）”。</p>
<p><img src="/img/clip_image028.jpg" alt="img"></p>
<p>６、是否启用TCP/IP连接，设定端口，如果不启用，就只能在自己的机器上访问mysql数据库了，在这个页面上，您还可以选择“启用标准模式”（Enable Strict Mode），这样MySQL就不会允许细小的语法错误。如果是新手，建议您取消标准模式以减少麻烦。但熟悉MySQL以后，尽量使用标准模式，因为它可以降低有害数据进入数据库的可能性。按“Next”继续</p>
<p><img src="/img/clip_image032.jpg" alt="img"></p>
<p>７、就是对mysql默认数据库语言编码进行设置（重要），一般选UTF-8，按 “Next”继续。</p>
<p><img src="/img/clip_image034.jpg" alt="img"></p>
<p>８、选择是否将mysql安装为windows服务，还可以指定Service Name（服务标识名称），是否将mysql的bin目录加入到Windows PATH（加入后，就可以直接使用bin下的文件，而不用指出目录名，比如连接，“mysql.exe -uusername -ppassword;”就可以了，不用指出mysql.exe的完整地址，很方便），我这里全部打上了勾，Service Name不变。按“Next”继续。</p>
<p><img src="/img/clip_image036.jpg" alt="img"></p>
<p>９、询问是否要修改默认root用户（超级管理）的密码。“Enable root access from remote machines（是否允许root用户在其它的机器上登陆，如果要安全，就不要勾上，如果要方便，就勾上它）”。最后“Create An Anonymous Account（新建一个匿名用户，匿名用户可以连接数据库，不能操作数据，包括查询）”，一般就不用勾了，设置完毕，按“Next”继续。</p>
<p><img src="/img/clip_image038.jpg" alt="img"></p>
<p>１０、确认设置无误，按“Execute”使设置生效，即完成MYSQL的安装和配置。</p>
<p><img src="/img/clip_image040.jpg" alt="img"></p>
<p><img src="/img/clip_image042.jpg" alt="img"></p>
<p>注意：设置完毕，按“Finish”后有一个比较常见的错误，就是不能“Start service”，一般出现在以前有安装mysql的服务器上，解决的办法，先保证以前安装的mysql服务器彻底卸载掉了；不行的话，检查是否按上面一步所说，之前的密码是否有修改，照上面的操作；如果依然不行，将mysql安装目录下的data文件夹备份，然后删除，在安装完成后，将安装生成的 data文件夹删除，备份的data文件夹移回来，再重启mysql服务就可以了，这种情况下，可能需要将数据库检查一下，然后修复一次，防止数据出错。</p>
<p><img src="/img/clip_image044.jpg" alt="img"></p>
<p>解决方法：</p>
<p>1, 卸载MySQL</p>
<p>2, Windows Xp系统删除目录 C:\Documents and Settings\All Users\Application Data\</p>
<p>windows 7\8\10操作系统删除目录C:\ProgramData\MySQL</p>
<p>3、重新安装就可以了</p>
<h5 id="数据库的卸载">数据库的卸载</h5>
<ol>
<li>停止 window 的 MySQL 服务。 找到“控制面板”-&gt; “管理工具”-&gt; “服务”，停止 MySQL 后台服务。</li>
</ol>
<p>​      <img src="/img/clip_image010-1608725672794.jpg" alt="img"></p>
<ol start="2">
<li>卸载 MySQL 安装程序。找到“控制面板”-&gt; &ldquo;程序和功能&rdquo;，卸载 MySQL 程序。</li>
</ol>
<p>​     <img src="/img/clip_image012-1608725672794.jpg" alt="img"></p>
<ol start="3">
<li>
<p>删除 MySQL 安装目录下的所有文件。</p>
</li>
<li>
<p>删除 c 盘 ProgramDate 目录中关于 MySQL 的目录。路径为：C:\ProgramData\MySQL(是隐藏文件,需要显示出来)</p>
</li>
</ol>
<p><img src="/img/clip_image014-1608725672796.jpg" alt="img"></p>
<h4 id="14-数据库服务的启动与登录">1.4 数据库服务的启动与登录</h4>
<p>MySQL 服务器启动方式有两种：</p>
<p>​	1)  通过服务的方式自动启动</p>
<p>​	2)  手动启动的方式</p>
<h5 id="windows-服务方式启动">Windows 服务方式启动</h5>
<p>操作步骤：</p>
<p>​                 <img src="/img/clip_image016-1608725672797.jpg" alt="img"></p>
<h5 id="dos-命令方式启动">DOS 命令方式启动</h5>
<p>操作步骤：  DOS输入：net start MySQL80</p>
<p><img src="/img/clip_image018-1608725672797.jpg" alt="img"></p>
<h5 id="控制台连接数据库">控制台连接数据库</h5>
<p>MySQL 是一个需要账户名密码登录的数据库，登陆后使用，它提供了一个默认的 root 账号，使用安装时设置的密码即可登录</p>
<ul>
<li>登录格式 1：u 和 p 后面没有空格 ! 本例：mysql -uroot -p123456</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql <span style="color:#f92672">-</span>u用户名 <span style="color:#f92672">-</span>p密码  

<span style="color:#75715e">#后输入密码方式
</span><span style="color:#75715e"></span>mysql <span style="color:#f92672">-</span>u<span style="color:#f92672">-</span>u用户名 <span style="color:#f92672">-</span>p
</code></pre></div><p><img src="/img/clip_image020-1608725672797.jpg" alt="img"></p>
<p><img src="/img/clip_image022-1608725672797.jpg" alt="img"></p>
<ul>
<li>登录格式 2：多用于连接远程数据库服务器。其中，127.0.0.1 代表本机的 IP 地址。</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql <span style="color:#f92672">-</span>hip地址 <span style="color:#f92672">-</span>u用户名 <span style="color:#f92672">-</span>p密码
</code></pre></div><p><img src="/img/clip_image024-1608725672798.jpg" alt="img"></p>
<p>退出 MySQL：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">quit <span style="color:#960050;background-color:#1e0010">或</span> <span style="color:#66d9ef">exit</span> 
</code></pre></div><p>​</p>
<h5 id="sqlyog-图形化工具客户端">SQLyog 图形化工具——客户端</h5>
<p>SQLyog 是业界著名的Webyog 公司出品的一款简洁高效、功能强大的图形化MySQL 数据库管理工具。使用</p>
<p>SQLyog 可以快速直观地让您从世界的任何角落通过网络来维护远端的 MySQL 数</p>
<p>使用 SQLyog 登录数据库</p>
<p><img src="/img/clip_image026-1608725672798.jpg" alt="img"></p>
<h5 id="mysql-目录结构">MySQL 目录结构</h5>
<table>
<thead>
<tr>
<th>MySQL 的目录结构</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>bin&lt;目录&gt;</td>
<td>所有 mysql 的可执行文件，如：mysql.exe</td>
</tr>
<tr>
<td>MySQLInstanceConfig.exe</td>
<td>数据库的配置向导，在安装时出现的内容</td>
</tr>
<tr>
<td>data&lt;目录&gt;</td>
<td>系统必须的数据库所在的目录</td>
</tr>
<tr>
<td>my.ini 文件</td>
<td>mysql 的配置文件，一般不建议去修改。</td>
</tr>
<tr>
<td>c:\ProgramData\MySQL\MySQ  L Server 5.5\data\</td>
<td>我们自己创建的数据库所在的文件夹</td>
</tr>
</tbody>
</table>
<h5 id="数据库管理系统">数据库管理系统</h5>
<p>数据库管理系统（DataBase Management System，DBMS）：指一种操作和管理数据库的大型软件，用于建立、使用和维护数据库，对数据库进行统一管理和控制，以保证数据库的安全性和完整性。用户通过数据库管理系统访问数据库中表内的数据</p>
<h5 id="数据库管理系统数据库和表的关系">数据库管理系统、数据库和表的关系</h5>
<p>数据库管理程序(DBMS)可以管理多个数据库，一般开发人员会针对每一个应用创建一个数据库。为保存应用中实体的数据，一般会在数据库创建多个表，以保存程序中实体 User 的数据。</p>
<p>数据库管理系统、数据库和表的关系如图所示：</p>
<p><img src="/img/clip_image028-1608725672798.jpg" alt="img"></p>
<p>结论：</p>
<p>​	1)   一个数据库服务器包含多个库</p>
<p>​	2)   一个数据库包含多张表</p>
<p>​	3)   一张表包含多条记录</p>
<h4 id="15-sql-的概念">1.5 SQL 的概念</h4>
<h5 id="什么是-sql">什么是 SQL</h5>
<p>Structured Query Language 结构化查询语言</p>
<h5 id="sql-作用">SQL 作用</h5>
<p>​	1)   是一种所有关系型数据库的查询规范，不同的数据库都支持。</p>
<p>​	2)   通用的数据库操作语言，可以用在不同的数据库中。</p>
<p>​	3)   不同的数据库 SQL 语句有一些区别</p>
<h5 id="sql-语句分类">SQL 语句分类</h5>
<p>​	1)     Data Definition Language (DDL 数据定义语言) 如：建库，建表</p>
<p>​	2)     Data Manipulation Language(DML 数据操纵语言)，如：对表中的记录操作增删改</p>
<p>​	3)     Data Query Language(DQL 数据查询语言)，如：对表中的查询操作</p>
<p>​	4)     Data Control Language(DCL 数据控制语言)，如：对用户权限的设置</p>
<h5 id="mysql-的语法">MySQL 的语法</h5>
<p>​	1)  每条语句以分号结尾，如果在 SQLyog 中不是必须加的。</p>
<p>​	2)  SQL 中不区分大小写，关键字中认为大写和小写是一样的</p>
<p>​	3)  3 种注释：</p>
<table>
<thead>
<tr>
<th>注释的语法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>&ndash;空格</td>
<td>单行注释</td>
</tr>
<tr>
<td>/ /</td>
<td>多行注释</td>
</tr>
<tr>
<td>#</td>
<td>这是 mysql 特有的注释方式</td>
</tr>
</tbody>
</table>
<h4 id="16-ddl-操作数据库">1.6 DDL 操作数据库</h4>
<h5 id="创建数据库">创建数据库</h5>
<p>创建数据库的几种方式</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e"># 创建数据库
</span><span style="color:#75715e"></span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> <span style="color:#960050;background-color:#1e0010">数据库名</span>;  

<span style="color:#75715e"># 判断数据库是否已经存在，不存在则创建数据库 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span> <span style="color:#960050;background-color:#1e0010">数据库名</span>;

<span style="color:#75715e"># 创建数据库并指定字符集
</span><span style="color:#75715e"></span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> <span style="color:#960050;background-color:#1e0010">数据库名</span> <span style="color:#66d9ef">CHARACTER</span> <span style="color:#66d9ef">SET</span> <span style="color:#960050;background-color:#1e0010">字符集</span>;                                                
</code></pre></div><p>具体操作：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 直接创建数据库 db1 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">database</span> db1;

<span style="color:#75715e">-- 判断是否存在，如果不存在则创建数据库 db2 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">database</span> <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">exists</span> db2;

<span style="color:#75715e">-- 创建数据库并指定字符集为 gbk
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">database</span> db3 <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">character</span> <span style="color:#66d9ef">set</span> gbk;
</code></pre></div><h5 id="查看数据库">查看数据库</h5>
<p>按 tab 键可以自动补全关键字</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 查看所有的数据库
</span><span style="color:#75715e"></span><span style="color:#66d9ef">show</span> <span style="color:#66d9ef">databases</span>;

<span style="color:#75715e">-- 查看某个数据库的定义信息 show 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">database</span> db3; <span style="color:#66d9ef">show</span> 
<span style="color:#66d9ef">create</span> <span style="color:#66d9ef">database</span> db1;
</code></pre></div><h5 id="修改数据库">修改数据库</h5>
<p>修改数据库默认的字符集</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">DATABASE</span> <span style="color:#960050;background-color:#1e0010">数据库名</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">CHARACTER</span> <span style="color:#66d9ef">SET</span> <span style="color:#960050;background-color:#1e0010">字符集</span>; 
</code></pre></div><p>具体操作：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 将 db3 数据库的字符集改成 utf8
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">database</span> db3 <span style="color:#66d9ef">character</span> <span style="color:#66d9ef">set</span> utf8;
</code></pre></div><h5 id="删除数据库">删除数据库</h5>
<p>删除数据库的语法</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">DATABASE</span> <span style="color:#960050;background-color:#1e0010">数据库名</span>;  
</code></pre></div><p>具体操作：每行 SQL 语句需要选中再执行，可以按 F9</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 删除 db2 数据库
</span><span style="color:#75715e"></span><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">database</span> db2;
</code></pre></div><h5 id="使用数据库">使用数据库</h5>
<p>查看正在使用的数据库</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">DATABASE</span>(); <span style="color:#75715e">-- 使用的一个 mysql 中的全局函数       
</span></code></pre></div><p>使用/切换数据库</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">USE</span> <span style="color:#960050;background-color:#1e0010">数据库名</span>;                             
</code></pre></div><p>具体操作：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 查看正在使用的数据库
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#66d9ef">database</span>();

<span style="color:#75715e">-- 改变要使用的数据库
</span><span style="color:#75715e"></span><span style="color:#66d9ef">use</span> db4; 
</code></pre></div><h4 id="17-ddl-操作表结构">1.7 DDL 操作表结构</h4>
<p>前提先使用某个数据库</p>
<h5 id="创建表">创建表</h5>
<p>创建表的格式</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#960050;background-color:#1e0010">表名</span> (  
    <span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#ae81ff">1</span> <span style="color:#960050;background-color:#1e0010">字段类型</span> <span style="color:#ae81ff">1</span>,  
    <span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#ae81ff">2</span> <span style="color:#960050;background-color:#1e0010">字段类型</span> <span style="color:#ae81ff">2</span>  
);  
</code></pre></div><p>​    Mysql的数据类型：</p>
<p>​    <img src="/img/clip_image035.jpg" alt="img"></p>
<p>详细数据类型如下：</p>
<table>
<thead>
<tr>
<th>分类</th>
<th>类型名称</th>
<th>类型说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>整数</td>
<td>tinyInt</td>
<td>微整型：很小的整数(占 8 位二进制)</td>
</tr>
<tr>
<td></td>
<td>smallint</td>
<td>小整型：小的整数(占 16 位二进制)</td>
</tr>
<tr>
<td></td>
<td>mediumint</td>
<td>中整型：中等长度的整数(占 24 位二进制)</td>
</tr>
<tr>
<td></td>
<td>int(integer)</td>
<td>整型：整数类型(占 32 位二进制)</td>
</tr>
<tr>
<td>小数</td>
<td>float</td>
<td>单精度浮点数，占  4 个字节</td>
</tr>
<tr>
<td></td>
<td>double</td>
<td>双精度浮点数，占 8 个字节</td>
</tr>
<tr>
<td>日期</td>
<td>time</td>
<td>表示时间类型</td>
</tr>
<tr>
<td></td>
<td>date</td>
<td>表示日期类型</td>
</tr>
<tr>
<td></td>
<td>datetime</td>
<td>同时可以表示日期和时间类型</td>
</tr>
<tr>
<td>字符串</td>
<td>char(m)</td>
<td>固定长度的字符串，无论使用几个字符都占满全部，M 为 0~255 之间的整数</td>
</tr>
<tr>
<td></td>
<td>varchar(m)</td>
<td>可变长度的字符串，使用几个字符就占用几个，M 为 0~65535 之间的整数</td>
</tr>
<tr>
<td>大二进制</td>
<td>tinyblob  Big Large Object</td>
<td>允许长度 0~255 字节</td>
</tr>
<tr>
<td></td>
<td>blob</td>
<td>允许长度 0~65535 字节</td>
</tr>
<tr>
<td></td>
<td>mediumblob</td>
<td>允许长度 0~167772150 字节</td>
</tr>
<tr>
<td></td>
<td>longblob</td>
<td>允许长度 0~4294967295 字节</td>
</tr>
<tr>
<td>大文本</td>
<td>tinytext</td>
<td>允许长度 0~255 字节</td>
</tr>
<tr>
<td></td>
<td>text</td>
<td>允许长度 0~65535 字节</td>
</tr>
<tr>
<td></td>
<td>mediumtext</td>
<td>允许长度 0~167772150 字节</td>
</tr>
<tr>
<td></td>
<td>longtext</td>
<td>允许长度 0~4294967295 字节</td>
</tr>
</tbody>
</table>
<p>具体操作:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">use</span> db1; 

<span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> <span style="color:#a6e22e">student</span> ( 
    id <span style="color:#66d9ef">int</span>, <span style="color:#75715e">-- 整数
</span><span style="color:#75715e"></span>	name <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">20</span>), <span style="color:#75715e">-- 字符串
</span><span style="color:#75715e"></span>	birthday <span style="color:#66d9ef">date</span> <span style="color:#75715e">-- 生日，最后没有逗号
</span><span style="color:#75715e"></span>);
</code></pre></div><h5 id="查看表">查看表</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 查看某个数据库中的所有表
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SHOW</span> <span style="color:#66d9ef">TABLES</span>;  

<span style="color:#75715e">-- 查看表结构
</span><span style="color:#75715e"></span><span style="color:#66d9ef">DESC</span> <span style="color:#960050;background-color:#1e0010">表名</span>;

<span style="color:#75715e">-- 查看创建表的 SQL 语句
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SHOW</span> <span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#960050;background-color:#1e0010">表名</span>;
</code></pre></div><p>具体操作：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 查看 day21 数据库中的所有表
</span><span style="color:#75715e"></span><span style="color:#66d9ef">use</span> day21; 
<span style="color:#66d9ef">show</span> <span style="color:#66d9ef">tables</span>;

<span style="color:#75715e">-- 查看 student 表的结构
</span><span style="color:#75715e"></span><span style="color:#66d9ef">desc</span> student;
</code></pre></div><p>执行结果：</p>
<p><img src="/img/image-20201223211306933.png" alt="image-20201223211306933"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 查看 student 的创建表 SQL 语句
</span><span style="color:#75715e"></span><span style="color:#66d9ef">show</span> <span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> student;
</code></pre></div><p>执行结果，，存在的目的是为了避免关键字的冲突</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#f92672">`</span>student<span style="color:#f92672">`</span> (

<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span> <span style="color:#66d9ef">int</span>(<span style="color:#ae81ff">11</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>,

<span style="color:#f92672">`</span>name<span style="color:#f92672">`</span> <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>,

<span style="color:#f92672">`</span>birthday<span style="color:#f92672">`</span> <span style="color:#66d9ef">date</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>

) <span style="color:#66d9ef">ENGINE</span><span style="color:#f92672">=</span>InnoDB <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">CHARSET</span><span style="color:#f92672">=</span>utf8
</code></pre></div><h5 id="快速创建一个表结构相同的表">快速创建一个表结构相同的表</h5>
<p>语法</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"> <span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#960050;background-color:#1e0010">新表名</span> <span style="color:#66d9ef">LIKE</span> <span style="color:#960050;background-color:#1e0010">旧表名</span>;  
</code></pre></div><p>具体操作：创建 s1 表，s1 表结构和 student 表结构相同</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 创建一个 s1 的表与 student 结构相同 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> s1 <span style="color:#66d9ef">like</span> student;
<span style="color:#66d9ef">desc</span> s1;
</code></pre></div><h5 id="删除表">删除表</h5>
<p>直接删除表</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"> <span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#960050;background-color:#1e0010">表名</span>;  
</code></pre></div><p>判断表是否存在，如果存在则删除表</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"> <span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">EXISTS</span> <span style="color:#960050;background-color:#1e0010">表名</span>;                                 
</code></pre></div><p>具体操作：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 直接删除表 s1 表
</span><span style="color:#75715e"></span><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">table</span> s1;

<span style="color:#75715e">-- 判断表是否存在并删除 s1 表
</span><span style="color:#75715e"></span><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">table</span> <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">exists</span> s1;  
</code></pre></div><ul>
<li>与直接删除的区别</li>
</ul>
<p>如果表不存在，不删除，存在则删除</p>
<h5 id="修改表结构">修改表结构</h5>
<p>添加表列 ADD</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#960050;background-color:#1e0010">表名</span> <span style="color:#66d9ef">ADD</span> <span style="color:#960050;background-color:#1e0010">列名</span> <span style="color:#960050;background-color:#1e0010">类型</span>;                                          
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 为学生表添加一个新的字段 remark,类型为 varchar(20)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> student <span style="color:#66d9ef">add</span> remark <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">20</span>);
</code></pre></div><p>修改列类型 MODIFY</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">  <span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#960050;background-color:#1e0010">表名</span> MODIFY <span style="color:#960050;background-color:#1e0010">列名</span> <span style="color:#960050;background-color:#1e0010">新的类型</span>;  
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 将 student 表中的 remark 字段的改成 varchar(100)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> student modify remark <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">100</span>);
</code></pre></div><p><img src="/img/image-20201223212256876.png" alt="image-20201223212256876"></p>
<p>修改列名 CHANGE</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#960050;background-color:#1e0010">表名</span> <span style="color:#66d9ef">CHANGE</span> <span style="color:#960050;background-color:#1e0010">旧列名</span> <span style="color:#960050;background-color:#1e0010">新列名</span> <span style="color:#960050;background-color:#1e0010">类型</span>;
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 将 student 表中的 remark 字段名改成 intro，类型 varchar(30)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> student <span style="color:#66d9ef">change</span> remark intro <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">30</span>);
</code></pre></div><p><img src="/img/image-20201223212532958.png" alt="image-20201223212532958"></p>
<p>删除列 DROP</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#960050;background-color:#1e0010">表名</span> <span style="color:#66d9ef">DROP</span> <span style="color:#960050;background-color:#1e0010">列名</span>;                                       
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 删除 student 表中的字段 intro
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> student <span style="color:#66d9ef">DROP</span> intro;
</code></pre></div><p><img src="/img/image-20201223212748658.png" alt="image-20201223212748658"></p>
<p>修改表名</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">RENAME</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#960050;background-color:#1e0010">表名</span> <span style="color:#66d9ef">TO</span> <span style="color:#960050;background-color:#1e0010">新表名</span>;   
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 将学生表 student 改名成 student2  
</span><span style="color:#75715e"></span><span style="color:#66d9ef">rename</span> <span style="color:#66d9ef">table</span> student <span style="color:#66d9ef">to</span> student2;
</code></pre></div><p>修改字符集 character set</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#960050;background-color:#1e0010">表名</span> <span style="color:#66d9ef">character</span> <span style="color:#66d9ef">set</span> <span style="color:#960050;background-color:#1e0010">字符集</span>;                              
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 将 student2 表的编码修改成 gbk 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> student2 <span style="color:#66d9ef">character</span> <span style="color:#66d9ef">set</span> gbk;
</code></pre></div><h4 id="18-dml-操作表中的数据">1.8 DML 操作表中的数据</h4>
<p>用于对表中的记录进行增删改操作</p>
<h5 id="插入记录">插入记录</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">INSERT</span>  [<span style="color:#66d9ef">INTO</span>] <span style="color:#960050;background-color:#1e0010">表名</span> [<span style="color:#960050;background-color:#1e0010">字段名</span>]  <span style="color:#66d9ef">VALUES</span> (<span style="color:#960050;background-color:#1e0010">字段值</span>)  

<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#960050;background-color:#1e0010">表名：表示往哪张表中添加数据</span>  
  (<span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#ae81ff">1</span>,   <span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#ae81ff">2</span>, <span style="color:#960050;background-color:#1e0010">…</span>)<span style="color:#960050;background-color:#1e0010">：要给哪些字段设置值</span>  
  <span style="color:#66d9ef">VALUES</span> (<span style="color:#960050;background-color:#1e0010">值</span> <span style="color:#ae81ff">1</span>,   <span style="color:#960050;background-color:#1e0010">值</span> <span style="color:#ae81ff">2</span>, <span style="color:#960050;background-color:#1e0010">…</span>)<span style="color:#960050;background-color:#1e0010">：设置具体的值</span>  
</code></pre></div><ul>
<li>插入全部字段</li>
</ul>
<p>所有的字段名都写出来</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">  <span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#960050;background-color:#1e0010">表名</span>  (<span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#ae81ff">1</span>, <span style="color:#960050;background-color:#1e0010">字段名</span>  <span style="color:#ae81ff">2</span>,  <span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">…</span>) <span style="color:#66d9ef">VALUES</span> (<span style="color:#960050;background-color:#1e0010">值</span> <span style="color:#ae81ff">1</span>, <span style="color:#960050;background-color:#1e0010">值</span>  <span style="color:#ae81ff">2</span>,  <span style="color:#960050;background-color:#1e0010">值</span> <span style="color:#ae81ff">3</span>);  
</code></pre></div><p>不写字段名</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"> <span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#960050;background-color:#1e0010">表名</span> <span style="color:#66d9ef">VALUES</span> (<span style="color:#960050;background-color:#1e0010">值</span> <span style="color:#ae81ff">1</span>, <span style="color:#960050;background-color:#1e0010">值</span> <span style="color:#ae81ff">2</span>, <span style="color:#960050;background-color:#1e0010">值</span> <span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">…</span>); 
</code></pre></div><p>​</p>
<ul>
<li>插入部分数据</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#960050;background-color:#1e0010">表名</span> (<span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#ae81ff">1</span>, <span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#ae81ff">2</span>, ...) <span style="color:#66d9ef">VALUES</span> (<span style="color:#960050;background-color:#1e0010">值</span> <span style="color:#ae81ff">1</span>, <span style="color:#960050;background-color:#1e0010">值</span> <span style="color:#ae81ff">2</span>, ...);
</code></pre></div><p>注：没有添加数据的字段会使用 NULL</p>
<p>具体操作: 插入所有的列，向学生表中</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">student</span> (id,name,age,sex) <span style="color:#66d9ef">values</span> (<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;孙悟空&#39;</span>, <span style="color:#ae81ff">20</span>, <span style="color:#e6db74">&#39;男&#39;</span>);
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">student</span> (id,name,age,sex) <span style="color:#66d9ef">values</span> (<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;孙悟天&#39;</span>, <span style="color:#ae81ff">16</span>, <span style="color:#e6db74">&#39;男&#39;</span>);
</code></pre></div><p>向表中插入所有字段</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 插入所有列
</span><span style="color:#75715e"></span><span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> student <span style="color:#66d9ef">values</span> (<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#39;孙悟饭&#39;</span>, <span style="color:#ae81ff">18</span>, <span style="color:#e6db74">&#39;男&#39;</span>, <span style="color:#e6db74">&#39;龟仙人洞中&#39;</span>);

<span style="color:#75715e">-- 如果只插入部分列，必须写列名
</span><span style="color:#75715e"></span><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#a6e22e">student</span> (id,NAME) <span style="color:#66d9ef">VALUES</span> (<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#39;孙悟饭&#39;</span>);

<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student;
</code></pre></div><p>执行效果</p>
<p><img src="/img/image-20201223213608042.png" alt="image-20201223213608042"></p>
<h5 id="dos-命令窗口操作数据乱码问题的解决">DOS 命令窗口操作数据乱码问题的解决</h5>
<p>当我们使用 DOS 命令行进行 SQL 语句操作如有有中文会出现乱码</p>
<p><img src="/img/image-20201223213704095.png" alt="image-20201223213704095"></p>
<p>insert 的注意事项：</p>
<p>​	1)   插入的数据应与字段的数据类型相同</p>
<p>​	2)   数据的大小应在列的规定范围内，例如：不能将一个长度为 80 的字符串加入到长度为 40 的列中。</p>
<p>​	3)   在 values 中列出的数据位置必须与被加入的列的排列位置相对应。在 mysql 中可以使用 value，但不建议使用，功能与 values 相同。</p>
<p>​	4)   字符和日期型数据应包含在单引号中。MySQL 中也可以使用双引号做为分隔符。</p>
<p>​	5)   不指定列或使用 null，表示插入空值。</p>
<p>乱码产生的原因</p>
<p><img src="/img/image-20201223213753148.png" alt="image-20201223213753148"></p>
<p>查看 MySQL 内部设置的编码</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 查看包含 character 开头的全局变量
</span><span style="color:#75715e"></span><span style="color:#66d9ef">show</span> variables <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;character%&#39;</span>;    
</code></pre></div><p>执行效果</p>
<p><img src="/img/image-20201223213902400.png" alt="image-20201223213902400"></p>
<p>解决方案</p>
<p>修改 client、connection、results 的编码为 GBK，保证和 DOS 命令行编码保持一致</p>
<p><img src="/img/image-20201223213927514.png" alt="image-20201223213927514"></p>
<table>
<thead>
<tr>
<th>单独设置</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>set character_set_client=gbk;</td>
<td>修改客户端的字符集为 GBK</td>
</tr>
<tr>
<td>set  character_set_connection=gbk;</td>
<td>修改连接的字符集为  GBK</td>
</tr>
<tr>
<td>set character_set_results=gbk;</td>
<td>修改查询的结果字符集为 GBK</td>
</tr>
</tbody>
</table>
<p>同时设置三项</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">set</span> names gbk; 
</code></pre></div><p>注意：退出 DOS 命令行就失效了，需要每次都配置</p>
<p><img src="/img/image-20201223214047788.png" alt="image-20201223214047788"></p>
<h5 id="蠕虫复制">蠕虫复制</h5>
<p>什么是蠕虫复制：将一张已经存在的表中的数据复制到另一张表中。</p>
<p>语法格式：将表名 2 中的所有的列复制到表名 1 中</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#960050;background-color:#1e0010">表名</span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> <span style="color:#960050;background-color:#1e0010">表名</span><span style="color:#ae81ff">2</span>;   

<span style="color:#75715e">-- 只复制部分列
</span><span style="color:#75715e"></span><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#960050;background-color:#1e0010">表名</span><span style="color:#ae81ff">1</span>(<span style="color:#960050;background-color:#1e0010">列</span><span style="color:#ae81ff">1</span>, <span style="color:#960050;background-color:#1e0010">列</span><span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">SELECT</span> <span style="color:#960050;background-color:#1e0010">列</span><span style="color:#ae81ff">1</span>, <span style="color:#960050;background-color:#1e0010">列</span><span style="color:#ae81ff">2</span> <span style="color:#66d9ef">FROM</span> student;  
</code></pre></div><p>具体操作:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 创建 student2 表，student2 结构和 student 表结构一样
</span><span style="color:#75715e"></span><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">table</span> student2;
<span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> student2 <span style="color:#66d9ef">like</span> student;

<span style="color:#75715e">-- 将 student 表中的数据添加到 student2 表中
</span><span style="color:#75715e"></span><span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> student2 <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student;

<span style="color:#75715e">-- 如果只想复制 student 表中 name,age 字段数据到 student2 表中，两张表都写出相应的列名
</span><span style="color:#75715e"></span><span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">student2</span> (name,age) <span style="color:#66d9ef">select</span> name,age <span style="color:#66d9ef">from</span> student;

<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student2;
</code></pre></div><h5 id="更新表记录">更新表记录</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">UPDATE</span> <span style="color:#960050;background-color:#1e0010">表名</span> <span style="color:#66d9ef">SET</span> <span style="color:#960050;background-color:#1e0010">列名</span><span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">值</span> [<span style="color:#66d9ef">WHERE</span> <span style="color:#960050;background-color:#1e0010">条件表达式</span>]

<span style="color:#66d9ef">UPDATE</span>: <span style="color:#960050;background-color:#1e0010">需要更新的表名</span>
<span style="color:#66d9ef">SET</span>: <span style="color:#960050;background-color:#1e0010">修改的列值</span>
<span style="color:#66d9ef">WHERE</span>: <span style="color:#960050;background-color:#1e0010">符合条件的记录才更新</span>
</code></pre></div><ul>
<li>
<p>你可以同时更新一个或多个字段。</p>
</li>
<li>
<p>你可以在 WHERE子句中指定任何条件。</p>
</li>
</ul>
<p>不带条件修改数据</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">UPDATE</span> <span style="color:#960050;background-color:#1e0010">表名</span> <span style="color:#66d9ef">SET</span> <span style="color:#960050;background-color:#1e0010">字段名</span><span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">值</span>; <span style="color:#75715e">-- 修改所有的行         
</span></code></pre></div><p>带条件修改数据</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">UPDATE</span> <span style="color:#960050;background-color:#1e0010">表名</span> <span style="color:#66d9ef">SET</span> <span style="color:#960050;background-color:#1e0010">字段名</span><span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">值</span> <span style="color:#66d9ef">WHERE</span> <span style="color:#960050;background-color:#1e0010">字段名</span><span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">值</span>;        
</code></pre></div><p>具体操作：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 不带条件修改数据，将所有的性别改成女
</span><span style="color:#75715e"></span><span style="color:#66d9ef">update</span> student <span style="color:#66d9ef">set</span> sex <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;女&#39;</span>;

<span style="color:#75715e">-- 带条件修改数据，将 id 号为 2 的学生性别改成男
</span><span style="color:#75715e"></span><span style="color:#66d9ef">update</span> student <span style="color:#66d9ef">set</span> sex<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;男&#39;</span> <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>;

<span style="color:#75715e">-- 一次修改多个列，把 id 为 3 的学生，年龄改成 26 岁，address 改成北京
</span><span style="color:#75715e"></span><span style="color:#66d9ef">update</span> student <span style="color:#66d9ef">set</span> age<span style="color:#f92672">=</span><span style="color:#ae81ff">26</span>, address<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;北京&#39;</span> <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>;
</code></pre></div><h5 id="删除表记录">删除表记录</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"> <span style="color:#66d9ef">DELETE</span> <span style="color:#66d9ef">FROM</span> <span style="color:#960050;background-color:#1e0010">表名</span> [<span style="color:#66d9ef">WHERE</span> <span style="color:#960050;background-color:#1e0010">条件表达式</span>]
</code></pre></div><p>如果没有指定 WHERE 子句，MySQL 表中的所有记录将被删除。你可以在 WHERE 子句中指定任何条件!</p>
<p>不带条件删除数据</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">DELETE</span> <span style="color:#66d9ef">FROM</span> <span style="color:#960050;background-color:#1e0010">表名</span>;                     
</code></pre></div><p>带条件删除数据</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"> <span style="color:#66d9ef">DELETE</span> <span style="color:#66d9ef">FROM</span> <span style="color:#960050;background-color:#1e0010">表名</span>   <span style="color:#66d9ef">WHERE</span> <span style="color:#960050;background-color:#1e0010">字段名</span><span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">值</span>;  
</code></pre></div><p>使用 truncate 删除表中所有记录</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">  TRUNCATE <span style="color:#66d9ef">TABLE</span> <span style="color:#960050;background-color:#1e0010">表名</span>;  
</code></pre></div><p>truncate 和 delete 的区别：truncate 相当于删除表的结构，再创建一张表。</p>
<p>具体操作：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 带条件删除数据，删除 id 为 1 的记录
</span><span style="color:#75715e"></span><span style="color:#66d9ef">delete</span> <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>;

<span style="color:#75715e">-- 不带条件删除数据,删除表中的所有数据
</span><span style="color:#75715e"></span><span style="color:#66d9ef">delete</span> <span style="color:#66d9ef">from</span> student;
</code></pre></div><h4 id="19-dql-查询表中的数据">1.9 DQL 查询表中的数据</h4>
<p>查询不会对数据库中的数据进行修改.只是一种显示数据的方式</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"> <span style="color:#66d9ef">SELECT</span> <span style="color:#960050;background-color:#1e0010">列名</span> <span style="color:#66d9ef">FROM</span> <span style="color:#960050;background-color:#1e0010">表名</span> [<span style="color:#66d9ef">WHERE</span> <span style="color:#960050;background-color:#1e0010">条件表达式</span>]
</code></pre></div><ol>
<li>
<pre><code>SELECT 命令可以读取一行或者多行记录。
</code></pre>
</li>
<li>
<pre><code>你可以使用星号来代替其他字段，SELECT 语句会返回表的所有字段数据
</code></pre>
</li>
</ol>
<p>3）  你可以使用 WHERE 语句来包含任何条件。</p>
<h5 id="简单查询">简单查询</h5>
<p>查询表所有行和列的数据</p>
<p>使用*表示所有列</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> <span style="color:#960050;background-color:#1e0010">表名</span>;  
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 查询所有的学生
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student;
</code></pre></div><p>查询指定列</p>
<p>查询指定列的数据,多个列之间以逗号分隔</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SELECT</span> <span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#ae81ff">1</span>, <span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#ae81ff">2</span>, <span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#ae81ff">3</span>, ... <span style="color:#66d9ef">FROM</span> <span style="color:#960050;background-color:#1e0010">表名</span>;   
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 查询 student 表中的 name 和 age 列
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> name,age <span style="color:#66d9ef">from</span> student;
</code></pre></div><h5 id="指定列的别名进行查询">指定列的别名进行查询</h5>
<p>使用关键字</p>
<p>使用别名的好处： 显示的时候使用新的名字，并不修改表的结构。</p>
<p>语法：对列指定别名</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SELECT</span> <span style="color:#960050;background-color:#1e0010">字段名</span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">AS</span> <span style="color:#960050;background-color:#1e0010">别名</span>, <span style="color:#960050;background-color:#1e0010">字段名</span><span style="color:#ae81ff">2</span> <span style="color:#66d9ef">AS</span> <span style="color:#960050;background-color:#1e0010">别名</span>... <span style="color:#66d9ef">FROM</span> <span style="color:#960050;background-color:#1e0010">表名</span>;   
</code></pre></div><p>对列和表同时指定别名</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">  <span style="color:#66d9ef">SELECT</span> <span style="color:#960050;background-color:#1e0010">字段名</span><span style="color:#ae81ff">1</span>  <span style="color:#66d9ef">AS</span> <span style="color:#960050;background-color:#1e0010">别名</span>, <span style="color:#960050;background-color:#1e0010">字段名</span><span style="color:#ae81ff">2</span>  <span style="color:#66d9ef">AS</span> <span style="color:#960050;background-color:#1e0010">别名</span>... <span style="color:#66d9ef">FROM</span> <span style="color:#960050;background-color:#1e0010">表名</span>   <span style="color:#66d9ef">AS</span> <span style="color:#960050;background-color:#1e0010">表别名</span>;  
</code></pre></div><p>具体操作：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 使用别名
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> name <span style="color:#66d9ef">as</span> <span style="color:#960050;background-color:#1e0010">姓名</span>,age <span style="color:#66d9ef">as</span> <span style="color:#960050;background-color:#1e0010">年龄</span> <span style="color:#66d9ef">from</span> student;

<span style="color:#75715e">-- 表使用别名
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> st.name <span style="color:#66d9ef">as</span> <span style="color:#960050;background-color:#1e0010">姓名</span>,age <span style="color:#66d9ef">as</span> <span style="color:#960050;background-color:#1e0010">年龄</span> <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">as</span> st
</code></pre></div><p>表使用别名的原因：用于多表查询操作</p>
<h5 id="清除重复值">清除重复值</h5>
<p>查询指定列并且结果不出现重复数据</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">DISTINCT</span> <span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#66d9ef">FROM</span> <span style="color:#960050;background-color:#1e0010">表名</span>; 
</code></pre></div><p>具体操作：查询学Th来至于哪些地方</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 查询学Th来至于哪些地方
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> address <span style="color:#66d9ef">from</span> student;

<span style="color:#75715e">-- 去掉重复的记录
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#66d9ef">distinct</span> address <span style="color:#66d9ef">from</span> student;
</code></pre></div><h5 id="查询结果参与运算">查询结果参与运算</h5>
<p>某列数据和固定值运算</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SELECT</span> <span style="color:#960050;background-color:#1e0010">列名</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> <span style="color:#960050;background-color:#1e0010">固定值</span> <span style="color:#66d9ef">FROM</span> <span style="color:#960050;background-color:#1e0010">表名</span>;                                               
</code></pre></div><p>某列数据和其他列数据参与运算</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SELECT</span> <span style="color:#960050;background-color:#1e0010">列名</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> <span style="color:#960050;background-color:#1e0010">列名</span><span style="color:#ae81ff">2</span> <span style="color:#66d9ef">FROM</span> <span style="color:#960050;background-color:#1e0010">表名</span>; 
</code></pre></div><p>注意: 参与运算的必须是数值类型</p>
<p>需求：添加数学，英语成绩列,给每条记录添加对应的数学和英语成绩，查询的时候将数学和英语的成绩相加</p>
<p>实现：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student;

<span style="color:#75715e">-- 给所有的数学加 5 分
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> math<span style="color:#f92672">+</span><span style="color:#ae81ff">5</span> <span style="color:#66d9ef">from</span> student;

<span style="color:#75715e">-- 查询 math + english 的和
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> (math<span style="color:#f92672">+</span>english) <span style="color:#66d9ef">as</span> <span style="color:#960050;background-color:#1e0010">总成绩</span> <span style="color:#66d9ef">from</span> student;
<span style="color:#75715e">-- as 可以省略
</span></code></pre></div><h5 id="条件查询">条件查询</h5>
<p>为什么要条件查询</p>
<p>如果没有查询条件，则每次查询所有的行。实际应用中，一般要指定查询的条件。对记录进行过滤。</p>
<p>条件查询的语法</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"> <span style="color:#66d9ef">SELECT</span> <span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#66d9ef">FROM</span> <span style="color:#960050;background-color:#1e0010">表名</span> <span style="color:#66d9ef">WHERE</span> <span style="color:#960050;background-color:#1e0010">条件</span>;
</code></pre></div><p>流程：取出表中的每条数据，满足条件的记录就返回，不满足条件的记录不返回</p>
<p>准备数据：创建一个学生表，包含如下列：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#a6e22e">student3</span> ( 
    id <span style="color:#66d9ef">int</span>, <span style="color:#75715e">-- 编号
</span><span style="color:#75715e"></span>	name <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">20</span>), <span style="color:#75715e">-- 姓名
</span><span style="color:#75715e"></span>	age <span style="color:#66d9ef">int</span>, <span style="color:#75715e">-- 年龄
</span><span style="color:#75715e"></span>	sex <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">5</span>), <span style="color:#75715e">-- 性别 address varchar(100), -- 地址 math int, -- 数学
</span><span style="color:#75715e"></span>	english <span style="color:#66d9ef">int</span> <span style="color:#75715e">-- 英语
</span><span style="color:#75715e"></span>);

<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#a6e22e">student3</span>(id,NAME,age,sex,address,math,english) <span style="color:#66d9ef">VALUES</span> 
(<span style="color:#ae81ff">1</span>,<span style="color:#e6db74">&#39;马云&#39;</span>,<span style="color:#ae81ff">55</span>,<span style="color:#e6db74">&#39;男&#39;</span>,<span style="color:#e6db74">&#39;杭州&#39;</span>,<span style="color:#ae81ff">66</span>,<span style="color:#ae81ff">78</span>),
(<span style="color:#ae81ff">2</span>,<span style="color:#e6db74">&#39;马化腾&#39;</span>,<span style="color:#ae81ff">45</span>,<span style="color:#e6db74">&#39;女&#39;</span>,<span style="color:#e6db74">&#39;深圳&#39;</span>,<span style="color:#ae81ff">98</span>,<span style="color:#ae81ff">87</span>),
(<span style="color:#ae81ff">3</span>,<span style="color:#e6db74">&#39;马景涛&#39;</span>,<span style="color:#ae81ff">55</span>,<span style="color:#e6db74">&#39;男&#39;</span>,<span style="color:#e6db74">&#39;香港&#39;</span>,<span style="color:#ae81ff">56</span>,<span style="color:#ae81ff">77</span>),
(<span style="color:#ae81ff">4</span>,<span style="color:#e6db74">&#39;柳岩&#39;</span>,<span style="color:#ae81ff">20</span>,<span style="color:#e6db74">&#39;女&#39;</span>,<span style="color:#e6db74">&#39;湖南&#39;</span>,<span style="color:#ae81ff">76</span>,<span style="color:#ae81ff">65</span>),
(<span style="color:#ae81ff">5</span>,<span style="color:#e6db74">&#39;柳青&#39;</span>,<span style="color:#ae81ff">20</span>,<span style="color:#e6db74">&#39;男&#39;</span>,<span style="color:#e6db74">&#39;湖南&#39;</span>,<span style="color:#ae81ff">86</span>,<span style="color:#66d9ef">NULL</span>),
(<span style="color:#ae81ff">6</span>,<span style="color:#e6db74">&#39;刘德华&#39;</span>,<span style="color:#ae81ff">57</span>,<span style="color:#e6db74">&#39;男&#39;</span>,<span style="color:#e6db74">&#39;香港&#39;</span>,<span style="color:#ae81ff">99</span>,<span style="color:#ae81ff">99</span>),
(<span style="color:#ae81ff">7</span>,<span style="color:#e6db74">&#39;马德&#39;</span>,<span style="color:#ae81ff">22</span>,<span style="color:#e6db74">&#39;女&#39;</span>,<span style="color:#e6db74">&#39;香港&#39;</span>,<span style="color:#ae81ff">99</span>,<span style="color:#ae81ff">99</span>),
(<span style="color:#ae81ff">8</span>,<span style="color:#e6db74">&#39;德玛西亚&#39;</span>,<span style="color:#ae81ff">18</span>,<span style="color:#e6db74">&#39;男&#39;</span>,<span style="color:#e6db74">&#39;南京&#39;</span>,<span style="color:#ae81ff">56</span>,<span style="color:#ae81ff">65</span>);
</code></pre></div><p>运算符</p>
<table>
<thead>
<tr>
<th>比较运算符</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>&gt;、&lt;、&lt;=、&gt;=、=、&lt;&gt;</td>
<td>&lt;&gt;在 SQL 中表示不等于，在 mysql 中也可以使用!=  没有==</td>
</tr>
<tr>
<td>BETWEEN&hellip;AND</td>
<td>在一个范围之内，如：between 100 and  200  相当于条件在 100 到 200 之间，包头又包尾</td>
</tr>
<tr>
<td>IN(集合)</td>
<td>集合表示多个值，使用逗号分隔</td>
</tr>
<tr>
<td>LIKE &lsquo;张%&rsquo;</td>
<td>模糊查询</td>
</tr>
<tr>
<td>IS NULL</td>
<td>查询某一列为  NULL 的值，注：不能写=NULL</td>
</tr>
</tbody>
</table>
<p>具体操作：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 查询 math 分数大于 80 分的学生
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student3 <span style="color:#66d9ef">where</span> math<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">80</span>;

<span style="color:#75715e">-- 查询 english 分数小于或等于 80 分的学生
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student3 <span style="color:#66d9ef">where</span> english <span style="color:#f92672">&lt;=</span><span style="color:#ae81ff">80</span>;

<span style="color:#75715e">-- 查询 age 等于 20 岁的学生
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student3 <span style="color:#66d9ef">where</span> age <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>;

<span style="color:#75715e">-- 查询 age 不等于 20 岁的学生，注：不等于有两种写法 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student3 <span style="color:#66d9ef">where</span> age <span style="color:#f92672">&lt;&gt;</span> <span style="color:#ae81ff">20</span>; 
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student3 <span style="color:#66d9ef">where</span> age <span style="color:#f92672">!=</span> <span style="color:#ae81ff">20</span>;
</code></pre></div><p>逻辑运算符</p>
<table>
<thead>
<tr>
<th>逻辑运算符</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>and 或 &amp;&amp;</td>
<td>与，SQL 中建议使用前者，后者并不通用。</td>
</tr>
<tr>
<td>or 或 ||</td>
<td>或</td>
</tr>
<tr>
<td>not 或 !</td>
<td>非</td>
</tr>
</tbody>
</table>
<p>具体操作：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 查询 age 大于 35 且性别为男的学生(两个条件同时满足) 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student3 <span style="color:#66d9ef">where</span> age<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">35</span> <span style="color:#66d9ef">and</span> sex<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;男&#39;</span>;

<span style="color:#75715e">-- 查询 age 大于 35 或性别为男的学生(两个条件其中一个满足) 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student3 <span style="color:#66d9ef">where</span> age<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">35</span> <span style="color:#66d9ef">or</span> sex<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;男&#39;</span>;

<span style="color:#75715e">-- 查询 id 是 1 或 3 或 5 的学生
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student3 <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">or</span> id<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> <span style="color:#66d9ef">or</span> id<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>;
</code></pre></div><p>in 关键字   in 里面的每个数据都会作为一次条件，只要满足条件的就会显示</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"> <span style="color:#66d9ef">SELECT</span> <span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#66d9ef">FROM</span> <span style="color:#960050;background-color:#1e0010">表名</span> <span style="color:#66d9ef">WHERE</span> <span style="color:#960050;background-color:#1e0010">字段</span> <span style="color:#66d9ef">in</span> (<span style="color:#960050;background-color:#1e0010">数据</span><span style="color:#ae81ff">1</span>, <span style="color:#960050;background-color:#1e0010">数据</span><span style="color:#ae81ff">2</span>...);
</code></pre></div><p>具体操作：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">   <span style="color:#75715e">-- 查询id是1或3或5的学生  
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student3 <span style="color:#66d9ef">where</span> id <span style="color:#66d9ef">in</span> (<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">5</span>);

<span style="color:#75715e">-- 查询id不是 1 或 3 或 5 的学生  
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student3 <span style="color:#66d9ef">where</span> id <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">in</span> (<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">5</span>);
</code></pre></div><p>范围查询 表示从值 1 到值 2 范围，包头又包尾</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">  <span style="color:#66d9ef">BETWEEN</span> <span style="color:#960050;background-color:#1e0010">值</span><span style="color:#ae81ff">1</span>  <span style="color:#66d9ef">AND</span> <span style="color:#960050;background-color:#1e0010">值</span><span style="color:#ae81ff">2</span> 
</code></pre></div><p>比如：age  BETWEEN 80 AND 100 相当于： age&gt;=80  &amp;&amp; age&lt;=100</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 查询 english 成绩大于等于 75，且小于等于 90 的学生
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student3 <span style="color:#66d9ef">where</span> english <span style="color:#66d9ef">between</span> <span style="color:#ae81ff">75</span> <span style="color:#66d9ef">and</span> <span style="color:#ae81ff">90</span>;
</code></pre></div><p>like 关键字</p>
<p>LIKE  表示模糊查询</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"> <span style="color:#66d9ef">SELECT</span> <span style="color:#960050;background-color:#1e0010">\</span>  <span style="color:#66d9ef">FROM</span> <span style="color:#960050;background-color:#1e0010">表名</span>   <span style="color:#66d9ef">WHERE</span> <span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;通配符字符串&#39;</span>;
</code></pre></div><p>MySQL 通配符</p>
<table>
<thead>
<tr>
<th>通配符</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>%</td>
<td>匹配任意多个字符串</td>
</tr>
<tr>
<td>_</td>
<td>匹配一个字符</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">  <span style="color:#75715e">-- 查询姓马的学生  
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student3 <span style="color:#66d9ef">where</span> name <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;马%&#39;</span>; 
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student3 <span style="color:#66d9ef">where</span> name <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;马&#39;</span>; 

<span style="color:#75715e">-- 查询姓名中包含&#39;德&#39;字的学生 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student3 <span style="color:#66d9ef">where</span> name <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;%德%&#39;</span>; 

 <span style="color:#75715e">-- 查询姓马，且姓名有两个字的学生 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student3 <span style="color:#66d9ef">where</span> name <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;马_&#39;</span>; 
</code></pre></div><hr>
<h3 id="第二章">第二章</h3>
<hr>
<h5 id="本章内容-1">本章内容</h5>
<ul>
<li>学习目标</li>
<li>DQL 查询语句</li>
<li>数据库备份和还原</li>
<li>数据库表的约束</li>
<li>表与表之间的关系</li>
<li>数据库设计</li>
</ul>
<hr>
<h4 id="21-学习目标">2.1 学习目标</h4>
<ol>
<li>
<p>能够使用 SQL 语句进行排序</p>
</li>
<li>
<p>能够使用聚合函数</p>
</li>
<li>
<p>能够使用 SQL 语句进行分组查询</p>
</li>
<li>
<p>能够完成数据的备份和恢复</p>
</li>
<li>
<p>能够使用 SQL 语句添加主键、外键、唯一、非空约束</p>
</li>
<li>
<p>能够说出多表之间的关系及其建表原则</p>
</li>
<li>
<p>能够理解三大范式</p>
</li>
</ol>
<h4 id="22-dql-查询语句">2.2 DQL 查询语句</h4>
<h5 id="排序">排序</h5>
<p>通过ORDER BY子句，可以将查询出的结果进行排序(排序只是显示方式，不会影响数据库中数据的顺序)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"> <span style="color:#66d9ef">SELECT</span>   <span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#66d9ef">FROM</span> <span style="color:#960050;background-color:#1e0010">表名</span> <span style="color:#66d9ef">WHERE</span> <span style="color:#960050;background-color:#1e0010">字段</span><span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">值</span>   <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#960050;background-color:#1e0010">字段名</span> [<span style="color:#66d9ef">ASC</span><span style="color:#f92672">|</span><span style="color:#66d9ef">DESC</span>];  
</code></pre></div><ul>
<li>
<p>ASC:  升序，默认值</p>
</li>
<li>
<p>DESC: 降序</p>
</li>
</ul>
<p>单列排序</p>
<p>什么是单列排序：只按某一个字段进行排序，单列排序。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"> <span style="color:#75715e">-- 查询所有数据,使用年龄降序排序
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> age <span style="color:#66d9ef">desc</span>;
</code></pre></div><p>实现不同数据库之间表的复制</p>
<p><img src="/img/image-20201224110330088.png" alt="image-20201224110330088"></p>
<p>组合排序</p>
<p>什么是组合排序?</p>
<p>同时对多个字段进行排序，如果第 1 个字段相等，则按第 2 个字段排序，依次类推。组合排序的语法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"> <span style="color:#66d9ef">SELECT</span> <span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#66d9ef">FROM</span> <span style="color:#960050;background-color:#1e0010">表名</span> <span style="color:#66d9ef">WHERE</span> <span style="color:#960050;background-color:#1e0010">字段</span><span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">值</span> <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#960050;background-color:#1e0010">字段名</span><span style="color:#ae81ff">1</span> [<span style="color:#66d9ef">ASC</span><span style="color:#f92672">|</span><span style="color:#66d9ef">DESC</span>], <span style="color:#960050;background-color:#1e0010">字段名</span><span style="color:#ae81ff">2</span> [<span style="color:#66d9ef">ASC</span><span style="color:#f92672">|</span><span style="color:#66d9ef">DESC</span>];   
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 查询所有数据,在年龄降序排序的基础上，如果年龄相同再以数学成绩升序排序
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> age <span style="color:#66d9ef">desc</span>, math <span style="color:#66d9ef">asc</span>; 
</code></pre></div><h5 id="聚合函数">聚合函数</h5>
<p>之前我们做的查询都是横向查询，它们都是根据条件一行一行的进行判断，而使用聚合函数查询是纵向查询，它是对一列的值进行计算，然后返回一个结果值。聚合函数会忽略空值 NULL。</p>
<p>五个聚合函数</p>
<table>
<thead>
<tr>
<th>SQL 中的聚合函数</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>max(列名)</td>
<td>求这一列的最大值</td>
</tr>
<tr>
<td>min(列名)</td>
<td>求这一列的最小值</td>
</tr>
<tr>
<td>avg(列名)</td>
<td>求这一列的平均值</td>
</tr>
<tr>
<td>count(列名)</td>
<td>统计这一列有多少条记录</td>
</tr>
<tr>
<td>sum(列名)</td>
<td>对这一列求总和</td>
</tr>
</tbody>
</table>
<p>语法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SELECT</span> <span style="color:#960050;background-color:#1e0010">聚合函数</span>(<span style="color:#960050;background-color:#1e0010">列名</span>) <span style="color:#66d9ef">FROM</span> <span style="color:#960050;background-color:#1e0010">表名</span>;
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"> <span style="color:#75715e">-- 查询学Th总数 
</span><span style="color:#75715e"></span> <span style="color:#66d9ef">select</span> <span style="color:#a6e22e">count</span>(id) <span style="color:#66d9ef">as</span> <span style="color:#960050;background-color:#1e0010">总人数</span> <span style="color:#66d9ef">from</span> student;  
 <span style="color:#66d9ef">select</span> <span style="color:#a6e22e">count</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">as</span> <span style="color:#960050;background-color:#1e0010">总人数</span> <span style="color:#66d9ef">from</span> student; 
</code></pre></div><p>我们发现对于 NULL 的记录不会统计，建议如果统计个数则不要使用有可能为 null 的列，但如果需要把 NULL也统计进去呢？</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#a6e22e">IFNULL</span>(<span style="color:#960050;background-color:#1e0010">列名，默认值</span>)              
<span style="color:#960050;background-color:#1e0010">如果列名不为空，返回这列的值。</span>
<span style="color:#960050;background-color:#1e0010">如果为</span> <span style="color:#66d9ef">NULL</span><span style="color:#960050;background-color:#1e0010">，则返回默认值。</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 查询 id 字段，如果为 null，则使用 0 代替 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">ifnull</span>(id,<span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">from</span> student;
</code></pre></div><p>我们可以利用 IFNULL()函数，如果记录为 NULL，给个默认值，这样统计的数据就不会遗漏</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">count</span>(<span style="color:#a6e22e">ifnull</span>(id,<span style="color:#ae81ff">0</span>)) <span style="color:#66d9ef">from</span> student;
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"> <span style="color:#75715e">-- 查询年龄大于 20 的总数
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">count</span>() <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">where</span> age<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">20</span>;

<span style="color:#75715e">-- 查询数学成绩总分
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">sum</span>(math) <span style="color:#960050;background-color:#1e0010">总分</span> <span style="color:#66d9ef">from</span> student;

<span style="color:#75715e">-- 查询数学成绩平均分
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">avg</span>(math) <span style="color:#960050;background-color:#1e0010">平均分</span> <span style="color:#66d9ef">from</span> student;

<span style="color:#75715e">-- 查询数学成绩最高分
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">max</span>(math) <span style="color:#960050;background-color:#1e0010">最高分</span> <span style="color:#66d9ef">from</span> student;

<span style="color:#75715e">-- 查询数学成绩最低分
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">min</span>(math) <span style="color:#960050;background-color:#1e0010">最低分</span> <span style="color:#66d9ef">from</span> student;
</code></pre></div><h5 id="分组">分组</h5>
<p>分组查询是指使用 GROUP BY 语句对查询信息进行分组，相同数据作为一组</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SELECT</span> <span style="color:#960050;background-color:#1e0010">字段</span><span style="color:#ae81ff">1</span>,<span style="color:#960050;background-color:#1e0010">字段</span><span style="color:#ae81ff">2</span>... <span style="color:#66d9ef">FROM</span> <span style="color:#960050;background-color:#1e0010">表名</span> <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> <span style="color:#960050;background-color:#1e0010">分组字段</span> [<span style="color:#66d9ef">HAVING</span> <span style="color:#960050;background-color:#1e0010">条件</span>];
</code></pre></div><p>GROUP BY 怎么分组的？将分组字段结果中相同内容作为一组，如按性别将学生分成 2 组。</p>
<p><img src="/img/image-20201224111430382.png" alt="image-20201224111430382"></p>
<p>GROUP BY 将分组字段结果中相同内容作为一组，并且返回每组的第一条数据，所以单独分组没什么用处。分组的目的就是为了统计，一般分组会跟聚合函数一起使用。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 按性别进行分组，求男Th和女Th数学的平均分
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> sex, <span style="color:#a6e22e">avg</span>(math) <span style="color:#66d9ef">from</span> student3 <span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> sex;
</code></pre></div><p>效果如下：</p>
<p>实际上是将每组的 math 求了平均,返回每组统计的结果</p>
<p>注意：当我们使用某个字段分组,在查询的时候也需要将这个字段查询出来,否则看不到数据属于哪组的</p>
<p>查询男女各多少人</p>
<p>​	1)   查询所有数据,按性别分组。</p>
<p>​	2)   统计每组人数</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 查询男女各多少人
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> sex, <span style="color:#a6e22e">count</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> sex;
</code></pre></div><p><img src="/img/clip_image020-1608775093269.jpg" alt="img"></p>
<p>查询年龄大于 25 岁的人,按性别分组,统计每组的人数</p>
<p>​	1)  先过滤掉年龄小于 25 岁的人。</p>
<p>​	2)  再分组。</p>
<p>​	3)  最后统计每组的人数</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 查询年龄大于 25 岁的人,按性别分组,统计每组的人数
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> sex, <span style="color:#a6e22e">count</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">from</span> student <span style="color:#66d9ef">where</span> age <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">25</span> <span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> sex ;
</code></pre></div><p>查询年龄大于 25 岁的人，按性别分组，统计每组的人数，并只显示性别人数大于 2 的数据以下代码是否正确？</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 查询年龄大于 25 岁的人，按性别分组，统计每组的人数，并只显示性别人数大于 2 的数据
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> sex, <span style="color:#a6e22e">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">FROM</span> student <span style="color:#66d9ef">WHERE</span> age <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">25</span> <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> sex <span style="color:#66d9ef">WHERE</span> <span style="color:#a6e22e">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#f92672">&gt;</span><span style="color:#ae81ff">2</span>;

<span style="color:#75715e">-- 正确写法：对分组查询的结果再进行过滤
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> sex, <span style="color:#a6e22e">COUNT</span>() <span style="color:#66d9ef">FROM</span> student3 <span style="color:#66d9ef">WHERE</span> age <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">25</span> <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> sex <span style="color:#66d9ef">having</span> <span style="color:#a6e22e">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#f92672">&gt;</span><span style="color:#ae81ff">2</span>;
</code></pre></div><p>只有分组后人数大于 2 的<code>男</code>这组数据显示出来</p>
<p><img src="/img/clip_image025-1608775093269.jpg" alt="img"></p>
<p>having 与 where 的区别</p>
<table>
<thead>
<tr>
<th>子名</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>where 子句</td>
<td>1) 对查询结果进行分组前，将不符合 where  条件的行去掉，即在分组之前过滤数据，即先过滤  再分组。  <!-- raw HTML omitted -->2) where 后面不可以使用聚合函数</td>
</tr>
<tr>
<td>having 子句</td>
<td>1)    having 子句的作用是筛选满足条件的组，即在分组之后过滤数据，即先分组再过滤。  <!-- raw HTML omitted -->2)    having  后面可以使用聚合函数</td>
</tr>
</tbody>
</table>
<p>面试题：有如下订单表</p>
<p>Orders 表数据如下所示，执行如下 SQL 语句，运行结果是？</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">select</span> product,<span style="color:#a6e22e">sum</span>(price) <span style="color:#66d9ef">from</span> orders <span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> product <span style="color:#66d9ef">where</span> <span style="color:#a6e22e">sum</span>(price) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">30</span>;
</code></pre></div><p>运行有误，group by 后面不能出现 where，使用 having</p>
<h4 id="limit-语句">limit 语句</h4>
<p>准备数据：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#a6e22e">student3</span>(id,NAME,age,sex,address,math,english) <span style="color:#66d9ef">VALUES</span>
(<span style="color:#ae81ff">9</span>,<span style="color:#e6db74">&#39;唐僧&#39;</span>,<span style="color:#ae81ff">25</span>,<span style="color:#e6db74">&#39;男&#39;</span>,<span style="color:#e6db74">&#39;长安&#39;</span>,<span style="color:#ae81ff">87</span>,<span style="color:#ae81ff">78</span>),
(<span style="color:#ae81ff">10</span>,<span style="color:#e6db74">&#39;孙悟空&#39;</span>,<span style="color:#ae81ff">18</span>,<span style="color:#e6db74">&#39;男&#39;</span>,<span style="color:#e6db74">&#39;花果ft&#39;</span>,<span style="color:#ae81ff">100</span>,<span style="color:#ae81ff">66</span>),
(<span style="color:#ae81ff">11</span>,<span style="color:#e6db74">&#39;猪八戒&#39;</span>,<span style="color:#ae81ff">22</span>,<span style="color:#e6db74">&#39;男&#39;</span>,<span style="color:#e6db74">&#39;高老庄&#39;</span>,<span style="color:#ae81ff">58</span>,<span style="color:#ae81ff">78</span>),
(<span style="color:#ae81ff">12</span>,<span style="color:#e6db74">&#39;沙僧&#39;</span>,<span style="color:#ae81ff">50</span>,<span style="color:#e6db74">&#39;男&#39;</span>,<span style="color:#e6db74">&#39;流沙河&#39;</span>,<span style="color:#ae81ff">77</span>,<span style="color:#ae81ff">88</span>),
(<span style="color:#ae81ff">13</span>,<span style="color:#e6db74">&#39;白骨精&#39;</span>,<span style="color:#ae81ff">22</span>,<span style="color:#e6db74">&#39;nv&#39;</span>,<span style="color:#e6db74">&#39;白虎岭&#39;</span>,<span style="color:#ae81ff">66</span>,<span style="color:#ae81ff">66</span>),
(<span style="color:#ae81ff">14</span>,<span style="color:#e6db74">&#39;蜘蛛精&#39;</span>,<span style="color:#ae81ff">23</span>,<span style="color:#e6db74">&#39;女&#39;</span>,<span style="color:#e6db74">&#39;盘丝洞&#39;</span>,<span style="color:#ae81ff">88</span>,<span style="color:#ae81ff">88</span>);
</code></pre></div><p>limit 的作用：</p>
<p>LIMIT 是限制的意思，所以 LIMIT 的作用就是限制查询记录的条数。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SELECT</span> <span style="color:#960050;background-color:#1e0010">字段列表</span> [<span style="color:#66d9ef">as</span> <span style="color:#960050;background-color:#1e0010">别名</span>] <span style="color:#66d9ef">FROM</span> <span style="color:#960050;background-color:#1e0010">表名</span> [<span style="color:#66d9ef">WHERE</span> <span style="color:#960050;background-color:#1e0010">子句</span>] [<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> <span style="color:#960050;background-color:#1e0010">子句</span>][<span style="color:#66d9ef">HAVING</span> <span style="color:#960050;background-color:#1e0010">子句</span>][<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#960050;background-color:#1e0010">子</span>
<span style="color:#960050;background-color:#1e0010">句</span>][<span style="color:#66d9ef">LIMIT</span> <span style="color:#960050;background-color:#1e0010">子句</span>];
</code></pre></div><p>LIMIT 语法格式：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">LIMIT</span> offset,length; 
offset<span style="color:#960050;background-color:#1e0010">：起始行数，从</span>  <span style="color:#ae81ff">0</span>  <span style="color:#960050;background-color:#1e0010">开始计数，如果省略，默认就是</span> <span style="color:#ae81ff">0</span>  
length<span style="color:#960050;background-color:#1e0010">：返回的行数</span>  
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"> <span style="color:#75715e">-- 查询学生表中数据，从第 3 条开始显示，显示 6 条。  
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student3  <span style="color:#66d9ef">limit</span> <span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">6</span>;  
</code></pre></div><p><img src="/img/image-20201224112747944.png" alt="image-20201224112747944"></p>
<p>LIMIT 的使用场景：</p>
<p>分页：比如我们登录京东，淘宝，返回的商品信息可能有几万条，不是一次全部显示出来。是一页显示固定的条数。 假设我们每页显示 5 条记录的方式来分页。</p>
<p>SQL 语句如下：</p>
<p><img src="/img/image-20201224112844918.png" alt="image-20201224112844918"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"> <span style="color:#75715e">-- 如果第一个参数是 0 可以省略写： 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student3 <span style="color:#66d9ef">limit</span> <span style="color:#ae81ff">5</span>;

<span style="color:#75715e">-- 最后如果不够5条，有多少显示多少
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> student3 <span style="color:#66d9ef">limit</span> <span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">5</span>;
</code></pre></div><h4 id="23-数据库备份和还原">2.3 数据库备份和还原</h4>
<h5 id="备份的应用场景">备份的应用场景</h5>
<p>在服务器进行数据传输、数据存储和数据交换，就有可能产生数据故障。比如发生意外停机或存储介质损坏。这时，如果没有采取数据备份和数据恢复手段与措施，就会导致数据的丢失，造成的损失是无法弥补与估量的。</p>
<h5 id="备份与还原的语句">备份与还原的语句</h5>
<p>备份格式： DOS 下，未登录的时候。这是一个可执行文件 exe，在 bin 文件夹</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql dump <span style="color:#f92672">-</span>u用户名 <span style="color:#f92672">-</span>p密码 <span style="color:#960050;background-color:#1e0010">数据库</span><span style="color:#f92672">&gt;</span><span style="color:#960050;background-color:#1e0010">文件的路径</span>     
</code></pre></div><p>备份操作：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 备份 db1 数据库中的数据到 F:/MySQL/Data/Data_db/db1.sql 文件中
</span><span style="color:#75715e"></span>mysqldump <span style="color:#f92672">-</span>uroot <span style="color:#f92672">-</span>proot db1 <span style="color:#f92672">&gt;</span> F:<span style="color:#f92672">/</span>MySQL<span style="color:#f92672">/</span>Data<span style="color:#f92672">/</span>Data_db<span style="color:#f92672">/</span>db1.<span style="color:#66d9ef">sql</span>
</code></pre></div><p>导出结果：数据库中的所有表和数据都会导出成 SQL 语句</p>
<p>还原格式：mysql 中的命令，需要登录后才可以操作</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">USE</span> <span style="color:#960050;background-color:#1e0010">数据库；</span>
SOURCE <span style="color:#960050;background-color:#1e0010">导入文件的路径</span>;
</code></pre></div><p>还原操作：还原 db1 数据库中的数据，注意：还原的时候需要先登录 MySQL,并选中对应的数据库。</p>
<p>​	1)  删除 db1 数据库中的所有表</p>
<p>​	2)  登录 MySQL</p>
<p>​	3)  选中数据库</p>
<p>​	4)  使用 SOURCE 命令还原数据</p>
<p>​	5)  查看还原结果</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysql <span style="color:#f92672">-</span>uroot <span style="color:#f92672">-</span>p123456
<span style="color:#66d9ef">use</span> db1;
source F:<span style="color:#f92672">/</span>MySQL<span style="color:#f92672">/</span>Data<span style="color:#f92672">/</span>Data_db<span style="color:#f92672">/</span>db1.<span style="color:#66d9ef">sql</span>;
</code></pre></div><h5 id="图形化界面备份与还原">图形化界面备份与还原</h5>
<p>备份数据库中的数据</p>
<p>​	1)    选中数据库，右键 ”备份/导出”</p>
<p>​	2)    指定导出路径，保存成.sql 文件即可。</p>
<p>​    <img src="/img/clip_image041.jpg" alt="img"></p>
<p>​    <img src="/img/clip_image043.jpg" alt="img"></p>
<p>还原数据库中的数据</p>
<p>​	1)    删除数据库</p>
<p>​	2)    数据库列表区域右键“执行 SQL 脚本”， 指定要执行的 SQL 文件，执行即可</p>
<p>​     <img src="/img/clip_image045.jpg" alt="img"></p>
<h4 id="24-数据库表的约束">2.4 数据库表的约束</h4>
<h5 id="数据库约束的概述">数据库约束的概述</h5>
<p>约束的作用：对表中的数据进行限制，保证数据的正确性、有效性和完整性。一个表如果添加了约束，不正确的数据将无法插入到表中。约束在创建表的时候添加比较合适。</p>
<p>约束种类：</p>
<table>
<thead>
<tr>
<th>约束名</th>
<th>约束关键字</th>
</tr>
</thead>
<tbody>
<tr>
<td>主键</td>
<td>primary  key</td>
</tr>
<tr>
<td>唯一</td>
<td>unique</td>
</tr>
<tr>
<td>非空</td>
<td>not  null</td>
</tr>
<tr>
<td>外键</td>
<td>foreign key</td>
</tr>
<tr>
<td>检查约束</td>
<td>check    注：mysql 不支持</td>
</tr>
</tbody>
</table>
<h5 id="主键约束">主键约束</h5>
<p>主键的作用：用来唯一标识数据库中的每一条记录！</p>
<p>哪个字段应该作为表的主键？通常不用业务字段作为主键，单独给每张表设计一个 id 的字段，把 id 作为主键。主键是给数据库和程序使用的，不是给最终的客户使用的。所以主键有没有含义没有关系，只要不重复，非空就行。</p>
<p>如：身份证！ 学号不建议做成主键</p>
<p>创建主键</p>
<ul>
<li>
<p>主键关键字： primary key</p>
</li>
<li>
<p>主键的特点：</p>
<ol>
<li>
<p>非空 not null</p>
</li>
<li>
<p>唯一</p>
</li>
</ol>
</li>
</ul>
<p>创建主键方式：</p>
<ol>
<li>在创建表的时候给字段添加主键</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#960050;background-color:#1e0010">字段类型</span> <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>                                                             
</code></pre></div><ol start="2">
<li>在已有表中添加主键</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#960050;background-color:#1e0010">表名</span> <span style="color:#66d9ef">ADD</span> <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>(<span style="color:#960050;background-color:#1e0010">字段名</span>);
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 创建表学生表 st5, 包含字段(id, name, age)将 id 做为主键
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> <span style="color:#a6e22e">st5</span> (
	id <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span>, <span style="color:#75715e">-- id 为主键
</span><span style="color:#75715e"></span>	name <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">20</span>), 
    age <span style="color:#66d9ef">int</span>
)

<span style="color:#66d9ef">desc</span> st5;
</code></pre></div><p><img src="/img/image-20201224113930579.png" alt="image-20201224113930579"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"> <span style="color:#75715e">-- 插入重复的主键值
</span><span style="color:#75715e"></span><span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> st5 <span style="color:#66d9ef">values</span> (<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;关羽&#39;</span>, <span style="color:#ae81ff">30</span>);

<span style="color:#75715e">-- 错误代码： 1062 Duplicate entry &#39;1&#39; for key &#39;PRIMARY&#39; 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> st5 <span style="color:#66d9ef">values</span> (<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;关云长&#39;</span>, <span style="color:#ae81ff">20</span>);

<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> st5;

<span style="color:#75715e">-- 插入 NULL 的主键值, Column &#39;id&#39; cannot be null 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> st5 <span style="color:#66d9ef">values</span> (<span style="color:#66d9ef">null</span>, <span style="color:#e6db74">&#39;关云长&#39;</span>, <span style="color:#ae81ff">20</span>);
</code></pre></div><p>删除主键</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 删除 st5 表的主键
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> st5 <span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span>;

<span style="color:#75715e">-- 添加主键
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> st5 <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span>(id);
</code></pre></div><p>主键自增</p>
<p>主键如果让我们自己添加很有可能重复,我们通常希望在每次插入新记录时,数据库自动生成主键字段的值</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">AUTO_INCREMENT</span> <span style="color:#960050;background-color:#1e0010">表示自动增长</span>(<span style="color:#960050;background-color:#1e0010">字段类型必须是整数类型</span>)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 创建表学生表 st6, 包含字段(id, name, age)将 id 做为主键，主键自增
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> <span style="color:#a6e22e">st6</span> (
	id <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span> <span style="color:#66d9ef">AUTO_INCREMENT</span>, <span style="color:#75715e">-- id 为主键，主键自增
</span><span style="color:#75715e"></span>	name <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">20</span>), 
    age <span style="color:#66d9ef">int</span>
)
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#a6e22e">st6</span>(NAME,age) <span style="color:#66d9ef">VALUES</span>(<span style="color:#e6db74">&#39;唐僧&#39;</span>,<span style="color:#ae81ff">22</span>),(<span style="color:#e6db74">&#39;孙悟空&#39;</span>,<span style="color:#ae81ff">26</span>),(<span style="color:#e6db74">&#39;猪八戒&#39;</span>,<span style="color:#ae81ff">25</span>),(<span style="color:#e6db74">&#39;沙僧&#39;</span>,<span style="color:#ae81ff">20</span>);
<span style="color:#66d9ef">desc</span> st6;
</code></pre></div><p><img src="/img/image-20201224114314544.png" alt="image-20201224114314544"></p>
<p>修改自增长的默认值起始值</p>
<p>默认地 AUTO_INCREMENT 的开始值是 1，如果希望修改起始值,请使用下列 SQL 语法
创建表时指定起始值</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#960050;background-color:#1e0010">表名</span>(
<span style="color:#960050;background-color:#1e0010">列名</span> <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span> <span style="color:#66d9ef">AUTO_INCREMENT</span>
) <span style="color:#66d9ef">AUTO_INCREMENT</span><span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">起始值</span>;
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 指定起始值为 1000 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> <span style="color:#a6e22e">st4</span> (
	id <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span> <span style="color:#66d9ef">auto_increment</span>, 
    name <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">20</span>)
) <span style="color:#66d9ef">auto_increment</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>;

<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> st4 <span style="color:#66d9ef">values</span> (<span style="color:#66d9ef">null</span>, <span style="color:#e6db74">&#39;孔明&#39;</span>); 
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> st4;
</code></pre></div><p>创建好以后修改起始值</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#960050;background-color:#1e0010">表名</span> <span style="color:#66d9ef">AUTO_INCREMENT</span><span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">起始值</span>;
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"> <span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> st4 <span style="color:#66d9ef">auto_increment</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">2000</span>;
 <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> st4 <span style="color:#66d9ef">values</span> (<span style="color:#66d9ef">null</span>, <span style="color:#e6db74">&#39;刘备&#39;</span>);
</code></pre></div><p><img src="/img/image-20201224114553205.png" alt="image-20201224114553205"></p>
<p>DELETE 和 TRUNCATE 对自增长的影响</p>
<ul>
<li>DELETE：删除所有的记录之后，自增长没有影响。</li>
</ul>
<p><img src="/img/image-20201224114638751.png" alt="image-20201224114638751"></p>
<ul>
<li>TRUNCATE：删除以后，自增长又重新开始。</li>
</ul>
<p><img src="/img/image-20201224114653369.png" alt="image-20201224114653369"></p>
<h5 id="唯一约束">唯一约束</h5>
<p>什么是唯一约束： 表中某一列不能出现重复的值</p>
<p>唯一约束的基本格式</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#960050;background-color:#1e0010">字段类型</span> <span style="color:#66d9ef">UNIQUE</span>                                                                 
</code></pre></div><p>实现唯一约束</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 创建学Th表 st7, 包含字段(id, name),name 这一列设置唯一约束,不能出现同名的学Th 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> <span style="color:#a6e22e">st7</span> (
id <span style="color:#66d9ef">int</span>,
name <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">unique</span>
)

<span style="color:#75715e">-- 添加一个同名的学Th
</span><span style="color:#75715e"></span><span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> st7 <span style="color:#66d9ef">values</span> (<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;张三&#39;</span>);

<span style="color:#75715e">-- Duplicate entry &#39;张三&#39; for key &#39;name&#39; 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> st7 <span style="color:#66d9ef">values</span> (<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;张三&#39;</span>);

<span style="color:#75715e">-- 重复插入多个 null 会怎样？
</span><span style="color:#75715e"></span><span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> st7 <span style="color:#66d9ef">values</span> (<span style="color:#ae81ff">2</span>, <span style="color:#66d9ef">null</span>); 
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> st7 <span style="color:#66d9ef">values</span> (<span style="color:#ae81ff">3</span>, <span style="color:#66d9ef">null</span>);
</code></pre></div><p><img src="/img/image-20201224114910311.png" alt="image-20201224114910311"></p>
<p>null 没有数据，不存在重复的问题</p>
<h5 id="非空约束">非空约束</h5>
<p>什么是非空约束：某一列不能为 null。</p>
<p>非空约束的基本语法格式</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#960050;background-color:#1e0010">字段类型</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> 
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 创建表学Th表 st8, 包含字段(id,name,gender)其中 name 不能为 NULL 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> <span style="color:#a6e22e">st8</span> (
	id <span style="color:#66d9ef">int</span>,
	name <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>, 
    gender <span style="color:#66d9ef">char</span>(<span style="color:#ae81ff">1</span>)
)

<span style="color:#75715e">-- 添加一条记录其中姓名不赋值
</span><span style="color:#75715e"></span><span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> st8 <span style="color:#66d9ef">values</span> (<span style="color:#ae81ff">1</span>,<span style="color:#e6db74">&#39;张三疯&#39;</span>,<span style="color:#e6db74">&#39;男&#39;</span>);

<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> st8;   

<span style="color:#75715e">-- Column &#39;name&#39; cannot be null
</span><span style="color:#75715e"></span><span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> st8 <span style="color:#66d9ef">values</span> (<span style="color:#ae81ff">2</span>,<span style="color:#66d9ef">null</span>,<span style="color:#e6db74">&#39;男&#39;</span>);
</code></pre></div><p>​</p>
<h5 id="默认值">默认值</h5>
<p>什么是默认值：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#960050;background-color:#1e0010">字段类型</span> <span style="color:#66d9ef">DEFAULT</span> <span style="color:#960050;background-color:#1e0010">默认值</span>     
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 创建一个学Th表 st9，包含字段(id,name,address)， 地址默认值是广州
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> <span style="color:#a6e22e">st9</span> ( 
    id <span style="color:#66d9ef">int</span>,
	name <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">20</span>),
	address <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">default</span> <span style="color:#e6db74">&#39;广州&#39;</span>
)

<span style="color:#75715e">-- 添加一条记录,使用默认地址
</span><span style="color:#75715e"></span><span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> st9 <span style="color:#66d9ef">values</span> (<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;李四&#39;</span>, <span style="color:#66d9ef">default</span>); 
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">st9</span> (id,name) <span style="color:#66d9ef">values</span> (<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;李白&#39;</span>);

<span style="color:#75715e">-- 添加一条记录,不使用默认地址
</span><span style="color:#75715e"></span><span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> st9 <span style="color:#66d9ef">values</span> (<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#39;李四光&#39;</span>, <span style="color:#e6db74">&#39;深圳&#39;</span>);                                           
</code></pre></div><p>疑问: 如果一个字段设置了非空与唯一约束，该字段与主键的区别?</p>
<p>​	1)   主键数在一个表中，只能有一个。不能出现多个主键。主键可以单列，也可以是多列。</p>
<p>​	2)   自增长只能用在主键上</p>
<h5 id="外键约束">外键约束</h5>
<p>单表的缺点</p>
<p>创建一个员工表包含如下列(id, name, age, dep_name, dep_location),id 主键并自动增长,添加 5 条数据</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#a6e22e">emp</span> (
id <span style="color:#66d9ef">INT</span> <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> <span style="color:#66d9ef">AUTO_INCREMENT</span>, NAME <span style="color:#66d9ef">VARCHAR</span>(<span style="color:#ae81ff">30</span>),
age <span style="color:#66d9ef">INT</span>,
dep_name <span style="color:#66d9ef">VARCHAR</span>(<span style="color:#ae81ff">30</span>), dep_location <span style="color:#66d9ef">VARCHAR</span>(<span style="color:#ae81ff">30</span>)
);

<span style="color:#75715e">-- 添加数据
</span><span style="color:#75715e"></span><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#a6e22e">emp</span> (NAME, age, dep_name, dep_location) <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;张三&#39;</span>, <span style="color:#ae81ff">20</span>, <span style="color:#e6db74">&#39;研发部&#39;</span>, <span style="color:#e6db74">&#39;广州&#39;</span>); 
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#a6e22e">emp</span> (NAME, age, dep_name, dep_location) <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;李四&#39;</span>, <span style="color:#ae81ff">21</span>, <span style="color:#e6db74">&#39;研发部&#39;</span>, <span style="color:#e6db74">&#39;广州&#39;</span>); 
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#a6e22e">emp</span> (NAME, age, dep_name, dep_location) <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;王五&#39;</span>, <span style="color:#ae81ff">20</span>, <span style="color:#e6db74">&#39;研发部&#39;</span>, <span style="color:#e6db74">&#39;广州&#39;</span>);
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#a6e22e">emp</span> (NAME, age, dep_name, dep_location) <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;老王&#39;</span>, <span style="color:#ae81ff">20</span>, <span style="color:#e6db74">&#39;销售部&#39;</span>, <span style="color:#e6db74">&#39;深圳&#39;</span>); 
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#a6e22e">emp</span> (NAME, age, dep_name, dep_location) <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;大王&#39;</span>, <span style="color:#ae81ff">22</span>, <span style="color:#e6db74">&#39;销售部&#39;</span>, <span style="color:#e6db74">&#39;深圳&#39;</span>); 
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#a6e22e">emp</span> (NAME, age, dep_name, dep_location) <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;小王&#39;</span>, <span style="color:#ae81ff">18</span>, <span style="color:#e6db74">&#39;销售部&#39;</span>, <span style="color:#e6db74">&#39;深圳&#39;</span>);
</code></pre></div><p>以上数据表的缺点:</p>
<p>​	1)   数据冗余</p>
<p>​	2)   后期还会出现增删改的问题</p>
<p><img src="/img/image-20201224115444416.png" alt="image-20201224115444416"></p>
<p>解决方案:</p>
<p><img src="/img/image-20201224115508316.png" alt="image-20201224115508316"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"> <span style="color:#75715e">-- 解决方案：分成 2 张表
</span><span style="color:#75715e">-- 创建部门表(id,dep_name,dep_location)
</span><span style="color:#75715e">-- 一方，主表
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> <span style="color:#a6e22e">department</span>(
id <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span> <span style="color:#66d9ef">auto_increment</span>, dep_name <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">20</span>),
dep_location <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">20</span>)
);

<span style="color:#75715e">-- 创建员工表(id,name,age,dep_id)
</span><span style="color:#75715e">-- 多方，从表
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> <span style="color:#a6e22e">employee</span>(
id <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span> <span style="color:#66d9ef">auto_increment</span>, name <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">20</span>),
age <span style="color:#66d9ef">int</span>,
dep_id <span style="color:#66d9ef">int</span> <span style="color:#75715e">-- 外键对应主表的主键
</span><span style="color:#75715e"></span>)

<span style="color:#75715e">-- 添加 2 个部门
</span><span style="color:#75715e"></span><span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> department <span style="color:#66d9ef">values</span>(<span style="color:#66d9ef">null</span>, <span style="color:#e6db74">&#39;研发部&#39;</span>,<span style="color:#e6db74">&#39;广州&#39;</span>),(<span style="color:#66d9ef">null</span>, <span style="color:#e6db74">&#39;销售部&#39;</span>, <span style="color:#e6db74">&#39;深圳&#39;</span>); 
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> department;

<span style="color:#75715e">-- 添加员工,dep_id 表示员工所在的部门
</span><span style="color:#75715e"></span><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#a6e22e">employee</span> (NAME, age, dep_id) <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;张三&#39;</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">1</span>);
<span style="color:#66d9ef">INSERT</span>	<span style="color:#66d9ef">INTO</span>	<span style="color:#a6e22e">employee</span>	(NAME,	age,	dep_id)	<span style="color:#66d9ef">VALUES</span>	(<span style="color:#e6db74">&#39;李四&#39;</span>,	<span style="color:#ae81ff">21</span>,	<span style="color:#ae81ff">1</span>);
<span style="color:#66d9ef">INSERT</span>	<span style="color:#66d9ef">INTO</span>	<span style="color:#a6e22e">employee</span>	(NAME,	age,	dep_id)	<span style="color:#66d9ef">VALUES</span>	(<span style="color:#e6db74">&#39;王五&#39;</span>,	<span style="color:#ae81ff">20</span>,	<span style="color:#ae81ff">1</span>);
<span style="color:#66d9ef">INSERT</span>	<span style="color:#66d9ef">INTO</span>	<span style="color:#a6e22e">employee</span>	(NAME,	age,	dep_id)	<span style="color:#66d9ef">VALUES</span>	(<span style="color:#e6db74">&#39;老王&#39;</span>,	<span style="color:#ae81ff">20</span>,	<span style="color:#ae81ff">2</span>);
<span style="color:#66d9ef">INSERT</span>	<span style="color:#66d9ef">INTO</span>	<span style="color:#a6e22e">employee</span>	(NAME,	age,	dep_id)	<span style="color:#66d9ef">VALUES</span>	(<span style="color:#e6db74">&#39;大王&#39;</span>,	<span style="color:#ae81ff">22</span>,	<span style="color:#ae81ff">2</span>);
<span style="color:#66d9ef">INSERT</span>	<span style="color:#66d9ef">INTO</span>	<span style="color:#a6e22e">employee</span>	(NAME,	age,	dep_id)	<span style="color:#66d9ef">VALUES</span>	(<span style="color:#e6db74">&#39;小王&#39;</span>,	<span style="color:#ae81ff">18</span>,	<span style="color:#ae81ff">2</span>);
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> employee;
</code></pre></div><p>问题：当我们在 employee 的 dep_id 里面输入不存在的部门,数据依然可以添加.但是并没有对应的部门，实际应用中不能出现这种情况。employee 的 dep_id 中的数据只能是 department 表中存在的 id</p>
<p><img src="/img/image-20201224115740568.png" alt="image-20201224115740568"></p>
<p>目标: 需要约束 dep_id 只能是 department 表中已经存在 id</p>
<p>解决方式: 使用外键约束！</p>
<p>什么是外键：在从表中与主表主键对应的那一列，如：员工表中的 dep_id</p>
<ul>
<li>
<p>主表： 一方，用来约束别人的表</p>
</li>
<li>
<p>从表： 多方，被别人约束的表</p>
</li>
</ul>
<p><img src="/img/image-20201224115846425.png" alt="image-20201224115846425"></p>
<p>创建约束的语法</p>
<p>新建表时增加外键：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"> [<span style="color:#66d9ef">CONSTRAINT</span>] [<span style="color:#960050;background-color:#1e0010">外键约束名称</span>] <span style="color:#66d9ef">FOREIGN</span> <span style="color:#66d9ef">KEY</span>(<span style="color:#960050;background-color:#1e0010">外键字段名</span>) <span style="color:#66d9ef">REFERENCES</span> <span style="color:#960050;background-color:#1e0010">主表名</span>(<span style="color:#960050;background-color:#1e0010">主键字段名</span>)                                                                
</code></pre></div><p>已有表增加外键：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#960050;background-color:#1e0010">从表</span> <span style="color:#66d9ef">ADD</span> [<span style="color:#66d9ef">CONSTRAINT</span>] [<span style="color:#960050;background-color:#1e0010">外键约束名称</span>] <span style="color:#66d9ef">FOREIGN</span> <span style="color:#66d9ef">KEY</span> (<span style="color:#960050;background-color:#1e0010">外键字段名</span>) <span style="color:#66d9ef">REFERENCES</span> <span style="color:#960050;background-color:#1e0010">主表</span>(<span style="color:#960050;background-color:#1e0010">主</span>
<span style="color:#960050;background-color:#1e0010">键字段名</span>);
</code></pre></div><p>具体操作：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 1) 删除副表/从表 employee drop table employee;
</span><span style="color:#75715e">-- 2) 创建从表 employee 并添加外键约束 emp_depid_fk
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 多方，从表
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> <span style="color:#a6e22e">employee</span>(
id <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span> <span style="color:#66d9ef">auto_increment</span>, name <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">20</span>),
age <span style="color:#66d9ef">int</span>,
dep_id <span style="color:#66d9ef">int</span>, <span style="color:#75715e">-- 外键对应主表的主键
</span><span style="color:#75715e">-- 创建外键约束
</span><span style="color:#75715e"></span><span style="color:#66d9ef">constraint</span> emp_depid_fk <span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span> (dep_id) <span style="color:#66d9ef">references</span> <span style="color:#a6e22e">department</span>(id)
)

<span style="color:#75715e">-- 3) 正常添加数据
</span><span style="color:#75715e"></span><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#a6e22e">employee</span> (NAME, age, dep_id) <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;张三&#39;</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">1</span>); 
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#a6e22e">employee</span> (NAME, age, dep_id) <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;李四&#39;</span>, <span style="color:#ae81ff">21</span>, <span style="color:#ae81ff">1</span>); 
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#a6e22e">employee</span> (NAME, age, dep_id) <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;王五&#39;</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">1</span>);
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#a6e22e">employee</span> (NAME, age, dep_id) <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;老王&#39;</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">2</span>); 
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#a6e22e">employee</span> (NAME, age, dep_id) <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;大王&#39;</span>, <span style="color:#ae81ff">22</span>, <span style="color:#ae81ff">2</span>); 
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#a6e22e">employee</span> (NAME, age, dep_id) <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;小王&#39;</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">2</span>);

<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> employee;

<span style="color:#75715e">-- 4) 部门错误的数据添加失败
</span><span style="color:#75715e">-- 插入不存在的部门
</span><span style="color:#75715e">-- Cannot add or update a child row: a foreign key constraint fails 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#a6e22e">employee</span> (NAME, age, dep_id) <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;老张&#39;</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">6</span>);
</code></pre></div><p>删除外键</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#960050;background-color:#1e0010">从表</span> <span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span> <span style="color:#960050;background-color:#1e0010">外键名称</span>;   
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 删除 employee 表的 emp_depid_fk 外键
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> employee <span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span> emp_depid_fk;

<span style="color:#75715e">-- 在 employee 表情存在的情况下添加外键
</span><span style="color:#75715e"></span><span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">table</span> employee <span style="color:#66d9ef">add</span> <span style="color:#66d9ef">constraint</span> emp_depid_fk <span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span> (dep_id) <span style="color:#66d9ef">references</span> <span style="color:#a6e22e">department</span>(id);                                  
</code></pre></div><p>外键的级联</p>
<p>出现新的问题：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> employee;
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> department;
<span style="color:#75715e">-- 要把部门表中的id值2，改为5，能不能直接更新呢？
</span><span style="color:#75715e">-- Cannot delete or update a parent row: a foreign key constraint fails 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">update</span> department <span style="color:#66d9ef">set</span> id <span style="color:#f92672">=</span><span style="color:#ae81ff">5</span> <span style="color:#66d9ef">where</span> id <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;
<span style="color:#75715e">-- 要删除部门id=1的部门，能不能直接删除呢？
</span><span style="color:#75715e">-- Cannot delete or update a parent row: a foreign key constraint fails 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">delete</span> <span style="color:#66d9ef">from</span> department <span style="color:#66d9ef">where</span> id <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</code></pre></div><p>什么是级联操作：在修改和删除主表的主键时，同时更新或删除副表的外键值，称为级联操作</p>
<table>
<thead>
<tr>
<th>级联操作语法</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>ON UPDATE CASCADE</td>
<td>级联更新，只能是创建表的时候创建级联关系。更新主表中的主键，从表中的外键  列也自动同步更新</td>
</tr>
<tr>
<td>ON DELETE CASCADE</td>
<td>级联删除</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"> <span style="color:#75715e">-- 删除 employee 表，重新创建  employee 表，添加级联更新和级联删除 
</span><span style="color:#75715e"></span> <span style="color:#66d9ef">drop</span>  <span style="color:#66d9ef">table</span> employee;     
 <span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> <span style="color:#a6e22e">employee</span>(  
     id <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span> <span style="color:#66d9ef">auto_increment</span>,  
     name <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">20</span>),  
     age <span style="color:#66d9ef">int</span>,  
     dep_id <span style="color:#66d9ef">int</span>, 
     <span style="color:#75715e">-- 外键对应主表的主键  
</span><span style="color:#75715e"></span>     <span style="color:#75715e">-- 创建外键约束  
</span><span style="color:#75715e"></span>     <span style="color:#66d9ef">constraint</span>  emp_depid_fk <span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span> (dep_id) <span style="color:#66d9ef">references</span> <span style="color:#a6e22e">department</span>(id) <span style="color:#66d9ef">on</span> <span style="color:#66d9ef">update</span> <span style="color:#66d9ef">cascade</span>  <span style="color:#66d9ef">on</span> <span style="color:#66d9ef">delete</span> <span style="color:#66d9ef">cascade</span> 
 )     
     <span style="color:#75715e">-- 再次添加数据到员工表和部门表  
</span><span style="color:#75715e"></span>     <span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#a6e22e">employee</span> (NAME, age,  dep_id) <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;张三&#39;</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">1</span>); 
     <span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#a6e22e">employee</span> (NAME,  age, dep_id) <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;李四&#39;</span>, <span style="color:#ae81ff">21</span>, <span style="color:#ae81ff">1</span>); 
     <span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#a6e22e">employee</span>  (NAME, age, dep_id) <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;王五&#39;</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">1</span>);     
     <span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#a6e22e">employee</span> (NAME, age,  dep_id) <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;老王&#39;</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">2</span>); 
     <span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#a6e22e">employee</span> (NAME,  age, dep_id) <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;大王&#39;</span>, <span style="color:#ae81ff">22</span>, <span style="color:#ae81ff">2</span>); 
     <span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#a6e22e">employee</span>  (NAME, age, dep_id) <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;小王&#39;</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">2</span>);  
     <span style="color:#75715e">-- 删除部门表？能不能直接删除？  
</span><span style="color:#75715e"></span>     <span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">table</span> department;     
     <span style="color:#75715e">-- 把部门表中 id 等于 1  的部门改成  id 等于 10 
</span><span style="color:#75715e"></span>     <span style="color:#66d9ef">update</span> department <span style="color:#66d9ef">set</span> id<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>  <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>; 
     <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> employee;  <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> department;     
     <span style="color:#75715e">-- 删除部门号是 2 的部门  
</span><span style="color:#75715e"></span>     <span style="color:#66d9ef">delete</span> <span style="color:#66d9ef">from</span> department <span style="color:#66d9ef">where</span>  id<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>;  
</code></pre></div><h5 id="数据约束小结">数据约束小结</h5>
<table>
<thead>
<tr>
<th>约束名</th>
<th>关键字</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>主键</td>
<td>primary key</td>
<td>1)    唯一 <!-- raw HTML omitted --> 2)  非空</td>
</tr>
<tr>
<td>默认</td>
<td>default</td>
<td>如果一列没有值，使用默认值</td>
</tr>
<tr>
<td>非空</td>
<td>not null</td>
<td>这一列必须有值</td>
</tr>
<tr>
<td>唯一</td>
<td>unique</td>
<td>这一列不能有重复值</td>
</tr>
<tr>
<td>外键</td>
<td>foreign key</td>
<td>主表中主键列，在从表中外键列</td>
</tr>
</tbody>
</table>
<h4 id="25-表与表之间的关系">2.5 表与表之间的关系</h4>
<h5 id="表关系的概念">表关系的概念</h5>
<p>现实生活中，实体与实体之间肯定是有关系的，比如：老公和老婆，部门和员工，老师和学生等。那么我们在设计表的时候，就应该体现出表与表之间的这种关系！</p>
<p>表与表之间的三种关系</p>
<ul>
<li>
<p>一对多：最常用的关系 部门和员工</p>
</li>
<li>
<p>多对多：学生选课表 和 学生表， 一门课程可以有多个学生选择，一个学生选择多门课程</p>
</li>
<li>
<p>一对一：相对使用比较少。员工表 简历表， 公民表 护照表</p>
</li>
</ul>
<h5 id="一对多">一对多</h5>
<p>一对多（1:n） 例如：班级和学生，部门和员工，客户和订单，分类和商品</p>
<p>一对多建表原则: 在从表(多方)创建一个字段,字段作为外键指向主表(一方)的主键</p>
<p><img src="/img/image-20201224121126799.png" alt="image-20201224121126799"></p>
<h5 id="多对多">多对多</h5>
<p>多对多（m:n） 例如：老师和学生，学生和课程，用户和角色</p>
<p>多对多关系建表原则: 需要创建第三张表，中间表中至少两个字段，这两个字段分别作为外键指向各自一方的主键。</p>
<p><img src="/img/image-20201224121151478.png" alt="image-20201224121151478"></p>
<h5 id="一对一">一对一</h5>
<p>一对一（1:1） 在实际的开发中应用不多.因为一对一可以创建成一张表。两种建表原则：</p>
<table>
<thead>
<tr>
<th>一对一的建表原则</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>外键唯一</td>
<td>主表的主键和从表的外键（唯一），形成主外键关系，外键唯一 UNIQUE</td>
</tr>
<tr>
<td>外键是主键</td>
<td>主表的主键和从表的主键，形成主外键关系</td>
</tr>
</tbody>
</table>
<p><img src="/img/image-20201224121236191.png" alt="image-20201224121236191"></p>
<h5 id="一对多关系案例">一对多关系案例</h5>
<p>需求：一个旅游线路分类中有多个旅游线路</p>
<p>界面</p>
<p><img src="/img/image-20201224121326299.png" alt="image-20201224121326299"></p>
<p>表与表的关系</p>
<p><img src="/img/image-20201224121417065.png" alt="image-20201224121417065"></p>
<p><img src="/img/image-20201224121435841.png" alt="image-20201224121435841"></p>
<p>具体操作：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 创建旅游线路分类表 tab_category
</span><span style="color:#75715e">-- cid 旅游线路分类主键，自动增长
</span><span style="color:#75715e">-- cname 旅游线路分类名称非空，唯一，字符串 100 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> <span style="color:#a6e22e">tab_category</span> (
cid <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span> <span style="color:#66d9ef">auto_increment</span>, cname <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">100</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span> <span style="color:#66d9ef">unique</span>
)

<span style="color:#75715e">-- 添加旅游线路分类数据：
</span><span style="color:#75715e"></span><span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">tab_category</span> (cname) <span style="color:#66d9ef">values</span> (<span style="color:#e6db74">&#39;周边游&#39;</span>), (<span style="color:#e6db74">&#39;出境游&#39;</span>), (<span style="color:#e6db74">&#39;国内游&#39;</span>), (<span style="color:#e6db74">&#39;港澳游&#39;</span>);

<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> tab_category;

<span style="color:#75715e">-- 创建旅游线路表 tab_route
</span><span style="color:#75715e"></span><span style="color:#75715e">/*
</span><span style="color:#75715e">rid 旅游线路主键，自动增长
</span><span style="color:#75715e">rname 旅游线路名称非空，唯一，字符串 100
</span><span style="color:#75715e">price 价格
</span><span style="color:#75715e">rdate 上架时间，日期类型
</span><span style="color:#75715e">cid 外键，所属分类
</span><span style="color:#75715e">*/</span>

<span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> <span style="color:#a6e22e">tab_route</span>(
	rid <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span> <span style="color:#66d9ef">auto_increment</span>, 
    rname <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">100</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span> <span style="color:#66d9ef">unique</span>, 
    price <span style="color:#66d9ef">double</span>,
	rdate <span style="color:#66d9ef">date</span>, 
    cid <span style="color:#66d9ef">int</span>,
<span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span> (cid) <span style="color:#66d9ef">references</span> <span style="color:#a6e22e">tab_category</span>(cid)
)

<span style="color:#75715e">-- 添加旅游线路数据
</span><span style="color:#75715e"></span><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> tab_route <span style="color:#66d9ef">VALUES</span>
(<span style="color:#66d9ef">NULL</span>, <span style="color:#e6db74">&#39;【厦门+鼓浪屿+南普陀寺+曾厝垵 高铁 3 天 惠贵团】尝味友鸭面线 住 1 晚鼓浪屿&#39;</span>, <span style="color:#ae81ff">1499</span>, <span style="color:#e6db74">&#39;2018-01-27&#39;</span>, <span style="color:#ae81ff">1</span>),
(<span style="color:#66d9ef">NULL</span>, <span style="color:#e6db74">&#39;【浪漫桂林 阳朔西街高铁 3 天纯玩 高级团】城徽象鼻ft 兴坪漓江 西ft公园&#39;</span>, <span style="color:#ae81ff">699</span>, <span style="color:#e6db74">&#39;2018-02-
</span><span style="color:#e6db74">22&#39;</span>, <span style="color:#ae81ff">3</span>),
(<span style="color:#66d9ef">NULL</span>, <span style="color:#e6db74">&#39;【爆款￥1699 秒杀】泰国 曼谷 芭堤雅 金沙岛 杜拉拉水上市场 双飞六天【含送签费 泰风情 广州往返 特价团】&#39;</span>, <span style="color:#ae81ff">1699</span>, <span style="color:#e6db74">&#39;2018-01-27&#39;</span>, <span style="color:#ae81ff">2</span>),
(<span style="color:#66d9ef">NULL</span>, <span style="color:#e6db74">&#39;【经典 狮航 ￥2399秒杀】巴厘岛双飞五天 抵玩【广州往返 特价团&#39;</span>, <span style="color:#ae81ff">2399</span>, <span style="color:#e6db74">&#39;2017-12-23&#39;</span>, <span style="color:#ae81ff">2</span>),
(<span style="color:#66d9ef">NULL</span>, <span style="color:#e6db74">&#39;香港迪士尼乐园自由行2天【永东跨境巴士广东至迪士尼去程交通+迪士尼一日门票+香港如心海景酒店暨会议中心标准房1晚住宿】&#39;</span>, <span style="color:#ae81ff">799</span>, <span style="color:#e6db74">&#39;2018-04-10&#39;</span>, <span style="color:#ae81ff">4</span>);

<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> tab_route;
</code></pre></div><h5 id="多对多关系案例">多对多关系案例</h5>
<p>需求：一个用户收藏多个线路，一个线路被多个用户收藏</p>
<p><img src="/works/img/clip_image104.gif" alt="img"></p>
<p>对于多对多的关系我们需要增加一张中间表来维护他们之间的关系</p>
<p>具体操作：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">/*
</span><span style="color:#75715e">创建用户表 tab_user uid 用户主键，自增长
</span><span style="color:#75715e">username 用户名长度 100，唯一，非空
</span><span style="color:#75715e">password 密码长度 30，非空
</span><span style="color:#75715e">name 真实姓名长度 100
</span><span style="color:#75715e">birthday 生日
</span><span style="color:#75715e">sex 性别，定长字符串 1
</span><span style="color:#75715e">telephone 手机号，字符串 11
</span><span style="color:#75715e">email 邮箱，字符串长度 100
</span><span style="color:#75715e">*/</span>

<span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> <span style="color:#a6e22e">tab_user</span> (
	uid <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span> <span style="color:#66d9ef">auto_increment</span>, 
    username <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">100</span>) <span style="color:#66d9ef">unique</span> <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>, 
    password <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">30</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>,
	name <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">100</span>), 
    birthday <span style="color:#66d9ef">date</span>,
	sex <span style="color:#66d9ef">char</span>(<span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">default</span> <span style="color:#e6db74">&#39;男&#39;</span>,
	telephone <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">11</span>), 
    email <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">100</span>)
)

<span style="color:#75715e">-- 添加用户数据
</span><span style="color:#75715e"></span><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> tab_user <span style="color:#66d9ef">VALUES</span>
(<span style="color:#66d9ef">NULL</span>, <span style="color:#e6db74">&#39;cz110&#39;</span>, <span style="color:#ae81ff">123456</span>, <span style="color:#e6db74">&#39;老王&#39;</span>, <span style="color:#e6db74">&#39;1977-07-07&#39;</span>, <span style="color:#e6db74">&#39;男&#39;</span>, <span style="color:#e6db74">&#39;13888888888&#39;</span>, <span style="color:#e6db74">&#39;66666@qq.com&#39;</span>),
(<span style="color:#66d9ef">NULL</span>, <span style="color:#e6db74">&#39;cz119&#39;</span>, <span style="color:#ae81ff">654321</span>, <span style="color:#e6db74">&#39;小王&#39;</span>, <span style="color:#e6db74">&#39;1999-09-09&#39;</span>, <span style="color:#e6db74">&#39;男&#39;</span>, <span style="color:#e6db74">&#39;13999999999&#39;</span>, <span style="color:#e6db74">&#39;99999@qq.com&#39;</span>);

<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> tab_user;

<span style="color:#75715e">/*
</span><span style="color:#75715e">创建收藏表 tab_favorite
</span><span style="color:#75715e">rid 旅游线路 id，外键
</span><span style="color:#75715e">date 收藏时间
</span><span style="color:#75715e">uid 用户 id，外键
</span><span style="color:#75715e">rid 和 uid 不能重复，设置复合主键，同一个用户不能收藏同一个线路两次
</span><span style="color:#75715e">*/</span>

<span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> <span style="color:#a6e22e">tab_favorite</span> ( 
    rid <span style="color:#66d9ef">int</span>,
	<span style="color:#66d9ef">date</span> <span style="color:#66d9ef">datetime</span>, 
    uid <span style="color:#66d9ef">int</span>,
	<span style="color:#75715e">-- 创建复合主键
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span>(rid,uid),
	<span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span> (rid) <span style="color:#66d9ef">references</span> <span style="color:#a6e22e">tab_route</span>(rid), 
    <span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span>(uid) <span style="color:#66d9ef">references</span> <span style="color:#a6e22e">tab_user</span>(uid)
)

<span style="color:#75715e">-- 增加收藏表数据
</span><span style="color:#75715e"></span><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> tab_favorite <span style="color:#66d9ef">VALUES</span>
(<span style="color:#ae81ff">1</span>,<span style="color:#e6db74">&#39;2018-01-01&#39;</span>,<span style="color:#ae81ff">1</span>), <span style="color:#75715e">-- 老王选择厦门
</span><span style="color:#75715e"></span>(<span style="color:#ae81ff">2</span>,<span style="color:#e6db74">&#39;2018-02-11&#39;</span>,<span style="color:#ae81ff">1</span>), <span style="color:#75715e">-- 老王选择桂林
</span><span style="color:#75715e"></span>(<span style="color:#ae81ff">3</span>,<span style="color:#e6db74">&#39;2018-03-21&#39;</span>,<span style="color:#ae81ff">1</span>), <span style="color:#75715e">-- 老王选择泰国
</span><span style="color:#75715e"></span>(<span style="color:#ae81ff">2</span>,<span style="color:#e6db74">&#39;2018-04-21&#39;</span>,<span style="color:#ae81ff">2</span>), <span style="color:#75715e">-- 小王选择桂林
</span><span style="color:#75715e"></span>(<span style="color:#ae81ff">3</span>,<span style="color:#e6db74">&#39;2018-05-08&#39;</span>,<span style="color:#ae81ff">2</span>), <span style="color:#75715e">-- 小王选择泰国
</span><span style="color:#75715e"></span>(<span style="color:#ae81ff">5</span>,<span style="color:#e6db74">&#39;2018-06-02&#39;</span>,<span style="color:#ae81ff">2</span>), <span style="color:#75715e">-- 小王选择迪士尼
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> tab_favorite;
</code></pre></div><h5 id="表与表之间的关系小结">表与表之间的关系小结</h5>
<table>
<thead>
<tr>
<th>表与表的关系</th>
<th>关系的维护</th>
</tr>
</thead>
<tbody>
<tr>
<td>一对多</td>
<td>主外键的关系</td>
</tr>
<tr>
<td>多对多</td>
<td>中间表，两个一对多</td>
</tr>
<tr>
<td>一对一</td>
<td>1)  特殊一对多，从表中的外键设置为唯一  <!-- raw HTML omitted -->2)  从表中的主键又是外键</td>
</tr>
</tbody>
</table>
<h4 id="26-数据库设计">2.6 数据库设计</h4>
<h5 id="数据规范化">数据规范化</h5>
<p>什么是范式：好的数据库设计对数据的存储性能和后期的程序开发，都会产生重要的影响。建立科学的，规范的数据库就需要满足一些规则来优化数据的设计和存储，这些规则就称为范式。</p>
<p>三大范式：</p>
<p>目前关系数据库有六种范式：第一范式（1NF）、第二范式（2NF）、第三范式（3NF）、巴斯-科德范式（BCNF）、第四范式(4NF）和第五范式（5NF，又称完美范式）。满足最低要求的范式是第一范式（1NF）。在第一范式的基础上进一步满足更多规范要求的称为第二范式（2NF，）其余范式以次类推。一般说来，数据库只需满足第三范式(3NF）就行了。</p>
<h5 id="1nf">1NF</h5>
<p>概念：数据库表的每一列都是不可分割的原子数据项，不能是集合、数组等非原子数据项。即表中的某个列有多个值时，必须拆分为不同的列。简而言之，第一范式每一列不可再拆分，称为原子性。</p>
<p>班级表：</p>
<table>
<thead>
<tr>
<th>学号</th>
<th>姓名</th>
<th>班级</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>张三</td>
<td>一年三班</td>
</tr>
<tr>
<td>2</td>
<td>李四</td>
<td>一年二级</td>
</tr>
<tr>
<td>3</td>
<td>王五</td>
<td>二年三班</td>
</tr>
</tbody>
</table>
<h5 id="2nf">2NF</h5>
<p>概念：在满足第一范式的前提下，表中的每一个字段都完全依赖于主键。</p>
<p>所谓完全依赖是指不能存在仅依赖主键一部分的列。简而言之，第二范式就是在第一范式的基础上所有列完全依赖于主键列。当存在一个复合主键包含多个主键列的时候，才会发生不符合第二范式的情况。比如有一个主键有两个列，不能存在这样的属性，它只依赖于其中一个列，这就是不符合第二范式。</p>
<p>第二范式的特点：</p>
<p>​	1)   一张表只描述一件事情。</p>
<p>​	2)   表中的每一列都完全依赖于主键</p>
<p>示例：</p>
<p>​	1)  借书证表：</p>
<table>
<thead>
<tr>
<th>学生证号</th>
<th>学生证名称</th>
<th>学生证办理时间</th>
<th>借书证号</th>
<th>借书证名称</th>
<th>借书证办理时间</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>​	2)  分成两张表</p>
<table>
<thead>
<tr>
<th>学生证号</th>
<th>学生证名称</th>
<th>学生证办理时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>借书证号</td>
<td>借书证名称</td>
<td>借书证办理时间</td>
</tr>
</tbody>
</table>
<h5 id="3nf">3NF：</h5>
<p>概念：在满足第二范式的前提下，表中的每一列都直接依赖于主键，而不是通过其它的列来间接依赖于主键。</p>
<p>简而言之，第三范式就是所有列不依赖于其它非主键列，也就是在满足 2NF 的基础上，任何非主列不得传递依赖于主键。所谓传递依赖，指的是如果存在&quot;A → B → C&quot;的决定关系，则 C 传递依赖于 A。因此，满足第三范式的数据库表应该不存在如下依赖关系：主键列 → 非主键列 x → 非主键列 y</p>
<p>示例：学生信息表</p>
<table>
<thead>
<tr>
<th>学号</th>
<th>姓名</th>
<th>年龄</th>
<th>所在学院</th>
<th>学院地点</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>存在传递的决定关系：学号—&gt;所在学院 —&gt; 学院地点</p>
<p>拆分成两张表</p>
<table>
<thead>
<tr>
<th>学号</th>
<th>姓名</th>
<th>年龄</th>
<th>所在学院的编号(外键)</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>学院编号</th>
<th>所在学院</th>
<th>学院地点</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>​</p>
<h5 id="三大范式小结">三大范式小结</h5>
<table>
<thead>
<tr>
<th>范式</th>
<th>特点</th>
</tr>
</thead>
<tbody>
<tr>
<td>1NF</td>
<td>原子性：表中每列不可再拆分。</td>
</tr>
<tr>
<td>2NF</td>
<td>不产生局部依赖，一张表只描述一件事情</td>
</tr>
<tr>
<td>3NF</td>
<td>不产生传递依赖，表中每一列都直接依赖于主键。而不是通过其它列间接依赖于主键。</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="第三章">第三章</h3>
<hr>
<h5 id="本章内容-2">本章内容</h5>
<ul>
<li>表连接查询</li>
<li>子查询</li>
<li>事务</li>
<li>DCL (Data Control Language)</li>
</ul>
<hr>
<h4 id="31-表连接查询">3.1 表连接查询</h4>
<h5 id="什么是多表查询">什么是多表查询</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 数据准备  
</span><span style="color:#75715e"></span><span style="color:#66d9ef">use</span> db3

<span style="color:#75715e">-- 创建部门表
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span>     <span style="color:#a6e22e">dept</span>(     
    id <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span> <span style="color:#66d9ef">auto_increment</span>, 
    name <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">20</span>)     
)           
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">dept</span> (name) <span style="color:#66d9ef">values</span> (<span style="color:#e6db74">&#39;开发部&#39;</span>),(<span style="color:#e6db74">&#39;市场部&#39;</span>),(<span style="color:#e6db74">&#39;财务部&#39;</span>);     


<span style="color:#75715e"># 创建员工表     
</span><span style="color:#75715e"></span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span>     <span style="color:#a6e22e">emp</span> (     
    id <span style="color:#66d9ef">int</span> <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span> <span style="color:#66d9ef">auto_increment</span>, 
    name     <span style="color:#66d9ef">varchar</span>(<span style="color:#ae81ff">10</span>),     
    gender <span style="color:#66d9ef">char</span>(<span style="color:#ae81ff">1</span>),  <span style="color:#75715e">-- 性别     
</span><span style="color:#75715e"></span>    salary <span style="color:#66d9ef">double</span>,  <span style="color:#75715e">-- 工资 
</span><span style="color:#75715e"></span>    join_date <span style="color:#66d9ef">date</span>, <span style="color:#75715e">-- 入职日期     
</span><span style="color:#75715e"></span>    dept_id <span style="color:#66d9ef">int</span>,     
    <span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span> (dept_id)     
    <span style="color:#66d9ef">references</span> <span style="color:#a6e22e">dept</span>(id) <span style="color:#75715e">-- 外键，关联部门表(部门表的主键)     
</span><span style="color:#75715e"></span>)     

<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span>     <span style="color:#a6e22e">emp</span>(name,gender,salary,join_date,dept_id) <span style="color:#66d9ef">values</span>
(<span style="color:#e6db74">&#39;孙悟空&#39;</span>,<span style="color:#e6db74">&#39;男 &#39;</span>,<span style="color:#ae81ff">7200</span>,<span style="color:#e6db74">&#39;2013-02-24&#39;</span>,<span style="color:#ae81ff">1</span>);     
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span>     <span style="color:#a6e22e">emp</span>(name,gender,salary,join_date,dept_id)     <span style="color:#66d9ef">values</span>
(<span style="color:#e6db74">&#39;猪八戒&#39;</span>,<span style="color:#e6db74">&#39;男     &#39;</span>,<span style="color:#ae81ff">3600</span>,<span style="color:#e6db74">&#39;2010-12-02&#39;</span>,<span style="color:#ae81ff">2</span>);                         
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">emp</span>(name,gender,salary,join_date,dept_id) <span style="color:#66d9ef">values</span>
(<span style="color:#e6db74">&#39;唐僧&#39;</span>,<span style="color:#e6db74">&#39;男&#39;</span>,<span style="color:#ae81ff">9000</span>,<span style="color:#e6db74">&#39;2008- 08-08&#39;</span>,<span style="color:#ae81ff">2</span>);    
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">emp</span>(name,gender,salary,join_date,dept_id) <span style="color:#66d9ef">values</span>
(<span style="color:#e6db74">&#39;白骨精&#39;</span>,<span style="color:#e6db74">&#39;女    &#39;</span>,<span style="color:#ae81ff">5000</span>,<span style="color:#e6db74">&#39;2015-10-07&#39;</span>,<span style="color:#ae81ff">3</span>);    
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">emp</span>(name,gender,salary,join_date,dept_id) <span style="color:#66d9ef">values</span>
(<span style="color:#e6db74">&#39;蜘蛛精&#39;</span>,<span style="color:#e6db74">&#39;女 &#39;</span>,<span style="color:#ae81ff">4500</span>,<span style="color:#e6db74">&#39;2011-03-14&#39;</span>,<span style="color:#ae81ff">1</span>);   
</code></pre></div><p>​</p>
<h5 id="多表查询的作用">多表查询的作用：</h5>
<p>比如：我们想查询孙悟空的名字和他所在的部门的名字，则需要使用多表查询。</p>
<p>如果一条 SQL 语句查询多张表，因为查询结果在多张不同的表中。每张表取 1 列或多列。</p>
<p>多表查询的分类：</p>
<p><img src="/img/image-20201224164145192.png" alt="image-20201224164145192"></p>
<h5 id="笛卡尔积现象">笛卡尔积现象</h5>
<p>什么是笛卡尔积：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 需求：查询所有的员工和所有的部门     
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> emp,dept;  
</code></pre></div><p>结果分析：如何清除笛卡尔积现象的影响</p>
<p>我们发现不是所有的数据组合都是有用的，只有员工表.dept_id = 部门表.id 的数据才是有用的。所以需要通过条件过滤掉没用的数据。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 设置过滤条件            
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> emp,dept <span style="color:#66d9ef">where</span> emp.dept_id <span style="color:#f92672">=</span> dept.id;           

<span style="color:#75715e">-- 查询员工和部门的名字     
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> emp.name, dept.name <span style="color:#66d9ef">from</span> emp,dept <span style="color:#66d9ef">where</span> emp.dept_id <span style="color:#f92672">=</span> dept.id; 
</code></pre></div><p>​</p>
<h5 id="内连接">内连接</h5>
<p>用左边表的记录去匹配右边表的记录，如果符合条件的则显示。如：从表.外键=主表.主键</p>
<p>隐式内连接：看不到 JOIN 关键字，条件使用 WHERE 指定</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SELECT</span> <span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#66d9ef">FROM</span> <span style="color:#960050;background-color:#1e0010">左表</span>, <span style="color:#960050;background-color:#1e0010">右表</span> <span style="color:#66d9ef">WHERE</span> <span style="color:#960050;background-color:#1e0010">条件</span>    
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> emp,dept <span style="color:#66d9ef">where</span> emp.dept_id<span style="color:#f92672">=</span> dept.id;  
</code></pre></div><p><img src="/img/image-20201224164530975.png" alt="image-20201224164530975"></p>
<p>显式内连接</p>
<p>显示内连接：使用 INNER JOIN &hellip; ON 语句, 可以省略 INNER</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SELECT</span> <span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#66d9ef">FROM</span> <span style="color:#960050;background-color:#1e0010">左表</span> [<span style="color:#66d9ef">INNER</span>] <span style="color:#66d9ef">JOIN</span> <span style="color:#960050;background-color:#1e0010">右表</span> <span style="color:#66d9ef">ON</span> <span style="color:#960050;background-color:#1e0010">条件</span>                            
</code></pre></div><p>查询唐僧的信息，显示员工 id，姓名，性别，工资和所在的部门名称</p>
<p>我们发现需要联合 2 张表同时才能查询出需要的数据，使用内连接</p>
<p>​	1)   确定查询哪些</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> emp <span style="color:#66d9ef">inner</span> <span style="color:#66d9ef">join</span> dept;          
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> emp e <span style="color:#66d9ef">inner</span> <span style="color:#66d9ef">join</span> dept d <span style="color:#66d9ef">on</span> e.dept_id <span style="color:#f92672">=</span> d.id;   
</code></pre></div><p>​	2)    确定表连接条件，员工表.dept_id = 部门表.id 的数据才是有效的</p>
<p><img src="/img/image-20201224164755746.png" alt="image-20201224164755746"></p>
<p>​	3)   确定查询条件，我们查询的是唐僧的信息，员工表.name='唐僧&rsquo;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> emp e <span style="color:#66d9ef">inner</span> <span style="color:#66d9ef">join</span> dept d <span style="color:#66d9ef">on</span> e.dept_id <span style="color:#f92672">=</span> d.id <span style="color:#66d9ef">where</span> e.name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;唐僧 &#39;</span>; 
</code></pre></div><p>​        <img src="/img/image-20201224164906207.png" alt="image-20201224164906207"></p>
<p>​	4)  确定查询字段，查询唐僧的信息，显示员工 id，姓名，性别，工资和所在的部门名称</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">select</span> e.id,e.name,e.gender,e.salary,d.name <span style="color:#66d9ef">from</span> emp e <span style="color:#66d9ef">inner</span> <span style="color:#66d9ef">join</span> dept d <span style="color:#66d9ef">on</span> e.dept_id <span style="color:#f92672">=</span> d.id <span style="color:#66d9ef">where</span> e.name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;唐僧&#39;</span>;     
</code></pre></div><p>​     <img src="/img/image-20201224164956003.png" alt="image-20201224164956003"></p>
<ol start="5">
<li>
<pre><code>我们发现写表名有点长，可以给表取别名，显示的字段名也使用别名        
</code></pre>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"> <span style="color:#66d9ef">select</span> e.id <span style="color:#960050;background-color:#1e0010">编号</span>,e.name <span style="color:#960050;background-color:#1e0010">姓名</span>,e.gender <span style="color:#960050;background-color:#1e0010">性别</span>,e.salary <span style="color:#960050;background-color:#1e0010">工资</span>,d.name <span style="color:#960050;background-color:#1e0010">部门名字</span> <span style="color:#66d9ef">from</span> emp e <span style="color:#66d9ef">inner</span> <span style="color:#66d9ef">join</span> dept d <span style="color:#66d9ef">on</span> e.dept_id <span style="color:#f92672">=</span> d.id <span style="color:#66d9ef">where</span> e.name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;唐僧&#39;</span>;  
</code></pre></div><p>​        <img src="/img/image-20201224165034413.png" alt="image-20201224165034413"></p>
<p>总结内连接查询步骤：</p>
<p>​	1)    确定查询哪些表</p>
<p>​	2)    确定表连接的条件</p>
<p>​	3)    确定查询的条件</p>
<p>​	4)    确定查询的字段</p>
<h5 id="左外连接">左外连接</h5>
<p>左外连接：使用 LEFT OUTER JOIN &hellip; ON，OUTER 可以省略</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SELECT</span> <span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#66d9ef">FROM</span> <span style="color:#960050;background-color:#1e0010">左表</span> <span style="color:#66d9ef">LEFT</span> [<span style="color:#66d9ef">OUTER</span>] <span style="color:#66d9ef">JOIN</span> <span style="color:#960050;background-color:#1e0010">右表</span> <span style="color:#66d9ef">ON</span> <span style="color:#960050;background-color:#1e0010">条件</span>         
</code></pre></div><p>用左边表的记录去匹配右边表的记录，如果符合条件的则显示；否则，显示 NULL</p>
<p>可以理解为：在内连接的基础上保证左表的数据全部显示(左表是部门，右表员工)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"> <span style="color:#75715e">-- 在部门表中增加一个销售部     
</span><span style="color:#75715e"></span> <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">dept</span> (name) <span style="color:#66d9ef">values</span> (<span style="color:#e6db74">&#39;销售部&#39;</span>); 
 <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> dept;           
 
 <span style="color:#75715e">-- 使用内连接查询     
</span><span style="color:#75715e"></span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> dept d <span style="color:#66d9ef">inner</span> <span style="color:#66d9ef">join</span> emp e <span style="color:#66d9ef">on</span> d.id <span style="color:#f92672">=</span> e.dept_id;           
 
 <span style="color:#75715e">-- 使用左外连接查询     
</span><span style="color:#75715e"></span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> dept d <span style="color:#66d9ef">left</span> <span style="color:#66d9ef">join</span> emp e <span style="color:#66d9ef">on</span> d.id <span style="color:#f92672">=</span> e.dept_id;  
</code></pre></div><p><img src="/img/image-20201224165240459.png" alt="image-20201224165240459"></p>
<h5 id="右外连接">右外连接</h5>
<p>右外连接：使用 RIGHT OUTER JOIN &hellip; ON，OUTER 可以省略</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SELECT</span> <span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#66d9ef">FROM</span> <span style="color:#960050;background-color:#1e0010">左表</span> <span style="color:#66d9ef">RIGHT</span> [<span style="color:#66d9ef">OUTER</span> ]<span style="color:#66d9ef">JOIN</span> <span style="color:#960050;background-color:#1e0010">右表</span> <span style="color:#66d9ef">ON</span> <span style="color:#960050;background-color:#1e0010">条件</span>   
</code></pre></div><p>用右边表的记录去匹配左边表的记录，如果符合条件的则显示；否则，显示 NULL</p>
<p>可以理解为：在内连接的基础上保证右表的数据全部显示</p>
<p><img src="/img/image-20201224165436598.png" alt="image-20201224165436598"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">  <span style="color:#75715e">-- 在员工表中增加一个员工     
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> emp <span style="color:#66d9ef">values</span> (<span style="color:#66d9ef">null</span>, <span style="color:#e6db74">&#39;沙僧&#39;</span>,<span style="color:#e6db74">&#39;男&#39;</span>,<span style="color:#ae81ff">6666</span>,<span style="color:#e6db74">&#39;2013-12-05&#39;</span>,<span style="color:#66d9ef">null</span>); 
  <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> emp;     
  
  <span style="color:#75715e">-- 使用内连接查询     
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> dept <span style="color:#66d9ef">inner</span> <span style="color:#66d9ef">join</span> emp <span style="color:#66d9ef">on</span> dept.id <span style="color:#f92672">=</span> emp.dept_id;           
  
  <span style="color:#75715e">-- 使用右外连接查询     
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> dept <span style="color:#66d9ef">right</span> <span style="color:#66d9ef">join</span> emp <span style="color:#66d9ef">on</span> dept.id <span style="color:#f92672">=</span> emp.dept_id;    
</code></pre></div><p><img src="/img/image-20201224165538461.png" alt="image-20201224165538461"></p>
<h4 id="32-子查询">3.2 子查询</h4>
<p>什么是子查询</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 需求：查询开发部中有哪些员工  
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> emp; 

<span style="color:#75715e">-- 通过两条语句查询   
</span><span style="color:#75715e">-- 1.查询开发部中有哪些员工
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> id <span style="color:#66d9ef">from</span> dept <span style="color:#66d9ef">where</span> name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;开发部&#39;</span> ; 
<span style="color:#75715e">-- 2.查询出部门id为1的员工
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> emp <span style="color:#66d9ef">where</span> dept_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;    

<span style="color:#75715e">-- 使用子查询    
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> emp <span style="color:#66d9ef">where</span> dept_id <span style="color:#f92672">=</span> (<span style="color:#66d9ef">select</span> id <span style="color:#66d9ef">from</span> dept <span style="color:#66d9ef">where</span> name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;开发部&#39;</span>);       
</code></pre></div><p>子查询的概念：</p>
<p>​	1)  一个查询的结果做为另一个查询的条件</p>
<p>​	2)  有查询的嵌套，内部的查询称为子查询</p>
<p>​	3)  子查询要使用括号</p>
<h5 id="子查询结果的三种情况">子查询结果的三种情况：</h5>
<p>​	1)   子查询的结果是单行单列</p>
<p><img src="/img/image-20201224165752303.png" alt="image-20201224165752303"></p>
<p>​	2)   子查询的结果是多行单列</p>
<p><img src="/img/image-20201224165812968.png" alt="image-20201224165812968"></p>
<p>​	3)   子查询的结果是多行多列</p>
<p><img src="/img/image-20201224165837561.png" alt="image-20201224165837561"></p>
<h5 id="子查询的结果是一个值的时候">子查询的结果是一个值的时候</h5>
<p>子查询结果只要是单行单列，肯定在 WHERE 后面作为条件，父查询使用：比较运算符，如：&gt; 、&lt;、&lt;&gt;、=等</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SELECT</span> <span style="color:#960050;background-color:#1e0010">查询字段</span> <span style="color:#66d9ef">FROM</span> <span style="color:#960050;background-color:#1e0010">表</span> <span style="color:#66d9ef">WHERE</span> <span style="color:#960050;background-color:#1e0010">字段</span><span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">（子查询）</span>;          
</code></pre></div><p>案例：查询工资最高的员工是谁？</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">  <span style="color:#75715e">-- 1) 查询最高工资是多少     
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">select</span> <span style="color:#a6e22e">max</span>(salary) <span style="color:#66d9ef">from</span> emp;     
  
  <span style="color:#75715e">-- 2) 根据最高工资到员工表查询到对应的员工信息     
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> emp <span style="color:#66d9ef">where</span> salary <span style="color:#f92672">=</span> (<span style="color:#66d9ef">select</span> <span style="color:#a6e22e">max</span>(salary) <span style="color:#66d9ef">from</span> emp);   
</code></pre></div><p>查询工资小于平均工资的员工有哪些？</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">  <span style="color:#75715e">-- 1) 查询平均工资是多少    
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">select</span> <span style="color:#a6e22e">avg</span>(salary) <span style="color:#66d9ef">from</span> emp;    
  
  <span style="color:#75715e">-- 2) 到员工表查询小于平均的员工信息    
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> emp <span style="color:#66d9ef">where</span> salary <span style="color:#f92672">&lt;</span> (<span style="color:#66d9ef">select</span> <span style="color:#a6e22e">avg</span>(salary) <span style="color:#66d9ef">from</span> emp);    
</code></pre></div><p>​</p>
<h5 id="子查询结果是多行单列的时候">子查询结果是多行单列的时候</h5>
<p>子查询结果是单例多行，结果集类似于一个数组，父查询使用 IN 运算符</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SELECT</span> <span style="color:#960050;background-color:#1e0010">查询字段</span> <span style="color:#66d9ef">FROM</span> <span style="color:#960050;background-color:#1e0010">表</span> <span style="color:#66d9ef">WHERE</span> <span style="color:#960050;background-color:#1e0010">字段</span> <span style="color:#66d9ef">IN</span> <span style="color:#960050;background-color:#1e0010">（子查询）</span>;                            
</code></pre></div><p>查询工资大于 5000 的员工，来自于哪些部门的名字</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 先查询大于 5000 的员工所在的部门 id     
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> dept_id <span style="color:#66d9ef">from</span> emp <span style="color:#66d9ef">where</span> salary <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">5000</span>;     

<span style="color:#75715e">-- 再查询在这些部门 id 中部门的名字  Subquery returns     more than 1 row     
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> name <span style="color:#66d9ef">from</span> dept <span style="color:#66d9ef">where</span> id <span style="color:#f92672">=</span> (<span style="color:#66d9ef">select</span> dept_id <span style="color:#66d9ef">from</span> emp <span style="color:#66d9ef">where</span> salary <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">5000</span>);       <span style="color:#75715e">-- 错误用法
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> name <span style="color:#66d9ef">from</span> dept <span style="color:#66d9ef">where</span> id <span style="color:#66d9ef">in</span> (<span style="color:#66d9ef">select</span> dept_id <span style="color:#66d9ef">from</span> emp <span style="color:#66d9ef">where</span> salary <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">5000</span>);    
</code></pre></div><p>查询开发部与财务部所有的员工信息</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 先查询开发部与财务部的     id     
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> id <span style="color:#66d9ef">from</span> dept <span style="color:#66d9ef">where</span> name <span style="color:#66d9ef">in</span>(<span style="color:#e6db74">&#39;开发部&#39;</span>,<span style="color:#e6db74">&#39;财务部&#39;</span>);     

<span style="color:#75715e">-- 再查询在这些部门 id 中有哪些员工     
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> emp <span style="color:#66d9ef">where</span> dept_id <span style="color:#66d9ef">in</span> (<span style="color:#66d9ef">select</span> id <span style="color:#66d9ef">from</span> dept <span style="color:#66d9ef">where</span> name <span style="color:#66d9ef">in</span>(<span style="color:#e6db74">&#39;开发部&#39;</span>,<span style="color:#e6db74">&#39;财务部&#39;</span>));          
</code></pre></div><h5 id="子查询的结果是多行多列">子查询的结果是多行多列</h5>
<p>子查询结果只要是多列，肯定在 FROM 后面作为表</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SELECT</span> <span style="color:#960050;background-color:#1e0010">查询字段</span> <span style="color:#66d9ef">FROM</span> <span style="color:#960050;background-color:#1e0010">（子查询）</span> <span style="color:#960050;background-color:#1e0010">表别名</span> <span style="color:#66d9ef">WHERE</span> <span style="color:#960050;background-color:#1e0010">条件</span>;                                     
</code></pre></div><p>子查询作为表需要取别名，否则这张表没有名称则无法访问表中的字段</p>
<p>查询出 2011 年以后入职的员工信息，包括部门名称</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"> <span style="color:#75715e">-- 查询出 2011 年以后入职的员工信息，包括部门名称     
</span><span style="color:#75715e"></span> <span style="color:#75715e">-- 在员工表中查询 2011-1-1 以后入职的员工     
</span><span style="color:#75715e"></span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> emp <span style="color:#66d9ef">where</span> join_date <span style="color:#f92672">&gt;=</span><span style="color:#e6db74">&#39;2011-1-1&#39;</span>;           
 
 <span style="color:#75715e">-- 查询所有的部门信息，与上面的虚拟表中的信息组合，找出所有部门 id 等于的 dept_id     
</span><span style="color:#75715e"></span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> dept d, (<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> emp <span style="color:#66d9ef">where</span> join_date <span style="color:#f92672">&gt;=</span><span style="color:#e6db74">&#39;2011-1-1&#39;</span>) e <span style="color:#66d9ef">where</span> d.id<span style="color:#f92672">=</span> e.dept_id ;          

<span style="color:#75715e">-- 也可以使用表连接：
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> emp <span style="color:#66d9ef">inner</span> <span style="color:#66d9ef">join</span> dept <span style="color:#66d9ef">on</span> emp.dept_id <span style="color:#f92672">=</span> dept.id <span style="color:#66d9ef">where</span> join_date <span style="color:#f92672">&gt;=</span><span style="color:#e6db74">&#39;2011-1-1&#39;</span>;    
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> emp <span style="color:#66d9ef">inner</span> <span style="color:#66d9ef">join</span> dept <span style="color:#66d9ef">on</span> emp.dept_id <span style="color:#f92672">=</span> dept.id <span style="color:#66d9ef">and</span> join_date <span style="color:#f92672">&gt;=</span><span style="color:#e6db74">&#39;2011-1-1&#39;</span>;  
</code></pre></div><h5 id="子查询小结">子查询小结</h5>
<ul>
<li>
<p>子查询结果只要是单列，则在 WHERE 后面作为条件</p>
</li>
<li>
<p>子查询结果只要是多列，则在 FROM 后面作为表进行二次查询</p>
</li>
</ul>
<h4 id="33-事务">3.3 事务</h4>
<h5 id="事务的应用场景说明">事务的应用场景说明</h5>
<p>什么是事务： 在实际的开发过程中，一个业务操作如：转账，往往是要多次访问数据库才能完成的。转账是一个用户扣钱，另一个用户加钱。如果其中有一条 SQL 语句出现异常，这条 SQL 就可能执行失败。</p>
<p>事务执行是一个整体，所有的 SQL 语句都必须执行成功。如果其中有 1 条SQL 语句出现异常，则所有的SQL 语句都要回滚，整个业务执行失败。</p>
<p>转账的操作:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"> <span style="color:#75715e">-- 创建数据表     
</span><span style="color:#75715e"></span> <span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#a6e22e">account</span> (     
     id <span style="color:#66d9ef">INT</span> <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> <span style="color:#66d9ef">AUTO_INCREMENT</span>, 
     NAME <span style="color:#66d9ef">VARCHAR</span>(<span style="color:#ae81ff">10</span>),     
     balance <span style="color:#66d9ef">DOUBLE</span>     
 );          
 
 <span style="color:#75715e">-- 图形界面 添加数据 
</span></code></pre></div><p>模拟张三给李四转 500 元钱，一个转账的业务操作最少要执行下面的 2 条语句：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">  <span style="color:#75715e">-- 张三账号-500     
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">update</span> account <span style="color:#66d9ef">set</span> balance <span style="color:#f92672">=</span> balance <span style="color:#f92672">-</span> <span style="color:#ae81ff">500</span> <span style="color:#66d9ef">where</span> name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;张三&#39;</span>;     
  
  <span style="color:#75715e">-- 李四账号+500     
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">update</span> account <span style="color:#66d9ef">set</span> balance <span style="color:#f92672">=</span> balance <span style="color:#f92672">+</span> <span style="color:#ae81ff">500</span> <span style="color:#66d9ef">where</span> name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;李四&#39;</span>;   
</code></pre></div><p>假设当张三账号上-500 元,服务器崩溃了。李四的账号并没有+500 元，数据就出现问题了。我们需要保证其中一条 SQL 语句出现问题，整个转账就算失败。只有两条 SQL 都成功了转账才算成功。这个时候就需要用到事务。</p>
<p>MYSQL 中可以有两种方式进行事务的操作：</p>
<p>​	1)   手动提交事务</p>
<p>​	2)   自动提交事务</p>
<h5 id="手动提交事务">手动提交事务</h5>
<p>手动提交事务的 SQL 语句</p>
<table>
<thead>
<tr>
<th>功能</th>
<th>SQL 语句</th>
</tr>
</thead>
<tbody>
<tr>
<td>开启事务</td>
<td>start transaction;</td>
</tr>
<tr>
<td>提交事务</td>
<td>commit;</td>
</tr>
<tr>
<td>回滚事务</td>
<td>rollback;</td>
</tr>
</tbody>
</table>
<p>手动提交事务使用过程：</p>
<p>​	1)  执行成功的情况： 开启事务 &gt; 执行多条 SQL 语句 &gt; 成功提交事务</p>
<p>​	2)  执行失败的情况： 开启事务 &gt; 执行多条 SQL 语句 &gt; 事务的回滚</p>
<p><img src="/img/image-20201224170616679.png" alt="image-20201224170616679"></p>
<p>案例演示 1：事务提交</p>
<p>模拟张三给李四转 500 元钱（成功） 目前数据库数据如下：</p>
<p><img src="/img/image-20201224170654646.png" alt="image-20201224170654646"></p>
<p>​	1)  使用 DOS 控制台进入 MySQL 设置编码解决中文乱码：set names gbk;</p>
<p>​	2)  执行以下 SQL 语句： 1.开启事务， 2.张三账号-500， 3.李四账号+500</p>
<p>​	3)  使用 SQLYog 查看数据库：发现数据并没有改变</p>
<p>​	4)  在控制台执行 commit 提交事务：</p>
<p>​	5)  使用 SQLYog 查看数据库：发现数据改变</p>
<p><img src="/img/image-20201224170750638.png" alt="image-20201224170750638"></p>
<p>案例演示 2：事务回滚</p>
<p>模拟张三给李四转 500 元钱（失败） 目前数据库数据如下：</p>
<p><img src="/img/image-20201224170840447.png" alt="image-20201224170840447"></p>
<p>​	1)  在控制台执行以下 SQL 语句：1.开启事务， 2.张三账号-500 3.李四账号+500</p>
<p>​	2)  使用 SQLYog 查看数据库：发现数据并没有改变</p>
<p>​	3)  在控制台执行 rollback 回滚事务：</p>
<p>​	4)  使用 SQLYog 查看数据库：发现数据没有改变</p>
<p><img src="/img/image-20201224170936123.png" alt="image-20201224170936123"></p>
<p><img src="/img/image-20201224171028706.png" alt="image-20201224171028706"></p>
<p><img src="/img/image-20201224171042754.png" alt="image-20201224171042754"></p>
<p>总结: 如果事务中 SQL 语句没有问题，commit 提交事务，会对数据库数据的数据进行改变。 如果事务中 SQL</p>
<p>语句有问题，rollback 回滚事务，会回退到开启事务时的状态。</p>
<h5 id="自动提交事务">自动提交事务</h5>
<p>MySQL 默认每一条 DML(增删改)语句都是一个单独的事务，每条语句都会自动开启一个事务，语句执行完毕自动提交事务，MySQL 默认开始自动提交事</p>
<p>案例演示 3：自动提交事务</p>
<ol>
<li>
<p>将金额重置为 1000</p>
</li>
<li>
<p>更新其中某一个账户</p>
</li>
<li>
<p>使用 SQLYog 查看数据库：发现数据已经改变</p>
</li>
</ol>
<p>案例演示 4：取消自动提交</p>
<p>查看 MySQL 是否开启自动提交事务</p>
<p><img src="/img/image-20201224171145315.png" alt="image-20201224171145315"></p>
<p>@@表示全局变量，1 表示开启，0 表示关闭</p>
<p>取消自动提交事务</p>
<p><img src="/img/image-20201224171221702.png" alt="image-20201224171221702"></p>
<p>执行更新语句，使用 SQLYog 查看数据库，发现数据并没有改变</p>
<p>在控制台执行 commit 提交任务</p>
<p><img src="/img/image-20201224171252575.png" alt="image-20201224171252575"></p>
<h5 id="事务原理">事务原理</h5>
<p>事务开启之后, 所有的操作都会临时保存到事务日志中, 事务日志只有在得到 commit 命令才会同步到数据表中，其他任何情况都会清空事务日志(rollback，断开连接)</p>
<p>原理图：</p>
<p><img src="/img/image-20201224171330411.png" alt="image-20201224171330411"></p>
<p>事务的步骤：</p>
<p>​	1)   客户端连接数据库服务器，创建连接时创建此用户临时日志文件</p>
<p>​	2)   开启事务以后，所有的操作都会先写入到临时日志文件中</p>
<p>​	3)   所有的查询操作从表中查询，但会经过日志文件加工后才返回</p>
<p>​	4)   如果事务提交则将日志文件中的数据写到表中，否则清空日志文件。</p>
<h5 id="回滚点">回滚点</h5>
<p>什么是回滚点？在某些成功的操作完成之后，后续的操作有可能成功有可能失败，但是不管成功还是失败，前面操作都已经成功，可以在当前成功的位置设置一个回滚点。可以供后续失败操作返回到该位置，而不是返回所有操作，这个点称之为回滚点。</p>
<p>回滚点的操作语句</p>
<table>
<thead>
<tr>
<th>回滚点的操作语句</th>
<th>语句</th>
</tr>
</thead>
<tbody>
<tr>
<td>设置回滚点</td>
<td>savepoint  名字</td>
</tr>
<tr>
<td>回到回滚点</td>
<td>rollback to 名字</td>
</tr>
</tbody>
</table>
<p>具体操作：</p>
<p>​	1)  将数据还原到 1000</p>
<p>​	2)  开启事务</p>
<p>​	3)  让张三账号减 10 块</p>
<p>​	4)  设置回滚点：savepoint p;</p>
<p>​	5)  让张三账号减 10 块</p>
<p>​	6)  回到回滚点：rollback to p;</p>
<p>​	7)  分析执行过程</p>
<p>总结：设置回滚点可以让我们在失败的时候回到回滚点，而不是回到事务开启的时候。</p>
<h5 id="事务的隔离级别">事务的隔离级别</h5>
<p>事务的四大特性 ACID</p>
<table>
<thead>
<tr>
<th>事务特性</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>原子性（Atomicity）</td>
<td>每个事务都是一个整体，不可再拆分，事务中所有的 SQL 语句要么都执行成功，  要么都失败。</td>
</tr>
<tr>
<td>一致性（Consistency）</td>
<td>事务在执行前数据库的状态与执行后数据库的状态保持一致。如：转账前2 个人的  总金额是 2000，转账后  2 个人总金额也是 2000（一致性的规则是自己定义的）</td>
</tr>
<tr>
<td>隔离性（Isolation）</td>
<td>事务与事务之间不应该相互影响，执行时保持隔离的状态。</td>
</tr>
<tr>
<td>持久性（Durability）</td>
<td>一旦事务执行成功，对数据库的修改是持久的。就算关机，也是保存下来的。</td>
</tr>
</tbody>
</table>
<p>事务的隔离级别</p>
<p>事务在操作时的理想状态： 所有的事务之间保持隔离，互不影响。因为并发操作，多个用户同时访问同一个数据。可能引发并发访问的问题：</p>
<table>
<thead>
<tr>
<th>并发访问的问题</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>脏读</td>
<td>一个事务读取到了另一个事务中尚未提交的数据</td>
</tr>
<tr>
<td>不可重复读</td>
<td>事物一读取到了age的值20，事物二将该值修改成了28，事物一再次读取age的值28，事物一两次读取的age值不一致</td>
</tr>
<tr>
<td>幻读</td>
<td>事物一读取到A表中有一条记录，事物二往A表中插入一条记录，事物一再次读取的时候记录变成了两条，就像发生幻觉一样</td>
</tr>
</tbody>
</table>
<p>不可重复读和幻读很相似，可以从两个角度理解两者的差别：</p>
<ol>
<li>
<p>不可重复读是另一个事物修改了数据，导致该事务多次读取出来的值不一样。而幻读是另一个事物插入或删除了记录，导致该事物多次读取出来的记录数不一样</p>
</li>
<li>
<p>不可重复读的解决只需要锁住会发生修改的记录就可以，幻读需要锁住的范围更大一些。</p>
</li>
</ol>
<p>MySQL 数据库有四种隔离级别</p>
<p>上面的级别最低，下面的级别最高。“是”表示会出现这种问题，“否”表示不会出现这种问题。</p>
<table>
<thead>
<tr>
<th>级别</th>
<th>名字</th>
<th>隔离级别</th>
<th>脏读</th>
<th>不可重复读</th>
<th>幻读</th>
<th>数据库默认隔离级别</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>读未提交</td>
<td>read  uncommitted</td>
<td>是</td>
<td>是</td>
<td>是</td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>读已提交</td>
<td>read  committed</td>
<td>否</td>
<td>是</td>
<td>是</td>
<td>Oracle  和 SQL  Server</td>
</tr>
<tr>
<td>3</td>
<td>可重复读</td>
<td>repeatable read</td>
<td>否</td>
<td>否</td>
<td>是</td>
<td>MySQL</td>
</tr>
<tr>
<td>4</td>
<td>串行化</td>
<td>serializable</td>
<td>否</td>
<td>否</td>
<td>否</td>
<td></td>
</tr>
</tbody>
</table>
<ol>
<li>
<p>读未提交（read uncommitted）: 事务中的修改，即使没有提交，其他事务也可以看得到。在这种隔离级别下有可能发生脏读，不可重复读和幻读。</p>
<p>一家酒店对外预定房间，现在还剩四间房，一个顾客到小王这里来预定四间房，小王查询系统发现还剩四间就将这四间房预定出去，该事务还没提交的时候另一个顾客到小李这里来预定房间，小李查询系统发现没房了，就拒绝了这个订单，此时小王的电脑发生故障，事务回滚，订单失效，这就是脏读造成的影响。</p>
</li>
<li>
<p>读已提交（read committed）: 事务中的修改只有提交以后才能被其它事务看到。在这种隔离级别下有可能发生不可重复读和幻读。</p>
<p>还是定房间的例子，一个顾客到小王这里来预定四间房，小王将这四间房预定了出去，该事务还没提交的时候另一个顾客到小李这里来预定房间，小李查询系统发现还有四间房，刚想预定的时候小王的事务提交了，小李的系统立马呈现0间房。这就是不可重复读造成的影响。</p>
</li>
<li>
<p>可重复读 （repeatable read）：该级别保证了在事务中看到的每行的记录的结果是一致的，但是这种级别下有可能发生幻读。</p>
<p>公司规定如果销售额达不到就要扣工资，经理查询小王的销售业绩，发现还差几间房，经理喜上眉梢，把结果打印出来，结果打印出来的结果业绩正好合格，原来小王在这当口又订出去几间房正好填上了这个空缺。这就是幻读造成的影响。</p>
</li>
<li>
<p>串行化（serializable）：该级别下所有的事务都是串行执行的，一个事务执行完了才能执行其它的事务，可以解决所有的并发问题，它是靠大量加锁实现的，所以效率很低下。只有在需要绝对保证数据一致性，并且并发量不大的情况下，可以考虑。</p>
</li>
</ol>
<p>结论：隔离级别越高，性能越差，安全性越高！</p>
<p>MySQL 事务隔离级别相关的命令</p>
<p>查询全局事务隔离级别</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 查询隔离级别      
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#f92672">@@</span>tx_isolation;  
</code></pre></div><p>设置事务隔离级别，需要退出 MySQL 再重新登录才能看到隔离级别的变化</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 设置隔离级别      
</span><span style="color:#75715e"></span><span style="color:#66d9ef">set</span> global transaction isolation level <span style="color:#960050;background-color:#1e0010">级别字符串</span>;   
</code></pre></div><p>脏读的演示</p>
<p>将数据进行恢复：UPDATE account SET balance = 1000;</p>
<ol>
<li>打开 A 窗口登录 MySQL，设置全局的隔离级别为最低</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 登录数据库
</span><span style="color:#75715e"></span>mysql <span style="color:#f92672">-</span>uroot <span style="color:#f92672">-</span>proot 
<span style="color:#75715e">-- 设置编码解决中文乱码
</span><span style="color:#75715e"></span><span style="color:#66d9ef">set</span> names gbk;  
<span style="color:#75715e">-- 设置全局的隔离级别为最低
</span><span style="color:#75715e"></span><span style="color:#66d9ef">set</span> global transaction isolation level <span style="color:#66d9ef">read</span> uncommitted;   
</code></pre></div><p><img src="/img/image-20201224172233786.png" alt="image-20201224172233786"></p>
<ol start="2">
<li>打开 B 窗口,AB 窗口都开启事务</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">use</span> db3;     
start transaction; 
</code></pre></div><p><img src="/img/image-20201224172417316.png" alt="image-20201224172417316"></p>
<ol start="3">
<li>A 窗口更新 2 个人的账户数据，未提交</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">update</span> account <span style="color:#66d9ef">set</span> balance<span style="color:#f92672">=</span>balance<span style="color:#f92672">-</span><span style="color:#ae81ff">500</span> <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>;     
<span style="color:#66d9ef">update</span> account <span style="color:#66d9ef">set</span> balance<span style="color:#f92672">=</span>balance<span style="color:#f92672">+</span><span style="color:#ae81ff">500</span> <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>;               
</code></pre></div><ol start="4">
<li>B 窗口查询账户</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> account;    
</code></pre></div><p><img src="/img/image-20201224172703306.png" alt="image-20201224172703306"></p>
<p><img src="/img/image-20201224172728950.png" alt="image-20201224172728950"></p>
<ol start="5">
<li>A 窗口回滚</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">rollback;     
</code></pre></div><p><img src="/img/image-20201224172830688.png" alt="image-20201224172830688"></p>
<p><img src="/img/image-20201224172851572.png" alt="image-20201224172851572"></p>
<ol start="6">
<li>B 窗口查询账户，钱没了</li>
</ol>
<p>脏读非常危险的，比如张三向李四购买商品，张三开启事务，向李四账号转入 500 块，然后打电话给李四说钱已经转了。李四一查询钱到账了，发货给张三。张三收到货后回滚事务，李四的再查看钱没了。</p>
<p>解决脏读的问题：将全局的隔离级别进行提升，将数据进行恢复：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">UPDATE</span> account <span style="color:#66d9ef">SET</span> balance <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>;  
</code></pre></div><ol>
<li>在 A 窗口设置全局的隔离级别为 read committed</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">set</span> global transaction isolation level <span style="color:#66d9ef">read</span> committed;     
</code></pre></div><p><img src="/img/image-20201224173047830.png" alt="image-20201224173047830"></p>
<p>B 窗口退出 MySQL，B 窗口再进入 MySQL</p>
<p><img src="/img/image-20201224173129021.png" alt="image-20201224173129021"></p>
<p>AB 窗口同时开启事务</p>
<p><img src="/img/image-20201224173304161.png" alt="image-20201224173304161"></p>
<ol start="2">
<li>A 更新 2 个人的账户，未提交</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">update</span> account <span style="color:#66d9ef">set</span> balance<span style="color:#f92672">=</span>balance<span style="color:#f92672">-</span><span style="color:#ae81ff">500</span> <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>;     
<span style="color:#66d9ef">update</span> account <span style="color:#66d9ef">set</span> balance<span style="color:#f92672">=</span>balance<span style="color:#f92672">+</span><span style="color:#ae81ff">500</span> <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>;  
</code></pre></div><p><img src="/img/image-20201224173359249.png" alt="image-20201224173359249"></p>
<ol start="3">
<li>B 窗口查询账户</li>
</ol>
<p><img src="/img/image-20201224173414929.png" alt="image-20201224173414929"></p>
<p>A 窗口 commit 提交事务</p>
<p><img src="/img/image-20201224173446130.png" alt="image-20201224173446130"></p>
<ol start="4">
<li>B 窗口查看账户</li>
</ol>
<p><img src="/img/image-20201224173505723.png" alt="image-20201224173505723"></p>
<p>结论：read committed 的方式可以避免脏读的发生</p>
<p>不可重复读的演示</p>
<p>将数据进行恢复：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">UPDATE</span> account <span style="color:#66d9ef">SET</span> balance <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>;
</code></pre></div><ol>
<li>开启 A 窗口</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">set</span> global transaction isolation level <span style="color:#66d9ef">read</span> committed;    
</code></pre></div><p>​      <img src="/img/image-20201224173643466.png" alt="image-20201224173643466"></p>
<ol start="2">
<li>开启 B 窗口，在 B 窗口开启事务</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">start transaction; 
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> account;     
</code></pre></div><p><img src="/img/image-20201224173700065.png" alt="image-20201224173700065"></p>
<ol start="3">
<li>在 A 窗口开启事务，并更新数据</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"> start transaction;     
 <span style="color:#66d9ef">update</span> account <span style="color:#66d9ef">set</span> balance<span style="color:#f92672">=</span>balance<span style="color:#f92672">+</span><span style="color:#ae81ff">500</span> <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>;     
 commit;   
</code></pre></div><p>​       <img src="/img/image-20201224173819323.png" alt="image-20201224173819323"></p>
<ol start="4">
<li>B 窗口查询</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> account;     
</code></pre></div><p><img src="/img/image-20201224173859230.png" alt="image-20201224173859230"></p>
<p>两次查询输出的结果不同，到底哪次是对的？不知道以哪次为准。 很多人认为这种情况就对了，无须困惑，当然是后面的为准。我们可以考虑这样一种情况，比如银行程序需要将查询结果分别输出到电脑屏幕和发短信给客户，结果在一个事务中针对不同的输出目的地进行的两次查询不一致，导致文件和屏幕中的结果不一致，银行工作人员就不知道以哪个为准了。</p>
<p>解决不可重复读的问题：将全局的隔离级别进行提升为：repeatable read</p>
<p>将数据进行恢复：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">UPDATE</span> account <span style="color:#66d9ef">SET</span> balance <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>;         
</code></pre></div><ol>
<li>A 窗口设置隔离级别为：repeatable read</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">set</span> global transaction isolation level repeatable <span style="color:#66d9ef">read</span>; 
</code></pre></div><p><img src="/img/image-20201224174017251.png" alt="image-20201224174017251"></p>
<ol start="2">
<li>B 窗口退出 MySQL，B 窗口再进入 MySQL</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">start transaction; 
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> account;  
</code></pre></div><p><img src="/img/image-20201224174056359.png" alt="image-20201224174056359"></p>
<ol start="3">
<li>A 窗口更新数据</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">start transaction;     
<span style="color:#66d9ef">update</span> account <span style="color:#66d9ef">set</span> balance<span style="color:#f92672">=</span>balance<span style="color:#f92672">+</span><span style="color:#ae81ff">500</span> <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>;     
commit;
</code></pre></div><p><img src="/img/image-20201224174119480.png" alt="image-20201224174119480"></p>
<ol start="4">
<li>B 窗口查询</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> account;  
</code></pre></div><p><img src="/img/image-20201224174229917.png" alt="image-20201224174229917"></p>
<p><img src="/img/image-20201224174301317.png" alt="image-20201224174301317"></p>
<p>结论：同一个事务中为了保证多次查询数据一致，必须使用 repeatable read 隔离级别</p>
<p><img src="/img/image-20201224174349794.png" alt="image-20201224174349794"></p>
<p>幻读的演示</p>
<p>在 MySQL 中无法看到幻读的效果。</p>
<p>但我们可以将事务隔离级别设置到最高，以挡住幻读的发生 将数据进行恢复：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">UPDATE</span> account <span style="color:#66d9ef">SET</span> balance <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>;     
</code></pre></div><ol>
<li>开启 A 窗口</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 设置隔离级别为最高 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">set</span> global transaction isolation level serializable;       
</code></pre></div><ol start="2">
<li>A 窗口退出 MySQL，A 窗口重新登录 MySQL</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">start transaction;     
<span style="color:#66d9ef">select</span> <span style="color:#a6e22e">count</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">from</span> account;    
</code></pre></div><p>​      <img src="/img/image-20201224174511259.png" alt="image-20201224174511259"></p>
<ol start="3">
<li>
<p>再开启 B 窗口，登录 MySQL</p>
</li>
<li>
<p>在 B 窗口中开启事务，添加一条记录</p>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#75715e">-- 开启事务
</span><span style="color:#75715e"></span>start transaction;      
<span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> <span style="color:#a6e22e">account</span> (name,balance) <span style="color:#66d9ef">values</span> (<span style="color:#e6db74">&#39;老王&#39;</span>, <span style="color:#ae81ff">500</span>);    
</code></pre></div><p><img src="/img/image-20201224174552910.png" alt="image-20201224174552910"></p>
<ol start="5">
<li>在 A 窗口中 commit 提交事务，B 窗口中 insert 语句会在 A 窗口事务提交后立马运行</li>
</ol>
<p><img src="/img/image-20201224174618233.png" alt="image-20201224174618233"></p>
<ol start="6">
<li>在 A 窗口中接着查询，发现数据不变</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">select</span> <span style="color:#a6e22e">count</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">from</span> account;  
</code></pre></div><p><img src="/img/image-20201224174638309.png" alt="image-20201224174638309"></p>
<ol start="7">
<li>B 窗口中 commit 提交当前事务</li>
</ol>
<p><img src="/img/image-20201224174709809.png" alt="image-20201224174709809"></p>
<ol start="8">
<li>A 窗口就能看到最新的数据</li>
</ol>
<p>​       <img src="/img/image-20201224174752246.png" alt="image-20201224174752246"></p>
<p>结论：使用 serializable 隔离级别，一个事务没有执行完，其他事务的 SQL 执行不了，可以挡住幻读</p>
<h4 id="34-dcl-data-control-language">3.4 DCL (Data Control Language)</h4>
<p>我们现在默认使用的都是 root 用户，超级管理员，拥有全部的权限。但是，一个公司里面的数据库服务器上面可能同时运行着很多个项目的数据库。所以，我们应该可以根据不同的项目建立不同的用户，分配不同的权限来管理和维护数据库。</p>
<p><img src="/img/image-20201224174831894.png" alt="image-20201224174831894"></p>
<h5 id="创建用户">创建用户</h5>
<p>语法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">USER</span> <span style="color:#e6db74">&#39;用户名&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;主机名&#39;</span> <span style="color:#66d9ef">IDENTIFIED</span> <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;密码&#39;</span>;                             
</code></pre></div><p>关键字说明：</p>
<table>
<thead>
<tr>
<th>关键字</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>用户名</td>
<td>将创建的用户名</td>
</tr>
<tr>
<td>主机名</td>
<td>指定该用户在哪个主机上可以登陆，<!-- raw HTML omitted -->如果是本地用户可用 localhost，<!-- raw HTML omitted -->如果想让该用户可以从任意远程主机登陆，可以使用通配符%</td>
</tr>
<tr>
<td>密码</td>
<td>该用户的登陆密码，密码可以为空，如果为空则该用户可以不需要密码登陆服务器</td>
</tr>
</tbody>
</table>
<p>具体操作：</p>
<p>创建 user1 用户，只能在 localhost 这个服务器登录 mysql 服务器，密码为 123</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">user</span> <span style="color:#e6db74">&#39;user1&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span> <span style="color:#66d9ef">identified</span> <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;123&#39;</span>;  
</code></pre></div><p>创建 user2 用户可以在任何电脑上登录 mysql 服务器，密码为 123</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">user</span> <span style="color:#e6db74">&#39;user2&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> <span style="color:#66d9ef">identified</span> <span style="color:#66d9ef">by</span> <span style="color:#e6db74">&#39;123&#39;</span>;        
</code></pre></div><p>注：创建的用户名都在 mysql 数据库中的 user 表中可以查看到，密码经过了加密。</p>
<p><img src="/img/image-20201224175010335.png" alt="image-20201224175010335"></p>
<h5 id="给用户授权">给用户授权</h5>
<p>用户创建之后，没什么权限！需要给用户授权</p>
<p>语法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">GRANT</span> <span style="color:#960050;background-color:#1e0010">权限</span><span style="color:#ae81ff">1</span>, <span style="color:#960050;background-color:#1e0010">权限</span><span style="color:#ae81ff">2</span>... <span style="color:#66d9ef">ON</span> <span style="color:#960050;background-color:#1e0010">数据库名</span>.<span style="color:#960050;background-color:#1e0010">表名</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;用户名&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;主机名&#39;</span>;   
</code></pre></div><p>关键字说明：</p>
<table>
<thead>
<tr>
<th>关键字</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>GRANT…ON…TO</td>
<td>授权关键字</td>
</tr>
<tr>
<td>权限</td>
<td>授予用户的权限，如 CREATE、ALTER、SELECT、INSERT、UPDATE 等。<!-- raw HTML omitted -->如果要授予所有的权限则使用 ALL</td>
</tr>
<tr>
<td>数据库名.表名</td>
<td>该用户可以操作哪个数据库的哪些表。<!-- raw HTML omitted -->如果要授予该用户对所有数据库和表的相应操作权限则可用*表示，如*.*</td>
</tr>
<tr>
<td>&lsquo;用户名&rsquo;@&lsquo;主机名&rsquo;</td>
<td>给哪个用户授权，注：有 2 对单引号</td>
</tr>
</tbody>
</table>
<p>具体操作：</p>
<ol>
<li>给 user1 用户分配对 test 这个数据库操作的权限：创建表，修改表，插入记录，更新记录，查询</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">grant</span> <span style="color:#66d9ef">create</span>,<span style="color:#66d9ef">alter</span>,<span style="color:#66d9ef">insert</span>,<span style="color:#66d9ef">update</span>,<span style="color:#66d9ef">select</span> <span style="color:#66d9ef">on</span> test.<span style="color:#f92672">*</span> <span style="color:#66d9ef">to</span> <span style="color:#e6db74">&#39;user1&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span>; 
</code></pre></div><p>注：用户名和主机名要与上面创建的相同，要加单引号。</p>
<ol start="2">
<li>给 user2 用户分配所有权限，对所有数据库的所有表</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">grant</span> <span style="color:#66d9ef">all</span> <span style="color:#66d9ef">on</span> . <span style="color:#66d9ef">to</span> <span style="color:#e6db74">&#39;user2&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span>;    
</code></pre></div><p>​</p>
<h5 id="撤销授权">撤销授权</h5>
<p>语法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">REVOKE</span>  <span style="color:#960050;background-color:#1e0010">权限</span><span style="color:#ae81ff">1</span>, <span style="color:#960050;background-color:#1e0010">权限</span><span style="color:#ae81ff">2</span>... <span style="color:#66d9ef">ON</span> <span style="color:#960050;background-color:#1e0010">数据库</span>.<span style="color:#960050;background-color:#1e0010">表名</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;用户名&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;主机名&#39;</span>;  

<span style="color:#66d9ef">revoke</span> <span style="color:#66d9ef">all</span> <span style="color:#66d9ef">on</span> test.<span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;user1&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span>;
</code></pre></div><table>
<thead>
<tr>
<th>关键字</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>REVOKE…ON…FROM</td>
<td>撤销授权的关键字</td>
</tr>
<tr>
<td>权限</td>
<td>用户的权限，如 CREATE、ALTER、SELECT、INSERT、UPDATE  等，<!-- raw HTML omitted -->所有的权限则使用 ALL</td>
</tr>
<tr>
<td>数据库名.表名</td>
<td>对哪些数据库的哪些表，<!-- raw HTML omitted -->如果要取消该用户对所有数据库和表的操作权限则可用*表示，如*.*</td>
</tr>
<tr>
<td>&lsquo;用户名&rsquo;@&lsquo;主机名&rsquo;</td>
<td>给哪个用户撤销</td>
</tr>
</tbody>
</table>
<p>具体操作：</p>
<p>撤销 user1 用户对 test 数据库所有表的操作的权限</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">revoke</span> <span style="color:#66d9ef">all</span> <span style="color:#66d9ef">on</span> test.<span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#39;user1&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;localhost&#39;</span>;   
</code></pre></div><p>注：用户名和主机名要与创建时相同，各自要加上单引号</p>
<h5 id="查看权限">查看权限</h5>
<p>语法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">SHOW</span> GRANTS <span style="color:#66d9ef">FOR</span> <span style="color:#e6db74">&#39;用户名&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;主机名&#39;</span>;                
</code></pre></div><p>具体操作：</p>
<p>查看 user1 用户的权限</p>
<p><img src="/img/image-20201224175314434.png" alt="image-20201224175314434"></p>
<p>注：usage 是指连接（登陆）权限，建立一个用户，就会自动授予其 usage 权限（默认授予）。</p>
<h5 id="删除用户">删除用户</h5>
<p>语法</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">USER</span> <span style="color:#e6db74">&#39;用户名&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;主机名&#39;</span>;   
</code></pre></div><p>​        <img src="/img/image-20201224175529284.png" alt="image-20201224175529284"></p>
<p>具体操作：</p>
<p>删除 user2</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">drop</span> <span style="color:#66d9ef">user</span> <span style="color:#e6db74">&#39;user2&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span>;  
</code></pre></div><p>​</p>
<h5 id="修改管理员密码">修改管理员密码</h5>
<p>语法</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">mysqladmin <span style="color:#f92672">-</span>uroot <span style="color:#f92672">-</span>p password <span style="color:#960050;background-color:#1e0010">新密码</span>   
</code></pre></div><p>​             <img src="/img/image-20201224175555196.png" alt="image-20201224175555196"></p>
<p>注意：需要在未登陆 MySQL 的情况下操作，新密码不需要加上引号。</p>
<p>具体操作：</p>
<p>​	1)  将 root 管理员的新密码改成 123456</p>
<p>​	2)  要求输入旧密码</p>
<p>​	3)  使用新密码登录</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">Mysqladmin <span style="color:#960050;background-color:#1e0010">–</span>uroot <span style="color:#960050;background-color:#1e0010">–</span>p password <span style="color:#ae81ff">123456</span>
</code></pre></div><h5 id="修改普通用户密码">修改普通用户密码</h5>
<p>语法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#66d9ef">set</span> password <span style="color:#66d9ef">for</span> <span style="color:#e6db74">&#39;用户名&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;主机名&#39;</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">password</span>(<span style="color:#e6db74">&#39;新密码&#39;</span>);  
</code></pre></div><p>注意：需要在登陆 MySQL 的情况下操作，新密码要加单引号。</p>
<p>具体操作：</p>
<p>​	1)   将&rsquo;user1&rsquo;@&lsquo;localhost'的密码改成&rsquo;666666&rsquo;</p>
<p>​	2)   使用新密码登录，老密码登录不了</p>
<p><img src="/img/image-20201224175739695.png" alt="image-20201224175739695"></p>
</div>
  
</article></main>
<footer class="footer">
  <span>&copy; 2021 <a href="https://xshi000.github.io/">及时当勉励，岁月不待人！@iNuo</a></span>
  <span>&middot;</span>
  <span>Powered by <a href="https://gohugo.io/" rel="noopener" target="_blank">Hugo️️</a>️</span>
  <span>&middot;</span>
  <span>Theme️ <a href="https://github.com/nanxiaobei/hugo-paper" rel="noopener" target="_blank">Paper</a></span>
</footer>
<script src="https://xshi000.github.io/highlight.min.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>
</body>
</html>

